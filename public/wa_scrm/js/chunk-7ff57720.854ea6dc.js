(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ff57720"],{"0ddd":function(e,t,a){"use strict";a("66fe")},"27b5":function(e,t,a){"use strict";a("28c0")},"28c0":function(e,t,a){},"3c2e":function(e,t,a){"use strict";a("9ddf")},"652c":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Attribute"},[t("section",{staticClass:"section"},[t("div",{staticClass:"total"},[t("a-form-model",{ref:"ruleForm",staticClass:"ant-advanced-search-form",attrs:{form:e.form,layout:"inline"}},[t("a-form-model-item",{attrs:{label:"Task  Name",name:"TaskName"}},[t("a-input",{attrs:{placeholder:"place input",size:"large",allowClear:""},model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName",t)},expression:"form.taskName"}})],1),t("a-form-model-item",[t("a-button",{attrs:{type:"primary"},on:{click:e.searchList}},[e._v("Search")]),t("a-button",{style:{marginLeft:"8px"},on:{click:e.clearFn}},[e._v("Clear")])],1)],1),t("a-button",{staticClass:"btn",attrs:{type:"primary",size:"large",disabled:e.Actions},on:{click:e.addBtn}},[e._v("Add")])],1),t("div",[t("a-table",{staticClass:"table",attrs:{columns:e.columns,rowKey:"id",loading:e.loading,dataSource:e.clientList,pagination:e.pagination},on:{change:e.changeTab},scopedSlots:e._u([{key:"messageContent",fn:function(a,s){return t("div",{},["1"==s.messageType?t("div",{domProps:{innerHTML:e._s(s.messageContent)}}):e._e(),"2"==s.messageType?t("img",{staticClass:"img",attrs:{src:s.messageContent}}):e._e()])}},{key:"status",fn:function(a){return t("div",{},[e._v(e._s("1"==a?"Enable":"Disable"))])}},{key:"Edit",fn:function(a,s){return t("div",{},[t("a-button",{attrs:{type:"link",disabled:e.Actions},on:{click:function(t){return e.editPage(s)}}},[e._v("Edit")]),e._v("  "),"1"==s.status?t("a-button",{attrs:{type:"link",disabled:e.Actions},on:{click:function(t){return e.toOperation(s)}}},[e._v("Disable")]):e._e(),e._v("  "),"2"==s.status?t("a-button",{attrs:{type:"link",disabled:e.Actions},on:{click:function(t){return e.toOperation(s)}}},[e._v("Enable")]):e._e(),e._v("  "),t("a-button",{attrs:{type:"link",disabled:e.Actions},on:{click:function(t){return e.deletePage(s)}}},[e._v("Delete")])],1)}}])})],1)]),t("a-modal",{attrs:{footer:null,destroyOnClose:"",width:"800px",centered:""},model:{value:e.AddBox,callback:function(t){e.AddBox=t},expression:"AddBox"}},[t("addReply",{attrs:{addType:e.addType,timestamp:e.timestamp,modalFormObj:e.modalFormObj},on:{successBack:e.successBack,cancelBack:e.cancelBack}})],1),t("a-modal",{attrs:{destroyOnClose:"",confirmLoading:e.confirmLoading,width:"500px",centered:""},on:{cancel:function(t){e.DisableBox=!1},ok:e.editAutoReplySure},model:{value:e.DisableBox,callback:function(t){e.DisableBox=t},expression:"DisableBox"}},[t("div",{staticClass:"panel"},[t("h2",{staticClass:"dialog-title"},[e._v(e._s("Disable"===e.disableType?"Disable":"Enable")+" autoresponder")]),"Disable"===e.disableType?t("p",[e._v("After disabling, the keyword will not trigger an autoresponder, please make sure if you need to disable it?")]):t("p",[e._v("When enabled, this keyword will trigger an auto-response, please make sure if you need to enable it?")])])])],1)},i=[],n=a("5530"),o=(a("d3b7"),a("ac1f"),a("5319"),a("25f0"),a("d81d"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"panel"},[t("h2",{staticClass:"dialog-title"},[e._v(e._s("add"===e.addType?"Add":"Edit")+" auto-response")]),t("a-form-model",e._b({ref:"ruleForm",attrs:{rules:e.rules,model:e.modalForm}},"a-form-model",e.layout,!1),[t("a-form-model-item",{attrs:{label:"Task Name",prop:"taskName"}},[t("a-input",{attrs:{placeholder:"place input",maxLength:20},model:{value:e.modalForm.taskName,callback:function(t){e.$set(e.modalForm,"taskName",t)},expression:"modalForm.taskName"}})],1),t("a-form-model-item",{attrs:{label:"Keywords",prop:"keyword"}},[t("a-textarea",{attrs:{placeholder:"Please enter keywords, multiple words separated by '|'",rows:4,maxLength:250},model:{value:e.modalForm.keyword,callback:function(t){e.$set(e.modalForm,"keyword",t)},expression:"modalForm.keyword"}})],1),t("a-form-model-item",{attrs:{label:"Matching mode",prop:"matchMode"}},[t("div",{staticClass:"flex"},[t("div",{class:["1"==e.modalForm.matchMode?"active":"","a-btn"],on:{click:function(t){return e.modeTab("1")}}},[e._v("Contains all words")]),t("div",{class:["2"==e.modalForm.matchMode?"active":"","a-btn"],on:{click:function(t){return e.modeTab("2")}}},[e._v("Include any word")]),t("a-tooltip",[t("template",{slot:"title"},[t("div",[e._v("Description")]),t("div",[e._v("1、Include all words")]),t("div",[e._v("Only when a message sent by the user contains all words, it will trigger an automatic reply.")]),t("br"),t("div",[e._v("2、Include any words")]),t("div",[e._v("Set multiple keywords, as long as it contains any keyword, it will trigger the auto-reply.")]),t("br")]),t("a-icon",{attrs:{type:"question-circle"}})],2)],1)]),t("a-form-model-item",{attrs:{label:"Message Type",prop:"messageType"}},[t("a-select",{staticClass:"w-200",attrs:{placeholder:"place select",disabled:"edit"==e.addType},model:{value:e.modalForm.messageType,callback:function(t){e.$set(e.modalForm,"messageType",t)},expression:"modalForm.messageType"}},[t("a-select-option",{attrs:{value:"1"}},[e._v("Text")]),t("a-select-option",{attrs:{value:"2"}},[e._v("Picture")])],1)],1),"1"==e.modalForm.messageType?t("a-form-model-item",{attrs:{label:"Message content",prop:"messageContent"}},[t("div",[t("div",{staticClass:"reason-box"},[t("Contenteditable",{ref:"contenteditable",attrs:{maxLength:e.maxLength,url:e.url},model:{value:e.modalForm.messageContent,callback:function(t){e.$set(e.modalForm,"messageContent",t)},expression:"modalForm.messageContent"}}),t("div",{staticClass:"reason-tip"},[e._v(e._s(e.contentOne.length)+"/"+e._s(e.maxLength))])],1),t("div",{staticClass:"url-box"},[t("div",[e._v("Insert URL")]),t("div",{staticClass:"flex"},[t("div",[e._v("URL：")]),t("a-input",{attrs:{placeholder:"place input"},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),t("a-button",{staticClass:"url-btn",attrs:{type:"primary"},on:{click:e.insertNickname}},[e._v("Determine")])],1)])])]):e._e(),"2"==e.modalForm.messageType?t("a-form-model-item",{attrs:{label:"Message content",prop:"cusServiceObj"}},[t("UpDateImg",{attrs:{timestamp:e.timestampImg,url:e.modalForm.messageContent,title:"Upload pictures"},model:{value:e.cusServiceObj,callback:function(t){e.cusServiceObj=t},expression:"cusServiceObj"}})],1):e._e()],1),t("div",{staticClass:"footer"},[t("a-button",{staticClass:"url-btn",attrs:{size:"large"},on:{click:e.cancelBtn}},[e._v("cancel")]),t("a-button",{staticClass:"url-btn",attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submitBtn}},[e._v("save")])],1)],1)}),r=[],l=a("c7eb"),c=a("1da1"),d=(a("a9e3"),a("b0c0"),a("4d63"),a("466d"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"textarea",class:e.classNmae,attrs:{contenteditable:"true",maxLength:"maxLength","data-form-type":"reason","data-placeholder":"place input"},domProps:{innerHTML:e._s(e.innerText)},on:{blur:e.textareaBlur,input:e.changeText}})}),m=[],u={name:"Contenteditable",props:{classNmae:{type:String,default:"link-textarea"},value:{type:String,default:""},maxLength:{type:[String,Number],default:""},url:{type:String,default:""}},computed:{state:function(){return this.$route.query.state}},data:function(){return{innerText:"",isLocked:!0,sel:null,range:null,textareaElement:"",num:0}},watch:{value:{handler:function(){"add"!==this.state&&this.isLocked&&this.value&&(this.innerText=this.value,this.isLocked=!1)},immediate:!0},classNmae:{handler:function(){this.textareaElement=document.querySelector(this.classNmae),this.textareaElement&&(this.textareaElement.focus(),this.textareaElement.blur())},immediate:!0}},methods:{keepLastIndex:function(e){e&&this.$nextTick((function(){if(window.getSelection){e.focus();var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()}else if(document.selection){t=document.selection.createRange();t.moveToElementText(e),t.collapse(!1),t.select()}}))},textareaBlur:function(){this.sel=window.getSelection(),this.range=this.sel.getRangeAt(0),this.range.deleteContents()},changeText:function(e){var t=this;this.controlMaxlength(e.target.innerHTML,e),this.$nextTick((function(){t.$emit("input",t.checkInnerHtml(t.$el.innerHTML))}))},controlMaxlength:function(e,t){(null===e||void 0===e?void 0:e.length)>this.maxLength&&(this.innerText=e.substring(0,this.maxLength-this.num),this.num++,this.num>6&&(this.num=0)),this.textareaElement=document.querySelector(".link-textarea"),this.keepLastIndex(this.textareaElement)},checkInnerHtml:function(e){var t=/<a[^>]*>([\s\S]*?)<\/a>/i,a=e.match(t),s=e;return a&&a[1]!==this.url&&(this.innerText=s,this.keepLastIndex(this.textareaElement)),s},insertHtmlAtCaret:function(e){try{if(window.getSelection){if(this.sel.getRangeAt&&this.sel.rangeCount){var t=document.createDocumentFragment(),a=t.appendChild(e),s=document.createElement("div");s.innerHTML="&#8203",a=t.appendChild(s.firstChild),this.range.insertNode(t),a&&(this.range=this.range.cloneRange(),this.range.setStartAfter(a),this.range.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(this.range),this.$emit("input",this.$el.innerHTML))}}else document.selection&&"Control"!=document.selection.type&&(document.selection.createRange().pasteHTML(html),this.$emit("input",this.$el.innerHTML))}catch(i){this.$message.warning("Please select the position to insert")}}}},p=u,g=(a("3c2e"),a("2877")),h=Object(g["a"])(p,d,m,!1,null,"164e3fa0",null),f=h.exports,b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"qrcode-wrap"},[t("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card",accept:e.accept,disabled:e.isDisabled,"file-list":e.fileList,customRequest:e.customRequest,"before-upload":e.beforeUpload},on:{preview:e.handlePreview,change:e.handleChange}},[t("div",[t("a-icon",{attrs:{type:"plus"}}),t("div",{staticClass:"ant-upload-text"},[e._v(" "+e._s(e.imageUrl?"Reselect":e.titleName)+" ")])],1)]),t("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:function(t){e.previewVisible=!1}}},[t("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.imageUrl}})])],1)},v=[],y={name:"UpDateImg",props:["value","url","title","isDisabled","articleFile","timestamp"],data:function(){return{accept:".jpg,.png,",previewVisible:!1,imageUrl:"",titleName:this.title||"Upload pictures",fileList:[]}},watch:{url:{handler:function(){this.url&&(this.fileList[0]={uid:"-1",name:"image.png",status:"done",url:this.url},this.imageUrl=this.url)},immediate:!0},articleFile:{handler:function(){var e=this;this.articleFile&&this.getBase64(this.articleFile,(function(t){e.fileList[0]={uid:"-1",name:"image.png",status:"done",url:e.imageUrl},e.imageUrl=t}))},immediate:!0},timestamp:{immediate:!0,handler:function(e,t){this.url?(this.fileList[0]={uid:"-1",name:"image.png",status:"done",url:this.url},this.imageUrl=this.url):(this.fileList=[],this.imageUrl="")}}},methods:{beforeUpload:function(e){var t=e.size/1024/1024<2,a="image/jpeg"==e.type||"image/jpg"==e.type||"image/png"==e.type;return t?a?t||a:(this.$message.warning("Uploaded pictures can only be in JPG, JPEG or PNG format!"),!1):(this.$message.error("The maximum upload size cannot exceed 2M"),!1)},customRequest:function(e){e.onSuccess()},handlePreview:function(e){this.previewVisible=!0},getBase64:function(e,t){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.readAsDataURL(e)},handleChange:function(e){var t,a,s=this;"uploading"===e.file.status&&(this.getBase64(e.file.originFileObj,(function(e){s.imageUrl=e})),this.fileList=[e.fileList[e.fileList.length-1]],this.fileList[0].status="done"),"removed"===e.file.status&&(this.fileList=[],this.imageUrl=""),this.$emit("imageChange",null===e||void 0===e||null===(t=e.fileList[e.fileList.length-1])||void 0===t?void 0:t.originFileObj),this.$emit("input",null===e||void 0===e||null===(a=e.fileList[e.fileList.length-1])||void 0===a?void 0:a.originFileObj)}}},x=y,k=(a("d8d4"),Object(g["a"])(x,b,v,!1,null,"058cd600",null)),w=k.exports,T=a("b775"),C={getAutoReplyList:"/autoreply/getAutoReplyList",addAutoReply:"/autoreply/addAutoReply",editAutoReply:"/autoreply/editAutoReply"};function F(e){return Object(T["b"])({url:C.getAutoReplyList,method:"post",data:e})}function L(e){return Object(T["b"])({url:C.addAutoReply,method:"post",data:e})}function O(e){return Object(T["b"])({url:C.editAutoReply,method:"post",data:e})}var _=a("7858"),A={props:{timestamp:{type:Number,default:null},addType:{typeof:String,default:"add"},modalFormObj:{typeof:Object,default:function(){return{}}}},components:{Contenteditable:f,UpDateImg:w},data:function(){return{loading:!1,cusServiceObj:void 0,timestampImg:void 0,maxLength:5e3,layout:{labelCol:{span:4},wrapperCol:{span:18}},url:void 0,modalForm:Object.assign({},this.modalFormObj),rules:{taskName:[{required:!0,message:"Please input Task Name"}],keyword:[{required:!0,message:"Please input Keywords"}],matchMode:[{required:!0,message:"Please input Keywords"}],messageType:[{required:!0,message:"Please select Message Type"}],messageContent:[{required:!0,message:"Please input Message content"}]}}},methods:{imgUpate:function(){var e=this;return new Promise((function(t){var a=e.cusServiceObj;if(a){var s=a.name.lastIndexOf("."),i=a.name.substring(s+1),n=Object(_["c"])()+i;_["b"].put(_["a"]+n,a).then((function(t){e.$set(e.modalForm,"messageContent",t.url)})).catch((function(t){e.$message.error(t)})).finally((function(){t()}))}else t()}))},cancelBtn:function(){this.$emit("cancelBack")},submitBtn:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;e.confirmLoading=!0,e.modalForm.id?e.editAutoReply():e.addAutoReply()}))},addAutoReply:function(){var e=this;return Object(c["a"])(Object(l["a"])().mark((function t(){var a,s;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("2"!=e.modalForm.messageType){t.next=3;break}return t.next=3,e.imgUpate();case 3:if(a=e.modalForm.messageContent,"1"==e.modalForm.messageType&&e.modalForm.messageContent&&(a=e.modalForm.messageContent.replace(/<a>/g," ").replace(/<\/a>/g," ").replace(/<br>/g,"").replace(/<[^>]+>/gi,"").replace(/&amp;/g,"&")),s={keyword:e.modalForm.keyword,matchMode:e.modalForm.matchMode,messageContent:a,messageType:e.modalForm.messageType,taskName:e.modalForm.taskName},e.modalForm.messageContent||"2"!=e.modalForm.messageType){t.next=10;break}return e.$message.warning("Please upload the picture"),e.confirmLoading=!1,t.abrupt("return");case 10:e.loading=!0,L(s).then((function(t){e.$emit("successBack"),e.$message.success("success")})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1,e.confirmLoading=!1}));case 12:case"end":return t.stop()}}),t)})))()},editAutoReply:function(){var e=this;return Object(c["a"])(Object(l["a"])().mark((function t(){var a,s;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("2"!=e.modalForm.messageType){t.next=3;break}return t.next=3,e.imgUpate();case 3:if(a=e.modalForm.messageContent,"1"==e.modalForm.messageType&&e.modalForm.messageContent&&(a=e.modalForm.messageContent.replace(/<a>/g," ").replace(/<\/a>/g," ").replace(/<br>/g,"").replace(/<[^>]+>/gi,"")),s={id:e.modalForm.id,keyword:e.modalForm.keyword,matchMode:e.modalForm.matchMode,messageContent:a,messageType:e.modalForm.messageType,taskName:e.modalForm.taskName},e.modalForm.messageContent||"2"!=e.modalForm.messageType){t.next=10;break}return e.$message.warning("Please upload the picture"),e.confirmLoading=!1,t.abrupt("return");case 10:e.loading=!0,O(s).then((function(t){e.$emit("successBack"),e.$message.success("success")})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1,e.confirmLoading=!1}));case 12:case"end":return t.stop()}}),t)})))()},urlVerification:function(e){var t=!1,a=new RegExp("(http://|https://)?((?:[A-Za-z0-9]+-[A-Za-z0-9]+|[A-Za-z0-9]+).)+([A-Za-z]+)[/?:]?.");return""!=e&&void 0!=e&&null!=e.match(a)&&(t=!0),t},insertNickname:function(){if(this.url){var e=this.urlVerification(this.url);if(e){var t=document.createElement("a");t.innerHTML=this.url,this.$refs.contenteditable.insertHtmlAtCaret(t)}else this.$message.warning("url invalid")}else this.$message.warning("Please input url")},modeTab:function(e){this.$set(this.modalForm,"matchMode",e)}},computed:{contentOne:function(){var e;return(null===(e=this.modalForm.messageContent)||void 0===e?void 0:e.replace(/<a class="nick-name"><\/a>/g,"#"))||""}},watch:{timestamp:{handler:function(){if("add"==this.addType)this.modalForm={};else{this.addType="edit",this.modalForm=Object.assign({},this.modalFormObj);var e=String(this.modalFormObj.messageType);if("1"==e){var t=this.modalFormObj.messageContent+" ";this.$set(this.modalForm,"messageContent",t)}this.$set(this.modalForm,"messageType",e)}},immediate:!0}}},$=A,j=(a("27b5"),Object(g["a"])($,o,r,!1,null,"181049af",null)),R=j.exports,S={name:"AutoReply",components:{addReply:R},data:function(){return{userList:[],AddBox:!1,DisableBox:!1,disableType:"Disable",fetching:!1,loading:!1,addType:"add",pagination:{current:1,pageSize:10,total:0},addTxt:"",form:{contactName:void 0,propertiesValue:void 0},clientList:[],columns:[{title:"Task name",dataIndex:"taskName"},{title:"Matching mode",dataIndex:"matchModeTxt"},{title:"Keyword",dataIndex:"keyword",width:"300px"},{title:"Message content",dataIndex:"messageContent",width:"300px",scopedSlots:{customRender:"messageContent"}},{title:"Created by",dataIndex:"creator",customRender:function(e){return e||"-"}},{title:"Status",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"Actions",dataIndex:"Edit",scopedSlots:{customRender:"Edit"}}],confirmLoading:!1,tagList:[],modalFormObj:{},timestamp:void 0,OperationObj:{}}},created:function(){this.getList()},computed:{Actions:function(){return!this.$route.meta.Actions}},methods:{deletePage:function(e){var t=this;this.$confirm({title:"tip",icon:"",cancelText:"cancel",okText:"delete",content:"After confirming the deletion, the autoReply will be deleted",onOk:function(){t.contactsDeleteFun(e)}})},contactsDeleteFun:function(e){var t=this,a={id:e.id,isDeleted:1};O(a).then((function(e){t.$message.success("success"),t.getList()})).catch((function(e){t.$message.error(e)}))},cancelBack:function(){this.AddBox=!1},successBack:function(){this.AddBox=!1,this.getList()},toOperation:function(e){"1"==e.status?this.disableType="Disable":this.disableType="Enable",this.OperationObj=e,this.DisableBox=!0},editAutoReplySure:function(){var e=this,t="1"==this.OperationObj.status?2:1;this.confirmLoading=!0;var a={id:this.OperationObj.id,status:t};O(a).then((function(t){e.getList(),e.$message.success("success")})).catch((function(t){e.$message.error(t)})).finally((function(){e.confirmLoading=!1,e.DisableBox=!1}))},clearFn:function(){this.form={taskName:void 0},this.searchList()},breakStr:function(e){var t=/(\r\n)|(\n)|(\↵)/g;e=e.toString().replace(t,"");var a=/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g;return e=e.replace(a,"<a>$1$2</a>"),e},getList:function(){var e=this,t=Object(n["a"])({currentPage:this.pagination.current,pageSize:this.pagination.pageSize},this.form);this.loading=!0,F(t).then((function(t){var a;e.clientList=null===(a=t.data.records)||void 0===a?void 0:a.map((function(t){var a,s;return"1"==t.matchMode?a="Contains all words":"2"==t.matchMode?a="Include any word":"3"==t.matchMode&&(a="Ignore matching words"),"1"==t.messageType?s="Text":"2"==t.messageType&&(s="Picture"),"1"==t.messageType&&(t.messageContent=e.breakStr(t.messageContent)),Object(n["a"])(Object(n["a"])({},t),{},{createTime:t.createTime?e.$moment(t.createTime).format("YYYY-MM-DD HH:mm:ss"):"-",matchModeTxt:a,messageContent:t.messageContent,messageTypeTxt:s})})),e.pagination.total=t.data.total})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}))},searchList:function(){this.pagination.current=1,this.getList()},editPage:function(e){this.addType="edit",this.timestamp=(new Date).getTime(),this.modalFormObj=e,this.AddBox=!0},addBtn:function(){this.addType="add",this.timestamp=(new Date).getTime(),this.AddBox=!0},changeTab:function(e){var t=e.current;this.pagination.current=t,this.getList()}}},M=S,B=(a("0ddd"),Object(g["a"])(M,s,i,!1,null,"7009cfc6",null));t["default"]=B.exports},"66fe":function(e,t,a){},"7dcd":function(e,t,a){},"9ddf":function(e,t,a){},d8d4:function(e,t,a){"use strict";a("7dcd")}}]);