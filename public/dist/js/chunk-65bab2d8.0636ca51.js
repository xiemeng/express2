(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65bab2d8"],{"0395":function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aks-person",on:{click:function(e){return t.$emit("open")}}},[e("ul",{staticClass:"a-line-omit"},[t._l(t.usePersionList,(function(i){return e("li",{key:i.key,staticClass:"a-line-omit"},[e("a-tag",[t._v(t._s(i.tagName))])],1)})),t.usePersionList.length<1?e("p",{staticClass:"font-color-black-25"},[t._v(t._s(t.placeHolder))]):t._e()],2),t.usePersionList.length>2?e("span",{staticClass:"omit"},[t._v("等"+t._s(t.usePersionList.length)+"个账号")]):t._e(),e("a-icon",{attrs:{type:"caret-down"}})],1)},a=[],s={name:"SelectInput",props:{usePersionList:{type:[Array],default:function(){return[]}},placeHolder:{type:[String],default:""}}},r=s,l=(i("af8f"),i("2877")),o=Object(l["a"])(r,n,a,!1,null,"7ad15fc6",null);e["a"]=o.exports},"098e":function(t,e,i){},1915:function(t,e,i){},"1bee":function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"b",(function(){return s}));i("a9e3"),i("ac1f"),i("5319"),i("4d63"),i("25f0");function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD hh:mm:ss",i=e,n=new Date(Number(t)),a={"M+":n.getMonth()+1,"D+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),"S+":n.getMilliseconds()};for(var s in/(y+)/i.test(i)&&(i=i.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+s+")").test(i)&&(i=i.replace(RegExp.$1,1===RegExp.$1.length?a[s]:("00"+a[s]).substr((""+a[s]).length)));return i}function a(t){var e=parseInt(t/3600)<10?"0"+parseInt(t/3600):parseInt(t/3600),i=parseInt(t%3600/60)<10?"0"+parseInt(t%3600/60):parseInt(t%3600/60);return e+":"+i}function s(t,e){var i=Date.parse(new Date),n=r(i,t),a=new Date(n),s=a.getTime(),l=r(i,e),o=new Date(l),c=o.getTime();return"start"?s>=c:c<=s}function r(t,e){var i=new Date(t),n=i.getFullYear()+"-",a=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",s=i.getDate()+" ";i.getHours(),i.getMinutes(),i.getSeconds();return n+a+s+e+":00"}},"28f6":function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",[e("SelectInput",{attrs:{placeHolder:"请选择标签",usePersionList:t.selectTagList},on:{open:function(e){t.visibleTag=!0}}}),e("a-modal",{attrs:{footer:null,width:"600px",centered:""},model:{value:t.visibleTag,callback:function(e){t.visibleTag=e},expression:"visibleTag"}},[e("SelectTags",{attrs:{selectTagList:t.selectTagList},on:{cancle:function(e){t.visibleTag=!1},serviceOk:t.serviceTagOk}})],1)],1)},a=[],s=(i("0481"),i("4069"),i("d81d"),i("4de4"),i("d3b7"),i("0395")),r=i("c844"),l={name:"GetClientTag",components:{SelectInput:s["a"],SelectTags:r["a"]},props:{value:{type:[Array],default:function(){return[]}}},data:function(){return{visibleTag:!1,selectTagList:this.value}},methods:{serviceTagOk:function(t){this.selectTagList=t.filter((function(t){return t.selectTagList.length>0})).map((function(t){return t.selectTagList})).flat(),this.visibleTag=!1,this.$emit("input",this.selectTagList)}}},o=l,c=i("2877"),u=Object(c["a"])(o,n,a,!1,null,"b000dc2e",null);e["a"]=u.exports},3031:function(t,e,i){"use strict";i("55ca")},"34db":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t._self._c;return e("div",[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:"创建分时段打标签规则"},on:{back:function(e){return t.$router.go(-1)}}}),e("section",{staticClass:"section background-white"},[e("a-form-model",{ref:"ruleForm",attrs:{"label-col":{span:2},"wrapper-col":{span:22},rules:t.rules,model:t.form}},[e("p",{staticClass:"base-info"},[t._v("规则基础信息")]),e("div",{staticClass:"font-color-black-25 set-rule"},[t._v("根据规则，当客户在设定时间段内成为企业微信客户，将自动被打上标签")]),e("a-form-model-item",{attrs:{label:"规则名称",prop:"ruleName","wrapper-col":{span:6}}},[e("a-input",{attrs:{placeholder:"请填写规则名称，仅内部可用",maxLength:15},model:{value:t.form.ruleName,callback:function(e){t.$set(t.form,"ruleName",e)},expression:"form.ruleName"}})],1),e("a-form-model-item",{attrs:{label:"生效成员",prop:"staffIds","wrapper-col":{span:6}}},[e("GetMember",{model:{value:t.form.staffIds,callback:function(e){t.$set(t.form,"staffIds",e)},expression:"form.staffIds"}})],1),e("p",{staticClass:"base-info"},[t._v("设置打标签规则")]),e("a-form-model-item",{attrs:{label:"","wrapper-col":{span:24}}},[e("ul",{staticClass:"add-rule"},[t._l(t.form.ruleDetails,(function(i,n){return e("li",{key:i.id,staticClass:"rule-list"},[e("div",[1!==t.form.ruleDetails.length?e("a-icon",{attrs:{type:"minus-circle"},on:{click:function(e){return t.delRule(n)}}}):t._e(),t._v(" 规则"+t._s(n+1)+"： ")],1),e("GetTime",{attrs:{item:i}})],1)})),e("a-button",{attrs:{type:"link"},on:{click:t.addRule}},[e("a-space",{attrs:{size:12}},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v("添加规则 "),e("span",{staticClass:"font-color-black-25"},[t._v("(添加的多条规则可同时生效，最多设置10个规则)")])],1)],1)],2)]),e("a-form-model-item",{attrs:{"wrapper-col":{span:12,offset:2}}},[e("a-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v(" 创建规则 ")])],1)],1)],1)],1)},a=[],s=(i("a15b"),i("d81d"),i("d3b7"),i("a434"),i("0395")),r=i("7ba4"),l=function(){var t=this,e=t._self._c;return e("div",[e("SelectInput",{attrs:{placeHolder:"请选择成员",usePersionList:t.usePersionList},on:{open:function(e){t.visibleUsePerson=!0}}}),e("a-modal",{attrs:{footer:null,centered:"",width:"680px"},model:{value:t.visibleUsePerson,callback:function(e){t.visibleUsePerson=e},expression:"visibleUsePerson"}},[e("AddTransfer",{attrs:{title:"选择成员",type:"deptId",selectRoleIdList:"[]",selectList:t.usePersionList},on:{serviceOk:t.serviceOk,cancle:function(e){t.visibleUsePerson=!1}}})],1)],1)},o=[],c=i("5530"),u=i("1eb1"),m={name:"GetMember",components:{SelectInput:s["a"],AddTransfer:u["a"]},props:{value:{type:[Array],default:function(){return[]}}},data:function(){return{visibleUsePerson:!1,usePersionList:this.value}},watch:{value:function(){this.usePersionList=this.value}},methods:{serviceOk:function(t){this.usePersionList=t.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{tagName:t.title})})),this.visibleUsePerson=!1,this.$emit("input",this.usePersionList)}}},d=m,f=i("2877"),p=Object(f["a"])(d,l,o,!1,null,"59bc1ecb",null),g=p.exports,v=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"rule-right"},[e("a-space",[t._v(" 为每 "),e("a-select",{on:{change:t.changeType},model:{value:t.item.type,callback:function(e){t.$set(t.item,"type",e)},expression:"item.type"}},t._l(t.dateList,(function(i){return e("a-select-option",{key:i.value,attrs:{value:i.value}},[t._v(" "+t._s(i.text)+" ")])})),1),1===t.item.type?e("div",[e("a-time-picker",{attrs:{placeholder:"开始时间",format:"HH:mm"},on:{change:function(e){return t.changeStartTime(t.item)}},model:{value:t.item.startTime,callback:function(e){t.$set(t.item,"startTime",e)},expression:"item.startTime"}}),t._v(" ~ "),e("a-time-picker",{attrs:{placeholder:"结束时间",format:"HH:mm"},on:{change:function(e){return t.changeEndTime(t.item)}},model:{value:t.item.endTime,callback:function(e){t.$set(t.item,"endTime",e)},expression:"item.endTime"}})],1):t._e(),2===t.item.type?e("div",[e("a-space",[e("a-select",{staticClass:"selectWeek",attrs:{mode:"multiple",placeholder:"请选择日期",allowClear:""},model:{value:t.item.weekly,callback:function(e){t.$set(t.item,"weekly",e)},expression:"item.weekly"}},t._l(t.weekList,(function(i){return e("a-select-option",{key:i.id,attrs:{value:i.id}},[t._v(" 周"+t._s(i.text)+" ")])})),1),e("a-time-picker",{attrs:{"default-value":t.defaultStart,placeholder:"开始时间",format:"HH:mm"},on:{change:function(e){return t.changeStartTime(t.item)}},model:{value:t.item.startTime,callback:function(e){t.$set(t.item,"startTime",e)},expression:"item.startTime"}}),t._v(" ~ "),e("a-time-picker",{attrs:{"default-value":t.defaultEnd,placeholder:"结束时间",format:"HH:mm"},on:{change:function(e){return t.changeEndTime(t.item)}},model:{value:t.item.endTime,callback:function(e){t.$set(t.item,"endTime",e)},expression:"item.endTime"}})],1)],1):t._e(),3===t.item.type?e("div",[e("a-space",[e("MoreSelect",{staticClass:"more-select",attrs:{placeHolder:"请选择日期",allowClear:""},model:{value:t.item.monthly,callback:function(e){t.$set(t.item,"monthly",e)},expression:"item.monthly"}}),e("a-time-picker",{attrs:{"default-value":t.defaultStart,placeholder:"开始时间",format:"HH:mm"},on:{change:function(e){return t.changeStartTime(t.item)}},model:{value:t.item.startTime,callback:function(e){t.$set(t.item,"startTime",e)},expression:"item.startTime"}}),t._v(" ~ "),e("a-time-picker",{attrs:{"default-value":t.defaultEnd,placeholder:"结束时间",format:"HH:mm"},on:{change:function(e){return t.changeEndTime(t.item)}},model:{value:t.item.endTime,callback:function(e){t.$set(t.item,"endTime",e)},expression:"item.endTime"}})],1)],1):t._e(),t._v(" 添加的客户 ")],1),e("p",[e("a-space",[t._v(" 打上 "),e("GetClientTag",{model:{value:t.item.bitmaps,callback:function(e){t.$set(t.item,"bitmaps",e)},expression:"item.bitmaps"}}),t._v(" 的标签 ")],1)],1)],1)])},h=[],b=(i("caad"),i("2532"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"select-input",attrs:{tabindex:"0",outline:"0"},on:{blur:function(e){t.isOpen=!1}}},[e("div",{staticClass:"select-contant",on:{click:function(e){t.isOpen=!t.isOpen}}},[e("ul",[t._l(t.selectList,(function(i,n){return e("a-tag",{key:n,attrs:{closable:""},on:{close:function(e){return t.close(n)}}},[t._v(" "+t._s(i)+"号 ")])})),t.selectList.length<1?e("p",{staticClass:"font-color-black-25"},[t._v(t._s(t.placeHolder))]):t._e()],2),e("div",{staticClass:"icon"},[t.selectList.length<1?e("a-icon",{attrs:{type:"down"}}):t._e(),t.allowClear&&t.selectList.length>0?e("a-icon",{staticClass:"close-circle",attrs:{type:"close-circle"},on:{click:function(e){return e.stopPropagation(),t.clean.apply(null,arguments)}}}):t._e()],1)]),t.isOpen?e("div",{staticClass:"povice"},[e("ul",{staticClass:"select-date"},t._l(31,(function(i){return e("li",{key:i,class:{active:t.selectList.includes(i)},on:{click:function(e){return t.getDate(i)}}},[t._v(" "+t._s(i)+" ")])})),0),e("footer",{staticClass:"footer"},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){t.isOpen=!1}}},[t._v("确定")])],1)]):t._e()])}),T=[],y=(i("c740"),{name:"MoreSelect",props:{allowClear:{type:Boolean,default:!1},placeHolder:{type:String,default:""},value:{type:Array,default:function(){return[]}}},data:function(){return{selectList:[],isOpen:!1}},created:function(){this.selectList=this.value},methods:{getDate:function(t){var e=this.selectList.findIndex((function(e){return e===t}));e<0?this.selectList.push(t):this.selectList.splice(e,1),this.$emit("input",this.selectList)},close:function(t){this.selectList.splice(t,1),this.$emit("input",this.selectList)},clean:function(){this.selectList=[],this.$emit("input",this.selectList)}}}),_=y,k=(i("b26a"),Object(f["a"])(_,b,T,!1,null,"5b5f813f",null)),L=k.exports,w=i("28f6"),x=i("9802"),H={name:"GetTime",components:{MoreSelect:L,GetClientTag:w["a"]},mixins:[x["a"]],props:{value:{type:[Array],default:function(){return[]}},item:{type:[Object],default:function(){}}},data:function(){return{weekList:[{id:2,text:"一"},{id:3,text:"二"},{id:4,text:"三"},{id:5,text:"四"},{id:6,text:"五"},{id:7,text:"六"},{id:1,text:"日"}],defaultStart:this.$moment("00.00","HH:mm"),defaultEnd:this.$moment("23.59","HH:mm"),dateList:[{value:1,text:"天"},{value:2,text:"周"},{value:3,text:"月"}]}},methods:{changeType:function(t){1===t?(this.item.startTime="",this.item.endTime=""):(this.item.startTime=this.defaultStart,this.item.endTime=this.defaultEnd)}}},O=H,C=(i("5f01"),Object(f["a"])(O,v,h,!1,null,"46578293",null)),$=C.exports,D={name:"AddTimeRules",components:{GetMember:g,SelectInput:s["a"],GetTime:$},data:function(){return{visibleTag:!1,selectTagList:[],form:{ruleName:"",staffIds:[],ruleDetails:[{type:1,startTime:"",endTime:"",weekly:void 0,monthly:void 0,bitmaps:[],id:(new Date).getTime()}]},defaultRuleDetails:function(){return{type:1,startTime:"",endTime:"",weekly:void 0,monthly:void 0,bitmaps:[],id:(new Date).getTime()}},rules:{ruleName:[{required:!0,message:"请填写规则名称"}],staffIds:[{required:!0,message:"请选择生效成员"}]}}},activated:function(){this.visibleTag=!1,this.selectTagList=[],this.form={ruleName:"",staffIds:[],ruleDetails:[{type:1,startTime:"",endTime:"",weekly:void 0,monthly:void 0,bitmaps:[],id:(new Date).getTime()}]}},methods:{createAutoTaggingTime:function(){var t,e=this,i={ruleName:this.form.ruleName,staffIds:null===(t=this.form.staffIds)||void 0===t?void 0:t.map((function(t){return t.source.userid})).join(","),rules:this.form.ruleDetails.map((function(t){var e,i;return{bitmaps:t.bitmaps.map((function(t){return t.bitmap})).join(","),type:t.type,startTime:t.startTime.format("HH:mm"),endTime:t.endTime.format("HH:mm"),weekly:2===t.type?null===(e=t.weekly)||void 0===e?void 0:e.join(","):null,monthly:3===t.type?null===(i=t.monthly)||void 0===i?void 0:i.join(","):null}}))};Object(r["d"])(i).then((function(){e.$message.success("创建规则成功"),e.$router.go(-1)}))},submitForm:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;t.validSubmit().then((function(){t.createAutoTaggingTime()})).catch((function(e){t.$message.warning(e.message||e)}))}))},validSubmit:function(){var t=this;return new Promise((function(e,i){for(var n=t.form.ruleDetails,a=0;a<n.length;a++){var s,r,l=n[a];l.startTime&&l.endTime||i("规则".concat(a+1,"时间没有填写")),(2===l.type&&!l.weekly||(null===(s=l.weekly)||void 0===s?void 0:s.length)<1)&&i("规则".concat(a+1,"日期没有填写")),(3===l.type&&!l.monthly||(null===(r=l.monthly)||void 0===r?void 0:r.length)<1)&&i("规则".concat(a+1,"日期没有填写 ")),l.bitmaps.length<1&&i("规则".concat(a+1,"标签没有填写"))}e()}))},delRule:function(t){this.form.ruleDetails.splice(t,1)},addRule:function(){this.form.ruleDetails.push(this.defaultRuleDetails())}}},S=D,j=(i("3031"),Object(f["a"])(S,n,a,!1,null,"f7abc7f6",null));e["default"]=j.exports},"55ca":function(t,e,i){},"5f01":function(t,e,i){"use strict";i("098e")},"7af2":function(t,e,i){},"7ba4":function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"g",(function(){return r})),i.d(e,"f",(function(){return l})),i.d(e,"c",(function(){return o})),i.d(e,"b",(function(){return c})),i.d(e,"d",(function(){return u})),i.d(e,"i",(function(){return m})),i.d(e,"j",(function(){return d})),i.d(e,"e",(function(){return f})),i.d(e,"h",(function(){return p}));var n=i("b775"),a={autoTaggingQueryList:"/client_transformation/autoTagging/autoTaggingQueryList",openRule:"/client_transformation/autoTagging/openRule",delRule:"/client_transformation/autoTagging/delRule",createAutoTaggingKeyWord:"/client_transformation/autoTagging/createAutoTaggingKeyWord",createAutoTaggingGrp:"/client_transformation/autoTagging/createAutoTaggingGrp",createAutoTaggingTime:"/client_transformation/autoTagging/createAutoTaggingTime",ruleDetail:"/client_transformation/autoTagging/ruleDetail",statistics:"/client_transformation/autoTaggingStatistics/statistics",customerList:"/client_transformation/autoTaggingStatistics/customerList",remindList:"/client_manager/customerdelremind/remindList"};function s(t){return Object(n["b"])({url:a.autoTaggingQueryList,method:"post",data:t})}function r(t){return Object(n["b"])({url:a.openRule,method:"post",data:t})}function l(t){return Object(n["b"])({url:a.delRule,method:"post",data:t})}function o(t){return Object(n["b"])({url:a.createAutoTaggingKeyWord,method:"post",data:t})}function c(t){return Object(n["b"])({url:a.createAutoTaggingGrp,method:"post",data:t})}function u(t){return Object(n["b"])({url:a.createAutoTaggingTime,method:"post",data:t})}function m(t){return Object(n["b"])({url:a.ruleDetail,method:"post",data:t})}function d(t){return Object(n["b"])({url:a.statistics,method:"post",data:t})}function f(t){return Object(n["b"])({url:a.customerList,method:"post",data:t})}function p(t){return Object(n["b"])({url:a.remindList,method:"post",data:t})}},9802:function(t,e,i){"use strict";var n=i("1bee");e["a"]={methods:{changeStartTime:function(t){if(t.endTime){var e,i,a=Object(n["b"])(null===t||void 0===t||null===(e=t.startTime)||void 0===e?void 0:e.format("HH:mm"),null===t||void 0===t||null===(i=t.endTime)||void 0===i?void 0:i.format("HH:mm"),"start");a&&(t.startTime=void 0,this.$message.warning("开始时间不能大于结束时间"))}},changeEndTime:function(t){if(t.startTime){var e,i=Object(n["b"])(null===t||void 0===t?void 0:t.startTime.format("HH:mm"),null===t||void 0===t||null===(e=t.endTime)||void 0===e?void 0:e.format("HH:mm"),"start");i&&(t.endTime=void 0,this.$message.warning("结束时间不能小于开始时间"))}}}}},af8f:function(t,e,i){"use strict";i("7af2")},b26a:function(t,e,i){"use strict";i("1915")}}]);