(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f6798a4"],{"0150":function(e,t,i){},"0d02":function(e,t,i){"use strict";i("7d94")},"1bee":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return s}));i("a9e3"),i("ac1f"),i("5319"),i("4d63"),i("25f0");function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD hh:mm:ss",i=t,n=new Date(Number(e)),a={"M+":n.getMonth()+1,"D+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),"S+":n.getMilliseconds()};for(var s in/(y+)/i.test(i)&&(i=i.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+s+")").test(i)&&(i=i.replace(RegExp.$1,1===RegExp.$1.length?a[s]:("00"+a[s]).substr((""+a[s]).length)));return i}function a(e){var t=parseInt(e/3600)<10?"0"+parseInt(e/3600):parseInt(e/3600),i=parseInt(e%3600/60)<10?"0"+parseInt(e%3600/60):parseInt(e%3600/60);return t+":"+i}function s(e,t){var i=Date.parse(new Date),n=r(i,e),a=new Date(n),s=a.getTime(),o=r(i,t),l=new Date(o),c=l.getTime();return"start"?s>=c:c<=s}function r(e,t){var i=new Date(e),n=i.getFullYear()+"-",a=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",s=i.getDate()+" ";i.getHours(),i.getMinutes(),i.getSeconds();return n+a+s+t+":00"}},2880:function(e,t,i){"use strict";i("592d")},"2a86":function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("h6",{staticClass:"dialog-title"},[e._v(e._s(e.title))]),e.tipText?t("span",{attrs:{name:"tip"}},[t("div",{staticClass:"tip"},[t("a-icon",{staticClass:"primaryColor",attrs:{type:"bell",theme:"filled"}}),e._v(" "+e._s(e.tipText)+" ")],1)]):e._e(),e._t("default"),e.footer?t("div",{staticClass:"foot-button"},[t("div",{staticClass:"left"},[e._t("bottomLeft")],2),t("a-space",{attrs:{size:12}},[e._t("footer"),t("a-button",{on:{click:function(t){return e.$emit("cancle")}}},[e._v(e._s(e.cancleText))]),t("a-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(t){return e.$emit("serviceOk")}}},[e._v(e._s(e.okText))])],2)],1):e._e()],2)},a=[],s={name:"CommonModal",props:{title:{type:String,default:"标题"},cancleText:{type:String,default:"取消"},okText:{type:String,default:"确定"},tipText:{type:[String,Boolean],default:!1},footer:{type:Boolean,default:!0},loading:{type:Boolean,default:!1}}},r=s,o=(i("2880"),i("2877")),l=Object(o["a"])(r,n,a,!1,null,"c55b780c",null);t["a"]=l.exports},"2bf4":function(e,t,i){"use strict";var n=i("2909"),a=i("5530"),s=(i("d3b7"),i("d81d"),i("3ca3"),i("ddb0"),i("9911"),i("a15b"),i("a9e3"),i("d885")),r=i("cf5f");t["a"]={methods:{addAccessory:function(e){this.attachments=e},uploadMedia:function(e){var t=this,i=e||this.attachments;return new Promise((function(e,n){var a=(null===i||void 0===i?void 0:i.map((function(e){return new Promise((function(i,n){if("link"===e.type)t.interactiveRadarAdd(e).then((function(e){i(e)}));else if("img"===e.type&&e.pic_url.file){var a=new FormData;a.append("file",e.pic_url.file),a.append("dir","clientTransformation"),a.append("type","image"),Object(r["y"])(a).then((function(t){e.pic_url.fileUrl=t.data.fileUrl,e.pic_url.mediaId=t.data.mediaId,i(t.data)}))}else i()}))})))||[];Promise.all(a).then((function(t){e()})).catch((function(e){t.$message.error(e||e.message),t.loading=!1,n(e)}))}))},channelCodeUploadFileFun:function(e){var t=this,i=e||this.attachments;return new Promise((function(e,n){var a=(null===i||void 0===i?void 0:i.map((function(e){return new Promise((function(i,n){if("link"===e.type)t.interactiveRadarAdd(e).then((function(e){i(e)}));else if("img"===e.type&&e.pic_url.file){var a=new FormData;a.append("file",e.pic_url.file),Object(r["d"])(a).then((function(t){e.pic_url.fileUrl=t.data.fileUrl,e.pic_url.mediaId=t.data.mediaId,i(t.data)}))}else i()}))})))||[];Promise.all(a).then((function(t){e()})).catch((function(e){t.$message.error(e||e.message),t.loading=!1,n(e)}))}))},getAttachments:function(e){var t=e||this.attachments;return null===t||void 0===t?void 0:t.map((function(e){if("img"===e.type)return{msgtype:"image",image:{media_id:e.pic_url.mediaId,pic_url:e.pic_url.fileUrl||e.pic_url.compress,title:e.title}};if("link"===e.type){var t="normal_link";e.linktype?t=e.linktype:e.radarId&&(t="radar_link");var i=e.radarId||e.formId||e.id;return i&&(i=String(i)),{msgtype:"link",link:{title:e.linkTitle,picurl:e.picurl||e.coverUrl.compress,desc:e.desc,url:e.url||e.link||e.activityLink,radarId:i,type:t}}}}))},interactiveRadarAdd:function(e){var t=this;return new Promise((function(i,n){t.getParamsLink(e).then((function(t){e.isRadar&&e.randerIsEdit?Object(s["f"])(t).then((function(t){e.radarId=t.data.radarId,e.url=t.data.radarLink+e.source,i(t)})).catch((function(e){n(e)})):i()}))}))},getParamsLink:function(e){return new Promise((function(t,i){var n=new FormData,a=e.isCustomerTag?[{autoMarkTagBitmaps:e.selectCustomerTagList.map((function(e){return e.bitmap})).join(",")}]:[];if(n.append("type",1),n.append("radarName",e.linkTitle),n.append("link",e.url),n.append("activityNotify",Number(e.activityNotify)),n.append("behaviorNotify",Number(e.behaviorNotify)),n.append("tagRule",JSON.stringify(a)),n.append("title",e.radarTitle),n.append("desc",e.desc),n.append("hasCustomerTag",Number(e.isCustomerTag)),e.isScoreRule){var s=JSON.stringify(e.ruleDetails.map((function(e){var t,i;return{autoMarkTagBitmaps:null===(t=e.selectTagList)||void 0===t||null===(i=t.map((function(e){return e.bitmap})))||void 0===i?void 0:i.join(","),hasTag:Number(e.hasTag),score:e.score,ruleKind:e.ruleKind,count:e.count||0}})));n.append("scoreRule",s)}if(e.coverUrl.file){var o=new FormData;o.append("file",e.coverUrl.file),o.append("dir","clientTransformation"),Object(r["m"])(o).then((function(i){n.append("coverUrl",i.data),e.picurl=i.data,t(n)})).catch((function(e){i(e)}))}else t(n)}))},attachmentsDetail:function(e){return null===e||void 0===e?void 0:e.map((function(e){var t,i,n,s,r,o="",l="",c="",d="",u={};("image"===e.msgtype&&(o="图文",l="visibileAddImg",d="img",c={compress:e.image.pic_url}),"link"===e.msgtype)&&(d="link",e.linktype=e.link.type,"radar_link"!==e.linktype&&"normal_link"!==e.linktype||(l="visibileAddLink",o="链接"),"form_link"===e.linktype&&(l="visibileForm",o="自定义表单"),"luck_link"===e.linktype&&(l="visibileLuckDraw",o="抽奖活动"),u={compress:e.link.picurl},e.linkTitle=e.link.title,e.desc=e.link.desc,e.url=e.link.url,e.link.interactRadar&&(e.isRadar=!0,e.behaviorNotify=Boolean(e.link.interactRadar.behaviorNotify),e.activityNotify=Boolean(e.link.interactRadar.activityNotify),e.isCustomerTag=(null===(t=e.link.interactRadar.tagRules)||void 0===t?void 0:t.length)>0,e.radarId=null===(i=e.link.interactRadar)||void 0===i?void 0:i.radarId,e.radarTitle=e.link.title,e.selectCustomerTagList=null===(n=e.link.interactRadar.tagRules[0])||void 0===n||null===(s=n.customerTags)||void 0===s?void 0:s.map((function(e){return Object(a["a"])(Object(a["a"])({},e),{},{key:e.tagId})})),e.isScoreRule=(null===(r=e.link.interactRadar.scoreRules)||void 0===r?void 0:r.length)>0,e.ruleDetails=e.link.interactRadar.scoreRules.map((function(e){var t;return Object(a["a"])(Object(a["a"])({},e),{},{autoMarkTagBitmaps:e.autoMarkTagBitmaps,selectTagList:null===(t=e.customerTags)||void 0===t?void 0:t.map((function(e){return Object(a["a"])(Object(a["a"])({},e),{},{key:e.tagId})})),hasTag:Boolean(e.hasTag),score:e.score,ruleKind:e.ruleKind,count:e.count})}))));return Object(a["a"])(Object(a["a"])({},e),{},{key:l,pic_url:c,type:d,coverUrl:u,typeText:o})}))}},computed:{state:function(){return this.$route.query.state},isAddText:function(){return"add"===this.$route.query.state?"新建":"修改"},textList:function(){var e=[];return this.messageOne&&e.push(this.messageOne),this.attachments&&e.push.apply(e,Object(n["a"])(this.attachments)),e}}}},"30b3":function(e,t,i){"use strict";i("50bf")},"50bf":function(e,t,i){},"51b8":function(e,t,i){},"592d":function(e,t,i){},"5e9f":function(e,t,i){"use strict";i("c4f4")},6942:function(e,t,i){},"6bd9":function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"use-person"},[t("ul",{staticClass:"a-line-omit",on:{click:function(t){e.visibleUsePerson=!0}}},[e._l(e.usePersionList,(function(i){return t("li",{key:i.key,staticClass:"a-line-omit"},[t("a-tooltip",{attrs:{title:i.title}},[i.icon?t("a-icon",{staticClass:"icon",attrs:{type:i.icon}}):t("a-avatar",{staticClass:"imgs",attrs:{size:23,src:i.source.thumbAvatar||e.defaultThumbAvatar}}),t("span",{staticClass:"title"},[e._v(" "+e._s(i.title)+" ")])],1)],1)})),e.usePersionList.length<1?t("p",{staticClass:"font-color-black-25"},[e._v(e._s(e.placeHolder))]):e._e()],2),e.usePersionList.length>2?t("span",{staticClass:"omit"},[e._v("等"+e._s(e.usePersionList.length)+"个账号")]):e._e(),t("a-icon",{attrs:{type:"caret-down"}})],1),t("a-modal",{attrs:{footer:null,width:"680px",centered:""},model:{value:e.visibleUsePerson,callback:function(t){e.visibleUsePerson=t},expression:"visibleUsePerson"}},[t("AddTransfer",e._b({attrs:{type:e.type,title:e.title,selectList:e.usePersionList,selectRoleIdList:e.selectRoleIdList},on:{serviceOk:e.serviceOk,cancle:function(t){e.visibleUsePerson=!1}}},"AddTransfer",e.source,!1))],1)],1)},a=[],s=(i("d81d"),i("1eb1")),r={name:"UsePerson",props:{defaultUsePerson:{type:[Array],default:function(){return[]}},placeHolder:{type:[String],default:""},type:{type:[String],default:""},title:{type:[String],default:"选择成员"},value:{type:[Array],default:function(){return[]}},needControlReturn:{type:Boolean,default:!1},source:{type:Object,default:function(){return{}}}},components:{AddTransfer:s["a"]},data:function(){return{defaultThumbAvatar:i("b5c3"),visibleUsePerson:!1,selectRoleIdList:[],usePersionList:this.value}},watch:{value:function(){this.usePersionList=this.value}},methods:{serviceOk:function(e){var t=this;e.length<1?this.usePersionList=this.defaultUsePerson:this.usePersionList=e,this.usePersionList.map((function(e){e.value=100})),this.needControlReturn||(this.visibleUsePerson=!1),this.$emit("input",this.usePersionList),this.$emit("usePersionInfo",this.usePersionList,(function(){t.visibleUsePerson=!1}))}}},o=r,l=(i("f0b2"),i("2877")),c=Object(l["a"])(o,n,a,!1,null,"de146f5e",null);t["a"]=c.exports},"717b":function(e,t,i){},"7c0b":function(e,t,i){"use strict";i("0150")},"7d94":function(e,t,i){},"842b":function(e,t,i){"use strict";var n=i("5530"),a=(i("d3b7"),i("d81d"),i("3ca3"),i("ddb0"),i("a15b"),i("a9e3"),i("b0c0"),i("9911"),i("d885")),s=i("cf5f");t["a"]={methods:{interactiveRadarUploadFile:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.uploadFilePath;return new Promise((function(i,n){var a=new FormData;a.append("file",e),a.append("dir",t),Object(s["m"])(a).then((function(e){i(e.data)})).catch((function(e){n(e)}))}))},uploadMedia:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attachments;return new Promise((function(i,n){var a=(null===t||void 0===t?void 0:t.map((function(t){return new Promise((function(i,n){if("link"===t.type&&t.isRadar&&!t.isMaterial)e.interactiveRadarAdd(t).then((function(e){i(e)})).catch((function(e){n(e)}));else if("img"===t.type){var a=new FormData;a.append("file",t.pic_url.file),a.append("dir","clientTransformation"),a.append("type","image"),Object(s["y"])(a).then((function(e){t.pic_url.fileUrl=e.data.fileUrl,t.pic_url.mediaId=e.data.mediaId,i(e.data)}))}else i()}))})))||[];Promise.all(a).then((function(e){i()})).catch((function(t){e.$message.error(t||t.message),e.loading=!1,n(t)}))}))},interactiveRadarAdd:function(e){var t=this;return new Promise((function(i,n){t.getParamsLink(e).then((function(t){Object(a["f"])(t).then((function(t){e.radarId=t.data.radarId,e.url=t.data.radarLink+e.source,i(t)})).catch((function(e){n(e)}))}))}))},getParamsLink:function(e){return new Promise((function(t,i){var n=new FormData,a=e.isCustomerTag?[{autoMarkTagBitmaps:e.selectCustomerTagList.map((function(e){return e.bitmap})).join(",")}]:[];if(n.append("type",1),n.append("radarName",e.linkTitle),n.append("link",e.url),n.append("activityNotify",Number(e.activityNotify)),n.append("behaviorNotify",Number(e.behaviorNotify)),n.append("tagRule",JSON.stringify(a)),n.append("title",e.radarTitle),n.append("desc",e.desc),n.append("hasCustomerTag",Number(e.isCustomerTag)),e.isScoreRule){var r=JSON.stringify(e.ruleDetails.map((function(e){var t,i;return{autoMarkTagBitmaps:null===(t=e.selectTagList)||void 0===t||null===(i=t.map((function(e){return e.bitmap})))||void 0===i?void 0:i.join(","),hasTag:Number(e.hasTag),score:e.score,ruleKind:e.ruleKind,count:e.count||0}})));n.append("scoreRule",r)}if(e.coverUrl.file){var o=new FormData;o.append("file",e.coverUrl.file),o.append("dir","clientTransformation"),Object(s["m"])(o).then((function(i){n.append("coverUrl",i.data),e.picurl=i.data,t(n)})).catch((function(e){i(e)}))}else t(n)}))},getMessageList:function(e){return e.map((function(e){var t="";if(0===e.msgType&&(t=e.msgContent,e.formObj={},e.pdfArr=[],e.videoArr=[]),1===e.msgType&&(t={compress:e.msgContent},e.imageObj={title:"图片",prop:"pic_url",type:"img",tips:"",accept:".jpg,.png",maxLength:2097152,value:{compress:e.msgContent}},e.formObj={},e.pdfArr=[],e.videoArr=[]),2===e.msgType){e.pdfArr=[],e.videoArr=[];var i,a,s,r,o=JSON.parse(e.msgContent);if(t={form:{linkTitle:o.title,desc:o.desc,coverUrl:{compress:o.picUrl},type:"link",url:o.url}},e.interactRadar)t.form.isRadar=!0,t.form.behaviorNotify=Boolean(e.interactRadar.behaviorNotify),t.form.activityNotify=Boolean(e.interactRadar.activityNotify),t.form.isCustomerTag=(null===(i=e.interactRadar.tagRules)||void 0===i?void 0:i.length)>0,t.form.radarTitle=e.interactRadar.radarName,t.form.radarId=e.interactRadar.radarId,t.form.selectCustomerTagList=null===(a=e.interactRadar.tagRules[0])||void 0===a||null===(s=a.customerTags)||void 0===s?void 0:s.map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{key:e.tagId})})),t.form.isScoreRule=(null===(r=e.interactRadar.scoreRules)||void 0===r?void 0:r.length)>0,t.form.ruleDetails=e.interactRadar.scoreRules.map((function(e){var t;return Object(n["a"])(Object(n["a"])({},e),{},{autoMarkTagBitmaps:e.autoMarkTagBitmaps,selectTagList:null===(t=e.customerTags)||void 0===t?void 0:t.map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{key:e.tagId})})),hasTag:Boolean(e.hasTag),score:e.score,ruleKind:e.ruleKind,count:e.count})}))}if(3===e.msgType){var l=JSON.parse(e.msgContent);e.pdfArr=[Object(n["a"])(Object(n["a"])({},l),{},{uid:"1",status:"done"})],e.formObj={},e.videoArr=[]}if(4===e.msgType){var c=JSON.parse(e.msgContent);e.formObj=Object(n["a"])(Object(n["a"])({},c),{},{name:c.title}),e.pdfArr=[]}if(5===e.msgType){var d=JSON.parse(e.msgContent);e.videoArr=[Object(n["a"])({},d)],e.formObj={},e.pdfArr=[]}return Object(n["a"])(Object(n["a"])({},e),{},{msgContent:t})}))},getPlanList:function(e){var t=this;return e.map((function(e){return Object(n["a"])(Object(n["a"])({},e),{},{messageList:t.getAddMessageList(e.messageList)})}))},getAddMessageList:function(e){return e.map((function(e){var t="";if(0===e.msgType&&(t=e.msgContent),1===e.msgType&&(t=e.fileUrl||e.msgContent.compress),2===e.msgType){var i,n,a="";e.fileUrl?a=e.fileUrl:e.msgContent.form.picurl?a=e.msgContent.form.picurl:e.msgContent.form.coverUrl.compress&&(a=e.msgContent.form.coverUrl.compress);var s=e.msgContent.form.radarId||(null===(i=e.msgContent.form.interactRadar)||void 0===i?void 0:i.radarId);s&&(s=String(s)),t=JSON.stringify({desc:e.msgContent.form.desc,picUrl:a,url:e.msgContent.form.url,title:e.msgContent.form.linkTitle,radarId:s,type:e.msgContent.form.radarId||null!==(n=e.msgContent.form.interactRadar)&&void 0!==n&&n.radarId?"radar_link":"normal_link"})}return 3===e.msgType&&(t=JSON.stringify({pdfFile:e.pdfArr[0].fileUrl||e.pdfArr[0].pdfFile,name:e.pdfArr[0].name,size:e.pdfArr[0].size,cover:"https://acadsocscrmpc.oss-cn-shenzhen.aliyuncs.com/h5/img/pdf.png"})),4===e.msgType&&(t=JSON.stringify({cover:e.formObj.cover,desc:e.formObj.desc,title:e.formObj.name,url:e.formObj.link})),{messageId:e.messageId,msgType:e.msgType,msgContent:t}}))},getPlanFileList:function(e){var t=this,i=[];return e.length>0&&(i=e.map((function(e){return new Promise((function(i,n){var a,s,r,o;2===e.msgType?e.msgContent.form.isRadar&&e.msgContent.form.randerIsEdit?t.interactiveRadarAdd(e.msgContent.form).then((function(t){e.radarId=t.data,i(t)})).catch((function(e){n(e)})):e.msgContent.form.coverUrl.file?t.interactiveRadarUploadFile(e.msgContent.form.coverUrl.file).then((function(t){e.fileUrl=t,i(t)})).catch((function(e){n(e)})):i():1===e.msgType&&e.msgContent.file?t.interactiveRadarUploadFile(e.msgContent.file).then((function(t){e.fileUrl=t,i(t)})).catch((function(e){n(e)})):3===e.msgType&&null!==(a=e.pdfArr)&&void 0!==a&&null!==(s=a[0])&&void 0!==s&&s.originFileObj?t.interactiveRadarUploadFile(e.pdfArr[0].originFileObj).then((function(t){e.pdfArr[0].fileUrl=t,i(t)})).catch((function(e){n(e)})):5===e.msgType&&null!==(r=e.videoArr)&&void 0!==r&&null!==(o=r[0])&&void 0!==o&&o.originFileObj?t.interactiveRadarUploadFile(e.videoArr[0].originFileObj).then((function(t){e.videoArr[0].fileUrl=t,i(t)})).catch((function(e){n(e)})):i()}))}))),i}}}},9802:function(e,t,i){"use strict";var n=i("1bee");t["a"]={methods:{changeStartTime:function(e){if(e.endTime){var t,i,a=Object(n["b"])(null===e||void 0===e||null===(t=e.startTime)||void 0===t?void 0:t.format("HH:mm"),null===e||void 0===e||null===(i=e.endTime)||void 0===i?void 0:i.format("HH:mm"),"start");a&&(e.startTime=void 0,this.$message.warning("开始时间不能大于结束时间"))}},changeEndTime:function(e){if(e.startTime){var t,i=Object(n["b"])(null===e||void 0===e?void 0:e.startTime.format("HH:mm"),null===e||void 0===e||null===(t=e.endTime)||void 0===t?void 0:t.format("HH:mm"),"start");i&&(e.endTime=void 0,this.$message.warning("结束时间不能小于开始时间"))}}}}},a768:function(e,t,i){"use strict";i("6942")},b35a:function(e,t,i){"use strict";i("cb6d")},b4f0:function(e,t,i){},b5c3:function(e,t,i){e.exports=i.p+"assets/default.c42b7ede.svg"},c4f4:function(e,t,i){},cb57:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrap"},[t("a-spin",{attrs:{spinning:e.loading}},[t("section",{staticClass:"background-white main page-box"},[t("div",{staticStyle:{height:"100%"}},[t("div",{staticClass:"tops"},[t("div",[t("a-radio-group",{attrs:{"button-style":"solid"},model:{value:e.direction,callback:function(t){e.direction=t},expression:"direction"}},[t("a-radio-button",{attrs:{value:"day"}},[e._v(" 日 ")]),t("a-radio-button",{attrs:{value:"week"}},[e._v(" 周 ")]),t("a-radio-button",{attrs:{value:"month"}},[e._v(" 月 ")])],1),t("a-button",{attrs:{type:"link"},on:{click:e.goToday}},[e._v("今天")])],1),e.isEdit?t("a-button",{attrs:{type:"primary"},on:{click:e.addWork}},[t("a-icon",{attrs:{type:"plus"}}),e._v(" 添加工作记录 ")],1):e._e()],1),"month"===e.direction?t("Calendar",{attrs:{repeatList:e.repeatList,sendTime:e.sendTime,status:"detail",planList:e.filterPlanList},on:{select:e.select,panelChange:e.panelChange}}):e._e(),t("Week",{directives:[{name:"show",rawName:"v-show",value:"week"===e.direction,expression:"direction === 'week'"}],attrs:{sendTime:e.sendTime,planList:e.filterPlanList,repeatList:e.repeatList},on:{select:e.select,panelChange:e.panelChange}}),t("Day",{directives:[{name:"show",rawName:"v-show",value:"day"===e.direction,expression:"direction === 'day'"}],attrs:{sendTime:e.sendTime,planList:e.filterPlanList,repeatList:e.repeatList},on:{select:e.select,panelChange:e.panelChange}})],1)])]),t("a-modal",{attrs:{footer:null,destroyOnClose:""},model:{value:e.visibleSendContant,callback:function(t){e.visibleSendContant=t},expression:"visibleSendContant"}},[t("AddSendContant",{attrs:{sendTime:e.sendTime,planItem:e.editData,userid:e.userid,status:"detail",future:e.future,isEdit:e.isEdit},on:{cancle:function(t){e.visibleSendContant=!1},serviceOk:e.serviceOk}})],1),t("a-modal",{attrs:{footer:null,destroyOnClose:""},model:{value:e.visibleSendContantMeet,callback:function(t){e.visibleSendContantMeet=t},expression:"visibleSendContantMeet"}},[t("AddSendContantMeet",{attrs:{sendTime:e.sendTime,planItem:e.editData,status:"detail",isEdit:e.isEdit},on:{cancle:function(t){e.visibleSendContantMeet=!1},serviceOk:e.serviceOk}})],1)],1)},a=[],s=i("5530"),r=(i("d81d"),i("b0c0"),i("d3b7"),i("d8bc")),o=(i("ac1f"),function(){var e=this,t=e._self._c;return t("CommonModal",{attrs:{title:e.title,okText:"确定",loading:e.loading},on:{cancle:function(t){return e.$emit("cancle")},serviceOk:e.serviceOk}},[t("div",{staticClass:"model-main"},[t("ul",{staticClass:"main",attrs:{id:"section"}},[t("li",[t("p",{staticClass:"title"},[e._v("选择OKR：")]),t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择OKR","show-search":"",allowClear:"","filter-option":!1,disabled:!e.isEdit},on:{search:e.handleSearch,change:e.changeOkr},model:{value:e.okrId,callback:function(t){e.okrId=t},expression:"okrId"}},e._l(e.deepOkrList,(function(i){return t("a-select-option",{key:i.id,attrs:{value:i.id}},[e._v(" "+e._s(i.workData)+" ")])})),1)],1),-1==e.okrId||"其他"==e.okrId?t("li",{staticClass:"retailve"},[t("p",{staticClass:"title"},[e._v("选择负责人：")]),t("usePerson",{attrs:{type:"deptId",source:e.source,placeHolder:"请选择负责人"},on:{usePersionInfo:e.usePersionInfo},model:{value:e.meetPersion,callback:function(t){e.meetPersion=t},expression:"meetPersion"}}),e.isEdit?e._e():t("div",{staticClass:"envelop"})],1):e._e(),t("li",{directives:[{name:"show",rawName:"v-show",value:e.isMeeting,expression:"isMeeting"}],staticClass:"retailve"},[t("p",{staticClass:"title"},[e._v("参与人：")]),t("usePerson",{attrs:{type:"deptId",placeHolder:"请选择参与人"},on:{usePersionInfo:e.usePersionInfo1},model:{value:e.attendees,callback:function(t){e.attendees=t},expression:"attendees"}}),e.isEdit?e._e():t("div",{staticClass:"envelop"})],1),t("li",{directives:[{name:"show",rawName:"v-show",value:e.isMeeting,expression:"isMeeting"}],staticClass:"retailve"},[t("p",{staticClass:"title"},[e._v("重复："),t("span",{staticClass:"red"},[e._v("(重复仅针对会议功能，工作记录请选择不重复)")])]),t("a-select",{staticStyle:{width:"200px"},attrs:{disabled:!e.isEdit},on:{change:e.changeRepeat},model:{value:e.reminders.repeatType,callback:function(t){e.$set(e.reminders,"repeatType",t)},expression:"reminders.repeatType"}},e._l(e.repetition,(function(i,n){return t("a-select-option",{key:n,attrs:{value:i.value}},[e._v(e._s(i.test))])})),1)],1),t("li",{directives:[{name:"show",rawName:"v-show",value:e.isMeeting,expression:"isMeeting"}]},[t("p",{staticClass:"title"},[e._v("是否开启提醒： "),t("a-switch",{attrs:{disabled:!e.isEdit},model:{value:e.isRemind,callback:function(t){e.isRemind=t},expression:"isRemind"}})],1),t("a-select",{directives:[{name:"show",rawName:"v-show",value:e.isRemind,expression:"isRemind"}],staticStyle:{width:"200px"},attrs:{disabled:!e.isEdit},model:{value:e.remindBeforeEventSecs,callback:function(t){e.remindBeforeEventSecs=t},expression:"remindBeforeEventSecs"}},e._l(e.remindTimeList,(function(i,n){return t("a-select-option",{key:n,attrs:{value:i.value}},[e._v(" "+e._s(i.text)+" ")])})),1)],1),t("li",{directives:[{name:"show",rawName:"v-show",value:e.isMeeting,expression:"isMeeting"}]},[t("p",{staticClass:"title"},[e._v("会议地点：")]),t("a-input",{attrs:{disabled:!e.isEdit,placeholder:"请输入会议地点"},model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1),t("li",[t("p",{staticClass:"title"},[e._v("时间"),t("span",{staticClass:"red"},[e._v("*")]),e._v(":")]),t("a-time-picker",{attrs:{format:"HH:mm",placeholder:"开始时间",disabled:!e.isEdit},on:{change:function(t){return e.changeStartTime(e.timeObj)}},model:{value:e.timeObj.startTime,callback:function(t){e.$set(e.timeObj,"startTime",t)},expression:"timeObj.startTime"}}),e._v(" ~ "),t("a-time-picker",{attrs:{format:"HH:mm",placeholder:"结束时间",disabled:!e.isEdit},on:{change:function(t){return e.changeEndTime(e.timeObj)}},model:{value:e.timeObj.endTime,callback:function(t){e.$set(e.timeObj,"endTime",t)},expression:"timeObj.endTime"}})],1),t("li",[t("p",{staticClass:"title"},[e._v("是否完成"),t("span",{staticClass:"red"},[e._v("*")]),e._v("： "),t("a-radio-group",{attrs:{name:"radioGroup",disabled:!e.isEdit||e.future},model:{value:e.isComplete,callback:function(t){e.isComplete=t},expression:"isComplete"}},[t("a-radio",{attrs:{value:1}},[e._v(" 完成 ")]),t("a-radio",{attrs:{value:0}},[e._v(" 进行中 ")])],1)],1)]),t("li",[t("p",{staticClass:"title"},[e._v("是否会议"),t("span",{staticClass:"red"},[e._v("*")]),e._v("： "),t("a-radio-group",{attrs:{name:"radioGroup",disabled:!e.isEdit},on:{change:e.changeIsMeet},model:{value:e.isMeetingOKR,callback:function(t){e.isMeetingOKR=t},expression:"isMeetingOKR"}},[t("a-radio",{attrs:{value:1}},[e._v(" 会议 ")]),t("a-radio",{attrs:{value:0}},[e._v(" 非会议 ")])],1)],1)]),t("li",[t("p",{staticClass:"title"},[e._v("描述"),t("span",{staticClass:"red"},[e._v("*")]),e._v("："),t("span",{staticClass:"red"},[e._v("(KR任务已完成则对完成值进行说明，未完成填写当天完成的内容)")])]),t("a-textarea",{attrs:{disabled:!e.isEdit,maxLength:512,placeholder:"设置内容名称,仅内容可见"},model:{value:e.taskContent,callback:function(t){e.taskContent=t},expression:"taskContent"}})],1)])]),t("a-modal",{attrs:{footer:null,destroyOnClose:"",centered:""},on:{cancel:e.cancleCustom},model:{value:e.isCustom,callback:function(t){e.isCustom=t},expression:"isCustom"}},[t("CustomRepetition",{attrs:{reminders:e.reminders,sendTime:e.sendTime},on:{cancle:e.cancleCustom,serviceOk:e.complete}})],1),t("CustomRepetition",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{isShow:!0,sendTime:e.sendTime,reminders:e.reminders},on:{serviceOk:e.complete}}),this.planItem.id&&e.isEdit?t("div",{attrs:{slot:"footer"},slot:"footer"},[t("a-popover",{attrs:{title:"请输入删除备注",trigger:"click"},model:{value:e.visiblePopover,callback:function(t){e.visiblePopover=t},expression:"visiblePopover"}},[t("template",{slot:"content"},[t("a-textarea",{attrs:{placeholder:"请输入备注"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}}),t("a-button",{attrs:{type:"link"},on:{click:function(t){e.visiblePopover=!1}}},[e._v("取消")]),t("a-button",{attrs:{type:"link",loading:e.popoverLoading},on:{click:e.submitPopover}},[e._v("确认")])],1),t("a-button",{attrs:{type:"danger"}},[e._v(" 删除 ")])],2)],1):e._e()],1)}),l=[],c=(i("7db0"),i("caad"),i("a434"),i("4de4"),i("2bf4")),d=i("9802"),u=i("6bd9"),m=i("2a86"),p=i("1bee"),h=i("1c9c"),f=(i("2532"),function(){var e=this,t=e._self._c;return t("CommonModal",{attrs:{title:"自定义重复",okText:"确定"},on:{cancle:function(t){return e.$emit("cancle")},serviceOk:e.serviceOk}},[t("a-form-model",{ref:"ruleForm",attrs:{model:e.reminders,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[t("a-form-model-item",{attrs:{label:"频率"}},[t("a-select",{on:{change:e.changeRepeatType},model:{value:e.reminders.repeatType,callback:function(t){e.$set(e.reminders,"repeatType",t)},expression:"reminders.repeatType"}},e._l(e.timeList,(function(i){return t("a-select-option",{key:i.value},[e._v(e._s(i.test))])})),1)],1),t("a-form-model-item",{attrs:{label:"每"}},[t("a-input-number",{directives:[{name:"show",rawName:"v-show",value:0==e.reminders.repeatType,expression:"reminders.repeatType == 0"}],attrs:{min:0},model:{value:e.reminders.repeatInterval,callback:function(t){e.$set(e.reminders,"repeatInterval",t)},expression:"reminders.repeatInterval"}}),t("a-select",{directives:[{name:"show",rawName:"v-show",value:1==e.reminders.repeatType,expression:"reminders.repeatType == 1"}],staticStyle:{width:"30%"},attrs:{placeholder:"请选择"},model:{value:e.reminders.repeatInterval,callback:function(t){e.$set(e.reminders,"repeatInterval",t)},expression:"reminders.repeatInterval"}},e._l(52,(function(i){return t("a-select-option",{key:i,attrs:{value:i}},[e._v(e._s(i))])})),1),t("a-select",{directives:[{name:"show",rawName:"v-show",value:2==e.reminders.repeatType,expression:"reminders.repeatType == 2"}],staticStyle:{width:"30%"},attrs:{placeholder:"请选择"},model:{value:e.reminders.repeatInterval,callback:function(t){e.$set(e.reminders,"repeatInterval",t)},expression:"reminders.repeatInterval"}},e._l(12,(function(i){return t("a-select-option",{key:i,attrs:{value:i}},[e._v(e._s(i))])})),1),t("a-select",{directives:[{name:"show",rawName:"v-show",value:5==e.reminders.repeatType,expression:"reminders.repeatType == 5"}],staticStyle:{width:"30%"},attrs:{placeholder:"请选择"},model:{value:e.reminders.repeatInterval,callback:function(t){e.$set(e.reminders,"repeatInterval",t)},expression:"reminders.repeatInterval"}},e._l(12,(function(i){return t("a-select-option",{key:i,attrs:{value:i}},[e._v(e._s(i))])})),1),e._v(" "+e._s(e.valueLabel)+" ")],1),e.specificTime?t("a-form-model-item",{attrs:{label:"每".concat(e.valueLabel,"的")}},[t("ul",{staticClass:"specific-wrap"},e._l(e.specificTime,(function(i,n){return t("li",{key:n,class:{active:e.changeArr.includes(n+1)},on:{click:function(t){return e.getActive(n+1)}}},[e._v(" "+e._s(i.test)+" ")])})),0)]):e._e(),t("a-form-model-item",{attrs:{label:"结束于"}},[t("a-date-picker",{attrs:{placeholder:"永不结束","disabled-date":e.disabledDate,defaultPickerValue:e.sendTime},model:{value:e.reminders.repeatUntil,callback:function(t){e.$set(e.reminders,"repeatUntil",t)},expression:"reminders.repeatUntil"}})],1)],1)],1)}),v=[],g=(i("a15b"),i("99af"),{components:{CommonModal:m["a"]},props:{reminders:{type:Object,default:function(){return{}}},isShow:{type:Boolean,default:!1},sendTime:{type:Object,default:function(){return this.$moment}}},data:function(){return{labelCol:{span:4},wrapperCol:{span:20},timeList:[{test:"按日重复",value:0,label:"日"},{test:"按周重复",value:1,label:"周",specificTime:[{test:"周一",value:1},{test:"周二",value:2},{test:"周三",value:3},{test:"周四",value:4},{test:"周五",value:5},{test:"周六",value:6},{test:"周日",value:7}]},{test:"按月重复",value:2,label:"月",specificTime:[{test:"1",value:""},{test:"2",value:""},{test:"3",value:""},{test:"4",value:""},{test:"5",value:""},{test:"6",value:""},{test:"7",value:""},{test:"8",value:""},{test:"9",value:""},{test:"10",value:""},{test:"11",value:""},{test:"12",value:""},{test:"13",value:""},{test:"14",value:""},{test:"15",value:""},{test:"16",value:""},{test:"17",value:""},{test:"18",value:""},{test:"19",value:""},{test:"20",value:""},{test:"21",value:""},{test:"22",value:""},{test:"23",value:""},{test:"24",value:""},{test:"25",value:""},{test:"26",value:""},{test:"27",value:""},{test:"28",value:""},{test:"29",value:""},{test:"30",value:""},{test:"31",value:""}]},{test:"按年重复",value:5,label:"年"}]}},mounted:function(){this.reminders.repeatType>=0&&this.isShow&&1==this.reminders.isCustomRepeat&&this.$emit("serviceOk",{test:this.getText,value:this.reminders.repeatType})},computed:{valueLabel:function(){var e,t=this,i=null===(e=this.timeList.find((function(e){return e.value===t.reminders.repeatType})))||void 0===e?void 0:e.label;return i},specificTime:function(){var e,t=this,i=null===(e=this.timeList.find((function(e){return e.value===t.reminders.repeatType})))||void 0===e?void 0:e.specificTime;return i},changeArr:function(){return 1==this.reminders.repeatType?this.reminders.repeatDayOfWeek||[]:2==this.reminders.repeatType&&this.reminders.repeatDayOfMonth||[]},getText:function(){var e,t,i,n,a=this,s="",r="";(this.reminders.repeatInterval&&1!==this.reminders.repeatInterval&&(r=this.reminders.repeatInterval),0==this.reminders.repeatType&&(s=""),1==this.reminders.repeatType)&&(s=null===(e=this.specificTime.filter((function(e,t){var i;return null===(i=a.reminders.repeatDayOfWeek)||void 0===i?void 0:i.includes(t+1)})))||void 0===e||null===(t=e.map((function(e){return e.test})))||void 0===t?void 0:t.join("、"));2==this.reminders.repeatType&&(s=(null===(i=this.specificTime.filter((function(e,t){var i;return null===(i=a.reminders.repeatDayOfMonth)||void 0===i?void 0:i.includes(t+1)})))||void 0===i||null===(n=i.map((function(e){return e.test})))||void 0===n?void 0:n.join("、"))+"号");if(this.reminders.repeatUntil){var o=this.reminders.repeatUntil.format("YYYY年MM月DD日");return"每".concat(r).concat(this.valueLabel).concat(s,"重复,").concat(o,"结束")}return"每".concat(r).concat(this.valueLabel).concat(s,"重复")}},methods:{serviceOk:function(){1==this.reminders.repeatType&&this.reminders.repeatDayOfWeek.length<1||2==this.reminders.repeatType&&this.reminders.repeatDayOfMonth<1?this.$message.warning("请选择日期"):this.$emit("serviceOk",{test:this.getText,value:this.reminders.repeatType})},disabledDate:function(e){var t;return e&&e<(null===(t=this.sendTime)||void 0===t?void 0:t.endOf("day"))},changeRepeatType:function(){this.reminders.repeatInterval=1},getActive:function(e){1==this.reminders.repeatType&&this.addOrDelete(e,this.reminders.repeatDayOfWeek),2==this.reminders.repeatType&&this.addOrDelete(e,this.reminders.repeatDayOfMonth)},addOrDelete:function(e,t){if(!e||!t)throw"必须传2个参数";var i=t.indexOf(e);i>=0?t.splice(i,1):t.push(e)}}}),b=g,T=(i("db3a"),i("2877")),k=Object(T["a"])(b,f,v,!1,null,"60578963",null),y=k.exports,O={name:"AddSendContant",components:{CommonModal:m["a"],usePerson:u["a"],CustomRepetition:y},mixins:[d["a"],c["a"]],props:{sendTime:{type:Object,default:function(){return this.$moment}},planItem:{type:[Object],default:function(){return{}}},status:{type:String,default:""},isEdit:{type:Boolean,default:!1},future:{type:Boolean,default:!1},userid:{type:String,default:""}},data:function(){return{visiblePopover:!1,source:{maxLength:1},filterValue:"",isCover:1,isMeeting:!0,isMeetingOKR:0,attendees:[],remindTimeList:[{text:"会议开始时",value:0},{text:"5分钟前",value:300},{text:"15分钟前",value:900},{text:"1小时前",value:3600},{text:"1天前",value:86400}],repetition:[{test:"不重复",value:-1},{test:"每天重复",value:0},{test:"每个工作日重复",value:7},{test:"每周重复",value:1},{test:"每月重复",value:2},{test:"每年重复",value:5},{test:"自定义",value:-2}],isRemind:!1,okrName:void 0,timeObj:{startTime:void 0,endTime:void 0},meetTime:{startTime:void 0,endTime:void 0},okrId:void 0,remark:null,loading:!1,remindBeforeEventSecs:0,leaderId:"",nickname:"",avatar:"",taskContent:"",planName:"",isComplete:0,okrList:[],title:"添加工作记录",location:"",meetPersion:[],isRepeat:0,isCustom:!1,popoverLoading:!1,reminders:{isCustomRepeat:0,repeatType:-1,repeatUntil:null,repeatInterval:null,repeatDayOfWeek:[],repeatDayOfMonth:[]},deepOkrList:[]}},watch:{planItem:{handler:function(){var e;if(null!==(e=this.planItem)&&void 0!==e&&e.id){var t;if(this.title="修改工作记录",this.okrName=this.planItem.okrname,this.timeObj.startTime=this.$moment(this.planItem.startTime),this.timeObj.endTime=this.$moment(this.planItem.endTime),this.okrId=this.planItem.okrId,this.taskContent=this.planItem.taskContent,this.isComplete=this.planItem.isComplete,this.leaderId=this.planItem.leaderId,this.avatar=this.planItem.avatar,this.isMeeting=Boolean(this.planItem.isMeeting),this.isMeetingOKR=this.planItem.isMeetingOKR,this.planItem.leaderId&&(this.meetPersion=[{key:this.planItem.leaderId,title:this.planItem.username,source:{userid:this.planItem.leaderId,thumbAvatar:this.planItem.avatar,name:this.planItem.username}}]),this.planItem.schedule)this.meetTime.startTime=this.planItem.schedule.meetingStartTime,this.meetTime.endTime=this.planItem.schedule.meetingEndTime,this.location=this.planItem.schedule.location,this.isRemind=Boolean(this.planItem.schedule.reminders.isRemind),this.remindBeforeEventSecs=this.planItem.schedule.reminders.remindBeforeEventSecs||0,this.sRepeat=this.planItem.schedule.reminders.sRepeat,this.isRepeat=this.planItem.schedule.reminders.isRepeat,this.reminders={isCustomRepeat:this.planItem.schedule.reminders.isCustomRepeat,repeatType:null===this.planItem.schedule.reminders.repeatType?-1:this.planItem.schedule.reminders.repeatType,repeatUntil:this.planItem.schedule.reminders.repeatUntil?this.$moment(this.planItem.schedule.reminders.repeatUntil):null,repeatInterval:this.planItem.schedule.reminders.repeatInterval,repeatDayOfWeek:this.planItem.schedule.reminders.repeatDayOfWeek||[],repeatDayOfMonth:this.planItem.schedule.reminders.repeatDayOfMonth||[]},this.attendees=null===(t=this.planItem.schedule.attendees)||void 0===t?void 0:t.map((function(e){return{key:e.userId,title:e.username,source:{userid:e.userId,name:e.username,thumbAvatar:e.avatar}}}))}else{var i=this.$store.state.user.info,n=i.userid,a=i.thumbAvatar,s=i.name;this.attendees=[{key:n,title:s,source:{userid:n,thumbAvatar:a,name:s}}]}},immediate:!0}},created:function(){this.future&&(this.isComplete=0),this.init()},methods:{init:function(){var e=this;Object(h["A"])({userId:this.userid,date:this.sendTime.format("YYYY-MM-DD")}).then((function(t){if(0===t.statusCode){e.okrList=t.data,e.deepOkrList=JSON.parse(JSON.stringify(e.okrList));var i=e.okrList.find((function(t){return t.id==e.okrId}));i||(e.okrId=e.planItem.okrname)}})).catch((function(t){e.$message.error(t)}))},usePersionInfo:function(e){this.leaderId=e[0].key,this.avatar=e[0].source.thumbAvatar,this.nickname=e[0].title},usePersionInfo1:function(e){this.attendees=e},changeTime:function(e){var t;return!((null===(t=this.timeObj.date)||void 0===t?void 0:t.format("YYYY MM DD"))==this.$moment().format("YYYY MM DD")&&!Object(p["b"])(null===e||void 0===e?void 0:e.format("HH:mm"),this.$moment().format("HH:mm")))||(this.$message.warning("发送时间不能小于当期时间"),!1)},serviceOk:function(){var e=this;this.isEdit?this.verify().then((function(){var t=e;e.isComplete?e.$confirm({title:"提示",content:"请确认是否已完成，点击已完成表示此项KR已结项（到了目标完成时间）或此项KR已完成，已完成后不能更改",onOk:function(){t.planItem.id?t.modifyFun():t.saveOKRFun(0)},onCancel:function(){}}):e.planItem.id?e.modifyFun():e.saveOKRFun(0)})).catch((function(t){e.$message.warning((null===t||void 0===t?void 0:t.message)||t)})):this.$emit("serviceOk")},saveOKRFun:function(e){var t=this,i=this.getParams(e);this.loading=!0,Object(h["x"])(i).then((function(e){t.$emit("serviceOk"),t.$message.success("添加成功")})).catch((function(e){t.$message.warning((null===e||void 0===e?void 0:e.msg)||e)})).finally((function(){t.loading=!1}))},modifyFun:function(){var e=this;this.loading=!0;var t=this.getParams();t.id=this.planItem.id,Object(h["u"])(t).then((function(t){e.$emit("serviceOk"),e.$message.success("更新成功")})).catch((function(t){e.$message.warning((null===t||void 0===t?void 0:t.msg)||t)})).finally((function(){e.loading=!1}))},getParams:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n={userId:this.userid,isCover:i,isMeeting:this.isMeeting?1:0,isMeetingOKR:this.isMeetingOKR,okrName:this.okrName,okrId:this.okrId===this.okrName?this.planItem.okrId:this.okrId,isComplete:this.isComplete?1:0,leaderId:-1==this.okrId?this.leaderId:"",avatar:this.avatar,nickname:this.nickname,startTime:this.getStartTime("startTime"),endTime:this.getStartTime("endTime"),taskContent:this.taskContent,attendees:null===(e=this.attendees)||void 0===e?void 0:e.map((function(e){return{userid:e.key}})),attenderInfo:null===(t=this.attendees)||void 0===t?void 0:t.map((function(e){return{userId:e.key,username:e.title,avatar:e.source.thumbAvatar}})),meetingStartTime:this.isMeeting?this.getStartTime("startTime"):"",meetingEndTime:this.isMeeting?this.getStartTime("endTime"):"",location:this.location,isRemind:this.isRemind?1:0,remindBeforeEventSecs:this.isRemind?this.remindBeforeEventSecs:null,isRepeat:this.isRepeat,repeatType:this.reminders.repeatType>=0?this.reminders.repeatType:"",repeatUntil:this.reminders.repeatUntil?this.reminders.repeatUntil.format("YYYY-MM-DD HH:mm:ss"):null,isCustomRepeat:this.reminders.isCustomRepeat,repeatInterval:this.reminders.repeatInterval,repeatDayOfWeek:this.reminders.repeatDayOfWeek,repeatDayOfMonth:this.reminders.repeatDayOfMonth};return n},verify:function(){var e=this;return new Promise((function(t,i){e.okrId||i("请选择OKR"),-1!==e.okrId||e.leaderId||i("请选择负责人"),e.timeObj.startTime||i("请选择开始时间"),e.timeObj.endTime||i("请选择结束时间"),[0,1].includes(e.isComplete)||i("请填写是否完成"),e.taskContent||i("请填写描述"),t()}))},deleteData:function(){var e=this;this.$confirm({title:"提示",icon:"",cancelText:"取消",okText:"删除",content:"确认删除后，将会删除这条推送",onOk:function(){e.delPage()}})},delPage:function(){this.planItem.delete=!0,this.$emit("serviceOk",this.planItem)},checkTimeFun:function(e){var t=this,i={userId:this.userid,startTime:this.sendTime.format("YYYY-MM-DD")+" "+this.$moment(this.timeObj.startTime).format("HH:mm:00"),endTime:this.sendTime.format("YYYY-MM-DD")+" "+this.$moment(this.timeObj.endTime).format("HH:mm:00")};Object(h["d"])(i).then((function(t){e()})).catch((function(e){var i="";-2===e.statusCode&&(i=e.error.Code);var n=t;t.$confirm({title:"提示",icon:"",okText:"确认",class:-2==i?"cancle":"",content:e.msg,onOk:function(){n.saveOKRFun(1)}})}))},changeOkr:function(e){var t;this.okrId=e,this.okrName=null===(t=this.okrList.find((function(t){return t.id===e})))||void 0===t?void 0:t.workData},changeRepeat:function(e){return-1==e?(this.reminders.isCustomRepeat=0,this.isRepeat=0,void(this.isCustom=!1)):-2==e?(this.reminders.isCustomRepeat=1,this.isRepeat=1,this.isCustom=!0,void([0,1,2,5].includes(this.reminders.repeatType)||(this.reminders.repeatType=0))):(this.reminders.isCustomRepeat=0,this.isCustom=!1,void(this.isRepeat=1))},cancleCustom:function(){this.isCustom=!1,this.changeRepeat(this.reminders.repeatType)},complete:function(e){this.isCustom=!1,7===this.repetition.length?this.repetition.splice(6,0,e):this.repetition[6]=e},submitPopover:function(){var e=this;if(this.remark){this.popoverLoading=!0;var t={id:this.planItem.id,userId:this.userid||this.planItem.schedule.organizer,startTime:this.planItem.startTime,endTime:this.planItem.endTime,remark:this.remark,okrId:this.planItem.okrId};Object(h["f"])(t).then((function(t){e.visiblePopover=!1,e.$emit("serviceOk"),e.$message.success("删除成功")})).catch((function(t){e.$message.warning((null===t||void 0===t?void 0:t.msg)||t)})).finally((function(){e.popoverLoading=!1}))}else this.$message.warning("请填写备注")},getStartTime:function(e){var t,i="";return i=null!==(t=this.planItem)&&void 0!==t&&t.id&&this.isRepeat?this.$moment(this.planItem.startTime).format("YYYY-MM-DD")+" "+this.$moment(this.timeObj[e]).format("HH:mm:00"):this.sendTime.format("YYYY-MM-DD")+" "+this.$moment(this.timeObj[e]).format("HH:mm:00"),i},changeIsMeet:function(e){0==this.isMeetingOKR&&(this.reminders.repeatType=-1)},handleSearch:function(e){var t=this.okrList.filter((function(t){return t.workData.indexOf(e)>=0}));this.deepOkrList=t,this.$forceUpdate()}}},C=O,I=(i("0d02"),Object(T["a"])(C,o,l,!1,null,"20b9ef70",null)),L=I.exports,_=function(){var e=this,t=e._self._c;return t("a-calendar",{attrs:{"header-render":e.headerRender},on:{select:e.select,panelChange:e.panelChange},scopedSlots:e._u([{key:"dateCellRender",fn:function(i){return t("ul",{staticClass:"events"},e._l(e.getListData(i),(function(n){return t("li",{key:n.content,staticClass:"time-content",class:{overdue:n.overdue},on:{click:function(t){return t.stopPropagation(),e.$emit("select",i,n)}}},[t("a-tooltip",{attrs:{title:n.text}},[t("p",{staticClass:"other"},[e._v("【"+e._s(e._f("getTime")(n.timeObj))+"】 "+e._s(n.text))])])],1)})),0)}}]),model:{value:e.selfTime,callback:function(t){e.selfTime=t},expression:"selfTime"}})},j=[],D=(i("159b"),i("c1df")),R=i.n(D),w={name:"Calendar",props:{planList:{type:Array,default:function(){return[]}},repeatList:{type:Array,default:function(){return[]}},status:{type:String,default:""},sendTime:{default:function(){return R()()}}},filters:{getTime:function(e){var t="";return e.time&&(t+=e.time.format("HH:mm")+"~"),e.date&&(t+=e.date.format("HH:mm")),t}},data:function(){return{repetition:[{test:"不重复",value:-1},{test:"每天重复",value:0},{test:"每个工作日重复",value:7},{test:"每周重复",value:1},{test:"每月重复",value:2},{test:"每年重复",value:5},{test:"自定义",value:-2}],selfTime:void 0}},watch:{planList:function(){this.getRepeat()},repeatList:function(){this.getRepeat()},sendTime:{handler:function(){this.selfTime=this.sendTime},immediate:!0,deep:!0}},methods:{getListData:function(e){var t=this,i=[];return this.planList.forEach((function(t){e.format("LL")===t.timeObj.date.format("LL")&&i.push(Object(s["a"])({},t))})),this.repeatList.forEach((function(n){if(e.format("LL")!==n.timeObj.date.format("LL")){if(e>n.timeObj.date){var a=n.schedule.reminders.repeatUntil,r=n.schedule.reminders.repeatDateList,o=n.schedule.reminders.repeatType;a?t.$moment(t.$moment(a).format("YYYY-MM-DD"))>e.clone().add(-1,"day")&&t.addRepeat(r,o,e,i,n):t.addRepeat(r,o,e,i,n)}}else i.push(Object(s["a"])({},n))})),i||[]},headerRender:function(e){for(var t=e.value,i=(e.type,e.onChange),n=(e.onTypeChange,this.$createElement),a=0,s=12,r=[],o=t.clone(),l=t.localeData(),c=[],d=0;d<12;d++)o.month(d),c.push(l.monthsShort(o));for(var u=a;u<s;u++)r.push(n("a-select-option",{class:"month-item",key:"".concat(u)},[c[u]]));for(var m=t.month(),p=t.year(),h=[],f=p-10;f<p+10;f+=1)h.push(n("a-select-option",{key:f,attrs:{value:f},class:"year-item"},[f]));return n("div",{style:{padding:"10px"}},[n("a-row",{attrs:{type:"flex",justify:"center"}},[n("a-col",[n("a-select",{attrs:{dropdownMatchSelectWidth:!1,value:String(p)},class:"my-year-select",on:{change:function(e){var n=t.clone().year(e);i(n)}}},[h])]),n("a-col",[n("a-select",{attrs:{dropdownMatchSelectWidth:!1,value:String(m)},on:{change:function(e){var n=t.clone();n.month(parseInt(e,10)),i(n)}}},[r])])])])},select:function(e){if(e.format("YYYY MM DD")>=this.$moment().format("YYYY MM DD")){var t=e.format("YYYY-MM-DD")+" "+this.$moment().format("HH:mm:ss");this.$emit("select",this.$moment(t),"","visibleSendContant")}else{var i=e.format("YYYY-MM-DD")+" "+this.$moment().format("HH:mm:ss");this.$emit("select",this.$moment(i),"","visibleSendContantMeet")}},panelChange:function(e){this.$emit("panelChange",e)},getRepeat:function(){var e;(null===(e=this.repeatList)||void 0===e?void 0:e.length)>0&&this.repeatList.forEach((function(e){if(1===e.schedule.reminders.isCustomRepeat)switch(e.schedule.reminders.repeatType){case 0:e.schedule.reminders.repeatInterval?e.schedule.reminders.repeatDateList=String(e.schedule.reminders.repeatInterval):e.schedule.reminders.repeatDateList=[1,2,3,4,5,6,7];break;case 1:e.schedule.reminders.repeatDateList=String(e.schedule.reminders.repeatInterval);break;case 2:e.schedule.reminders.repeatDateList=e.schedule.reminders.repeatDayOfMonth;break;case 5:e.schedule.reminders.repeatDateList=e.timeObj.date.format("MM DD");break;default:break}else switch(e.schedule.reminders.repeatType){case 0:e.schedule.reminders.repeatDateList=[1,2,3,4,5,6,7];break;case 1:e.schedule.reminders.repeatDateList=[e.timeObj.date.day()];break;case 2:e.schedule.reminders.repeatDateList=e.timeObj.date.format("DD");break;case 5:e.schedule.reminders.repeatDateList=e.timeObj.date.format("MM DD");break;case 7:e.schedule.reminders.repeatDateList=[1,2,3,4,5];break;default:break}}))},addRepeat:function(e,t,i,n,a){if(e)if("string"===typeof e){if(0===t&&this.$moment(a.timeObj.date.format("YYYY MM DD")).unix()%(86400*a.schedule.reminders.repeatInterval)==this.$moment(i.format("YYYY MM DD")).unix()%(86400*a.schedule.reminders.repeatInterval)&&n.push(Object(s["a"])({},a)),1===t&&a.timeObj.date.week()%a.schedule.reminders.repeatInterval==this.$moment(i.format("YYYY MM DD")).week()%a.schedule.reminders.repeatInterval){var r=i.day();0===r&&(r=7),a.schedule.reminders.repeatDayOfWeek.includes(r)&&n.push(Object(s["a"])({},a))}2===t&&i.format("DD")===e&&n.push(Object(s["a"])({},a)),5===t&&i.format("MM DD")===e&&(a.schedule.reminders.repeatInterval?i.format("YYYY")%a.schedule.reminders.repeatInterval===a.timeObj.date.format("YYYY")%a.schedule.reminders.repeatInterval&&n.push(Object(s["a"])({},a)):n.push(Object(s["a"])({},a)))}else{var o=i.day();0===o&&(o=7),[0,1,7].includes(t)&&e.includes(o)&&n.push(Object(s["a"])({},a)),2===t&&(a.timeObj.date.month()+1)%a.schedule.reminders.repeatInterval==(i.month()+1)%a.schedule.reminders.repeatInterval&&a.schedule.reminders.repeatDayOfMonth.includes(i.date())&&n.push(Object(s["a"])({},a))}}}},M=w,Y=(i("d7aa"),Object(T["a"])(M,_,j,!1,null,"5d99f8f4",null)),S=Y.exports,x=i("842b"),$=function(){var e=this,t=e._self._c;return t("CommonModal",{attrs:{title:"添加会议",okText:"确定"},on:{cancle:function(t){return e.$emit("cancle")},serviceOk:e.serviceOk}},[t("div",{staticClass:"model-main"},[t("ul",{staticClass:"main",attrs:{id:"section"}},[t("li",{staticClass:"retailve"},[t("p",{staticClass:"title"},[e._v("会议参与人：")]),t("usePerson",{attrs:{type:"deptId",placeHolder:"请选择会议参与人"},on:{usePersionInfo:e.usePersionInfo1},model:{value:e.attendees,callback:function(t){e.attendees=t},expression:"attendees"}}),e.isEdit?e._e():t("div",{staticClass:"envelop"})],1),t("li",{staticClass:"retailve"},[t("p",{staticClass:"title"},[e._v("重复：")]),t("a-select",{staticStyle:{width:"200px"},on:{change:e.changeRepeat},model:{value:e.repeatType,callback:function(t){e.repeatType=t},expression:"repeatType"}},e._l(e.repetition,(function(i,n){return t("a-select-option",{key:n,attrs:{value:i.value}},[e._v(e._s(i.test))])})),1)],1),t("li",[t("p",{staticClass:"title"},[e._v("是否开启提醒： "),t("a-switch",{attrs:{disabled:!e.isEdit},model:{value:e.isRemind,callback:function(t){e.isRemind=t},expression:"isRemind"}})],1),t("a-select",{directives:[{name:"show",rawName:"v-show",value:e.isRemind,expression:"isRemind"}],staticStyle:{width:"200px"},attrs:{disabled:!e.isEdit},model:{value:e.remindBeforeEventSecs,callback:function(t){e.remindBeforeEventSecs=t},expression:"remindBeforeEventSecs"}},e._l(e.remindTimeList,(function(i,n){return t("a-select-option",{key:n,attrs:{value:i.value}},[e._v(" "+e._s(i.text)+" ")])})),1)],1),t("li",[t("p",{staticClass:"title"},[e._v("会议地点：")]),t("a-input",{attrs:{disabled:!e.isEdit,placeholder:"请输入会议地点"},model:{value:e.location,callback:function(t){e.location=t},expression:"location"}})],1),t("li",[t("p",{staticClass:"title"},[e._v("会议时间"),t("span",{staticClass:"red"},[e._v("*")]),e._v(":")]),t("a-time-picker",{attrs:{format:"HH:mm",placeholder:"开始时间",disabled:!e.isEdit},on:{change:function(t){return e.changeStartTime(e.meetTime)}},model:{value:e.meetTime.startTime,callback:function(t){e.$set(e.meetTime,"startTime",t)},expression:"meetTime.startTime"}}),e._v(" ~ "),t("a-time-picker",{attrs:{format:"HH:mm",placeholder:"结束时间",disabled:!e.isEdit},on:{change:function(t){return e.changeEndTime(e.meetTime)}},model:{value:e.meetTime.endTime,callback:function(t){e.$set(e.meetTime,"endTime",t)},expression:"meetTime.endTime"}})],1),t("li",[t("p",{staticClass:"title"},[e._v("描述"),t("span",{staticClass:"red"},[e._v("*")]),e._v("：")]),t("a-input",{attrs:{disabled:!e.isEdit,placeholder:"设置内容名称,仅内容可见"},model:{value:e.taskContent,callback:function(t){e.taskContent=t},expression:"taskContent"}})],1)])]),t("a-modal",{attrs:{footer:null,destroyOnClose:"",centered:""},on:{cancel:e.cancleCustom},model:{value:e.isCustom,callback:function(t){e.isCustom=t},expression:"isCustom"}},[t("CustomRepetition",{attrs:{reminders:e.reminders},on:{cancle:e.cancleCustom}})],1)],1)},P=[],H={name:"AddSendContant",components:{CommonModal:m["a"],usePerson:u["a"],CustomRepetition:y},mixins:[d["a"],c["a"]],props:{sendTime:{type:Object,default:function(){return this.$moment}},planItem:{type:[Object],default:function(){return{}}},status:{type:String,default:""},isEdit:{type:Boolean,default:!1}},data:function(){return{source:{maxLength:1},isCover:1,isMeeting:!1,attendees:[],remindTimeList:[{text:"会议开始时",value:0},{text:"5分钟前",value:300},{text:"15分钟前",value:900},{text:"1小时前",value:3600},{text:"1天前",value:86400}],repetition:[{test:"不重复",value:-1},{test:"每天重复",value:0},{test:"每个工作日重复",value:7},{test:"每周重复",value:1},{test:"每月重复",value:2},{test:"每年重复",value:5},{test:"自定义",value:-2}],isCustom:!1,repeatType:-1,isRepeat:0,isCustomRepeat:0,isRemind:!1,okrName:"",timeObj:{startTime:void 0,endTime:void 0},meetTime:{startTime:void 0,endTime:void 0},okrId:void 0,remindBeforeEventSecs:0,leaderId:"",taskContent:"",planName:"",isComplete:"",okrList:[],userid:"",location:"",meetPersion:[],reminders:{repeatUntil:0}}},watch:{planItem:{handler:function(){var e;if(null!==(e=this.planItem)&&void 0!==e&&e.taskContent){var t;if(this.timeObj.startTime=this.planItem.startTime,this.timeObj.endTime=this.planItem.endTime,this.okrId=this.planItem.okrname,this.taskContent=this.planItem.taskContent,this.isComplete=this.planItem.isComplete,this.isMeeting=Boolean(this.planItem.isMeeting),this.meetPersion=[{key:this.planItem.userId,title:this.planItem.username,source:{userid:this.planItem.userId,thumbAvatar:this.planItem.avatar,name:this.planItem.username}}],this.planItem.schedule)this.meetTime.startTime=this.planItem.schedule.meetingStartTime,this.meetTime.endTime=this.planItem.schedule.meetingEndTime,this.location=this.planItem.schedule.location,this.isRemind=Boolean(this.planItem.schedule.reminders.isRemind),this.remindBeforeEventSecs=this.planItem.schedule.reminders.remindBeforeEventSecs,this.attendees=null===(t=this.planItem.schedule.attendees)||void 0===t?void 0:t.map((function(e){return{key:e.userId,title:e.username,source:{userid:e.userId,name:e.username,thumbAvatar:e.avatar}}}))}else{var i=this.$store.state.user.info,n=i.userid,a=i.thumbAvatar,s=i.name;this.attendees=[{key:n,title:s,source:{userid:n,thumbAvatar:a,name:s}}]}},immediate:!0}},created:function(){this.userid=this.$store.state.user.info.userid,this.init()},methods:{init:function(){var e=this;Object(h["A"])({userId:this.userid}).then((function(t){0===t.statusCode&&(e.okrList=t.data)}))},usePersionInfo:function(e){this.leaderId=e[0].key},usePersionInfo1:function(e){this.attendees=e},changeTime:function(e){var t;return!((null===(t=this.timeObj.date)||void 0===t?void 0:t.format("YYYY MM DD"))==this.$moment().format("YYYY MM DD")&&!Object(p["b"])(null===e||void 0===e?void 0:e.format("HH:mm"),this.$moment().format("HH:mm")))||(this.$message.warning("发送时间不能小于当期时间"),!1)},disabledHours:function(){for(var e=this.$moment().format("HH"),t=[],i=0;i<e;i++)t.push(i);return t},disabledMinutes:function(e){var t=this.$moment().format("mm"),i=this.$moment().format("HH"),n=[];if(e==i)for(var a=0;a<t;a++)n.push(a);return n},disabledDate:function(e){return e&&e<=this.$moment().subtract(1,"days")},addContent:function(){this.sendContentList.push(this.defaultSendContentList()),this.$nextTick((function(){var e=document.getElementById("section");e.scrollHeight>e.clientHeight&&setTimeout((function(){e.scrollTop=e.scrollHeight}),300)}))},delContent:function(e){this.sendContentList.splice(e,1)},serviceOk:function(){var e=this;this.isEdit?this.verify().then((function(){e.saveOKRFun(0)})).catch((function(t){e.$message.warning((null===t||void 0===t?void 0:t.message)||t)})):this.$emit("serviceOk")},saveOKRFun:function(e){var t,i,n=this,a={userId:this.userid,isCover:e,isMeeting:1,okrName:this.okrName,okrId:this.okrId,isComplete:this.isComplete?1:0,leaderId:-1==this.okrId?this.leaderId:"",taskContent:this.taskContent,attendees:null===(t=this.attendees)||void 0===t?void 0:t.map((function(e){return{userid:e.key,username:e.title,avatar:e.source.thumbAvatar}})),attenderInfo:null===(i=this.attendees)||void 0===i?void 0:i.map((function(e){return{userId:e.key,username:e.title,avatar:e.source.thumbAvatar}})),meetingStartTime:this.sendTime.format("YYYY-MM-DD")+" "+this.$moment(this.meetTime.startTime).format("HH:mm:00"),meetingEndTime:this.sendTime.format("YYYY-MM-DD")+" "+this.$moment(this.meetTime.endTime).format("HH:mm:00"),location:this.location,isRemind:this.isRemind?1:0,remindBeforeEventSecs:this.isRemind?this.remindBeforeEventSecs:null,isRepeat:this.isRepeat,repeatType:this.repeatType>=0?this.repeatType:""};Object(h["x"])(a).then((function(e){n.$emit("serviceOk"),n.$message.success("添加成功")})).catch((function(e){n.$message.warning((null===e||void 0===e?void 0:e.msg)||e)}))},verify:function(){var e=this;return new Promise((function(t,i){e.location||i("请填写会议地点"),e.meetTime.startTime||i("请选择会议开始时间"),e.meetTime.endTime||i("请选择会议结束时间"),e.taskContent||i("请填写描述"),t()}))},deleteData:function(){var e=this;this.$confirm({title:"提示",icon:"",cancelText:"取消",okText:"删除",content:"确认删除后，将会删除这条推送",onOk:function(){e.delPage()}})},delPage:function(){this.planItem.delete=!0,this.$emit("serviceOk",this.planItem)},checkTimeFun:function(e){var t=this,i={userId:this.userid,startTime:this.$moment(this.timeObj.startTime).format("YYYY-MM-DD HH:mm:ss"),endTime:this.$moment(this.timeObj.endTime).format("YYYY-MM-DD HH:mm:ss")};Object(h["d"])(i).then((function(t){e()})).catch((function(e,i){var n="";-2===i.errorCode&&(n=i.error.Code);var a=t;t.$confirm({title:"提示",icon:"",okText:"确认",class:-2==n?"cancle":"",content:e,onOk:function(){a.saveOKRFun(1)}})}))},changeOkr:function(e){this.okrName=this.okrList.find((function(t){return t.id===e})).workData},changeRepeat:function(e){return 0==e?(this.isCustomRepeat=0,this.isRepeat=0,void(this.isCustom=!1)):-2==e?(this.isCustomRepeat=1,this.isRepeat=1,void(this.isCustom=!0)):(this.isCustomRepeat=0,this.isCustom=!1,void(this.isRepeat=1))},cancleCustom:function(){this.isCustom=!1,this.repeatType=-1,this.changeRepeat(this.repeatType)}}},A=H,U=(i("b35a"),Object(T["a"])(A,$,P,!1,null,"3bddab03",null)),E=U.exports,N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrap"},[t("header",{staticClass:"header"},[t("a-button",{attrs:{type:"link"},on:{click:function(t){return e.changeDate("subtract")}}},[t("a-icon",{attrs:{type:"left"}})],1),t("a-button",{attrs:{type:"link"},on:{click:function(t){return e.changeDate("add")}}},[t("a-icon",{attrs:{type:"right"}})],1),t("h2",[e._v(" "+e._s(e._f("dayFormat")(e.selectTime))+" ")])],1),t("ul",{staticClass:"list-wrap"},e._l(e.get24Hource(),(function(i,n){return t("li",{key:n,staticClass:"list"},[t("span",[e._v(e._s(e._f("changeTimeTest")(i.test)))]),i.okrList.length<1?t("div",{staticClass:"dashed",class:{"now-hource":i.test===e.nowHource&&e.isToday()}},[t("div",{staticClass:"round"})]):t("ul",{staticClass:"okr-list-wrap"},e._l(i.okrList,(function(i,n){return t("li",{key:n,staticClass:"day-content",on:{click:function(t){return e.select(i)}}},[t("a-tooltip",{attrs:{title:i.okrname}},[t("p",{staticClass:"primaryColor okr-name"},[e._v(e._s(i.okrname))])]),t("p",{staticClass:"primaryColor"},[e._v(e._s(i.hourText))])],1)})),0)])})),0)])},F=[],B={name:"Day",components:{},props:{planList:{type:Array,default:function(){return[]}},repeatList:{type:Array,default:function(){return[]}},status:{type:String,default:""},sendTime:{default:function(){return moment()}}},data:function(){return{listData:[],selectTime:void 0,nowHource:void 0}},watch:{planList:function(){this.getListData()},repeatList:function(){this.getListData()},sendTime:{handler:function(){this.selectTime=this.sendTime,this.nowHource=this.selectTime.hours(),this.getListData()},immediate:!0,deep:!0}},filters:{dayFormat:function(e){return e?e.format("YYYY年MM月DD日"):e},changeTimeTest:function(e){return e<=9?"0".concat(e,":00"):"".concat(e,":00")}},methods:{select:function(e){this.$emit("select",this.selectTime,e)},get24Hource:function(){for(var e=this,t=[],i=function(i){var n=e.listData.find((function(e){return e.hour===i}));n?t.push(Object(s["a"])({test:i,okrList:[]},n)):t.push({okrList:[],test:i})},n=0;n<24;n++)i(n);return t},getListData:function(){var e=this,t=[];this.planList.forEach((function(i){e.selectTime.format("LL")===i.timeObj.time.format("LL")&&e.pushList(t,i)})),this.repeatList.forEach((function(i){if(e.selectTime.format("LL")===i.timeObj.time.format("LL")&&e.pushList(t,i),e.selectTime>i.timeObj.date){var n=i.schedule.reminders.repeatUntil,a=i.schedule.reminders.repeatDateList,s=i.schedule.reminders.repeatType;n?e.$moment(n)>e.selectTime.clone().add(-1,"day")&&e.addRepeat(a,s,e.selectTime,t,i):e.addRepeat(a,s,e.selectTime,t,i)}})),this.listData=t},changeDate:function(e){var t=this.selectTime.clone();"add"===e&&this.selectTime.add(1,"day"),"subtract"===e&&this.selectTime.subtract(1,"day"),t.month()!=this.selectTime.month()&&this.$emit("panelChange",this.selectTime),this.getListData(),this.$forceUpdate()},isToday:function(){return this.$moment().format("LL")===this.selectTime.format("LL")},addRepeat:function(e,t,i,n,a){if(e)if("string"===typeof e){if(0===t&&this.$moment(a.timeObj.date.format("YYYY MM DD")).unix()%(86400*a.schedule.reminders.repeatInterval)==this.$moment(i.format("YYYY MM DD")).unix()%(86400*a.schedule.reminders.repeatInterval)&&this.pushList(n,a),1===t&&a.timeObj.date.week()%a.schedule.reminders.repeatInterval==this.$moment(i.format("YYYY MM DD")).week()%a.schedule.reminders.repeatInterval){var s=i.day();0===s&&(s=7),a.schedule.reminders.repeatDayOfWeek.includes(s)&&this.pushList(n,a)}2===t&&i.format("DD")===e&&this.pushList(n,a),5===t&&i.format("MM DD")===e&&(a.schedule.reminders.repeatInterval?i.format("YYYY")%a.schedule.reminders.repeatInterval===a.timeObj.date.format("YYYY")%a.schedule.reminders.repeatInterval&&this.pushList(n,a):this.pushList(n,a))}else{var r=i.day();0===r&&(r=7),[0,1,7].includes(t)&&e.includes(r)&&this.pushList(n,a),2===t&&(a.timeObj.date.month()+1)%a.schedule.reminders.repeatInterval==(i.month()+1)%a.schedule.reminders.repeatInterval&&a.schedule.reminders.repeatDayOfMonth.includes(i.date())&&this.pushList(n,a)}},pushList:function(e,t){var i=e.find((function(e){return e.hour===t.timeObj.time.hours()}));i?i.okrList.push(Object(s["a"])(Object(s["a"])({},t),{},{hour:t.timeObj.time.hours(),hourText:"".concat(t.timeObj.time.format("HH:mm"),"~").concat(t.timeObj.date.format("HH:mm"))})):e.push({hour:t.timeObj.time.hours(),okrList:[Object(s["a"])(Object(s["a"])({},t),{},{hour:t.timeObj.time.hours(),hourText:"".concat(t.timeObj.time.format("HH:mm"),"~").concat(t.timeObj.date.format("HH:mm"))})]})}}},W=B,K=(i("7c0b"),Object(T["a"])(W,N,F,!1,null,"ffdea6ea",null)),J=K.exports,z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrap"},[t("header",{staticClass:"header"},[t("div",[e._v(" "+e._s(e._f("mounthFormat")(e.selectTime))+" "),t("a-button",{attrs:{type:"link"},on:{click:function(t){return e.changeDate("subtract")}}},[t("a-icon",{attrs:{type:"left"}})],1),t("a-button",{attrs:{type:"link"},on:{click:function(t){return e.changeDate("add")}}},[t("a-icon",{attrs:{type:"right"}})],1)],1),t("ul",{staticClass:"time-wrap"},e._l(e.timeList,(function(i,n){return t("li",{key:n,class:{active:e.selectTime.weekday()===n}},[t("p",[e._v(e._s(e.weekList[i.time.weekday()]))]),t("p",[e._v(e._s(i.time.format("DD")))])])})),0)]),t("ul",{staticClass:"list-wrap"},e._l(e.get24Hource,(function(i,n){return t("li",{key:n,staticClass:"hour-list"},[t("span",{staticClass:"hour-time"},[e._v(e._s(e._f("changeTimeTest")(i.test)))]),e._l(e.timeList,(function(a,s){return t("div",{key:s,staticClass:"list",class:{top:0===n,left:0===s,zero:e.isZero(i.test,a)}},[e.getOkrList(a.data,i.test).length<1?t("div",{staticClass:"dashed",class:{"now-hource":i.test===e.nowHource&&e.isToday(),active:e.selectTime.weekday()===s}},[t("div",{staticClass:"round"})]):t("ul",{staticClass:"okr-list-wrap"},e._l(e.getOkrList(a.data,i.test),(function(i,n){return t("li",{key:n,staticClass:"day-content",on:{click:function(t){return e.select(i)}}},[t("a-tooltip",{attrs:{title:i.okrname}},[t("p",{staticClass:"primaryColor okr-name"},[e._v(e._s(i.okrname))])]),t("p",{staticClass:"primaryColor"},[e._v(e._s(i.hourText))])],1)})),0)])}))],2)})),0)])},G=[],q={name:"Week",components:{},props:{planList:{type:Array,default:function(){return[]}},repeatList:{type:Array,default:function(){return[]}},status:{type:String,default:""},sendTime:{default:function(){return moment()}}},data:function(){return{listData:[],selectTime:void 0,nowHource:void 0,timeList:[],weekList:["周一","周二","周三","周四","周五","周六","周天"]}},created:function(){this.getWeekList()},watch:{planList:function(){this.getWeekList(),this.getListData()},repeatList:function(){this.getWeekList(),this.getListData()},sendTime:{handler:function(){this.selectTime=this.sendTime,this.nowHource=this.selectTime.hours(),this.getWeekList()},immediate:!0,deep:!0}},computed:{get24Hource:function(){for(var e=this,t=[],i=function(i){var n=e.listData.find((function(e){return e.hour===i})),a=e.listData.find((function(e){return e.hour<i&&e.endHour>=i})),r=!1;a&&(r=!0),n?t.push(Object(s["a"])(Object(s["a"])({test:i,okrList:[]},n),{},{zero:!0})):t.push({okrList:[],test:i,zero:r})},n=0;n<24;n++)i(n);return t}},filters:{dayFormat:function(e){return e?e.format("YYYY年MM月DD日"):e},mounthFormat:function(e){return e?e.format("YYYY年MM月"):e},changeTimeTest:function(e){return e<=9?"0".concat(e,":00"):"".concat(e,":00")}},methods:{getWeekList:function(){for(var e=this.selectTime.weekday(),t=[],i=0;i<7;i++)t.push({time:this.selectTime.clone().add(i-e,"d"),data:this.getListData(this.selectTime.clone().add(i-e,"d"))});this.timeList=t},select:function(e){this.$emit("select",this.selectTime,e)},getListData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectTime,i=[];return this.planList.forEach((function(n){t.format("LL")===n.timeObj.time.format("LL")&&e.pushList(i,n)})),this.repeatList.forEach((function(n){if(t.format("LL")===n.timeObj.time.format("LL")&&e.pushList(i,n),t>n.timeObj.date){var a=n.schedule.reminders.repeatUntil,s=n.schedule.reminders.repeatDateList,r=n.schedule.reminders.repeatType;a?e.$moment(a)>t.clone().add(-1,"day")&&e.addRepeat(s,r,t,i,n):e.addRepeat(s,r,t,i,n)}})),this.listData=i,i},changeDate:function(e){var t=this.selectTime.clone();"add"===e&&this.selectTime.add(7,"day"),"subtract"===e&&this.selectTime.subtract(7,"day"),t.month()!=this.selectTime.month()&&this.$emit("panelChange",this.selectTime),this.getWeekList(),this.getListData(),this.$forceUpdate()},isToday:function(){return this.$moment().format("LL")===this.selectTime.format("LL")},addRepeat:function(e,t,i,n,a){if(e)if("string"===typeof e){if(0===t&&this.$moment(a.timeObj.date.format("YYYY MM DD")).unix()%(86400*a.schedule.reminders.repeatInterval)==this.$moment(i.format("YYYY MM DD")).unix()%(86400*a.schedule.reminders.repeatInterval)&&this.pushList(n,a),1===t&&a.timeObj.date.week()%a.schedule.reminders.repeatInterval==this.$moment(i.format("YYYY MM DD")).week()%a.schedule.reminders.repeatInterval){var s=i.day();0===s&&(s=7),a.schedule.reminders.repeatDayOfWeek.includes(s)&&this.pushList(n,a)}2===t&&i.format("DD")===e&&this.pushList(n,a),5===t&&i.format("MM DD")===e&&(a.schedule.reminders.repeatInterval?i.format("YYYY")%a.schedule.reminders.repeatInterval===a.timeObj.date.format("YYYY")%a.schedule.reminders.repeatInterval&&this.pushList(n,a):this.pushList(n,a))}else{var r=i.day();0===r&&(r=7),[0,1,7].includes(t)&&e.includes(r)&&this.pushList(n,a),2===t&&(a.timeObj.date.month()+1)%a.schedule.reminders.repeatInterval==(i.month()+1)%a.schedule.reminders.repeatInterval&&a.schedule.reminders.repeatDayOfMonth.includes(i.date())&&this.pushList(n,a)}},pushList:function(e,t){var i=e.find((function(e){return e.hour===t.timeObj.time.hours()}));i?i.okrList.push(Object(s["a"])(Object(s["a"])({},t),{},{hour:t.timeObj.time.hours(),endHour:t.timeObj.date.hours(),hourText:"".concat(t.timeObj.time.format("HH:mm"),"~").concat(t.timeObj.date.format("HH:mm"))})):e.push({hour:t.timeObj.time.hours(),endHour:t.timeObj.date.hours(),okrList:[Object(s["a"])(Object(s["a"])({},t),{},{hour:t.timeObj.time.hours(),endHour:t.timeObj.date.hours(),hourText:"".concat(t.timeObj.time.format("HH:mm"),"~").concat(t.timeObj.date.format("HH:mm"))})]})},getOkrList:function(e,t){var i,n=null===(i=e.find((function(e){return e.hour===t})))||void 0===i?void 0:i.okrList;return n||[]},isZero:function(e,t){var i;if((null===(i=t.data)||void 0===i?void 0:i.length)>0)for(var n=0;n<t.data.length;n++){var a=t.data[n];if(a.hour<=e&&a.endHour>=e)return!0}return!1}}},V=q,Z=(i("5e9f"),Object(T["a"])(V,z,G,!1,null,"36c83ea7",null)),Q=Z.exports,X={name:"CalendarDetail",components:{AksSwitch:r["a"],AddSendContant:L,Calendar:S,AddSendContantMeet:E,Day:J,Week:Q},mixins:[x["a"]],props:{edit:{type:Boolean,default:!0},viewUserId:{type:String,default:""}},data:function(){return{uploadFilePath:"clientGroup",form:{name:""},rules:{name:[{required:!0,message:"请填写日历名称"}]},direction:"month",visibleSendContant:!1,bodyStyle:{height:"599px"},visible:!1,sendTime:"",rule:{},planList:[],loading:!1,visibleSendContantMeet:!1,editData:{},isEdit:!0,visibleGroup:!1,chatList:[],userid:"",future:!1,repeatList:[]}},watch:{viewUserId:function(){this.userid=this.viewUserId,this.init()}},computed:{filterPlanList:function(){return this.planList},calendarId:function(){return this.$route.query.id}},created:function(){this.isEdit=this.edit,this.sendTime=this.$moment(),this.edit&&(this.userid=this.$store.state.user.info.userid,this.init())},methods:{init:function(){var e=this,t={userId:this.userid,date:this.sendTime.format("YYYY-MM")};Object(h["r"])(t).then((function(t){e.planList=t.data.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{text:t.startTime?t.okrname:"会议记录",timeObj:{date:e.$moment(t.endTime||t.schedule.meetingStartTime),time:e.$moment(t.startTime||t.schedule.meetingStartTime)}})}))})).catch((function(t){e.$message.error(t.msg||"网络错误")})),Object(h["o"])(t).then((function(t){e.repeatList=t.data.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{text:t.startTime?t.okrname:"会议记录",timeObj:{date:e.$moment(t.endTime||t.schedule.meetingStartTime),time:e.$moment(t.startTime||t.schedule.meetingStartTime)}})}))})).catch((function(t){e.$message.error(t.msg||"网络错误")}))},clearData:function(){this.form.name="",this.planList=[]},addWork:function(){this.editData={},this.sendTime=this.$moment(),this.visibleSendContant=!0,this.future=!1},verify:function(){var e=this;return new Promise((function(t,i){var n;e.form.name||i("请填写日历名称"),(null===(n=e.planList)||void 0===n?void 0:n.length)<=0&&i("请添加日历推送内容"),t()}))},serviceOk:function(){this.visibleSendContant=!1,this.visibleSendContantMeet=!1,this.edit&&this.init()},select:function(e,t){this.editData=t||{},this.sendTime=e,e.format("YYYY MM DD")>this.$moment().format("YYYY MM DD")?this.future=!0:this.future=!1,(this.isEdit||this.editData.id)&&(this.visibleSendContant=!0)},panelChange:function(e){this.sendTime=e,this.init()},goToday:function(){this.sendTime=this.$moment(),this.init()}}},ee=X,te=(i("30b3"),Object(T["a"])(ee,n,a,!1,null,"71cb30ac",null));t["default"]=te.exports},cb6d:function(e,t,i){},cf5f:function(e,t,i){"use strict";i.d(t,"k",(function(){return s})),i.d(t,"r",(function(){return r})),i.d(t,"l",(function(){return o})),i.d(t,"m",(function(){return l})),i.d(t,"a",(function(){return c})),i.d(t,"e",(function(){return d})),i.d(t,"i",(function(){return u})),i.d(t,"p",(function(){return m})),i.d(t,"q",(function(){return p})),i.d(t,"u",(function(){return h})),i.d(t,"v",(function(){return f})),i.d(t,"x",(function(){return v})),i.d(t,"t",(function(){return g})),i.d(t,"o",(function(){return b})),i.d(t,"g",(function(){return T})),i.d(t,"b",(function(){return k})),i.d(t,"h",(function(){return y})),i.d(t,"s",(function(){return O})),i.d(t,"c",(function(){return C})),i.d(t,"n",(function(){return I})),i.d(t,"f",(function(){return L})),i.d(t,"w",(function(){return _})),i.d(t,"j",(function(){return j})),i.d(t,"y",(function(){return D})),i.d(t,"d",(function(){return R}));var n=i("b775"),a={syncUpdate:"/client_transformation/oss/syncArticle",getOfficialAccount:"/client_transformation/oss/getPublicAccount",getLastSyncTime:"/client_transformation/oss/getLastSyncTime",upload:"/client_transformation/oss/upload",update:"/client_transformation/oss/update",materialList:"/client_transformation/oss/page",deleteMaterial:"/client_transformation/oss/delete",addTag:"/client_transformation/materialTag/add",deleteTag:"/client_transformation/materialTag/delete",tagList:"/client_transformation/materialTag/page",updateTag:"/client_transformation/materialTag/update",addWelcome:"/client_transformation/welcome/add",listWelcome:"/client_transformation/welcome/page",delWelcome:"/client_transformation/welcome/delWelcome",detailWelcome:"/client_transformation/welcome/detail",updateWelcome:"/client_transformation/welcome/update",addCustomerSend:"/client_transformation/customerSend/add",delCustomerSend:"/client_transformation/customerSend/delete",pageCustomerSend:"/client_transformation/customerSend/page",upDateCustomerSend:"/client_transformation/customerSend/update",addSersonSop:"/client_transformation/personSop/add",delGroupSop:"/client_transformation/personSop/delGroupSop",detailPersonSop:"/client_transformation/personSop/detail",pagePersonSop:"/client_transformation/personSop/page",setPersonSopStaff:"/client_transformation/personSop/setPersonSopStaff",updatePersonSop:"/client_transformation/personSop/update",updateStatus:"/client_transformation/personSop/updateStatus",interactiveRadarUploadFile:"/client_group/upload/uploadFile",uploadMedia:"/client_group/upload/uploadMedia",channelCodeUploadFile:"/channel/channelCode/uploadFile"};function s(e){return Object(n["b"])({url:a.getLastSyncTime,method:"get",params:e})}function r(e){return Object(n["b"])({url:a.syncUpdate,method:"get",params:e})}function o(e){return Object(n["b"])({url:a.getOfficialAccount,method:"get",params:e})}function l(e){return Object(n["b"])({url:a.interactiveRadarUploadFile,method:"post",data:e})}function c(e){return Object(n["b"])({url:a.addSersonSop,method:"post",data:e})}function d(e){return Object(n["b"])({url:a.delGroupSop,method:"post",params:e})}function u(e){return Object(n["b"])({url:a.detailPersonSop,method:"get",params:e})}function m(e){return Object(n["b"])({url:a.pagePersonSop,method:"get",params:e})}function p(e){return Object(n["b"])({url:a.setPersonSopStaff,method:"post",data:e})}function h(e){return Object(n["b"])({url:a.updatePersonSop,method:"post",data:e})}function f(e){return Object(n["b"])({url:a.updateStatus,method:"post",params:e})}function v(e){return Object(n["b"])({url:a.upload,method:"post",data:e})}function g(e){return Object(n["b"])({url:a.update,method:"post",data:e})}function b(e){return Object(n["b"])({url:a.materialList,method:"get",params:e})}function T(e){return Object(n["b"])({url:a.deleteMaterial,method:"get",params:e})}function k(e){return Object(n["b"])({url:a.addTag,method:"post",data:e})}function y(e){return Object(n["b"])({url:a.deleteTag,method:"get",params:e})}function O(e){return Object(n["b"])({url:a.tagList,method:"get",params:e})}function C(e){return Object(n["b"])({url:a.addWelcome,method:"post",data:e})}function I(e){return Object(n["b"])({url:a.listWelcome,method:"get",params:e})}function L(e){return Object(n["b"])({url:a.delWelcome,method:"post",params:e})}function _(e){return Object(n["b"])({url:a.updateWelcome,method:"post",data:e})}function j(e){return Object(n["b"])({url:a.detailWelcome,method:"get",params:e})}function D(e){return Object(n["b"])({url:a.uploadMedia,method:"post",data:e})}function R(e){return Object(n["b"])({url:a.channelCodeUploadFile,method:"post",data:e})}},d7aa:function(e,t,i){"use strict";i("717b")},d885:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"e",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"n",(function(){return l})),i.d(t,"o",(function(){return c})),i.d(t,"m",(function(){return d})),i.d(t,"l",(function(){return u})),i.d(t,"d",(function(){return m})),i.d(t,"a",(function(){return p})),i.d(t,"j",(function(){return h})),i.d(t,"h",(function(){return f})),i.d(t,"k",(function(){return v})),i.d(t,"g",(function(){return g})),i.d(t,"f",(function(){return b})),i.d(t,"i",(function(){return T}));var n=i("b775"),a={interactiveRadarAdd:"/client_transformation/interactradar/add",interactiveRadarList:"/client_transformation/interactradar/list",interactiveRadarDelete:"/client_transformation/interactradar/delete",interactiveRadarupdate:"/client_transformation/interactradar/update",interactiveRadarInfo:"/client_transformation/interactradar/info",interactiveRadarSave:"/client_transformation/interactradar/channel/save",channelLinks:"/client_transformation/interactradar/getChannelLinks",generateChannelLink:"/client_transformation/interactradar/generateChannelLink",interactradarList:"/client_transformation/interactradar/channel/list",interactradarUpdate:"/client_transformation/interactradar/channel/update",statisticOverview:"/client_transformation/interactradar/statisticOverview",statisticDetail:"/client_transformation/interactradar/statisticDetail",customerLog:"/client_transformation/interactradar/customerLog",getCustomerLogDetail:"/client_transformation/interactradar/customerLogDetail",channelLog:"/client_transformation/interactradar/channelLog"};function s(e){return Object(n["b"])({url:a.channelLog,method:"post",data:e})}function r(e){return Object(n["b"])({url:a.getCustomerLogDetail,method:"get",params:e})}function o(e){return Object(n["b"])({url:a.customerLog,method:"post",data:e})}function l(e){return Object(n["b"])({url:a.statisticDetail,method:"get",params:e})}function c(e){return Object(n["b"])({url:a.statisticOverview,method:"get",params:e})}function d(e){return Object(n["b"])({url:a.interactradarUpdate,method:"post",data:e})}function u(e){return Object(n["b"])({url:a.interactradarList,method:"get",params:e})}function m(e){return Object(n["b"])({url:a.generateChannelLink,method:"get",params:e})}function p(e){return Object(n["b"])({url:a.channelLinks,method:"get",params:e})}function h(e){return Object(n["b"])({url:a.interactiveRadarSave,method:"post",data:e})}function f(e){return Object(n["b"])({url:a.interactiveRadarInfo+"/"+e,method:"get"})}function v(e){return Object(n["b"])({url:a.interactiveRadarupdate,method:"post",data:e})}function g(e){return Object(n["b"])({url:a.interactiveRadarDelete,method:"post",data:e})}function b(e){return Object(n["b"])({url:a.interactiveRadarAdd,method:"post",data:e})}function T(e){return Object(n["b"])({url:a.interactiveRadarList,method:"post",data:e})}},d8bc:function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"switch",class:{active:"left"===e.isActive}},[t("span",{class:{active:"left"===e.isActive},on:{click:function(t){return e.changeSwitch("left")}}},[e._v(" "+e._s(e.leftText)+" ")]),t("span",{class:{active:"right"===e.isActive},on:{click:function(t){return e.changeSwitch("right")}}},[e._v(" "+e._s(e.rightText)+" ")])])},a=[],s={name:"AksSwitch",props:{leftText:{type:String,default:function(){return"日历"}},rightText:{type:String,default:function(){return"时间轴"}}},data:function(){return{isActive:"left"}},methods:{changeSwitch:function(e){this.isActive!==e&&(this.isActive=e,this.$emit("changeSwitch",e))}}},r=s,o=(i("a768"),i("2877")),l=Object(o["a"])(r,n,a,!1,null,"a69f9f30",null);t["a"]=l.exports},db3a:function(e,t,i){"use strict";i("51b8")},f0b2:function(e,t,i){"use strict";i("b4f0")}}]);