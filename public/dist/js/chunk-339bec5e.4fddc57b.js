(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-339bec5e"],{"11d6":function(t,e,a){"use strict";a("9400")},"161b":function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return o}));var i=a("b775"),n={queryGroupPageByGroupSop:"/client_group/customerGroup/queryGroupPageByGroupSop",addOrEditGroupTag:"/client_group/groupTagController/addOrEditGroupTag",delGroupTag:"/client_group/groupTagController/delGroupTag",queryGroupTag:"/client_group/groupTagController/queryGroupTag"};function r(t){return Object(i["b"])({url:n.addOrEditGroupTag,method:"post",data:t})}function s(t){return Object(i["b"])({url:n.delGroupTag,method:"post",data:t})}function o(t){return Object(i["b"])({url:n.queryGroupTag,method:"post",data:t})}},"1d4c":function(t,e,a){"use strict";a("fc8b")},3538:function(t,e,a){"use strict";a("8eae")},"8eae":function(t,e,a){},9400:function(t,e,a){},"9c6d":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-tags"},[e("section",{attrs:{id:"operator-tag-group-dialog"}},[e("p",{staticClass:"dialog-title dialog-tag-title"},[t._v(" "+t._s(t.statusText)+"标签组 ")]),e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[e("div",{staticClass:"blue-tips-filled"},[e("a-icon",{staticStyle:{color:"#1890ff"},attrs:{type:"bell",theme:"filled"}}),t._v(" 管理员可根据不同部门选择展示不同的标签组，部门管理员可创建部门可见的标签 ")],1),e("a-form-model-item",{attrs:{label:"标签组名称",prop:"tagGroupName"}},[e("a-input",{staticClass:"tags-name",attrs:{placeholder:"请输入标签组名称",maxLength:15},model:{value:t.form.tagGroupName,callback:function(e){t.$set(t.form,"tagGroupName",e)},expression:"form.tagGroupName"}})],1),e("FormlabelAdd",{attrs:{form:t.form}})],1)],1),e("div",{staticClass:"foot-button"},[e("a-space",{attrs:{size:12}},[e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("确定")])],1)],1)])},n=[],r=(a("d81d"),a("d3b7"),a("99af"),a("159b"),a("c740"),a("a434"),function(){var t=this,e=t._self._c;return e("div",[t._l(t.form.tagList,(function(a,i){return e("a-form-model-item",t._b({key:a.key,attrs:{prop:"tagList",label:0===i?"标签名称":"",rules:{required:!0,message:"标签名称不能为空"}}},"a-form-model-item",0===i?t.formItemLayout:t.formItemLayoutWithOutLabel,!1),[e("a-input",{staticStyle:{width:"60%","margin-right":"8px"},attrs:{placeholder:"请输入标签名称",maxLength:10},model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"domain.value"}}),t.form.tagList.length>1?e("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===t.form.tagList.length},on:{click:function(e){return t.removeDomain(a)}}}):t._e()],1)})),e("a-form-model-item",{attrs:{"wrapper-col":{offset:3}}},[e("a-button",{attrs:{type:"link"},on:{click:t.addDomain}},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v(" 添加标签 ")],1)],1)],2)}),s=[],o={name:"FormlabelAdd",props:{form:{type:[Object],default:function(){return{}}}},data:function(){return{formItemLayout:{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},formItemLayoutWithOutLabel:{wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:4}}}}},methods:{removeDomain:function(t){var e=this.form.tagList.indexOf(t);-1!==e&&this.form.tagList.splice(e,1)},addDomain:function(){this.form.tagList.push({value:"",key:Date.now()})}}},u=o,l=(a("11d6"),a("2877")),c=Object(l["a"])(u,r,s,!1,null,"48498136",null),g=c.exports,d=a("161b"),p={props:{tagDetail:{type:[Object],default:function(){return{}}}},computed:{statusText:function(){return this.tagDetail.grpTagId?"修改":"新增"}},data:function(){return{formLayout:"horizontal",labelCol:{span:4},wrapperCol:{span:14},selectList:[],form:{tagGroupName:"",scope:0,tagList:[{value:"",key:Date.now()}]},rules:{tagGroupName:[{required:!0,message:"标签组名称不能为空"}],tagList:[{required:!0,message:"标签名称不能为空"}]}}},created:function(){var t;null!==(t=this.tagDetail)&&void 0!==t&&t.grpTagId&&(this.form={tagGroupName:this.tagDetail.grpTagName,tagList:this.tagDetail.tags.map((function(t){return{value:t.tagName,key:t.tagId,tagId:t.tagId}}))})},components:{FormlabelAdd:g},methods:{selectPerson:function(t){this.selectList=t},submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;e.validate().then((function(){e.addOrEditGroupTag()})).catch((function(t){e.$message.warning(t.message||t)}))}))},validate:function(){var t=this;return new Promise((function(e,a){1===t.form.scope&&t.selectList.length<1&&a("请选择部门");for(var i=t.form.tagList,n=0;n<i.length;n++){var r=i[n];r.value||a("请填写标签名称");for(var s=n+1;s<i.length;s++)r.value===i[s].value&&a("第".concat(n+1,"个和第").concat(s+1,"个标签名重复"))}e()}))},getAddParams:function(){var t,e={tagGrpName:this.form.tagGroupName,addOrEditTags:null===(t=this.form.tagList)||void 0===t?void 0:t.map((function(t){return{tagName:t.value}})),departments:[]};return e},getEditParams:function(){var t,e,a=this,i=[],n=[];this.tagDetail.tags.forEach((function(t){var e=a.form.tagList.findIndex((function(e){if(t.tagId===e.tagId)return e}));e<0&&i.push({tagName:t.tagName,tagId:t.tagId})})),this.form.tagList.forEach((function(t){t.tagId?a.tagDetail.tags.forEach((function(e){e.tagId===t.tagId&&e.tagName!==t.value&&n.push({tagName:t.value,tagId:e.tagId})})):n.push({tagName:t.value})})),null===(t=this.form.tagList)||void 0===t||t.map((function(t){return{tagName:t.value,tagId:t.tagId}}));var r={tagGroupGrpId:this.tagDetail.grpTagId,tagGrpName:this.form.tagGroupName,delTags:i,addOrEditTags:n,departments:null===(e=this.selectList)||void 0===e?void 0:e.map((function(t){return{wxDepartmentId:t.source.wxDepartmentId}}))};return r},addOrEditGroupTag:function(){var t,e=this,a=null!==(t=this.tagDetail)&&void 0!==t&&t.grpTagId?this.getEditParams():this.getAddParams();Object(d["a"])(a).then((function(){e.$message.success("".concat(e.statusText,"标签成功")),e.$emit("serviceOk")})).catch((function(t){e.$message.error(t)}))},removeDomain:function(t){var e=this.form.tagList.indexOf(t);-1!==e&&this.form.tagList.splice(e,1)}}},f=p,m=(a("3538"),Object(l["a"])(f,i,n,!1,null,"c2e3eeda",null));e["a"]=m.exports},c5d4:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("h6",{staticClass:"dialog-title"},[t._v(t._s(t.title))]),t.hasTips?e("div",{staticClass:"tips"},[t._v("为选中的"+t._s(t.selectedRows.length)+"个群批量打标签，请选择标签")]):t._e(),e("section",{staticClass:"main"},[e("ul",t._l(t.DataGroupList,(function(a){return e("li",{key:a.grpTagId},[e("div",{staticClass:"tag-group-name"},[t._v(t._s(a.grpTagName))]),e("TagComponents",{attrs:{tagslist:a,selectTagList:a.selectTagList},on:{serviceOk:t.serviceOk}})],1)})),0)]),e("div",{staticClass:"foot-button"},[e("a-button",{attrs:{type:"link"},on:{click:function(e){t.visible=!0}}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 新建标签组 ")],1),e("a-space",{attrs:{size:12}},[e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm()}}},[t._v("确定")])],1)],1),e("a-modal",{attrs:{footer:null,width:"599px",centered:"",destroyOnClose:""},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("NewLabelgroup",{attrs:{tagDetail:t.tagDetail},on:{cancle:function(e){t.visible=!1},serviceOk:t.serviceOk}})],1)],1)},n=[],r=a("5530"),s=(a("0481"),a("4069"),a("d81d"),a("4de4"),a("d3b7"),a("159b"),a("9c6d")),o=(a("caad"),a("2532"),a("fb6a"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"tag-but"},[e("a-button",{staticClass:"add-tag-button",attrs:{size:"small"},on:{click:t.showInput}},[e("a-icon",{attrs:{type:"plus"}}),t._v("添加")],1),t.inputVisible?e("a-input",{ref:"input",style:{width:"120px"},attrs:{type:"text",size:"small",maxLength:10,inputVisible:"false"},on:{blur:t.cancle,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):t._e(),t._l(t.tagslist.tags,(function(a,i){return[a.tagName.length>20?e("a-tooltip",{key:i},[e("a-tag",{key:a.tagName,attrs:{color:t.tagIdList.includes(a.tagId)?"blue":""},on:{click:function(e){return t.checkedTag(a)}}},[t._v(" "+t._s("".concat(a.tagName.slice(0,20),"..."))+" ")])],1):e("a-tag",{key:i,attrs:{color:t.tagIdList.includes(a.tagId)?"blue":""},on:{click:function(e){return t.checkedTag(a)}}},[t._v(" "+t._s(a.tagName)+" ")])]}))],2)}),u=[],l=a("2909"),c=(a("c740"),a("a434"),a("498a"),a("99af"),a("161b")),g={data:function(){return{inputVisible:!1,inputValue:"",index:""}},props:{selectTagList:{type:[Array],default:function(){return[]}},tagslist:{type:[Object],default:function(){return{}}}},computed:{tagIdList:function(){var t;return(null===(t=this.selectTagList)||void 0===t?void 0:t.map((function(t){return t.tagId})))||[]}},methods:{showInput:function(){this.inputVisible=!0,this.$nextTick((function(){this.$refs.input.focus()}))},checkedTag:function(t){var e=this.selectTagList.findIndex((function(e){if(e.tagId===t.tagId)return e}));e>=0?this.selectTagList.splice(e,1):this.selectTagList.push(t)},cancle:function(){this.inputValue="",this.inputVisible=!1},handleInputConfirm:function(){var t=this,e=this.inputValue.trim();if(!e)return this.inputValue="",void this.$message.warning("标签名不能为空");var a=this.tagslist.tags,i={tagName:e},n=a.map((function(t){return t.tagName}));if(n.includes(i.tagName))this.$message.warning("存在重复标签");else{var r=this.getAddParams(e);Object(c["a"])(r).then((function(){t.$message.success("添加标签成功"),e&&(a=[].concat(Object(l["a"])(a),[i])),t.$emit("serviceOk"),t.tagslist.tags=a,t.cancle()})).catch((function(e){t.$message.error("标签添加失败")}))}},getAddParams:function(t){var e={tagGroupGrpId:this.tagslist.grpTagId,tagGrpName:this.tagslist.grpTagName,addOrEditTags:[{tagName:t}],departments:[]};return e}}},d=g,p=(a("ee0b"),a("2877")),f=Object(p["a"])(d,o,u,!1,null,"9c2ebe14",null),m=f.exports,h={name:"MakeTags",data:function(){return{visible:!1,tagDetail:"",DataGroupList:[]}},components:{NewLabelgroup:s["a"],TagComponents:m},props:{selectedRows:{type:Array,default:function(){return[]}},title:{type:String,default:"批量打群标签"},hasTips:{type:Boolean,default:!0},operation:{type:Object,default:function(){}}},created:function(){this.getGroupList()},computed:{getSelectTag:function(){return this.DataGroupList.filter((function(t){return t.selectTagList.length>0})).map((function(t){return t.selectTagList})).flat()}},methods:{serviceOk:function(){this.visible=!1,this.getGroupList()},getGroupList:function(){var t=this,e={grpName:""};return Object(c["c"])(e).then((function(e){t.DataGroupList=null===e||void 0===e?void 0:e.data.map((function(e){var a,i,n=[];return null===(a=t.operation)||void 0===a||null===(i=a.groupTagList)||void 0===i||i.forEach((function(t){var a;null===(a=e.tags)||void 0===a||a.filter((function(e){t.tagId==e.tagId&&n.push(e)}))})),Object(r["a"])(Object(r["a"])({},e),{},{selectTagList:n})}))})).catch((function(e){t.$message.error(e)}))},submitForm:function(){this.operation?this.$emit("serviceOk",this.getSelectTag):this.getSelectTag.length<1?this.$message.warning("请选择标签"):this.$emit("serviceOk",this.getSelectTag)}}},v=h,b=(a("1d4c"),Object(p["a"])(v,i,n,!1,null,"3cae62ef",null));e["a"]=b.exports},db54:function(t,e,a){},ee0b:function(t,e,a){"use strict";a("db54")},fc8b:function(t,e,a){}}]);