(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c96d273c"],{"06c6":function(t,e,a){"use strict";a("1c2c")},"1c2c":function(t,e,a){},"309f":function(t,e,a){"use strict";a("69a6")},"572c":function(t,e,a){"use strict";a("edc8")},"69a6":function(t,e,a){},8177:function(t,e,a){},a064:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"date-range"},[e("div",{staticClass:"radio-group"},[t.hasToday?e("label",{class:["0"==t.dayType?"active":"","el-radio-button el-l"],on:{click:function(e){return t.dayBtn("0")}}},[t._v("Today")]):t._e(),e("label",{class:["1"==t.dayType?"active":"","el-radio-button el-l"],on:{click:function(e){return t.dayBtn("1")}}},[t._v("yesterday")]),e("label",{class:["7"==t.dayType?"active":"","el-radio-button"],on:{click:function(e){return t.dayBtn("7")}}},[t._v("current week")]),e("label",{class:["30"==t.dayType?"active":"","el-radio-button el-l"],on:{click:function(e){return t.dayBtn("30")}}},[t._v("current month")])]),e("a-range-picker",{staticStyle:{width:"260px","margin-left":"20px"},attrs:{disabledDate:t.disabledDate},on:{change:t.changeDate},model:{value:t.startAndEndTime,callback:function(e){t.startAndEndTime=e},expression:"startAndEndTime"}})],1)},n=[],s={name:"ChooseTime",components:{},props:{videoDataTime:{type:Array,default:function(){return[]}},hasToday:{type:Boolean,default:!1}},data:function(){return{analysisDate:[],dayType:"1",startAndEndTime:void 0}},created:function(){this.startAndEndTime=this.videoDataTime},methods:{dayBtn:function(t){this.dayType=t,"30"==t&&(this.startAndEndTime=[this.$moment().startOf("month"),this.$moment().subtract(1,"days")]),"7"==t&&(this.startAndEndTime=[this.$moment().subtract(this.$moment().weekday(),"days"),this.$moment().subtract(1,"days")]),0==t&&(this.startAndEndTime=[this.$moment().subtract(t,"days"),this.$moment().subtract(0,"days")]),"1"==t&&(this.startAndEndTime=[this.$moment().subtract(t,"days"),this.$moment().subtract(1,"days")]),this.$emit("changeTime",this.startAndEndTime)},disabledDate:function(t){return t&&t>this.$moment()},changeDate:function(t){this.dayType="",this.startAndEndTime=t,this.$emit("changeTime",this.startAndEndTime)}}},o=s,c=(a("f5a7"),a("2877")),r=Object(c["a"])(o,i,n,!1,null,"89977580",null);e["a"]=r.exports},d2e5:function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return o})),a.d(e,"c",(function(){return c})),a.d(e,"f",(function(){return r}));var i=a("b775"),n={getCustomerMsg:"/chatCollect/getCustomerMsg",getCustomerFollows:"/chatCollect/getCustomerFollows",getFollowChatPage:"/sessionInfo/getFollowChatPage",pageUpdate:"/label/update",labelGroupPage:"/labelGroup/page",labelGroupListAll:"/labelGroup/listAll",labelGroupDelete:"/labelGroup/delete",labelGroupCreate:"/labelGroup/create",labelGroupUpdate:"/labelGroup/update"};function s(t){return Object(i["b"])({url:n.getCustomerMsg,method:"post",data:t})}function o(t){return Object(i["b"])({url:n.getCustomerFollows,method:"post",data:t})}function c(t){return Object(i["b"])({url:n.getFollowChatPage,method:"post",data:t})}function r(t){return Object(i["b"])({url:n.pageUpdate,method:"post",data:t})}},eb3f:function(t,e,a){"use strict";a.r(e);a("b0c0");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"team-wrap"},[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:"Detail"},on:{back:function(e){return t.$router.go(-1)}}}),e("section",{staticClass:"section"},[e("a-table",{staticClass:"table",attrs:{columns:t.columns,rowKey:"id",loading:t.loading,dataSource:t.dataList,pagination:t.pagination},on:{change:t.changeTab},scopedSlots:t._u([{key:"name",fn:function(a,i){return e("div",{},[e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.lookDetail(i)}}},[t._v(t._s(a))])],1)}},{key:"role",fn:function(a){return e("div",{},[t._v(" "+t._s(t.getRoleText(a))+" ")])}},{key:"actions",fn:function(a,i){return e("div",{},[e("a-button",{attrs:{type:"link",disabled:t.Actions},on:{click:function(e){return t.editPage(i)}}},[t._v("查看会话")]),t._v("  ")],1)}}])},[e("div",{attrs:{slot:"remark"},slot:"remark"},t._l(5,(function(a){return e("a-tag",{key:a},[e("a-tooltip",{attrs:{title:"查看聊天详情"}},[e("a-button",{attrs:{type:"link"}},[t._v(" "+t._s(a)+" ")])],1)],1)})),1)])],1),e("a-modal",{attrs:{visible:t.visibleChat,width:"800px",destroyOnClose:"",title:"Chat"},on:{ok:function(e){t.visibleChat=!1},cancel:function(e){t.visibleChat=!1}}},[e("ChatHistory",{attrs:{userData:t.userData,name:t.name}})],1)],1)},n=[],s=(a("d3b7"),a("7db0"),a("d2e5")),o=a("a064"),c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"section"},[e("header",[e("div",{staticClass:"section-head"},[e("div",{staticClass:"left"},[e("span",{staticClass:"name"},[t._v(t._s(t.name)+" : "+t._s(t.dispatchName(t.userData.username)))])])])]),e("a-spin",{attrs:{spinning:t.loading}},[e("section",{staticClass:"section-content"},[e("ul",{ref:"new_message",staticClass:"content-list-wrap",attrs:{id:"new_message"},on:{scroll:t.scroll}},[t.isEnd?e("p",{staticStyle:{"text-align":"center","margin-bottom":"20px",color:"#bbb"}},[t._v("No more data.")]):t._e(),t._l(t.chatList,(function(a,i){return e("li",{key:i},[0===a.isSend?e("div",{staticClass:"content-list"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1),e("div",{staticClass:"content-wrap"},[e("InfoList",{staticClass:"text",attrs:{dataDetail:a}}),e("p",{staticClass:"time"},[t._v(t._s(a.createTime))])],1)]):t._e(),3===a.isSend?e("div",{staticClass:"content-center"},[t._v(t._s(a.content))]):t._e(),1===a.isSend?e("div",{staticClass:"content-list right"},[e("div",{staticClass:"content-wrap"},[e("InfoList",{staticClass:"text",attrs:{dataDetail:a}}),e("p",{staticClass:"time"},[t._v(t._s(a.createTime))]),a.isSuccess?t._e():e("p",{staticClass:"time",staticStyle:{color:"red","font-size":"14px"}},[t._v(t._s(a.msg))])],1),e("div",{staticStyle:{"margin-left":"10px"}},[e("div",{staticClass:"message right"},[t._v(" "+t._s(a.from)+" ")]),t._v(" "+t._s(a.from)+" ")])]):t._e()])}))],2)])])],1)},r=[],l=a("5530"),d=a("2909"),u=(a("d81d"),a("ac1f"),a("5319"),a("ec1f")),m={name:"ChatHistory",components:{InfoList:u["a"]},props:{userData:{type:Object,default:function(){return{}}},name:{type:String,default:""}},data:function(){return{loading:!1,isEnd:!1,pagination:{current:1,pageSize:10,total:0},chatList:[]}},created:function(){this.init()},methods:{scroll:function(t){var e=t.target,a=e.scrollTop;e.clientHeight,e.scrollHeight;0!==a||this.isEnd||(this.pagination.current++,this.init())},init:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,id:this.userData.customerId,endTime:this.userData.endTime,startTime:this.userData.startTime};this.loading=!0,Object(s["c"])(e).then((function(e){var a,i,n,s=/\n/gi;if((a=t.chatList).unshift.apply(a,Object(d["a"])(null===(i=e.data.records)||void 0===i?void 0:i.map((function(t){var e;return Object(l["a"])(Object(l["a"])({},t),{},{key:t.id,content:(null===t||void 0===t||null===(e=t.content)||void 0===e?void 0:e.replace(s,"<br/>"))||(null===t||void 0===t?void 0:t.content)})})).reverse())),(null===(n=e.data)||void 0===n?void 0:n.records.length)<t.pagination.pageSize&&(t.isEnd=!0),t.pagination.total=e.data.total,1===t.pagination.current)t.$nextTick((function(){var e=t.$el.querySelector("#new_message");e.scrollTop=e.scrollHeight}));else{var o=t,c=t.$el.querySelector("#new_message").scrollHeight;t.$nextTick((function(){var e=t.$el.querySelector("#new_message"),a=o.height?c-o.height:-50;o.height=o.$refs.new_message.scrollHeight,e.scrollTop=o.height-c+a}))}})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},dispatchName:function(t){return t===this.$store.state.user.info.username?"you":t||"No Assigned"}}},h=m,f=(a("06c6"),a("2877")),p=Object(f["a"])(h,c,r,!1,null,"8c3018e4",null),g=p.exports,v={name:"RecordDetail",components:{ChooseTime:o["a"],ChatHistory:g},data:function(){return{visibleChat:!1,userStatus:[{value:"Has UID",id:1},{value:"No UID",id:0}],dataList:[],form:this.$form.createForm(this,{name:"advanced_search"}),userList:[],visibleSearch:!1,editData:{},columns:[{title:"Allocation time",dataIndex:"createTime"},{title:"Follow up CS",dataIndex:"username"},{title:"Total Sessions",dataIndex:"msgTotal"},{title:"User sends message",dataIndex:"customerMsgTotal"},{title:"CS sends a message",dataIndex:"staffMsgTotal"},{title:"CS sends template message",dataIndex:"templateTotal"},{title:"CS  sends success message",dataIndex:"staffMsgSuccessTotal"},{title:"CS send Failure Message",dataIndex:"staffMsgFailTotal"},{title:"Detail",dataIndex:"actions",scopedSlots:{customRender:"actions"}}],layout:{labelCol:{span:6},wrapperCol:{span:14}},userListStatus:[{text:"admin",value:1},{text:"BM",value:2},{text:"Sales",value:3}],loading:!1,pagination:{current:1,pageSize:10,total:0},title:"Group messaging",modalForm:{labelName:void 0,groupId:void 0,remark:void 0},confirmLoading:!1,rules:{labelName:[{required:!0,message:"Please input tag name"}],groupId:[{required:!0,message:"Please select"}]},groupList:[],searchData:{time:[this.$moment().subtract(1,"days"),this.$moment().subtract(1,"days")],role:void 0},dataDetail:{},visibleNew:!1,newColumns:[{title:"UID",dataIndex:"labelName"},{title:"Name",dataIndex:"labelName"},{title:"Country",dataIndex:"labelName"},{title:"Status",dataIndex:"labelName"}],userData:{}}},created:function(){this.getList()},activated:function(){this.getList()},computed:{Actions:function(){return!this.$route.meta.Actions},customerId:function(){return this.$route.query.customerId},name:function(){return this.$route.query.name},endTime:function(){return this.$route.query.endTime},startTime:function(){return this.$route.query.startTime}},methods:{getList:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,customerId:this.customerId};this.loading=!0,Object(s["a"])(e).then((function(e){t.dataList=e.data.records,t.pagination.total=e.data.total,t.loading=!1})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},handleSearch:function(t){var e=this;t.preventDefault(),this.form.validateFields((function(t,a){e.searchData=a,e.searchList()}))},handleReset:function(){this.form.resetFields(),this.searchData={},this.searchList()},submitKeyword:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;var a=t.modalForm;t.confirmLoading=!0,t.editData.id?t.editKeywordFn(a):t.addKeywordFn(a)}))},addKeywordFn:function(t){var e=this;Object(s["pageCreate"])(t).then((function(t){e.visibleSearch=!1,e.searchList()})).catch((function(t){e.$message.error(t)})).finally((function(){e.confirmLoading=!1}))},editKeywordFn:function(t){var e=this;t.id=this.editData.id,Object(s["f"])(t).then((function(t){e.visibleSearch=!1,e.searchList()})).catch((function(t){e.$message.error(t)})).finally((function(){e.confirmLoading=!1}))},getRoleText:function(t){var e=this.userListStatus.find((function(e){return e.value==t}));return e.text},editPage:function(t){this.title="Edit Group messaging",this.userData=t,this.visibleChat=!0},addAgent:function(){this.title="Group messaging",this.visibleSearch=!0,this.editData={},this.modalForm={labelName:void 0,groupId:void 0,remark:void 0}},serviceOk:function(){this.pagination.current=1,this.visibleSearch=!1,this.$message.success("success"),this.$emit("editSuccess")},deletePage:function(t){var e=this;this.$confirm({title:"tip",icon:"",cancelText:"cancel",okText:"delete",content:"Please check if you want to delete the tags, all the tags that have been tagged will be deleted after deletion。",onOk:function(){e.contactsDeleteFun(t.id)}})},contactsDeleteFun:function(t){var e=this,a={id:t};Object(s["pageDetele"])(a).then((function(t){e.$message.success("delete success"),e.getList()})).catch((function(t){e.$message.error(t)}))},baseTrendGoodsFun:function(t){this.searchData.time=t},changeTab:function(t){var e=t.current;this.pagination.current=e,this.getList()},searchList:function(){this.pagination.current=1,this.getList()},lookDetail:function(t){this.visibleNew=!0,this.dataDetail=t}}},b=v,y=(a("572c"),Object(f["a"])(b,i,n,!1,null,"32b508f1",null));e["default"]=y.exports},ec1f:function(t,e,a){"use strict";a("b0c0");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"info-list"},["image"===t.dataDetail.type?e("div",{staticClass:"img"},[e("img",{attrs:{src:t.dataDetail.content},on:{click:t.lookBigImg}}),e("p",{staticStyle:{"margin-top":"10px"}},[t._v(t._s(t.dataDetail.caption))])]):t._e(),"text"===t.dataDetail.type?e("div",[e("div",{staticClass:"text",domProps:{innerHTML:t._s(t.dataDetail.content)}})]):t._e(),"unsupported"===t.dataDetail.type?e("div",[e("div",{domProps:{innerHTML:t._s(t.dataDetail.content)}}),t.dataDetail.isSuccess?t._e():e("p",{staticStyle:{color:"red"}},[t._v(t._s(t.dataDetail.msg))])]):t._e(),"audio"===t.dataDetail.type?e("div",[e("audio",{attrs:{src:t.dataDetail.content,controls:""}})]):t._e(),"contacts"===t.dataDetail.type?e("div",[e("div",{staticClass:"contact-wrap"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1),e("span",[t._v(t._s(t.getContactName))])]),e("div",{staticClass:"button-wrap"},[e("a-button",{attrs:{type:"link"},on:{click:function(e){t.contactVisible=!0}}},[t._v("View all")])],1)]):t._e(),"document"===t.dataDetail.type?e("div",[e("div",[e("a-icon",{attrs:{type:"file"}}),t._v(" file ")],1),e("p"),e("a-button",{staticStyle:{padding:"0"},attrs:{type:"link"},on:{click:function(e){return t.downloadnPdf(t.dataDetail.content)}}},[t._v("Download")])],1):t._e(),"video"===t.dataDetail.type?e("div",[e("video",{staticStyle:{width:"100%"},attrs:{src:t.dataDetail.content,controls:""}})]):t._e(),"file"===t.dataDetail.type?e("div",[e("div",[e("a-icon",{attrs:{type:"file"}}),t._v(" file ")],1),e("p"),e("a-button",{staticStyle:{padding:"0"},attrs:{type:"link"},on:{click:function(e){return t.downloadnPdf(t.dataDetail.content)}}},[t._v("Download")])],1):t._e(),e("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:function(e){t.previewVisible=!1}}},[e("img",{staticStyle:{width:"100%"},attrs:{src:t.previewImage}})]),e("a-modal",{attrs:{footer:null,title:"".concat(t.dataDetail.content.length," contacts")},on:{cancel:function(e){t.contactVisible=!1}},model:{value:t.contactVisible,callback:function(e){t.contactVisible=e},expression:"contactVisible"}},[t.contactVisible?e("ul",t._l(t.dataDetail.content,(function(a,i){return e("li",{key:i,staticClass:"box-wrap"},[e("div",{staticClass:"name"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1),e("strong",[t._v(t._s(a.name.formatted_name))])]),e("ul",t._l(a.phones,(function(a,i){return e("li",{key:i,staticClass:"tel-wrap"},[e("p",[t._v(t._s(a.phone))]),e("p",{staticClass:"tel"},[t._v("TEL")])])})),0)])})),0):t._e()])],1)},n=[],s=a("53ca"),o=(a("99af"),a("caad"),a("ac1f"),a("5319"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("7858")),c={name:"InfoList",components:{},props:{dataDetail:{type:Object,default:function(){return{}}}},data:function(){return{previewVisible:!1,contactVisible:!1,previewImage:""}},computed:{getContactName:function(){var t,e,a="";return"contacts"===this.dataDetail.type&&(null===(t=this.dataDetail)||void 0===t||null===(e=t.content)||void 0===e?void 0:e.length)>0&&(a="".concat(this.dataDetail.content[0].name.formatted_name," and ").concat(this.dataDetail.content.length-1," other contact")),a}},created:function(){var t;this.isJSON(this.dataDetail.content)&&["image","contacts"].includes(this.dataDetail.type)&&(this.dataDetail.content=(null===(t=JSON.parse(this.dataDetail.content))||void 0===t?void 0:t.url)||JSON.parse(this.dataDetail.content));"text"===this.dataDetail.type&&(this.dataDetail.content=this.breakStr(this.dataDetail.content))},methods:{lookBigImg:function(t){this.previewVisible=!0,this.previewImage=t.srcElement.currentSrc},breakStr:function(t){var e=/(\r\n)|(\n)|(\↵)/g;t=t.toString().replace(e,"<br>");var a=/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g;return t=t.replace(a,"<a href='$1$2' target='_blank'>$1$2</a>"),t},isJSON:function(t){if("string"==typeof t)try{var e=JSON.parse(t);return!("object"!=Object(s["a"])(e)||!e)}catch(a){return!1}},downloadnPdf:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="blob",e.onload=function(){if(200===e.status){var t=e.response,a=document.createElement("a");a.style.display="none";var i=window.URL.createObjectURL(t);a.href=i,a.setAttribute("download","".concat(Object(o["c"])(),".pdf")),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a)}},e.send()}}},r=c,l=(a("309f"),a("2877")),d=Object(l["a"])(r,i,n,!1,null,"4dbfb761",null);e["a"]=d.exports},edc8:function(t,e,a){},f5a7:function(t,e,a){"use strict";a("8177")}}]);