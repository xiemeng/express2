(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41a252bc"],{1740:function(t,a,e){},"19c0":function(t,a,e){},"22b4f":function(t,a,e){"use strict";e("1740")},"3dd5":function(t,a,e){},"4e2c":function(t,a,e){"use strict";e("c54d")},7473:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t._self._c;return a("div",{staticClass:"page-wrap"},[a("header",[a("div",{staticClass:"tagger"},[a("h1",[t._v("User Tag Management")]),a("div",[a("a-space",[a("a-button",{attrs:{type:"primary",disabled:t.Actions},on:{click:function(a){t.visibleTags=!0}}},[t._v("Create User Tag Group")]),a("a-button",{attrs:{type:"primary",disabled:t.Actions},on:{click:t.buildingTag}},[t._v("Create User Tag")])],1)],1)])]),a("section",{staticClass:"section1"},[a("TagList",{ref:"tagList",staticClass:"tag-list",on:{getId:t.infoFun}}),a("Content",{staticClass:"content",attrs:{tagInfo:t.tagInfo,loading:t.loading,tagId:t.tagId},on:{deleteTag:t.deleteTag}})],1),a("a-modal",{attrs:{footer:null,width:"599px",centered:"",destroyOnClose:""},model:{value:t.visibleTags,callback:function(a){t.visibleTags=a},expression:"visibleTags"}},[a("Tags",{on:{cancle:function(a){t.visibleTags=!1},serviceOk:t.serviceOk}})],1)],1)},n=[],s=e("5530"),o=(e("d3b7"),function(){var t=this,a=t._self._c;return a("div",{staticClass:"tag-list"},[a("a-input-search",{staticStyle:{"margin-bottom":"8px"},attrs:{placeholder:"Search"},on:{change:t.onChange}}),a("a-spin",{attrs:{spinning:t.loading}},[a("a-tree",{attrs:{"expanded-keys":t.expandedKeys,"tree-data":t.tagList,defaultSelectedKeys:t.defaultSelectedKeys},on:{expand:t.onExpand},scopedSlots:t._u([{key:"title",fn:function(e){return[a("span",{on:{click:function(a){return t.selectKey(e)}}},[t._v(t._s(e.title))])]}}])})],1)],1)}),r=[],c=(e("d81d"),e("4de4"),e("d28d")),l={name:"TagList",components:{},data:function(){return{expandedKeys:[],searchValue:"",loading:!1,dataList:[],tagList:[],defaultSelectedKeys:[]}},created:function(){this.init()},methods:{init:function(){var t=this;this.loading=!0,Object(c["a"])().then((function(a){var e,i,n,o;a.data.length>0&&(t.tagList=a.data.map((function(a){var e;return t.dataList.push(a.categoryName),{key:a.id,selectable:!1,title:a.categoryName,children:null===(e=a.tagVoList)||void 0===e?void 0:e.map((function(a){return t.dataList.push(a.tagName),Object(s["a"])(Object(s["a"])({key:"chilren"+a.id},a),{},{title:a.tagName})})),scopedSlots:{title:"title"}}})),t.defaultSelectedKeys=["chilren"+(null===(e=a.data)||void 0===e||null===(i=e[0].tagVoList)||void 0===i?void 0:i[0].id)],t.$emit("getId",null===(n=a.data)||void 0===n||null===(o=n[0].tagVoList)||void 0===o?void 0:o[0].id))})).catch((function(a){t.$message.error(a||"系统错误")})).finally((function(){t.loading=!1}))},onExpand:function(t){this.expandedKeys=t,this.autoExpandParent=!1},selectKey:function(t){"number"!==typeof t.key&&this.$emit("getId",t.id)},onChange:function(t){var a=this,e=t.target.value,i=this.dataList.map((function(t){return t.indexOf(e)>-1?a.getParentKey(t,a.tagList):null})).filter((function(t,a,e){return t&&e.indexOf(t)===a}));Object.assign(this,{expandedKeys:i,searchValue:e,autoExpandParent:!0})},getParentKey:function(t,a){for(var e,i=0;i<a.length;i++){var n=a[i];n.children&&(n.children.some((function(a){return a.title===t}))?e=n.key:this.getParentKey(t,n.children)&&(e=this.getParentKey(t,n.children)))}return e}}},d=l,u=(e("fdb6"),e("2877")),h=Object(u["a"])(d,o,r,!1,null,"44315694",null),g=h.exports,f=function(){var t=this,a=t._self._c;return a("div",[a("a-spin",{attrs:{spinning:t.loading||t.spinning}},[a("header",{staticClass:"header"},[a("div",{staticClass:"top"},[a("div",{staticClass:"left"},[t._v(t._s(t.tagInfo.statusName)+" "),a("a-switch",{on:{change:t.changeStatus},model:{value:t.tagInfo.statusBool,callback:function(a){t.$set(t.tagInfo,"statusBool",a)},expression:"tagInfo.statusBool"}})],1),a("div",{staticClass:"right"},[t._v(" "+t._s(t.tagInfo.task_type)+" "),a("a-divider",{attrs:{type:"vertical"}}),t._v(" "+t._s(t.tagInfo.creatorName)+" ")],1)]),a("div",{staticClass:"title"},[a("h1",[t._v(t._s(t.tagInfo.tagName))]),a("p",{staticClass:"down"},[a("span",[t._v(t._s(t.tagInfo.remark))]),t.tagInfo.allow_to_write?a("a-dropdown-button",{staticStyle:{"margin-right":"20px"},on:{click:t.editTag}},[t._v(" Edit "),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},["手动更新"===t.tagInfo.task_type?a("a-menu-item",{key:"1",on:{click:t.createFun}},[a("a-icon",{attrs:{type:"folder-open"}}),t._v("Update ")],1):t._e(),a("a-menu-item",{key:"2",on:{click:t.downloadTagFun}},[a("a-icon",{attrs:{type:"folder-open"}}),t._v("Download ")],1),a("a-menu-item",{key:"3",on:{click:t.deleteTagFun}},[a("a-icon",{staticStyle:{color:"red"},attrs:{type:"rest"}}),t._v("Delete ")],1)],1)],1):t._e()],1)]),a("div",{staticClass:"rule-look",on:{click:function(a){return t.editTag("look")}}},[t._v(" 通过自定义的规则，将用户划分为 "),a("strong",[t._v(t._s(t.tagInfo.hierarchyInsertDtoList.length))]),t._v("个分层 "),t.tagInfo.hierarchyInsertDtoList.length>0?a("span",[t._v(" ,分别为 "),t._l(t.tagInfo.hierarchyInsertDtoList,(function(e,i){return a("strong",{key:i},[t._v(" "+t._s(e.hierarchyName)+" "),a("span",{directives:[{name:"show",rawName:"v-show",value:i+1<t.tagInfo.hierarchyInsertDtoList.length,expression:"(index + 1) < tagInfo.hierarchyInsertDtoList.length"}]},[t._v(",")])])}))],2):t._e(),a("a-icon",{attrs:{type:"right"}})],1)]),a("section",{staticClass:"section"},[a("div",{staticClass:"tabs"},[a("div",{staticClass:"tag"},[a("p",{staticClass:"tab",class:{activite:1===t.isActivite},attrs:{disabled:t.Actions},on:{click:function(a){return t.changeTab(1)}}},[t._v("Tag Population Distribution")]),a("p",{staticClass:"tab",class:{activite:2===t.isActivite},attrs:{disabled:t.Actions},on:{click:function(a){return t.changeTab(2)}}},[t._v("Tag History Details")])]),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.isActivite,expression:"isActivite === 1"}],staticClass:"right"},[a("div",{staticClass:"chart"},[a("a-icon",{staticClass:"cross-bar icon",class:{active:"cross"===t.rowOrCross},attrs:{type:"bar-chart"},on:{click:function(a){t.rowOrCross="cross"}}}),a("a-icon",{staticClass:"icon",class:{active:"row"===t.rowOrCross},attrs:{type:"bar-chart"},on:{click:function(a){t.rowOrCross="row"}}})],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.isActivite,expression:"isActivite === 2"}],staticClass:"right"},[a("a-range-picker",{staticStyle:{width:"200px","margin-left":"10px"},on:{change:t.changeTime},model:{value:t.startAndEnd,callback:function(a){t.startAndEnd=a},expression:"startAndEnd"}})],1)]),t.noData?a("div",[t._v(t._s(t.noData))]):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.isActivite&&!t.noData,expression:"isActivite === 1 && !noData"}],attrs:{id:"echarts1"}}),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.isActivite,expression:"isActivite === 2"}]},[a("div",{attrs:{id:"echarts2"}}),a("a-table",{attrs:{columns:t.columns,pagination:!1,dataSource:t.historyList}})],1)])])],1)},v=[],m=(e("a9e3"),e("159b"),e("b680"),e("b0c0"),e("313e")),p=e("4cb5"),y=e("9394"),b=e("2da7"),I=e("4b2a"),T=e("f95e"),_=e("ca00"),w=e("c1df"),C=e.n(w);m["b"]([y["a"],b["a"],I["a"],p["a"],T["a"]]);var x={name:"Content",components:{},props:{tagInfo:{type:Object,default:function(){return{hierarchyInsertDtoList:[]}}},loading:{type:Boolean,default:!1},tagId:{type:[String,Number],default:""}},data:function(){return{chartIndex:1,isActivite:1,pageDate:5,spinning:!1,tagData:"asc",rowOrCross:"cross",pageList:[{test:"前5页",value:5},{test:"前10页",value:10},{test:"前15页",value:15},{test:"前20页",value:20},{test:"前25页",value:25},{test:"前30页",value:30},{test:"前50页",value:50}],tagList:[{test:"按标签覆盖人数升序",value:"asc"},{test:"按标签覆盖人数降序",value:"desc"}],layered:[{test:"前5页",value:5},{test:"第一项",value:10}],myChart1:void 0,myChart2:void 0,tagInfoList:[],baseData:{},startAndEnd:[C()().subtract(14,"days"),C()()],columns:[],pagination:{current:1,pageSize:10,total:0},histpryService:[],historyList:[],noData:""}},mounted:function(){this.myChart1=m["a"](document.getElementById("echarts1"))},computed:{Actions:function(){return!this.$route.meta.Actions}},watch:{rowOrCross:{handler:function(){"cross"===this.rowOrCross&&this.rendEcharts(this.crossData()),"row"===this.rowOrCross&&this.rendEcharts(this.rowData())}},tagId:function(){this.tagId&&(2===this.isActivite?this.getTagInfo({startTime:this.startAndEnd[0].format("YYYY-MM-DD 00:00:00"),endTime:this.startAndEnd[1].format("YYYY-MM-DD 23:59:59")}):this.getTagInfo())}},methods:{getTagInfo:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(s["a"])({tagId:this.tagId,startTime:this.$moment().subtract(1,"days").format("YYYY-MM-DD 00:00:00"),endTime:this.$moment().format("YYYY-MM-DD 23:59:59")},a);this.spinning=!0,Object(c["l"])(e).then((function(a){if("string"==typeof a.data)return t.noData=a.data,t.tagInfoList=[],t.histpryService=[],t.historyList=[],t.baseData={},void t.history();var e,i;(t.noData="",2===t.isActivite)?(t.histpryService=[],t.historyList=[],t.histpryService=null===(e=a.data[0].tagResultVos)||void 0===e?void 0:e.map((function(t){return t.resultDate})),t.historyList=null===(i=a.data)||void 0===i?void 0:i.map((function(t,a){var e,i={};return null===(e=t.tagResultVos)||void 0===e||e.forEach((function(t){i[t.resultDate]=(100*t.proportion).toFixed(2)+"%"})),Object(s["a"])(Object(s["a"])({},t),{},{name:t.hierarchyName,key:a},i)})),t.history()):(t.tagInfoList=a.data,t.baseData=a.data,t.rendEcharts(t.crossData()))})).catch((function(a){t.$message.error(a)})).finally((function(){t.spinning=!1}))},history:function(){var t,a;this.columns=(null===(t=this.histpryService)||void 0===t?void 0:t.map((function(t){return{title:t,dataIndex:t,key:t}})))||[],this.columns.unshift({title:"用户生命周期",dataIndex:"name",key:"name"}),1===this.chartIndex&&(this.myChart2=m["a"](document.getElementById("echarts2")),this.chartIndex++),this.myChart2.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:this.histpryService},yAxis:{type:"value"},series:null===(a=this.historyList)||void 0===a?void 0:a.map((function(t){var a;return{name:t.name,type:"bar",stack:"total",label:{show:!0},emphasis:{focus:"series"},data:null===(a=t.tagResultVos)||void 0===a?void 0:a.map((function(t){return t.resultValue}))}}))},!0)},rendEcharts:function(t){var a;this.myChart1.setOption(Object(s["a"])(Object(s["a"])({color:"#1890ff",tooltip:{},title:{}},t),{},{grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},series:[{data:null===(a=this.tagInfoList)||void 0===a?void 0:a.map((function(t){var a,e;return null===(a=t.tagResultVos)||void 0===a||null===(e=a[0])||void 0===e?void 0:e.resultValue})),type:"bar"}]}))},rowData:function(){var t;return{xAxis:{type:"value"},yAxis:{type:"category",data:null===(t=this.tagInfoList)||void 0===t?void 0:t.map((function(t){return t.hierarchyName}))}}},crossData:function(){var t;return{xAxis:{type:"category",data:null===(t=this.tagInfoList)||void 0===t?void 0:t.map((function(t){return t.hierarchyName}))},yAxis:{type:"value"}}},changeTab:function(t){this.isActivite=t,2===t?this.getTagInfo({startTime:this.startAndEnd[0].format("YYYY-MM-DD 00:00:00"),endTime:this.startAndEnd[1].format("YYYY-MM-DD 23:59:59")}):this.getTagInfo()},changeTime:function(){this.getTagInfo({startTime:this.startAndEnd[0].format("YYYY-MM-DD 00:00:00"),endTime:this.startAndEnd[1].format("YYYY-MM-DD 23:59:59")})},deleteTagFun:function(){var t=this;Object(c["e"])({id:this.tagId}).then((function(a){t.$message.success("删除成功"),t.$emit("deleteTag")})).catch((function(a){t.$message.error(a)}))},downloadTagFun:function(){var t=this;Object(c["f"])({id:this.tagId}).then((function(a){Object(_["b"])(a,".csv",t.tagInfo.tag_name),t.$message.success("下载成功")})).catch((function(a){t.$message.error(a)}))},createFun:function(){var t=this;Object(c["d"])({id:this.tagId}).then((function(t){})).catch((function(a){t.$message.error(a)})).finally((function(){}))},editTag:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$router.push({name:"BuildTag",query:{id:this.tagId,look:t}})},changeStatus:function(t){var a=this,e={id:this.tagInfo.id,status:Number(!t)};Object(c["c"])(e).then((function(e){a.tagInfo.statusName=t?"已启用":"已停用"})).catch((function(t){a.$message.error(t)}))}}},k=x,D=(e("4e2c"),Object(u["a"])(k,f,v,!1,null,"1072daea",null)),O=D.exports,L=e("e6e8"),A=function(){var t=this,a=t._self._c;return a("CommonModal",t._b({attrs:{loading:t.loading},on:{cancle:function(a){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.source,!1),[a("a-input",{staticClass:"tag-name",attrs:{placeholder:"请输入标签名",maxLength:15},model:{value:t.tagName,callback:function(a){t.tagName=a},expression:"tagName"}})],1)},Y=[],N=e("2a86"),$={name:"Tags",components:{CommonModal:N["a"]},props:{},computed:{},data:function(){return{source:{title:"添加标签分类"},tagName:void 0}},created:function(){},methods:{serviceOk:function(){var t=this;this.tagName?(this.loading=!1,Object(c["b"])({categoryName:this.tagName}).then((function(a){t.$emit("serviceOk")})).catch((function(a){t.$message.warning(a)})).finally((function(){t.loading=!0}))):this.$message.warning("请输入标签名")}}},j=$,E=(e("9427"),Object(u["a"])(j,A,Y,!1,null,"5e88661c",null)),S=E.exports,M={name:"CreateLabel",components:{TagList:g,Content:O,BuildTag:L["default"],Tags:S},data:function(){return{visibleTags:!1,tagInfo:{hierarchyInsertDtoList:[]},tagId:"",loading:!1,statusList:[{value:"1",test:"不限"},{value:"2",test:"已暂停"},{value:"3",test:"待审批"}],form:{status:void 0}}},created:function(){},computed:{Actions:function(){return!this.$route.meta.Actions}},methods:{buildingTag:function(){this.$router.push({name:"BuildTag"})},serviceOk:function(){this.visibleTags=!1,this.$message.success("新建成功")},infoFun:function(t){var a=this;t&&(this.tagId=t,this.loading=!0,Object(c["h"])({id:t}).then((function(t){a.tagInfo=Object(s["a"])(Object(s["a"])({},t.data),{},{statusBool:!Boolean(t.data.status)})})).catch((function(t){a.$message.error(t)})).finally((function(){a.loading=!1})))},deleteTag:function(){this.$refs.tagList.init()}}},K=M,B=(e("22b4f"),Object(u["a"])(K,i,n,!1,null,"5b62aff0",null));a["default"]=B.exports},9427:function(t,a,e){"use strict";e("3dd5")},c54d:function(t,a,e){},fdb6:function(t,a,e){"use strict";e("19c0")}}]);