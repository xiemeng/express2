(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ac4a0602"],{2880:function(t,e,n){"use strict";n("592d")},"2a86":function(t,e,n){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",[e("h6",{staticClass:"dialog-title"},[t._v(t._s(t.title))]),t.tipText?e("span",{attrs:{name:"tip"}},[e("div",{staticClass:"tip"},[e("a-icon",{staticClass:"primaryColor",attrs:{type:"bell",theme:"filled"}}),t._v(" "+t._s(t.tipText)+" ")],1)]):t._e(),t._t("default"),t.footer?e("div",{staticClass:"foot-button"},[e("div",{staticClass:"left"},[t._t("bottomLeft")],2),e("a-space",{attrs:{size:12}},[t._t("footer"),e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v(t._s(t.cancleText))]),e("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.$emit("serviceOk")}}},[t._v(t._s(t.okText))])],2)],1):t._e()],2)},s=[],i={name:"CommonModal",props:{title:{type:String,default:"标题"},cancleText:{type:String,default:"取消"},okText:{type:String,default:"确定"},tipText:{type:[String,Boolean],default:!1},footer:{type:Boolean,default:!0},loading:{type:Boolean,default:!1}}},o=i,r=(n("2880"),n("2877")),c=Object(r["a"])(o,a,s,!1,null,"c55b780c",null);e["a"]=c.exports},"2e82":function(t,e,n){},"3d04":function(t,e,n){},"3e35":function(t,e,n){},4907:function(t,e,n){"use strict";n("3e35")},"4c3e":function(t,e,n){},"55c9":function(t,e,n){"use strict";n("af32")},"592d":function(t,e,n){},"61af":function(t,e,n){"use strict";n("8381")},"74be":function(t,e,n){"use strict";n("2e82")},8381:function(t,e,n){},"84ef":function(t,e,n){},"8e9f":function(t,e,n){"use strict";var a=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({attrs:{loading:t.loading},on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.sourceModal,!1),[e("section",{staticClass:"section"},[e("div",[t._v(" 将给客户修改评分,此次 "),e("a-select",{on:{change:t.changeWay},model:{value:t.isAdd,callback:function(e){t.isAdd=e},expression:"isAdd"}},t._l(t.wayList,(function(n,a){return e("a-select-option",{key:a,attrs:{value:n.id}},[t._v(" "+t._s(n.text)+" ")])})),1),e("a-input-number",{staticClass:"score",attrs:{max:1e4,min:0},model:{value:t.score,callback:function(e){t.score=e},expression:"score"}}),t._v(" 分 ")],1),e("FormList",{staticClass:"textarea",attrs:{formInfo:t.textAreaInfo}}),t.isBatch?t._e():e("div",[e("a-button",{staticClass:"history-score",attrs:{type:"link"},on:{click:function(e){t.isOpen=!t.isOpen}}},[t._v(" "+t._s(t.isOpen?"收起":"查看评分修改记录")+" ")]),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],staticClass:"history-list"},[e("h4",[t._v("历史修改评分记录")]),t._l(t.scoreHistoryList,(function(n,a){return e("li",{key:a},[e("p",{staticClass:"time"},[e("a-icon",{attrs:{type:"clock-circle"}}),t._v(t._s(n.updateTime))],1),e("div",{staticClass:"name-info"},[e("a-avatar",{attrs:{size:22,src:n.staffAvatar}}),e("span",{staticClass:"name"},[t._v(t._s(n.contentText))])],1)])}))],2)],1)],1)])},s=[],i=n("5530"),o=(n("d81d"),n("ac1f"),n("5319"),n("d3b7"),n("2a86")),r=n("26f2"),c=n("90a8"),u={name:"ModifySouce",components:{CommonModal:o["a"],FormList:r["a"]},props:{selectedRows:{type:[Array],default:function(){return[]}},isBatch:{type:Boolean,default:!0},customerWxid:{type:String,default:""}},watch:{selectedRows:{handler:function(){this.isBatch&&(this.sourceModal.tipText=this.wayList[0].tip)},immediate:!0,deep:!0},isOpen:function(){this.isOpen&&this.scoreHistoryList.length<1&&this.getHistoryList()}},data:function(){return{isOpen:!1,scoreHistoryList:[],sourceModal:{title:"修改评分",tipText:""},loading:!1,score:1,textAreaInfo:{title:"",type:"textarea",tips:"请输入修改评分批注",maxLength:300,value:""},isAdd:1,wayList:[{text:"添加",tip:"将给满足条件的".concat(this.selectedRows.length,"客户批量添加评分"),id:1},{text:"减少",id:0,tip:"将给满足条件的".concat(this.selectedRows.length,"个客户批量减少评分，若减少的评分大于客户拥有评分，则该客户评分直接减少至0 ")}]}},computed:{getParams:function(){return{customerWxidList:this.selectedRows.map((function(t){return t.customerId})),isAdd:Boolean(this.isAdd),score:this.score,isBatch:this.isBatch,remark:this.textAreaInfo.value}}},methods:{getHistoryList:function(){var t=this,e={currentPage:1,pageSize:200,customerWxid:this.customerWxid};Object(c["w"])(e).then((function(e){var n;t.scoreHistoryList=(null===(n=e.data)||void 0===n?void 0:n.list.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{contentText:t.content.replace(/#staff#​*/g,t.staffName)})})))||[]})).catch((function(e){t.$message.error(e)}))},serviceOk:function(){var t=this;this.score?(this.loading=!0,Object(c["z"])(this.getParams).then((function(e){t.$message.success("修改评分成功"),t.$emit("serviceOk")})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))):this.$message.warning("请输入分数值")},changeWay:function(t){this.sourceModal.tipText=this.wayList[t].tip}}},l=u,d=(n("c29b"),n("2877")),m=Object(d["a"])(l,a,s,!1,null,"78b65b02",null);e["a"]=m.exports},"90a8":function(t,e,n){"use strict";n.d(e,"q",(function(){return i})),n.d(e,"p",(function(){return o})),n.d(e,"x",(function(){return r})),n.d(e,"e",(function(){return c})),n.d(e,"j",(function(){return u})),n.d(e,"A",(function(){return l})),n.d(e,"a",(function(){return d})),n.d(e,"b",(function(){return m})),n.d(e,"v",(function(){return f})),n.d(e,"w",(function(){return p})),n.d(e,"z",(function(){return g})),n.d(e,"h",(function(){return h})),n.d(e,"i",(function(){return v})),n.d(e,"o",(function(){return b})),n.d(e,"u",(function(){return y})),n.d(e,"m",(function(){return T})),n.d(e,"f",(function(){return I})),n.d(e,"k",(function(){return _})),n.d(e,"l",(function(){return C})),n.d(e,"y",(function(){return L})),n.d(e,"g",(function(){return x})),n.d(e,"d",(function(){return O})),n.d(e,"c",(function(){return k})),n.d(e,"s",(function(){return j})),n.d(e,"r",(function(){return $})),n.d(e,"t",(function(){return S})),n.d(e,"n",(function(){return E}));var a=n("b775"),s={customerList:"/client_manager/client/getCustomerList",dictionaryByCode:"/client_manager/client/getDictionaryByCode",distinctNum:"/client_manager/client/getDistinctNum",syncCustomerData:"/client_manager/client/syncCustomerData",tagGroup:"/client_manager/CustomerTag/getTagGroup ",customerLoss:"/client_manager/customerLoss/page",batchTagging:"/client_manager/CustomerTag/batchTagging",batchTaggingFront:"/client_manager/CustomerTag/batchTaggingFront",batchDelTagFront:"/client_manager/CustomerTag/batchDelTagFront",findByCustomerGroup:"/client_manager/client/findByCustomerGroup",findByCustomerEvent:"/client_manager/client/findByCustomerEvent",findEventByCustomerWxid:"/client_manager/client/findEventByCustomerWxid",findByCustomField:"/client_manager/client/findByCustomField",exportDown:"/client_manager/customerLoss/export",getCustomerListExport:"/client_manager/client/getCustomerListExport",findByCustomFieldExport:"/client_manager/client/findByCustomFieldExport",customerScoreExport:"/client_manager/customerScore/customerScoreExport",customerScore:"/client_manager/customerScore/customerScore",updateScore:"/client_manager/customerScore/updateScore",historyList:"/client_manager/customerScore/list",getTemplateList:"/client_manager/customerEvent/getTemplateList",addTemplateEvent:"/client_manager/customerEvent/addTemplateEvent",addTemplate:"/client_manager/customerEvent/addTemplate",updateTemplate:"/client_manager/customerEvent/updateTemplate",delTemplate:"/client_manager/customerEvent/delTemplate",findByCustomIntegral:"/client_manager/customerIntegral/findByCustomIntegral",findByCustomIntegralExport:"/client_manager/customerIntegral/findByCustomIntegralExport",channelList:"/client_manager/customerIntegral/channelList",integralList:"/client_manager/customerIntegral/integralList"};function i(t){return Object(a["b"])({url:s.findByCustomIntegralExport,method:"post",data:t,responseType:"blob"})}function o(t){return Object(a["b"])({url:s.findByCustomIntegral,method:"post",data:t})}function r(t){return Object(a["b"])({url:s.integralList,method:"post",data:t})}function c(t){return Object(a["b"])({url:s.channelList,method:"get",params:t})}function u(t){return Object(a["b"])({url:s.delTemplate,method:"get",params:t})}function l(t){return Object(a["b"])({url:s.updateTemplate,method:"get",params:t})}function d(t){return Object(a["b"])({url:s.addTemplate,method:"get",params:t})}function m(t){return Object(a["b"])({url:s.addTemplateEvent,method:"get",params:t})}function f(t){return Object(a["b"])({url:s.getTemplateList,method:"get",params:t})}function p(t){return Object(a["b"])({url:s.historyList,method:"get",params:t})}function g(t){return Object(a["b"])({url:s.updateScore,method:"post",data:t})}function h(t){return Object(a["b"])({url:s.customerScore,method:"post",data:t})}function v(t){return Object(a["b"])({url:s.customerScoreExport,method:"post",data:t,responseType:"blob"})}function b(t){return Object(a["b"])({url:s.findByCustomFieldExport,method:"post",data:t,responseType:"blob"})}function y(t){return Object(a["b"])({url:s.getCustomerListExport,method:"get",params:t,responseType:"blob"})}function T(t){return Object(a["b"])({url:s.exportDown,method:"post",data:t,responseType:"blob"})}function I(t){return Object(a["b"])({url:s.customerList,method:"get",params:t})}function _(t){return Object(a["b"])({url:s.dictionaryByCode,method:"get",params:t})}function C(t){return Object(a["b"])({url:s.distinctNum,method:"get",params:t})}function L(){return Object(a["b"])({url:s.tagGroup,method:"post",data:{}})}function x(t){return Object(a["b"])({url:s.customerLoss,method:"post",data:t})}function O(t){return Object(a["b"])({url:s.batchTaggingFront,method:"post",data:t})}function k(t){return Object(a["b"])({url:s.batchDelTagFront,method:"post",data:t})}function j(t){return Object(a["b"])({url:s.findByCustomerGroup,method:"post",data:t})}function $(t){return Object(a["b"])({url:s.findByCustomerEvent,method:"post",data:t})}function S(t){return Object(a["b"])({url:s.findEventByCustomerWxid,method:"post",data:t})}function E(t){return Object(a["b"])({url:s.findByCustomField,method:"post",data:t})}},"934a":function(t,e,n){"use strict";n("84ef")},"986e":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var a=n("2b0e"),s=new a["a"]},af32:function(t,e,n){},b799:function(t,e,n){"use strict";n("fd23")},c29b:function(t,e,n){"use strict";n("fa23")},c745:function(t,e,n){},d233:function(t,e,n){"use strict";n("3d04")},e758:function(t,e,n){"use strict";n("c745")},eac4:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t._self._c;return e("section",[e("a-page-header",{staticClass:"background-white",attrs:{title:"客户详情"},on:{back:function(e){return t.$router.go(-1)}}}),e("div",{staticClass:"page-box background-white"},[e("a-tabs",{style:{width:"100%"},attrs:{tabBarStyle:t.tabBarStyle},on:{change:t.changeTab},model:{value:t.staffId,callback:function(e){t.staffId=e},expression:"staffId"}},[e("div",{staticClass:"tabBar-extra-content",attrs:{slot:"tabBarExtraContent"},slot:"tabBarExtraContent"},[e("span",{staticClass:"aks-tips"},[t._v("已添加"+t._s(t.customerList.length-1)+"个员工")]),e("a-divider",{attrs:{type:"vertical"}})],1),t._l(t.customerList,(function(n){return e("a-tab-pane",{key:n.staffId,staticClass:"tab-content",attrs:{tab:n.staffName}},[e("AddCustomerList",{attrs:{staffId:t.staffId,customerInfo:t.customerInfo[0]}}),e("div",{staticClass:"bar"}),e("CustomerInfo",{attrs:{customerInfo:t.customerInfo,staffId:t.staffId}})],1)}))],2)],1)],1)},s=[],i=n("5530"),o=n("2909"),r=(n("7db0"),n("d3b7"),n("d81d"),n("4de4"),n("a15b"),n("99af"),n("b0c0"),function(){var t=this,e=t._self._c;return e("header",{staticClass:"background-white page-wrap"},[e("div",{staticClass:"personal-wrap"},[e("div",{staticClass:"personal-info"},[e("a-avatar",{attrs:{shape:"square",size:64,src:t.customerInfo.avatar}}),e("div",{staticClass:"info-right"},[e("div",{staticClass:"flex-box"},[e("strong",{staticClass:"name"},[t._v(" "+t._s(t.customerInfo.name)+" "),t.customerInfo.typeText?e("span",{staticClass:"source",class:{firm:2===t.customerInfo.type}},[t._v(" @"+t._s(t.customerInfo.typeText)+" ")]):t._e()]),t.customerInfo.lossTips?e("div",[e("a-tooltip",{attrs:{title:t.customerInfo.lossTips}},[e("a-tag",{staticClass:"tag tag-all"},[t._v(t._s(t.customerInfo.lossTips))])],1)],1):t._e(),t.customerInfo.lossTips||1!==t.customerInfo.lossStatus?t._e():e("a-tag",{staticClass:"tag"},[t._v("客户已流失")])],1),e("p",{staticClass:"aks-tip"},[e("a-space",[t._v(" 客户评分: "),e("span",{staticClass:"num"},[t._v(t._s(t.customerInfo.score))]),t._v("客户积分: "),e("span",{staticClass:"num"},[t._v(t._s(t.customerInfo.currentIntegral))])])],1)])],1),e("a-space",[e("a-button",{attrs:{type:"primary",ghost:"",size:"large"},on:{click:function(e){t.visibleSouce=!0}}},[t._v("修改评分")]),e("a-button",{attrs:{type:"primary",ghost:"",size:"large"},on:{click:function(e){t.visibleEvent=!0}}},[t._v("添加事件")])],1)],1),e("section",[e("div",{staticClass:"tag-group-list"},[e("p",{staticClass:"title aks-tips"},[t._v(" 企业标签 "),""===t.staffId?e("a-tooltip",{attrs:{title:"汇总展示所有员工添加的标签，在当前页面不可编辑"}},[e("a-icon",{attrs:{type:"question-circle"}})],1):t._e(),t._v(" ： ")],1),e("ul",[t._l(t.firmList,(function(n){return e("a-tag",{key:n.tagId,attrs:{color:"blue"}},[t._v(t._s(n.tagName))])})),t.staffId?e("a-button",{attrs:{type:"link"},on:{click:function(e){t.visibleTag=!0}}},[e("a-icon",{attrs:{type:"edit"}}),t._v(" 编辑 ")],1):t._e()],2)]),e("div",{staticClass:"tag-group-list"},[e("p",{staticClass:"title aks-tips"},[t._v(" 个人标签 "),t.staffId?t._e():e("a-tooltip",{attrs:{title:"汇总展示所有员工添加的标签，在当前页面不可编辑"}},[e("a-icon",{attrs:{type:"question-circle"}})],1),t._v(" ： ")],1),e("ul",[t._l(t.customerTagList,(function(n){return e("a-tag",{key:n.personalTagId,attrs:{color:"blue"}},[t._v(t._s(n.tagName))])})),t.staffId?e("a-button",{attrs:{type:"link"},on:{click:t.searchPersonTag}},[e("a-icon",{attrs:{type:"edit"}}),t._v(" 编辑 ")],1):t._e()],2)])]),e("a-modal",{attrs:{footer:null,centered:"",destroyOnClose:""},model:{value:t.visibleTag,callback:function(e){t.visibleTag=e},expression:"visibleTag"}},[e("SelectTags",{attrs:{selectTagList:t.firmList},on:{cancle:function(e){t.visibleTag=!1},serviceOk:t.serviceOk}})],1),e("a-modal",{attrs:{footer:null,centered:"",destroyOnClose:""},model:{value:t.visiblePersionTag,callback:function(e){t.visiblePersionTag=e},expression:"visiblePersionTag"}},[e("CommonInput",{attrs:{source:t.source,tagsItem:t.personTagList},on:{cancle:function(e){t.visiblePersionTag=!1},addTag:t.addTag,closeTag:t.closeTag,serviceOk:t.servicePersonOk}})],1),e("a-modal",{attrs:{footer:null,centered:"",destroyOnClose:""},model:{value:t.visibleSouce,callback:function(e){t.visibleSouce=e},expression:"visibleSouce"}},[e("ModifySouce",{attrs:{selectedRows:t.selectedRows,isBatch:!1,customerWxid:t.customerWxid},on:{cancle:function(e){t.visibleSouce=!1},serviceOk:t.serviceSouce}})],1),e("a-modal",{attrs:{footer:null,centered:"",destroyOnClose:""},model:{value:t.visibleEvent,callback:function(e){t.visibleEvent=e},expression:"visibleEvent"}},[e("AddEvent",{attrs:{selectedRows:t.selectedRows,customerWxid:t.customerWxid},on:{cancle:function(e){t.visibleEvent=!1},serviceOk:t.serviceEvent}})],1)],1)}),c=[],u=(n("a9e3"),n("caad"),n("2532"),n("0481"),n("4069"),n("c844")),l=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.source,!1),[e("TagComponents",{attrs:{tagslist:t.tagsItem,isEdit:t.source.isEdit,selectTagList:t.tagsItem.selectTagList,closable:t.source.isEdit},on:{addTag:t.addTag,closeTag:t.closeTag}}),t.tagsItem.tags&&t.tagsItem.tags.length>0?t._e():e("a-empty",{staticClass:"empty"})],1)},d=[],m=n("2a86"),f=n("6290"),p={name:"CommonInput",components:{CommonModal:m["a"],TagComponents:f["a"]},props:{source:{type:Object,default:function(){return{}}},tagsItem:{type:Object,default:function(){return{}}}},computed:{},data:function(){return{}},created:function(){},methods:{closeTag:function(t){this.$emit("closeTag",t)},addTag:function(t){this.$emit("addTag",t)},serviceOk:function(){this.$emit("serviceOk",this.tagsItem)}}},g=p,h=(n("b799"),n("2877")),v=Object(h["a"])(g,l,d,!1,null,"b5e3d47c",null),b=v.exports,y=n("8e9f"),T=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({attrs:{loading:t.loading},on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.sourceModal,!1),[e("a-tabs",{model:{value:t.activiteTabId,callback:function(e){t.activiteTabId=e},expression:"activiteTabId"}},[e("a-tab-pane",{key:1,attrs:{tab:"自定义事件"}},[e("FormList",{staticClass:"textarea",attrs:{formInfo:t.textAreaInfo}})],1),e("a-tab-pane",{key:2,attrs:{tab:"模板事件","force-render":""}},[e("div",{staticClass:"plan center"},[e("span",{staticClass:"title"},[t._v("选择事件:")]),t.isAdd?[e("a-input",{ref:"eventName",staticClass:"main",attrs:{placeholder:"请输入事件名称"},model:{value:t.modalName,callback:function(e){t.modalName=e},expression:"modalName"}}),e("a-space",[e("a-button",{attrs:{type:"link"},on:{click:t.addModal}},[t._v("确定")]),e("span",{on:{click:function(e){t.isAdd=!1}}},[t._v("取消")])],1)]:[e("a-select",{staticClass:"main",attrs:{placeholder:"选择模板事件"},model:{value:t.eventType.eventTypeName,callback:function(e){t.$set(t.eventType,"eventTypeName",e)},expression:"eventType.eventTypeName"}},[e("ul",{attrs:{slot:"dropdownRender"},slot:"dropdownRender"},t._l(t.eventList,(function(n,a){return e("li",{key:n.eventTypeId,attrs:{value:n.eventTypeId},on:{click:function(e){return t.chooseEventId(n)}}},[e("div",{staticClass:"select-list",on:{mouseenter:function(e){return t.mouseenter(a)},mouseleave:function(e){return t.mouseleave(a)}}},[t._v(" "+t._s(n.eventTypeName)+" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.selectIndex===a,expression:"selectIndex === index"}]},[e("a-icon",{staticClass:"edit",attrs:{type:"edit"},on:{click:function(e){return e.stopPropagation(),t.editGroup(n)}}}),1!==n.isDefault?e("a-icon",{attrs:{type:"delete"},on:{click:function(e){return e.stopPropagation(),t.deleteGroup(n)}}}):t._e()],1)])])})),0)]),e("a-button",{attrs:{type:"link"},on:{click:function(e){t.isAdd=!0}}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 新建 ")],1)]],2),e("div",{staticClass:"plan"},[e("span",{staticClass:"title"},[t._v("备注:")]),e("FormList",{staticClass:"main",attrs:{formInfo:t.textAreaModal}})],1)])],1),e("div",[e("a-button",{staticClass:"history-score",attrs:{type:"link"},on:{click:function(e){t.isOpen=!t.isOpen}}},[e("a-icon",{attrs:{type:t.isOpen?"minus-circle":"plus-circle"}}),t._v(" "+t._s(t.isOpen?"取消添加评分":"添加评分")+" ")],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],staticClass:"history-list"},[e("a-space",[t._v(" 给该客户添加"),e("a-input-number",{attrs:{min:0},model:{value:t.score,callback:function(e){t.score=e},expression:"score"}}),t._v("分 ")],1)],1)],1)],1)},I=[],_=n("26f2"),C=n("90a8"),L={name:"AddEvent",components:{CommonModal:m["a"],FormList:_["a"]},props:{customerWxid:{type:String,default:""}},data:function(){return{selectIndex:"",activiteTabId:1,sourceModal:{},editModalId:"",eventType:{eventTypeName:void 0},loading:!1,isAdd:!1,isOpen:!1,score:1,modalName:"",eventList:[],textAreaInfo:{title:"",type:"textarea",tips:"请输入要添加的备注信息吧，添加成功后将出现在客户动态列表里~",maxLength:100,value:""},textAreaModal:{title:"备注",type:"textarea",tips:"请输入要添加的备注信息吧，添加成功后将出现在客户动态列表里~",maxLength:100,value:""}}},created:function(){this.getTemplateList()},watch:{isAdd:function(){var t=this;this.isAdd&&this.$nextTick((function(){t.$refs.eventName.focus()}))}},computed:{params:function(){var t=1===this.activiteTabId?this.textAreaInfo.value:this.textAreaModal.value;return{eventTypeId:this.eventType.eventTypeId,remark:t,score:this.isOpen?this.score:"",customerWxid:this.customerWxid}}},methods:{chooseEventId:function(t){this.eventType=t},mouseenter:function(t){this.selectIndex=t},mouseleave:function(){this.selectIndex=""},editGroup:function(t){this.editModalId=t.eventTypeId,this.eventType=t,this.modalName=t.eventTypeName,this.isAdd=!0},deleteGroup:function(t){var e=this;this.$confirm({title:"提示",icon:"",okText:"删除",content:"确认删除？",onOk:function(){e.delTemplate(t)}})},delTemplate:function(t){var e=this;Object(C["j"])({eventTypeId:t.eventTypeId}).then((function(t){e.$message.success("删除成功")})).catch((function(t){e.$message.error(t)}))},addModal:function(){var t=this;if(this.modalName){var e=this.editModalId?C["A"]:C["a"],n=this.editModalId?"编辑":"新增",a={name:this.modalName,eventTypeId:this.editModalId};e(a).then((function(e){var a;t.$message.success("".concat(n,"成功")),t.isAdd=!1,null!==(a=e.data)&&void 0!==a&&a.eventTypeId&&(t.eventTypeId=e.data.eventTypeId),t.eventType.eventTypeName=t.modalName,t.editModalId="",t.getTemplateList()})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))}else this.$message.warning("请输入名称")},serviceOk:function(){var t=this;this.verify().then((function(e){t.loading=!0,Object(C["b"])(t.params).then((function(e){t.$message.success("添加事件成功"),t.$emit("serviceOk")})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))})).catch((function(e){t.$message.warning(e)}))},verify:function(){var t=this;return new Promise((function(e,n){1===t.activiteTabId&&(t.textAreaInfo.value||n("请填写备注信息")),2===t.activiteTabId&&(t.eventType.eventTypeId||n("请选择模板"),t.textAreaModal.value||n("请填写备注信息")),t.isOpen&&!t.score&&n("请输入有效评分"),e()}))},getTemplateList:function(){var t=this;Object(C["v"])().then((function(e){t.eventList=e.data}))}}},x=L,O=(n("934a"),Object(h["a"])(x,T,I,!1,null,"e18fb1a8",null)),k=O.exports,j=n("b775"),$={getCustomerStaffList:"/client_manager/client/getCustomerStaffList",getCustomerDetail:"/client_manager/client/getCustomerDetail",getCustomerTagList:"/client_manager/client/getCustomerTagList",setCustomerTag:"/client_manager/client/setCustomerTag",personalTagList:"/client_manager/personalTag/list",personalTagSave:"/client_manager/personalTag/save",personalTagDelete:"/client_manager/personalTag/delete",getPersonalTagList:"/client_manager/personalTag/getPersonalTagList",setPersonalTag:"/client_manager/personalTag/setPersonalTag",showInfo:"/client_manager/fieldCustomRule/showInfo",getFieldCustomList:"/client_manager/fieldCustomRule/getFieldCustomList",updateFieldBase:"/client_manager/client/updateFieldBase",updateFieldCustom:"/client_manager/fieldCustomRule/updateFieldCustom",getStageList:"/client_transformation/customerstage/getStageList",customerEventList:"/client_manager/customerEvent/list",getTypeList:"/client_manager/customerEvent/getTypeList",getCustomerGroup:"/client_manager/client/getCustomerGroup"};function S(t){return Object(j["b"])({url:$.getCustomerStaffList,method:"get",params:t})}function E(t){return Object(j["b"])({url:$.getCustomerDetail,method:"get",params:t})}function w(t){return Object(j["b"])({url:$.getCustomerTagList,method:"get",params:t})}function B(t){return Object(j["b"])({url:$.setCustomerTag,method:"post",data:t})}function D(t){return Object(j["b"])({url:$.personalTagList,method:"get",params:t})}function N(t){return Object(j["b"])({url:$.personalTagSave,method:"post",data:t})}function W(t){return Object(j["b"])({url:$.personalTagDelete,method:"post",data:t})}function M(t){return Object(j["b"])({url:$.getPersonalTagList,method:"get",params:t})}function A(t){return Object(j["b"])({url:$.setPersonalTag,method:"post",data:t})}function R(t){return Object(j["b"])({url:$.showInfo,method:"get",params:t})}function F(t){return Object(j["b"])({url:$.updateFieldBase,method:"post",data:t})}function P(t){return Object(j["b"])({url:$.updateFieldCustom,method:"post",data:t})}function Y(t){return Object(j["b"])({url:$.getStageList,method:"get",params:t})}function G(t){return Object(j["b"])({url:$.customerEventList,method:"post",data:t})}function z(t){return Object(j["b"])({url:$.getTypeList,method:"get",params:t})}function q(t){return Object(j["b"])({url:$.getCustomerGroup,method:"get",params:t})}var H=n("986e"),V={name:"AddCustomerList",components:{SelectTags:u["a"],CommonInput:b,ModifySouce:y["a"],AddEvent:k},props:{staffId:{type:[String,Number],default:""},customerInfo:{type:Object,default:function(){return{}}}},data:function(){return{visibleEvent:!1,visibleSouce:!1,visibleTag:!1,visiblePersionTag:!1,selectTagList:[],firmList:[],personTagList:[],customerTagList:[],source:{title:"个人标签",isEdit:!0}}},computed:{customerWxid:function(){return this.$route.query.customerId},selectedRows:function(){return[{customerId:this.customerWxid}]}},created:function(){this.visibleTag=!1,this.visiblePersionTag=!1,this.selectTagList=[],this.firmList=[],this.personTagList=[],this.customerTagList=[],this.init()},methods:{serviceEvent:function(){this.visibleEvent=!1,H["a"].$emit("customerEventList"),H["a"].$emit("getCustomerDetail")},init:function(){this.source.isEdit=this.$store.state.user.info.userid===this.staffId,this.getCustomerTagList(),this.getPersonalTagList()},serviceSouce:function(){this.visibleSouce=!1,H["a"].$emit("getCustomerDetail"),H["a"].$emit("customerEventList")},addTag:function(t){var e=this,n=t.callBack,a=t.value;t.tagItem;if(a){var s={staffWxid:this.staffId,tagName:a};N(s).then((function(t){n(),e.searchPersonTag(),e.$message.success("新增成功"),H["a"].$emit("customerEventList")})).catch((function(t){e.$message.error(t)}))}else n()},closeTag:function(t){var e=this;W([t.personalTagId]).then((function(t){e.$message.success("标签删除成功"),H["a"].$emit("customerEventList")})).catch((function(t){e.$message.error(t)}))},searchPersonTag:function(){var t=this;D({staffWxid:this.staffId}).then((function(e){t.personTagList={tags:e.data.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{tagId:t.personalTagId})})),selectTagList:t.customerTagList.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{tagId:t.personalTagId})}))},t.visiblePersionTag=!0})).catch((function(e){t.$message.error(e)}))},servicePersonOk:function(t){var e,n=this,a={customerWxid:this.customerWxid,addTagList:(null===t||void 0===t||null===(e=t.selectTagList)||void 0===e?void 0:e.map((function(t){return t.personalTagId})))||[],removeTagList:this.getRemoveTagList(t.selectTagList,this.customerTagList)};A(a).then((function(t){n.visiblePersionTag=!1,n.getPersonalTagList(),n.$message.success("标签设置成功"),H["a"].$emit("customerEventList")})).catch((function(t){n.$message.error(t)}))},getRemoveTagList:function(t,e){var n,a=(null===(n=t.filter((function(t){return t.personalTagId})))||void 0===n?void 0:n.map((function(t){return t.personalTagId})))||[],s=[];return e.length>0&&(s=e.filter((function(t){return!a.includes(t.personalTagId)})).map((function(t){return t.personalTagId}))),s},serviceOk:function(t){var e=this,n=t.filter((function(t){return t.selectTagList.length>0})).map((function(t){return t.selectTagList})).flat(),a={customerId:this.customerWxid,staffId:this.staffId,tagIds:n.map((function(t){return t.bitmap})).join(",")};B(a).then((function(t){e.$message.success("标签更新成功"),e.firmList=n,e.visibleTag=!1,H["a"].$emit("customerEventList")})).catch((function(t){e.$message.error(t)}))},getPersonalTagList:function(){var t=this;M({customerWxid:this.customerWxid,staffWxid:this.staffId}).then((function(e){t.customerTagList=e.data||[]})).catch((function(e){t.$message.error(e)}))},getCustomerTagList:function(){var t=this;w({customerWxid:this.customerWxid,staffWxid:this.staffId}).then((function(e){t.firmList=e.data})).catch((function(e){t.$message.error(e)}))}}},J=V,U=(n("d233"),Object(h["a"])(J,r,c,!1,null,"7c62bf08",null)),K=U.exports,Q=function(){var t=this,e=t._self._c;return e("div",[e("a-tabs",{model:{value:t.checkedId,callback:function(e){t.checkedId=e},expression:"checkedId"}},t._l(t.tabList,(function(n){return e("a-tab-pane",{key:n.id,attrs:{tab:n.name}},[e(n.component,{tag:"component",attrs:{customerInfo:t.customerInfo,staffId:t.staffId},on:{searchMore:t.searchMore}})],1)})),1)],1)},X=[],Z=function(){var t=this,e=t._self._c;return e("a-table",{attrs:{columns:t.columns,"data-source":t.dataList,pagination:!1},scopedSlots:t._u([{key:"groupName",fn:function(n){return e("div",{},[e("a-avatar",{attrs:{src:"/icons/groupChat.png",shape:"square",size:40}}),e("span",{staticStyle:{"padding-left":"10px"}},[t._v(t._s(n))])],1)}},{key:"userName",fn:function(n){return e("div",{},[e("a-tag",[e("a-icon",{attrs:{type:"user"}}),t._v(" "+t._s(n)+" ")],1)],1)}},{key:"inGroup",fn:function(n){return e("div",{},[n?e("a-tag",{attrs:{color:"blue"}},[t._v("我已在群聊中")]):e("a-tag",[t._v("我不在群聊中")])],1)}}])})},tt=[],et={name:"GroupChat",components:{},data:function(){return{columns:[{title:"群名称",dataIndex:"groupName",key:"groupName",scopedSlots:{customRender:"groupName"}},{title:"群主",dataIndex:"userName",key:"userName",scopedSlots:{customRender:"userName"}},{title:"群人数",dataIndex:"liveCount",key:"liveCount",scopedSlots:{customRender:"liveCount"}},{title:"客户入群时间",dataIndex:"joinTime",key:"joinTime",scopedSlots:{customRender:"joinTime"}},{title:"状态",dataIndex:"inGroup",key:"inGroup",scopedSlots:{customRender:"inGroup"}},{title:"创建时间",dataIndex:"wxCreateTime",key:"wxCreateTime"}],dataList:[],pagination:{current:1,pageSize:10,total:0}}},computed:{customerWxid:function(){return this.$route.query.customerId}},created:function(){this.dataList=[],this.pagination={current:1,pageSize:10,total:0},this.getCustomerGroup()},methods:{getCustomerGroup:function(){var t=this;q({customerWxId:this.customerWxid}).then((function(e){t.dataList=e.data})).catch((function(e){t.$message.error(e)}))}}},nt=et,at=Object(h["a"])(nt,Z,tt,!1,null,"21dd55fb",null),st=at.exports,it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex-box page-wrap"},[e("div",{staticClass:"left"},[e("ul",[e("h4",[e("a-icon",{staticClass:"icon",attrs:{type:"user"}}),t._v(" 添加客服信息")],1),e("a-table",{attrs:{columns:t.columns,"data-source":t.dataList,pagination:!1},scopedSlots:t._u([{key:"operation",fn:function(n){return e("div",{},[e("a-avatar",{attrs:{src:n.staffAvatar,shape:"square",size:23}}),e("span",{staticStyle:{"padding-left":"10px"}},[t._v(t._s(n.staffName))])],1)}}])})],1),e("div",[e("h4",[e("a-icon",{staticClass:"icon",attrs:{type:"table"}}),t._v(" 基本信息 "),e("a-divider",{attrs:{type:"vertical"}}),e("span",{staticClass:"aks-tips"},[t._v(" 所属员工可在「侧边栏-客户画像」中进行编辑 "),e("a-tooltip",[e("img",{staticClass:"base-tips",attrs:{slot:"title",src:"/imgs/baseTip.png"},slot:"title"}),e("a-icon",{attrs:{type:"question-circle"}})],1)],1)],1),e("EditTable",{attrs:{pageList:t.fieldBaseRuleList},on:{changeDate:t.updateFieldBase}})],1),e("div",[e("h4",[e("a-icon",{staticClass:"icon",attrs:{type:"edit"}}),t._v(" 自定义信息")],1),e("EditTable",{attrs:{pageList:t.fieldCustomRuleList},on:{changeDate:t.updateFieldCustom}})],1),e("div",[e("h4",[e("a-icon",{staticClass:"icon",attrs:{type:"edit"}}),t._v(" 客户阶段")],1),e("ul",{staticClass:"stage-table"},[e("p",{staticClass:"all-customer"},[t._v("共"+t._s(t.customerInfo.length)+"个客服")]),t._l(t.customerInfo,(function(n){return e("li",{key:n.id},[e("span",{staticClass:"name"},[t._v(t._s(n.staffName)+" "+t._s(n.current))]),e("a-steps",{attrs:{current:n.current,size:"small",labelPlacement:"vertical"},on:{change:t.onChange}},t._l(t.stageList,(function(n){return e("a-step",{key:n.stageId,attrs:{title:n.stageName,disabled:t.customerInfo.length>1}})})),1)],1)}))],2)])]),e("div",{staticClass:"right"},[e("p",{staticClass:"right-title"},[e("span",[t._v("客户动态")]),e("span",{staticClass:"aks-tips",on:{click:function(e){return t.$emit("searchMore")}}},[t._v("查看更多"),e("a-icon",{attrs:{type:"right"}})],1)]),e("TimeLine",{attrs:{dynamicList:t.dynamicList}})],1)])},ot=[],rt=(n("159b"),n("c740"),n("38cf"),function(){var t=this,e=t._self._c;return e("ul",{staticClass:"page-wrap"},t._l(t.pageList,(function(n){return e("li",{key:n.fieldId},[e("span",{staticClass:"title"},[t._v(t._s(n.fieldName))]),e("div",{staticClass:"info"},[e("FieldType",{attrs:{item:n},on:{changeDate:t.changeDate}})],1)])})),0)}),ct=[],ut=function(){var t=this,e=t._self._c;return e("div",[1===t.item.value.length?e("div",[1===t.item.fieldType?e("div",[e("a-input",{attrs:{placeholder:"请输入",disabled:!Boolean(t.item.canModify)},on:{pressEnter:function(e){return t.changeInput(t.item)},blur:function(e){return t.changeInput(t.item)}},model:{value:t.item.value[0],callback:function(e){t.$set(t.item.value,0,e)},expression:"item.value[0]"}})],1):t._e(),2===t.item.fieldType?e("div",[e("a-date-picker",{staticClass:"picker-time",attrs:{format:"YYYY-MM-DD HH:mm:ss","show-time":{defaultValue:t.$moment("00:00:00","HH:mm:ss")}},on:{ok:function(e){return t.changeTime(t.item)}},model:{value:t.item.value[0],callback:function(e){t.$set(t.item.value,0,e)},expression:"item.value[0]"}})],1):t._e(),3===t.item.fieldType?e("div",[e("a-select",{staticStyle:{width:"175px"},attrs:{placeholder:"请输入"},on:{change:function(e){return t.changeOption(t.item)}},model:{value:t.item.value[0],callback:function(e){t.$set(t.item.value,0,e)},expression:"item.value[0]"}},t._l(t.item.optionList,(function(n){return e("a-select-option",{key:n.optionId,attrs:{value:n.optionId}},[t._v(" "+t._s(n.optionValue)+" ")])})),1)],1):t._e(),4===t.item.fieldType?e("div",[e("a-date-picker",{on:{change:function(e){return t.changeDate(t.item)}},model:{value:t.item.value[0],callback:function(e){t.$set(t.item.value,0,e)},expression:"item.value[0]"}})],1):t._e()]):e("ul",t._l(t.item.value,(function(n,a){return e("li",{key:a},[t._v(" "+t._s(n)+" ")])})),0)])},lt=[],dt={name:"FieldType",components:{},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{changeTime:function(t){this.$emit("changeDate",t,this.item.value[0].format("YYYY-MM-DD HH:mm:ss"))},changeDate:function(t){this.$emit("changeDate",t,this.item.value[0].format("YYYY-MM-DD"))},changeInput:function(t){this.$emit("changeDate",t,this.item.value[0])},changeOption:function(t){this.$emit("changeDate",t,this.item.value[0])}}},mt=dt,ft=(n("55c9"),Object(h["a"])(mt,ut,lt,!1,null,"00da90ba",null)),pt=ft.exports,gt={name:"EditTable",components:{FieldType:pt},props:{pageList:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{changeDate:function(t,e){this.$emit("changeDate",t,e)}}},ht=gt,vt=(n("fd96"),Object(h["a"])(ht,rt,ct,!1,null,"dbecdda2",null)),bt=vt.exports,yt=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"rule-list"},t._l(t.dynamicList,(function(n){return e("li",{key:n.eventId},[n.repeat?t._e():e("div",{staticClass:"date"},[t._v(" "+t._s(t._f("getDate")(n.createTime))+" ")]),e("div",{staticClass:"rule-head"},[e("div",[e("a-icon",{staticClass:"clock",attrs:{type:"clock-circle"}})],1),e("span",[t._v(t._s(t._f("getTime")(n.createTime)))])]),e("div",{staticClass:"rule-content"},[e("section",{staticClass:"section"},[e("h5",{staticClass:"title"},[t._v(t._s(n.eventTypeName))]),e("p",[t._v(t._s(t._f("getContent")(n)))])])])])})),0)},Tt=[],It=(n("ac1f"),n("5319"),n("c1df")),_t=n.n(It),Ct={name:"TimeLine",components:{},props:{dynamicList:{type:Array,default:function(){return[]}}},filters:{getDate:function(t){var e=["日","一","二","三","四","五","六"],n="";if(t){var a=_t()(t).format("d");n+="星期".concat(e[a]," "),n+=_t()(t).format("YYYY-MM-DD")}return n},getContent:function(t){return t.content.replace("#staff#",t.staffName).replace("#customer#",t.customerName)},getTime:function(t){var e=t;return t&&(e=_t()(t).format("HH:mm")),e}},data:function(){return{}},methods:{}},Lt=Ct,xt=(n("74be"),Object(h["a"])(Lt,yt,Tt,!1,null,"5ee0323e",null)),Ot=xt.exports,kt=n("ca00"),jt={name:"BaseInfo",components:{EditTable:bt,TimeLine:Ot},props:{customerInfo:{type:[Array],default:function(){return{}}},staffId:{type:String,default:""}},watch:{customerInfo:function(){var t=this;this.fieldBaseRuleList=this.getFieldBaseRuleList(this.fieldBaseRuleList),this.fieldBaseRuleList.forEach((function(t){"性别"===t.fieldName&&t.value.length>1&&(t.value=Object(kt["j"])(t.value),t.value.push(""))})),this.dataList=this.customerInfo.map((function(e){return e.current=t.getCurrent(e.status),Object(i["a"])(Object(i["a"])({},e),{},{current:t.getCurrent(e.status)})}))},stageList:function(){var t=this;this.dataList=this.customerInfo.map((function(e){return e.current=t.getCurrent(e.status),Object(i["a"])(Object(i["a"])({},e),{},{current:t.getCurrent(e.status)})}))}},data:function(){return{columns:[{title:"所属员工",dataIndex:"operation",key:"operation",scopedSlots:{customRender:"operation"}},{title:"客户来源",dataIndex:"customerSource",key:"customerSource",scopedSlots:{customRender:"customerSource"},customRender:function(t,e,n){return t||"-"}},{title:"添加时间",dataIndex:"addTime",key:"addTime",scopedSlots:{customRender:"addTime"},customRender:function(t,e,n){return t||"-"}},{title:"最近沟通时间",dataIndex:"lastCommunicationTime",key:"lastCommunicationTime",scopedSlots:{customRender:"lastCommunicationTime"},customRender:function(t,e,n){return t||"-"}}],dataList:[],fieldBaseRuleList:[],fieldCustomRuleList:[],dynamicList:[],pagination:{current:1,pageSize:4,total:0},stageList:[],sexList:{0:"未知",1:"男",2:"女"}}},created:function(){H["a"].$on("customerEventList",this.customerEventList),this.dynamicList=[],this.fieldCustomRuleList=[],this.fieldBaseRuleList=[],this.stageList=[],this.dataList=[],this.getShowInfo(),this.getStageList(),this.customerEventList()},destroyed:function(){H["a"].$off("customerEventList",this.customerEventList)},computed:{customerWxid:function(){return this.$route.query.customerId}},methods:{getCurrent:function(t){return this.stageList.findIndex((function(e){return e.stageId===t}))},updateFieldCustom:function(t,e){var n=this,a={customerWxid:this.customerWxid,staffWxid:this.staffId,fieldId:t.fieldId,fieldValue:e};return P(a).then((function(t){n.$message.success("信息更改成功"),n.customerEventList()})).catch((function(t){n.$message.error(t)}))},updateFieldBase:function(t,e){var n=this,a={id:this.customerInfo[0].id};return a[t.fieldAttr]=e,F(a).then((function(){n.$message.success("信息更改成功"),n.customerEventList()})).catch((function(t){n.$message.error(t)}))},onChange:function(t){var e=this;t===this.customerInfo[0].current?this.updateFieldBase({fieldAttr:"status"},0).then((function(t){e.$set(e.customerInfo[0],"current",-1),e.$forceUpdate()})):this.updateFieldBase({fieldAttr:"status"},this.stageList[t].stageId).then((function(n){e.$set(e.customerInfo[0],"current",t),e.$forceUpdate()}))},getStageList:function(){var t=this;Y().then((function(e){t.stageList=e.data})).catch((function(e){t.$message.error(e)}))},getFieldBaseRuleList:function(t){var e=this;return t.map((function(t){var n;return Object(i["a"])(Object(i["a"])({},t),{},{value:(null===(n=e.customerInfo)||void 0===n?void 0:n.map((function(n){return"性别"===t.fieldName?e.sexList[n[t.fieldAttr]]:[2,4].includes(t.fieldType)&&n[t.fieldAttr]?(null===(a=e.customerInfo)||void 0===a?void 0:a.length)>1?n[t.fieldAttr]:e.$moment(n[t.fieldAttr]):n[t.fieldAttr]||null;var a})))||[null]})}))},getShowInfo:function(){var t=this,e={customerWxid:this.customerWxid,staffWxid:this.staffId};R(e).then((function(e){t.fieldBaseRuleList=t.getFieldBaseRuleList(e.data.fieldBaseRuleList),t.fieldCustomRuleList=e.data.fieldCustomRuleList.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{value:e.fieldCustomValueList.map((function(n){var a;return[2,4].includes(e.fieldType)&&n.fieldValue?((null===(a=t.customerInfo)||void 0===a?void 0:a.length)>1?n.fieldValue:t.$moment(n.fieldValue))||null:n.fieldValue||void 0}))})}))})).catch((function(e){t.$message.error(e)}))},customerEventList:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,customerWxid:this.customerWxid,staffWxid:this.staffId,eventTypeId:""};this.loading=!0,G(e).then((function(e){if(e.data.list.length>0&&(t.dynamicList=e.data.list,t.disposePageData(t.dynamicList)),e.data.list.length<t.pagination.pageSize)return t.busy=!0,void(t.loading=!1);t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e)}))},disposePageData:function(t){for(var e={},n=0;n<t.length;n++){var a=t[n],s=this.$moment(a.createTime).format("YYYY-MM-DD");e[s]?a.repeat=!0:e[s]=!0}return this.planList}}},$t=jt,St=(n("4907"),Object(h["a"])($t,it,ot,!1,null,"7c1b5e06",null)),Et=St.exports,wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content"},[e("a-radio-group",{attrs:{name:"radioGroup"},on:{change:t.changeEvent},model:{value:t.eventTypeId,callback:function(e){t.eventTypeId=e},expression:"eventTypeId"}},t._l(t.dynamicType,(function(n){return e("a-radio",{key:n.eventTypeId,attrs:{value:n.eventTypeId}},[t._v(" "+t._s(n.eventTypeName)+" ")])})),1),e("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],staticClass:"scroll-list rule-list",attrs:{"infinite-scroll-disabled":t.busy,"infinite-scroll-distance":10}},[t.dynamicList.length>0?[e("TimeLine",{attrs:{dynamicList:t.dynamicList}})]:e("a-empty"),t.loading?e("div",{staticClass:"loading-container"},[e("a-spin",{attrs:{tip:"正在加载中..."}})],1):t._e(),!t.loading&&t.dynamicList.length>0?e("div",{staticClass:"loading-container"},[t._v("没有更多数据了")]):t._e()],2)],1)},Bt=[],Dt=n("487a"),Nt=n.n(Dt),Wt={directives:{infiniteScroll:Nt.a},name:"Dynamic",components:{TimeLine:Ot},props:{staffId:{type:String,default:""}},data:function(){return{pagination:{current:1,pageSize:10,total:0},busy:!1,defaultType:[{eventTypeName:"全部动态",eventTypeId:""}],dynamicType:[],dynamicList:[],eventTypeId:"",loading:!1}},created:function(){var t=this;this.pagination={current:1,pageSize:10,total:0},this.busy=!1,this.dynamicType=[],this.dynamicList=[],this.eventTypeId="",this.loading=!1,this.getTypeList(),this.debounceMethods=Object(kt["m"])(this.customerEventList,200),setTimeout((function(){t.handleInfiniteOnLoad()}),201)},computed:{customerWxid:function(){return this.$route.query.customerId}},methods:{customerEventList:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,customerWxid:this.customerWxid,staffWxid:this.staffId,eventTypeId:this.eventTypeId};this.loading=!0,G(e).then((function(e){var n;e.data.list.length>0&&((n=t.dynamicList).push.apply(n,Object(o["a"])(e.data.list)),t.disposePageData(t.dynamicList));if(e.data.list.length<t.pagination.pageSize)return t.busy=!0,void(t.loading=!1);t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e)}))},disposePageData:function(t){for(var e={},n=0;n<t.length;n++){var a=t[n],s=this.$moment(a.createTime).format("YYYY-MM-DD");e[s]?a.repeat=!0:e[s]=!0}return this.planList},getTypeList:function(){var t=this;z().then((function(e){t.dynamicType=[].concat(Object(o["a"])(t.defaultType),Object(o["a"])(e.data))})).catch((function(e){t.$message.error(e)}))},changeEvent:function(){this.dynamicList=[],this.busy=!1,this.pagination.current=1,this.handleInfiniteOnLoad()},handleInfiniteOnLoad:function(){!this.busy&&this.debounceMethods()}}},Mt=Wt,At=(n("e758"),Object(h["a"])(Mt,wt,Bt,!1,null,"6903cae4",null)),Rt=At.exports,Ft=function(){var t=this,e=t._self._c;return e("div",[e("News",{attrs:{source:"CustomerDetail",customerId:t.customerId,staffIdSource:t.staffId}})],1)},Pt=[],Yt=n("8a24"),Gt={name:"Records",components:{News:Yt["default"]},props:{staffId:{type:String,default:""}},computed:{customerId:function(){return this.$route.query.customerId}},data:function(){return{}},methods:{}},zt=Gt,qt=Object(h["a"])(zt,Ft,Pt,!1,null,"20a2234b",null),Ht=qt.exports,Vt={name:"CustomerInfo",components:{GroupChat:st,BaseInfo:Et,Dynamic:Rt,Records:Ht},props:{customerInfo:{type:Array,default:function(){return{}}},staffId:{type:String,default:""}},data:function(){return{checkedId:1,tabList:[{name:"客户概况",id:1,component:"BaseInfo"},{name:"客户动态",id:2,component:"Dynamic"},{name:"聊天记录",id:3,component:"Records"},{name:"所在群聊",id:4,component:"GroupChat"}]}},methods:{searchMore:function(){this.checkedId=2}}},Jt=Vt,Ut=Object(h["a"])(Jt,Q,X,!1,null,"dfe6e02a",null),Kt=Ut.exports,Qt={name:"CustomerDetail",components:{AddCustomerList:K,CustomerInfo:Kt},data:function(){return{customerList:[{staffName:"客户信息汇总",staffId:""}],tabBarStyle:{width:"100%"},staffId:null,customerInfo:[]}},activated:function(){this.customerInfo=[],this.customerList=[{staffName:"客户信息汇总",staffId:""}],this.init()},computed:{customerWxid:function(){return this.$route.query.customerId},staffWxid:function(){return this.$route.query.staffId}},created:function(){H["a"].$on("getCustomerDetail",this.getCustomerDetail)},destroyed:function(){H["a"].$off("getCustomerDetail",this.getCustomerDetail)},methods:{init:function(){var t=this;S({customerWxid:this.customerWxid}).then((function(e){var n;(n=t.customerList).push.apply(n,Object(o["a"])(e.data||[]));var a=t.customerList.find((function(e){return e.staffId===t.staffWxid}));t.staffId=a?t.staffWxid:"",t.getCustomerDetail()})).catch((function(e){t.$message.error(e)}))},getCustomerDetail:function(){var t=this;E({customerWxid:this.customerWxid,staffWxid:this.staffId}).then((function(e){var n;if(t.customerInfo=e.data.map((function(t,e){return Object(i["a"])(Object(i["a"])({},t),{},{key:e,operation:t,typeText:1===t.type?"微信":t.corpName})})),1!==e.data.length){var a=null===(n=e.data)||void 0===n?void 0:n.filter((function(t){return 1===t.lossStatus})),s="";(null===a||void 0===a?void 0:a.length)>0&&(s=a.map((function(t){return[t.staffName]})).join("、"),t.customerInfo[0].lossTips="客户已经删除了".concat(s,"等").concat(a.length,"位员工"))}})).catch((function(e){t.$message.error(e)}))},changeTab:function(){this.getCustomerDetail()}}},Xt=Qt,Zt=(n("61af"),Object(h["a"])(Xt,a,s,!1,null,"2b9685a4",null));e["default"]=Zt.exports},fa23:function(t,e,n){},fd23:function(t,e,n){},fd96:function(t,e,n){"use strict";n("4c3e")}}]);