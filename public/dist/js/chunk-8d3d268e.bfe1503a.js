(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8d3d268e"],{2314:function(t,e,i){"use strict";i("afd2")},"260e":function(t,e,i){},"299d":function(t,e,i){},"2bf4":function(t,e,i){"use strict";var n=i("2909"),a=i("5530"),s=(i("d3b7"),i("d81d"),i("3ca3"),i("ddb0"),i("9911"),i("a15b"),i("a9e3"),i("d885")),r=i("cf5f");e["a"]={methods:{addAccessory:function(t){this.attachments=t},uploadMedia:function(t){var e=this,i=t||this.attachments;return new Promise((function(t,n){var a=(null===i||void 0===i?void 0:i.map((function(t){return new Promise((function(i,n){if("link"===t.type)e.interactiveRadarAdd(t).then((function(t){i(t)}));else if("img"===t.type&&t.pic_url.file){var a=new FormData;a.append("file",t.pic_url.file),a.append("dir","clientTransformation"),a.append("type","image"),Object(r["y"])(a).then((function(e){t.pic_url.fileUrl=e.data.fileUrl,t.pic_url.mediaId=e.data.mediaId,i(e.data)}))}else i()}))})))||[];Promise.all(a).then((function(e){t()})).catch((function(t){e.$message.error(t||t.message),e.loading=!1,n(t)}))}))},channelCodeUploadFileFun:function(t){var e=this,i=t||this.attachments;return new Promise((function(t,n){var a=(null===i||void 0===i?void 0:i.map((function(t){return new Promise((function(i,n){if("link"===t.type)e.interactiveRadarAdd(t).then((function(t){i(t)}));else if("img"===t.type&&t.pic_url.file){var a=new FormData;a.append("file",t.pic_url.file),Object(r["d"])(a).then((function(e){t.pic_url.fileUrl=e.data.fileUrl,t.pic_url.mediaId=e.data.mediaId,i(e.data)}))}else i()}))})))||[];Promise.all(a).then((function(e){t()})).catch((function(t){e.$message.error(t||t.message),e.loading=!1,n(t)}))}))},getAttachments:function(t){var e=t||this.attachments;return null===e||void 0===e?void 0:e.map((function(t){if("img"===t.type)return{msgtype:"image",image:{media_id:t.pic_url.mediaId,pic_url:t.pic_url.fileUrl||t.pic_url.compress,title:t.title}};if("link"===t.type){var e="normal_link";t.linktype?e=t.linktype:t.radarId&&(e="radar_link");var i=t.radarId||t.formId||t.id;return i&&(i=String(i)),{msgtype:"link",link:{title:t.linkTitle,picurl:t.picurl||t.coverUrl.compress,desc:t.desc,url:t.url||t.link||t.activityLink,radarId:i,type:e}}}}))},interactiveRadarAdd:function(t){var e=this;return new Promise((function(i,n){e.getParamsLink(t).then((function(e){t.isRadar&&t.randerIsEdit?Object(s["f"])(e).then((function(e){t.radarId=e.data.radarId,t.url=e.data.radarLink+t.source,i(e)})).catch((function(t){n(t)})):i()}))}))},getParamsLink:function(t){return new Promise((function(e,i){var n=new FormData,a=t.isCustomerTag?[{autoMarkTagBitmaps:t.selectCustomerTagList.map((function(t){return t.bitmap})).join(",")}]:[];if(n.append("type",1),n.append("radarName",t.linkTitle),n.append("link",t.url),n.append("activityNotify",Number(t.activityNotify)),n.append("behaviorNotify",Number(t.behaviorNotify)),n.append("tagRule",JSON.stringify(a)),n.append("title",t.radarTitle),n.append("desc",t.desc),n.append("hasCustomerTag",Number(t.isCustomerTag)),t.isScoreRule){var s=JSON.stringify(t.ruleDetails.map((function(t){var e,i;return{autoMarkTagBitmaps:null===(e=t.selectTagList)||void 0===e||null===(i=e.map((function(t){return t.bitmap})))||void 0===i?void 0:i.join(","),hasTag:Number(t.hasTag),score:t.score,ruleKind:t.ruleKind,count:t.count||0}})));n.append("scoreRule",s)}if(t.coverUrl.file){var o=new FormData;o.append("file",t.coverUrl.file),o.append("dir","clientTransformation"),Object(r["m"])(o).then((function(i){n.append("coverUrl",i.data),t.picurl=i.data,e(n)})).catch((function(t){i(t)}))}else e(n)}))},attachmentsDetail:function(t){return null===t||void 0===t?void 0:t.map((function(t){var e,i,n,s,r,o="",c="",l="",u="",d={};("image"===t.msgtype&&(o="图文",c="visibileAddImg",u="img",l={compress:t.image.pic_url}),"link"===t.msgtype)&&(u="link",t.linktype=t.link.type,"radar_link"!==t.linktype&&"normal_link"!==t.linktype||(c="visibileAddLink",o="链接"),"form_link"===t.linktype&&(c="visibileForm",o="自定义表单"),"luck_link"===t.linktype&&(c="visibileLuckDraw",o="抽奖活动"),d={compress:t.link.picurl},t.linkTitle=t.link.title,t.desc=t.link.desc,t.url=t.link.url,t.link.interactRadar&&(t.isRadar=!0,t.behaviorNotify=Boolean(t.link.interactRadar.behaviorNotify),t.activityNotify=Boolean(t.link.interactRadar.activityNotify),t.isCustomerTag=(null===(e=t.link.interactRadar.tagRules)||void 0===e?void 0:e.length)>0,t.radarId=null===(i=t.link.interactRadar)||void 0===i?void 0:i.radarId,t.radarTitle=t.link.title,t.selectCustomerTagList=null===(n=t.link.interactRadar.tagRules[0])||void 0===n||null===(s=n.customerTags)||void 0===s?void 0:s.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{key:t.tagId})})),t.isScoreRule=(null===(r=t.link.interactRadar.scoreRules)||void 0===r?void 0:r.length)>0,t.ruleDetails=t.link.interactRadar.scoreRules.map((function(t){var e;return Object(a["a"])(Object(a["a"])({},t),{},{autoMarkTagBitmaps:t.autoMarkTagBitmaps,selectTagList:null===(e=t.customerTags)||void 0===e?void 0:e.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{key:t.tagId})})),hasTag:Boolean(t.hasTag),score:t.score,ruleKind:t.ruleKind,count:t.count})}))));return Object(a["a"])(Object(a["a"])({},t),{},{key:c,pic_url:l,type:u,coverUrl:d,typeText:o})}))}},computed:{state:function(){return this.$route.query.state},isAddText:function(){return"add"===this.$route.query.state?"新建":"修改"},textList:function(){var t=[];return this.messageOne&&t.push(this.messageOne),this.attachments&&t.push.apply(t,Object(n["a"])(this.attachments)),t}}}},"2f82":function(t,e,i){},"3de3":function(t,e,i){"use strict";i("95d0")},"3fc5":function(t,e,i){},"507e":function(t,e,i){"use strict";i("2f82")},7581:function(t,e,i){"use strict";i("b0c0");var n=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.sourceModal,!1),[e("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],staticClass:"scroll-list",attrs:{"infinite-scroll-disabled":t.busy,"infinite-scroll-distance":10}},[t.pageList.length>0?e("ul",{staticClass:"randar-list-wrap"},t._l(t.pageList,(function(i){return e("li",{key:i.formId,staticClass:"randar-list",on:{click:function(e){t.selectRandarId=i.formId}}},[e("header",{staticClass:"randar-head"},[e("div"),e("a-checkbox",{attrs:{checked:t.selectRandarId===i.formId}})],1),e("section",{staticClass:"randar-main"},[e("div",{staticClass:"randar-main-content"},[e("p",[t._v(t._s(i.name))]),e("p",{staticClass:"aks-tips"},[t._v(t._s(i.describe))])]),e("a-avatar",{attrs:{size:40,src:i.cover,shape:"square"}})],1)])})),0):e("a-empty"),t.loading?e("div",{staticClass:"loading-container"},[e("a-spin",{attrs:{tip:"正在加载中..."}})],1):t._e(),!t.loading&&t.pageList.length>0?e("div",{staticClass:"loading-container"},[t._v("没有更多数据了")]):t._e()],1)])},a=[],s=i("2909"),r=(i("7db0"),i("d3b7"),i("2a86")),o=i("487a"),c=i.n(o),l=i("8f19"),u={name:"AddForm",directives:{infiniteScroll:c.a},components:{CommonModal:r["a"]},props:{editData:{type:Object,default:function(){return{}}},source:{type:String,default:""}},data:function(){return{sourceModal:{title:"自定义表单"},pagination:{current:1,pageSize:10,total:0},form:{typeText:"自定义表单",type:"link",linkTitle:"",desc:"",coverUrl:{compress:""}},type:"",typeText:{1:"链接",2:"PDF",3:"文章",4:"文章"},typeImg:{1:"/imgs/default-cover.png",2:"/icons/pdf.png",3:"/imgs/default-cover.png",4:"/imgs/default-cover.png"},radarName:"",loading:!1,busy:!1,pageList:[],selectRandarId:""}},watch:{editData:{handler:function(){},deep:!0,immediate:!0}},methods:{serviceOk:function(){var t=this;if(this.selectRandarId){var e=this.pageList.find((function(e){return e.formId===t.selectRandarId}));e.typeText="自定义表单",e.linkTitle=e.name,e.desc=e.describe,e.type="link",e.key="visibileForm",e.linktype="form_link",e.coverUrl={compress:e.cover},this.$emit("serviceOk",e)}else this.$message.warning("请选择一个自定义表单")},init:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,source:this.source,status:1};this.loading=!0,Object(l["f"])(e).then((function(e){var i;e.data.list.length>0&&(i=t.pageList).push.apply(i,Object(s["a"])(e.data.list));if(t.pagination.current++,e.data.list.length<t.pagination.pageSize)return t.busy=!0,void(t.loading=!1);t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e||e.message)}))},selectTab:function(t){this.type=t,this.pagination.current=1,this.pageList=[],this.busy=!1,this.init()},search:function(){this.pagination.current=1,this.pageList=[],this.busy=!1,this.init()},handleInfiniteOnLoad:function(){!this.busy&&this.init()}}},d=u,m=(i("2314"),i("2877")),f=Object(m["a"])(d,n,a,!1,null,"66fbf478",null);e["a"]=f.exports},"7a44":function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",[e("ul",{staticClass:"list-wrap"},t._l(t.attachments,(function(i,n){return e("li",{key:n,staticClass:"list"},[e("div",[e("a-icon",{staticClass:"button",attrs:{type:"minus-circle"},on:{click:function(e){return t.deleteAttachments(n)}}}),t._v(" 【"+t._s(i.typeText)+"】: "+t._s(i.title||i.linkTitle)+" ")],1),e("a-icon",{staticClass:"button",attrs:{type:"form"},on:{click:function(e){return t.editAttachments(i,n)}}})],1)})),0),e("a-dropdown",{attrs:{placement:"topCenter",trigger:["click"]}},[e("a-button",{staticClass:"add-button",attrs:{type:"link",block:"",size:"large"}},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v(" 添加附件 ")],1),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},t._l(t.menuList,(function(i){return e("a-menu-item",{key:i.id,on:{click:function(e){return t.openAccessory(i.key)}}},[t._v(" "+t._s(i.text)+" ")])})),1)],1),e("a-modal",{attrs:{footer:null,destroyOnClose:"",centered:"",width:"580px"},model:{value:t.visibileAddImg,callback:function(e){t.visibileAddImg=e},expression:"visibileAddImg"}},[e("AddImg",{attrs:{editData:t.editData},on:{cancle:function(e){t.visibileAddImg=!1},serviceOk:t.serviceOk}})],1),e("a-modal",{attrs:{footer:null,destroyOnClose:"",centered:"",width:"580px"},model:{value:t.visibileAddLink,callback:function(e){t.visibileAddLink=e},expression:"visibileAddLink"}},[e("AddLink",{attrs:{editData:t.editData,source:t.source,isNeedSelectRadar:t.isNeedSelectRadar,isNeedRader:t.isNeedRader},on:{cancle:function(e){t.visibileAddLink=!1},serviceOk:t.serviceOk}})],1),e("a-modal",{attrs:{footer:null,destroyOnClose:"",centered:"",width:"880px"},model:{value:t.visibileForm,callback:function(e){t.visibileForm=e},expression:"visibileForm"}},[e("AddForm",{attrs:{editData:t.editData,source:t.source},on:{cancle:function(e){t.visibileForm=!1},serviceOk:t.serviceOk}})],1),e("a-modal",{attrs:{footer:null,destroyOnClose:"",centered:"",width:"880px"},model:{value:t.visibileLuckDraw,callback:function(e){t.visibileLuckDraw=e},expression:"visibileLuckDraw"}},[e("AddluckyDraw",{attrs:{editData:t.editData,source:t.source},on:{cancle:function(e){t.visibileLuckDraw=!1},serviceOk:t.serviceOk}})],1)],1)},a=[],s=(i("a9e3"),i("a434"),function(){var t=this,e=t._self._c;return e("CommonModal",t._b({attrs:{loading:t.loading},on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.source,!1),[e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},t._l(t.formInfoList,(function(t,i){return e("a-form-model-item",{key:i,attrs:{label:t.title,prop:t.prop}},[e("FormList",{staticClass:"input",attrs:{formInfo:t}})],1)})),1)],1)}),r=[],o=(i("d3b7"),i("159b"),i("2a86")),c=i("26f2"),l={name:"AddImg",components:{CommonModal:o["a"],FormList:c["a"]},props:{editData:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}},data:function(){return{source:{title:"添加图片"},labelCol:{span:4},wrapperCol:{span:6},formInfoList:[{title:"图片标题",prop:"title",type:"input",tips:"请输入图片标题",maxLength:30,value:""},{title:"图片",prop:"pic_url",type:"img",tips:"",accept:".jpg,.png",maxLength:2097152,value:{}}],form:{pic_url:{},title:"",type:"img",typeText:"图片",key:"visibileAddImg"},rules:{title:[{required:!1,message:"未填写图片标题"}],pic_url:[{required:!0,message:"未选择图片"}]}}},watch:{editData:{handler:function(){var t;null!==(t=this.editData)&&void 0!==t&&t.type&&(this.form.title=this.editData.title||"",this.form.pic_url=this.editData.pic_url,this.getlistValue())},immediate:!0}},methods:{serviceOk:function(){var t=this;this.getFormValue()&&this.$refs.ruleForm.validate((function(e){if(!e)return!1;t.form.pic_url.compress?t.$emit("serviceOk",t.form):t.$message.warning("图片没有上传")}))},getFormValue:function(){var t=this;return this.formInfoList.forEach((function(e){e.type,t.form[e.prop]=e.value})),!0},getlistValue:function(){var t=this;this.formInfoList.forEach((function(e){e.type,e.value=t.form[e.prop]}))}}},u=l,d=(i("f564"),i("2877")),m=Object(d["a"])(u,s,r,!1,null,"cd8ffb1e",null),f=m.exports,p=i("a2ba"),h=i("7581"),g=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.sourceModal,!1),[e("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],staticClass:"scroll-list",attrs:{"infinite-scroll-disabled":t.busy,"infinite-scroll-distance":10}},[t.pageList.length>0?e("ul",{staticClass:"randar-list-wrap"},t._l(t.pageList,(function(i){return e("li",{key:i.id,staticClass:"randar-list",on:{click:function(e){t.selectRandarId=i.id}}},[e("header",{staticClass:"randar-head"},[e("div"),e("a-checkbox",{attrs:{checked:t.selectRandarId===i.id}})],1),e("section",{staticClass:"randar-main"},[e("div",{staticClass:"randar-main-content"},[e("p",[t._v(t._s(i.activityName))]),e("p",{staticClass:"aks-tips"},[t._v(t._s(i.activityExplain))])]),e("a-avatar",{attrs:{size:40,src:i.cover,shape:"square"}})],1)])})),0):e("a-empty"),t.loading?e("div",{staticClass:"loading-container"},[e("a-spin",{attrs:{tip:"正在加载中..."}})],1):t._e(),!t.loading&&t.pageList.length>0?e("div",{staticClass:"loading-container"},[t._v("没有更多数据了")]):t._e()],1)])},v=[],b=i("2909"),k=(i("7db0"),i("487a")),y=i.n(k),L=i("8bac"),_={name:"AddluckyDraw",directives:{infiniteScroll:y.a},components:{CommonModal:o["a"]},props:{editData:{type:Object,default:function(){return{}}},source:{type:String,default:""}},data:function(){return{sourceModal:{title:"抽奖活动"},pagination:{current:1,pageSize:10,total:0},form:{typeText:"抽奖活动",type:"link",linkTitle:"",desc:"",key:"visibileLuckDraw",coverUrl:{compress:""}},type:"",typeImg:{1:"/imgs/default-cover.png",2:"/icons/pdf.png",3:"/imgs/default-cover.png",4:"/imgs/default-cover.png"},radarName:"",loading:!1,busy:!1,pageList:[],selectRandarId:""}},watch:{editData:{handler:function(){},deep:!0,immediate:!0}},methods:{serviceOk:function(){var t=this;if(this.selectRandarId){var e=this.pageList.find((function(e){return e.id===t.selectRandarId}));e.typeText="抽奖活动",e.linkTitle=e.activityName,e.desc=e.activityExplain,e.type="link",e.key="visibileLuckDraw",e.linktype="luck_link",e.coverUrl={compress:e.cover},this.$emit("serviceOk",e)}else this.$message.warning("请选择一个自定义表单")},init:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,source:this.source,name:"",status:1};this.loading=!0,Object(L["f"])(e).then((function(e){var i;e.data.list.length>0&&((i=t.pageList).push.apply(i,Object(b["a"])(e.data.list)),t.pageList.forEach((function(t){t.cover="https://acadsocscrmpc.oss-cn-shenzhen.aliyuncs.com/h5/img/luckyBg.png"})));if(t.pagination.current++,e.data.list.length<t.pagination.pageSize)return t.busy=!0,void(t.loading=!1);t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e||e.message)}))},selectTab:function(t){this.type=t,this.pagination.current=1,this.pageList=[],this.busy=!1,this.init()},search:function(){this.pagination.current=1,this.pageList=[],this.busy=!1,this.init()},handleInfiniteOnLoad:function(){!this.busy&&this.init()}}},x=_,O=(i("3de3"),Object(d["a"])(x,g,v,!1,null,"ec688aec",null)),I=O.exports,C={name:"Accessory",components:{AddImg:f,AddLink:p["a"],AddForm:h["a"],AddluckyDraw:I},props:{source:{type:String,default:""},maxLength:{type:Number,default:9},isNeedRader:{type:Boolean,default:!0},isNeedSelectRadar:{type:Boolean,default:!0},attachmentsWrap:{type:Array,default:function(){return[]}},menuList:{type:Array,default:function(){return[{text:"图片",id:1,key:"visibileAddImg"},{text:"链接",id:2,key:"visibileAddLink"},{text:"自定义表单",id:4,key:"visibileForm"},{text:"抽奖活动",id:5,key:"visibileLuckDraw"}]}}},data:function(){return{visibileAddImg:!1,visibileAddLink:!1,visibileForm:!1,visibileLuckDraw:!1,key:"",editData:{},editIndex:void 0,attachments:[]}},watch:{attachmentsWrap:{handler:function(){this.attachments=this.attachmentsWrap},deep:!0,immediate:!0}},methods:{openAccessory:function(t){this.attachments.length>=this.maxLength?this.$message.warning("最多上传".concat(this.maxLength,"个附件")):(this.editData={},this.editIndex=void 0,this.key=t,this[this.key]=!0)},serviceOk:function(t){void 0===this.editIndex?this.attachments.length>=this.maxLength?this.$message.warning("最多上传".concat(this.maxLength,"个附件")):this.attachments.push(t):this.$set(this.attachments,this.editIndex,t),this[this.key]=!1,this.$emit("serviceOk",this.attachments)},deleteAttachments:function(t){this.attachments.splice(t,1)},editAttachments:function(t,e){this.editData=t,this.editIndex=e,this.key=t.key,this[this.key]=!0}}},w=C,T=(i("8897"),Object(d["a"])(w,n,a,!1,null,"6cd29031",null));e["a"]=T.exports},8897:function(t,e,i){"use strict";i("e53d")},"8bac":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return r})),i.d(e,"g",(function(){return o})),i.d(e,"h",(function(){return c})),i.d(e,"j",(function(){return l})),i.d(e,"e",(function(){return u})),i.d(e,"f",(function(){return d})),i.d(e,"a",(function(){return m})),i.d(e,"d",(function(){return f})),i.d(e,"i",(function(){return p}));var n=i("b775"),a={getList:"/marketing/luckyActivity/list",addSave:"/marketing/luckyActivity/save",updateList:"/marketing/luckyActivity/update",deleteList:"/marketing/luckyActivity/delete",getInfo:"/marketing/luckyActivity/info",uploadFile:"/marketing/luckActivityPrize/uploadFile",prizeInfo:"/marketing/luckActivityPrize/prizeInfo",numberOfPeopleInfo:"/marketing/luckyActivity/numberOfPeopleInfo",customerInfo:"/marketing/luckyActivity/customerInfo",cancelAfterVerification:"/marketing/luckyActivity/cancelAfterVerification"};function s(t){return Object(n["b"])({url:a.cancelAfterVerification,method:"post",data:t})}function r(t){return Object(n["b"])({url:a.customerInfo,method:"get",params:t})}function o(t){return Object(n["b"])({url:a.numberOfPeopleInfo,method:"get",params:t})}function c(t){return Object(n["b"])({url:a.prizeInfo,method:"get",params:t})}function l(t){return Object(n["b"])({url:a.uploadFile,method:"post",data:t})}function u(t){return Object(n["b"])({url:a.getInfo,method:"get",params:t})}function d(t){return Object(n["b"])({url:a.getList,method:"get",params:t})}function m(t){return Object(n["b"])({url:a.addSave,method:"post",data:t})}function f(t){return Object(n["b"])({url:a.deleteList,method:"post",data:t})}function p(t){return Object(n["b"])({url:a.updateList,method:"post",data:t})}},"8e34":function(t,e,i){"use strict";i("299d")},"8e87":function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"textarea",class:t.classNmae,attrs:{contenteditable:"true",maxLength:"maxLength","data-form-type":"reason","data-placeholder":"请输入回复框的内容"},domProps:{innerHTML:t._s(t.innerText)},on:{blur:t.textareaBlur,input:t.changeText}})},a=[],s=(i("a9e3"),i("ac1f"),i("466d"),i("5319"),{name:"Contenteditable",props:{classNmae:{type:String,default:"link-textarea"},value:{type:String,default:""},maxLength:{type:[String,Number],default:""}},computed:{state:function(){return this.$route.query.state}},data:function(){return{innerText:"",isLocked:!0,sel:null,range:null,textareaElement:"",num:0}},watch:{value:{handler:function(){"add"!==this.state&&this.isLocked&&this.value&&(this.innerText=this.value,this.isLocked=!1)},immediate:!0},classNmae:{handler:function(){this.textareaElement=document.querySelector(this.classNmae),this.textareaElement&&(this.textareaElement.focus(),this.textareaElement.blur())},immediate:!0}},methods:{keepLastIndex:function(t){t&&this.$nextTick((function(){if(window.getSelection){t.focus();var e=window.getSelection();e.selectAllChildren(t),e.collapseToEnd()}else if(document.selection){e=document.selection.createRange();e.moveToElementText(t),e.collapse(!1),e.select()}}))},textareaBlur:function(){this.sel=window.getSelection(),this.range=this.sel.getRangeAt(0),this.range.deleteContents()},changeText:function(t){var e=this;this.controlMaxlength(t.target.innerHTML,t),this.$nextTick((function(){e.$emit("input",e.checkInnerHtml(e.$el.innerHTML))}))},controlMaxlength:function(t,e){(null===t||void 0===t?void 0:t.length)>this.maxLength&&(this.innerText=t.substring(0,this.maxLength-this.num),this.num++,this.num>6&&(this.num=0)),this.keepLastIndex(this.textareaElement)},checkInnerHtml:function(t){var e=/<span[^>]*>([\s\S]*?)<\/span>/i,i=t.match(e),n=t;return i&&"客户昵称"!==i[1]&&(n=t.replace(/<span class="nick-name">/g,"").replace(/<\/span>/g,""),this.innerText=n,this.keepLastIndex(this.textareaElement)),n},insertHtmlAtCaret:function(t){if(window.getSelection){if(this.sel.getRangeAt&&this.sel.rangeCount){var e=document.createDocumentFragment(),i=e.appendChild(t),n=document.createElement("div");n.innerHTML="&#8203",i=e.appendChild(n.firstChild),this.range.insertNode(e),i&&(this.range=this.range.cloneRange(),this.range.setStartAfter(i),this.range.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(this.range),this.$emit("input",this.$el.innerHTML))}}else document.selection&&"Control"!=document.selection.type&&(document.selection.createRange().pasteHTML(html),this.$emit("input",this.$el.innerHTML))}}}),r=s,o=(i("d3ba"),i("2877")),c=Object(o["a"])(r,n,a,!1,null,"6c1514fc",null);e["a"]=c.exports},"8f19":function(t,e,i){"use strict";i.d(e,"n",(function(){return s})),i.d(e,"q",(function(){return r})),i.d(e,"a",(function(){return o})),i.d(e,"j",(function(){return c})),i.d(e,"h",(function(){return l})),i.d(e,"f",(function(){return u})),i.d(e,"l",(function(){return d})),i.d(e,"d",(function(){return m})),i.d(e,"e",(function(){return f})),i.d(e,"i",(function(){return p})),i.d(e,"g",(function(){return h})),i.d(e,"b",(function(){return g})),i.d(e,"k",(function(){return v})),i.d(e,"m",(function(){return b})),i.d(e,"c",(function(){return k})),i.d(e,"p",(function(){return y})),i.d(e,"o",(function(){return L}));var n=i("b775"),a={customerFormSave:"/client_transformation/customerForm/save",dateInfoList:"/client_transformation/customerFormData/dateInfoList",customerFormList:"/client_transformation/customerForm/list",customerFormInfo:"/client_transformation/customerForm/info",customerFormUpdate:"/client_transformation/customerForm/update",customerFormPublish:"/client_transformation/customerForm/publish",customerFormDelete:"/client_transformation/customerForm/delete",dataInfo:"/client_transformation/customerFormData/dataInfo",analysis:"/client_transformation/customerFormData/analysis",staffList:"/client_transformation/customerFormData/staffList",infoList:"/client_transformation/customerFormData/infoList",analysisExport:"/client_transformation/customerFormData/analysisExport",dataInfoExport:"/client_transformation/customerFormData/dataInfoExport",infoCityList:"/client_transformation/customerFormData/infoCityList",batchTags:"/client_transformation/customerFormData/batchTags",selectList:"/client_transformation/customerForm/userData/selectList",queryDataList:"/client_transformation/customerFormData/queryDataList"};function s(t){return Object(n["b"])({url:a.infoList,method:"post",data:t})}function r(t){return Object(n["b"])({url:a.staffList,method:"get",params:t})}function o(t){return Object(n["b"])({url:a.analysis,method:"get",params:t})}function c(t){return Object(n["b"])({url:a.dataInfo,method:"get",params:t})}function l(t){return Object(n["b"])({url:a.customerFormSave,method:"post",data:t})}function u(t){return Object(n["b"])({url:a.customerFormList,method:"get",params:t})}function d(t){return Object(n["b"])({url:a.dateInfoList,method:"get",params:t})}function m(t){return Object(n["b"])({url:a.customerFormDelete,method:"post",data:t})}function f(t){return Object(n["b"])({url:a.customerFormInfo,method:"get",params:t})}function p(t){return Object(n["b"])({url:a.customerFormUpdate,method:"post",data:t})}function h(t){return Object(n["b"])({url:a.customerFormPublish,method:"post",data:t})}function g(t){return Object(n["b"])({url:a.analysisExport,method:"get",params:t,responseType:"blob"})}function v(t){return Object(n["b"])({url:a.dataInfoExport,method:"get",params:t,responseType:"blob"})}function b(t){return Object(n["b"])({url:a.infoCityList,method:"get",params:t})}function k(t){return Object(n["b"])({url:a.batchTags,method:"post",data:t})}function y(t){return Object(n["b"])({url:a.selectList,method:"get",params:t})}function L(t){return Object(n["b"])({url:a.queryDataList,method:"post",data:t})}},"95d0":function(t,e,i){},a2ba:function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({attrs:{loading:t.loading},on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.sourceModal,!1),[e("AddLinkWrap",{ref:"AddLinkWrap",staticClass:"add-link-wrap",attrs:{editData:t.editData,isNeedTag:t.isNeedTag,source:t.source,isNeedRader:t.isNeedRader,isNeedSelectRadar:t.isNeedSelectRadar}})],1)},a=[],s=i("7807"),r=i("2a86"),o={name:"AddLink",components:{AddLinkWrap:s["a"],CommonModal:r["a"]},props:{editData:{type:Object,default:function(){return{}}},source:{type:String,default:""},loading:{type:Boolean,default:!1},isNeedTag:{type:Boolean,default:!1},isNeedRader:{type:Boolean,default:!0},isNeedSelectRadar:{type:Boolean,default:!0}},watch:{editData:{handler:function(){this.sourceModal.title=this.editData.id?"修改链接":"添加链接"},immediate:!0}},data:function(){return{sourceModal:{}}},methods:{serviceOk:function(){var t=this;this.$refs.AddLinkWrap.getFormValue()&&this.$refs.AddLinkWrap.$refs.ruleForm.validate((function(e){if(!e)return!1;t.$emit("serviceOk",t.$refs.AddLinkWrap.form)}))}}},c=o,l=(i("d6b1"),i("2877")),u=Object(l["a"])(c,n,a,!1,null,"2002f84d",null);e["a"]=u.exports},afd2:function(t,e,i){},c762:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"height100"},[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:"".concat(t.isAddText,"欢迎语")},on:{back:function(e){return t.$router.go(-1)}}}),e("section",{staticClass:"section background-white"},[e("a-form",{staticClass:"model",attrs:{"label-col":{span:2},"wrapper-col":{span:12},form:t.form},on:{submit:t.handleSubmit}},[e("p",{staticClass:"base-info"},[t._v("基础信息")]),e("div",{staticClass:"tips"},[e("a-icon",{attrs:{type:"exclamation-circle"}}),e("div",[e("p",[t._v("1、在渠道码处设置的欢迎语会被优先推送，如果成员在渠道码处设置了欢迎语，在此设置的欢迎语不会生效")]),e("p",[t._v("2、一个成员如果被设置了多个欢迎语，将会使用最新设置或修改的欢迎语")])])],1),e("a-form-item",{attrs:{label:"使用人员",required:""}},[e("div",{staticClass:"use-person"},[e("ul",{staticClass:"a-line-omit",on:{click:function(e){t.visibleUsePerson=!0}}},t._l(t.usePersionList,(function(i){return e("li",{key:i.key,staticClass:"a-line-omit"},[i.icon?e("a-icon",{staticClass:"icon",attrs:{type:i.icon}}):e("a-avatar",{attrs:{size:23,src:i.source.thumbAvatar}}),e("span",[t._v(" "+t._s(i.title)+" ")])],1)})),0),t.usePersionList.length>3?e("span",{staticClass:"omit"},[t._v("等"+t._s(t.usePersionList.length)+"个账号")]):t._e(),e("a-icon",{attrs:{type:"caret-down"}})],1)]),e("p",{staticClass:"base-info"},[t._v("发送欢迎语")]),e("a-form-item",{attrs:{label:"欢迎语"}},[e("div",{staticClass:"reason-box"},[e("div",{staticClass:"reason-tilte",on:{click:t.insertNickname}},[t._v("[插入客户昵称]")]),e("Contenteditable",{ref:"contenteditable",attrs:{maxLength:t.maxLength},model:{value:t.innerText,callback:function(e){t.innerText=e},expression:"innerText"}}),e("div",{staticClass:"reason-tip"},[t._v(t._s(t.contentOne.length)+"/"+t._s(t.maxLength))])],1),e("Accessory",{staticStyle:{"margin-top":"20px"},attrs:{maxLength:9,source:"welcome",attachmentsWrap:t.attachments},on:{serviceOk:t.addAccessory}}),e("p",[t._v("当客户昵称字样由黄色变为黑色时，即不生效，请重新输入")])],1),e("a-form-item",{attrs:{"wrapper-col":{span:12,offset:2}}},[e("a-button",{attrs:{type:"primary","html-type":"submit",loading:t.loading}},[t._v(" 保存 ")])],1)],1),e("PhoneModel",{attrs:{textList:t.textList}})],1),e("a-modal",{attrs:{footer:null,width:"680px",centered:""},model:{value:t.visibleUsePerson,callback:function(e){t.visibleUsePerson=e},expression:"visibleUsePerson"}},[e("AddTransfer",{attrs:{type:"deptId",selectList:t.selectList,selectRoleIdList:t.selectRoleIdList},on:{serviceOk:t.serviceOk,cancle:function(e){t.visibleUsePerson=!1}}})],1)],1)},a=[],s=i("c7eb"),r=i("1da1"),o=i("2909"),c=(i("ac1f"),i("5319"),i("d3b7"),i("d81d"),i("b0c0"),i("1eb1")),l=i("cf5f"),u=i("8e87"),d=i("e6b1"),m=i("2bf4"),f=i("7a44"),p={name:"NewWelcome",components:{AddTransfer:c["a"],Contenteditable:u["a"],PhoneModel:d["a"],Accessory:f["a"]},mixins:[m["a"]],data:function(){return{selectRoleIdList:[],form:this.$form.createForm(this,{name:"coordinated"}),visibleUsePerson:!1,maxLength:600,usePersionList:[{title:"全部账号",icon:"user",default:!0}],defaultUsePerson:function(){return{title:"全部账号",icon:"user",default:!0}},loading:!1,attachments:[],innerText:""}},computed:{selectList:function(){var t=this.usePersionList;return this.usePersionList[0].title===this.defaultUsePerson.title&&(t=[]),t},contentOne:function(){return this.innerText.replace(/<span class="nick-name">客户昵称<\/span>/g,"#")},welcomeId:function(){return this.$route.query.welcomeId},textList:function(){var t,e=[];return this.innerText&&e.push(this.innerText.replace(/<span class="nick-name">/g," ").replace(/<\/span>/g," ")),(null===(t=this.attachments)||void 0===t?void 0:t.length)>0&&e.push.apply(e,Object(o["a"])(this.attachments)),e}},created:function(){this.welcomeId&&this.getDetailWelcome()},methods:{handleSubmit:function(t){var e=this;t.preventDefault(),this.verify().then(Object(r["a"])(Object(s["a"])().mark((function t(){var i,n;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.uploadMedia();case 3:i=e.getParams(),n=e.welcomeId?e.updateWelcome(i):e.addWelcome(i),n.then((function(){e.$message.success("".concat(e.isAddText,"欢迎语成功")),e.$router.go(-1)})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}));case 6:case"end":return t.stop()}}),t)})))).catch((function(t){e.$message.warning(t)}))},updateWelcome:function(t){return t.welcomeId=this.welcomeId,Object(l["w"])(t)},addWelcome:function(t){return Object(l["c"])(t)},verify:function(){var t=this;return new Promise((function(e,i){!t.contentOne&&t.attachments.length<1?i("请填写欢迎语"):e()}))},getParams:function(){var t=this.innerText.replace(/<span class="nick-name">/g,"#").replace(/<\/span>/g,"#"),e={messageContent:{text:{content:t},attachments:this.getAttachments()||[]},spanWelcomeEnable:0};return t||delete e.messageContent.text,1===this.usePersionList.length&&this.usePersionList[0].default?e.type=0:(e.type=1,e.welcomeUseRefList=this.usePersionList.map((function(t){var e;return{type:t.source.children?1:0,refId:t.source.children?t.source.deptId:t.key,name:t.title,thumbAvatar:null===t||void 0===t||null===(e=t.source)||void 0===e?void 0:e.thumbAvatar}}))),e},getDetailWelcome:function(){var t=this;Object(l["j"])({welcomeId:this.welcomeId}).then((function(e){if(null!==e&&void 0!==e&&e.data){var i;e.data.welcomeUseRefList&&(t.usePersionList=e.data.welcomeUseRefList.map((function(t){return{title:t.name,deptId:1===t.type?t.refId:null,staffId:0===t.type?t.refId:null,icon:1===t.type?"file":null,key:t.refId,source:{thumbAvatar:t.thumbAvatar}}})));var n=JSON.parse(e.data.content);t.attachments=t.attachmentsDetail(null===n||void 0===n?void 0:n.attachments),null!==n&&void 0!==n&&null!==(i=n.text)&&void 0!==i&&i.content&&(t.innerText=n.text.content.replace(/#客户昵称#​*/g,'<span class="nick-name">客户昵称</span>'))}})).catch((function(e){t.$message.error(e)}))},serviceOk:function(t){t.length<1?this.usePersionList=[this.defaultUsePerson()]:this.usePersionList=t,this.visibleUsePerson=!1},insertNickname:function(){var t=document.createElement("span");t.className="nick-name",t.innerHTML="客户昵称",this.$refs.contenteditable.insertHtmlAtCaret(t)}}},h=p,g=(i("507e"),i("2877")),v=Object(g["a"])(h,n,a,!1,null,"62f43e82",null);e["default"]=v.exports},d3ba:function(t,e,i){"use strict";i("e7a1")},d6b1:function(t,e,i){"use strict";i("260e")},e53d:function(t,e,i){},e6b1:function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"phone-model"},[e("img",{staticClass:"bg",attrs:{src:"/imgs/chatBg.png"}}),e("div",{staticClass:"contant"},[e("p",{staticClass:"time"},[t._v(t._s(t.time))]),t.textList.length>0?e("ul",t._l(t.textList,(function(i,n){return e("li",{key:n,staticClass:"contant-list"},["img"===i.type?[e("img",{staticClass:"user",attrs:{src:"/icons/user.png"}}),e("div",{staticClass:"contant-main"},[e("img",{staticClass:"upload-img",attrs:{src:i.pic_url.compress}})])]:t._e(),"link"===i.type?[e("img",{staticClass:"user",attrs:{src:"/icons/user.png"}}),e("div",{staticClass:"contant-title"},[e("a-tooltip",{attrs:{title:i.linkTitle}},[e("p",{staticClass:"contant-subtitle"},[t._v(t._s(i.linkTitle))])]),e("div",{staticClass:"contant-contant"},[i.desc?e("a-tooltip",{attrs:{title:i.desc}},[e("span",[t._v(t._s(i.desc))])]):t._e(),e("a-avatar",{attrs:{src:i.coverUrl.compress,size:32,shape:"square"}})],1)],1)]:t._e(),i.type?t._e():[e("img",{staticClass:"user",attrs:{src:"/icons/user.png"}}),e("div",{staticClass:"contant-main"},[t._v(t._s(i))])]],2)})),0):t._e()])])},a=[],s={name:"PhoneModel",data:function(){return{time:this.$moment().format("HH:mm")}},props:{textList:{type:[Array],default:function(){return[]}}},watch:{textList:function(){}}},r=s,o=(i("8e34"),i("2877")),c=Object(o["a"])(r,n,a,!1,null,"1aa7a172",null);e["a"]=c.exports},e7a1:function(t,e,i){},f564:function(t,e,i){"use strict";i("3fc5")}}]);