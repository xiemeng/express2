(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bab86a4"],{"0859":function(t,e,n){},"0a2c":function(t,e,n){"use strict";n("c0e2")},1011:function(t,e,n){"use strict";n("b0c0");var a=function(){var t=this,e=t._self._c;return e("div",[e("ul",t._l(t.sendContentList,(function(n,a){return e("li",{key:a,staticClass:"send-content"},[t.needTitle?e("span",[t._v("消息"+t._s(a+1)+"：")]):t._e(),e("div",{staticClass:"flex1"},[e("p",{staticClass:"radio"},[e("a-radio-group",{on:{change:function(e){return t.changeType(a)}},model:{value:n.msgType,callback:function(e){t.$set(n,"msgType",e)},expression:"item.msgType"}},t._l(t.msgTypeList,(function(n,a){return e("a-radio",{key:a,attrs:{value:n.id}},[t._v(" "+t._s(n.text)+" ")])})),1),0!==a?e("a-icon",{attrs:{type:"delete"},on:{click:function(e){return t.$emit("delContent",a)}}}):t._e()],1),0===n.msgType?e("div",{staticClass:"textarea-wrap"},[e("a-textarea",{staticClass:"textarea",attrs:{maxLength:n.maxLength,placeholder:"请输入内容",autoSize:{minRows:4,maxRows:4}},model:{value:n.msgContent,callback:function(e){t.$set(n,"msgContent",e)},expression:"item.msgContent"}}),n.maxLength?e("p",{staticClass:"statistics font-color-black-25"},[t._v(" "+t._s(n.msgContent.length)+"/"+t._s(n.maxLength)+" ")]):t._e()],1):t._e(),1===n.msgType?e("div",[e("FormList",{staticClass:"input",attrs:{formInfo:n.imageObj},model:{value:n.msgContent,callback:function(e){t.$set(n,"msgContent",e)},expression:"item.msgContent"}})],1):t._e(),2===n.msgType?e("div",[e("AddLinkWrap",{attrs:{editData:n.msgContent.form,isNeedSelectRadar:t.isNeedSelectRadar,source:t.source,isNeedRader:t.isNeedRader},model:{value:n.msgContent,callback:function(e){t.$set(n,"msgContent",e)},expression:"item.msgContent"}})],1):t._e(),3===n.msgType?e("div",{staticClass:"flex-pdf"},[n.pdfArr[0]?e("AccessoryList",{attrs:{item:n}}):t._e(),e("div",{staticClass:"flex-pdf"},[e("a-upload",{attrs:{"file-list":n.pdfArr,showUploadList:!1,accept:t.acceptPdf,customRequest:t.customRequest},on:{change:t.handleChange}},[n.pdfArr[0]?e("a-button",{attrs:{type:"link"}},[t._v("重新上传")]):e("div",{staticClass:"ant-upload"},[e("a-icon",{attrs:{type:"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" 添加pdf ")])],1)],1),e("span",{staticClass:"font-color-black-25",staticStyle:{"margin-left":"10px"}},[t._v("请在20M以内")])],1)],1):t._e(),4===n.msgType?e("div",{staticClass:"flex-box"},[n.formObj.name?e("AccessoryList",{attrs:{item:n}}):t._e(),e("div",[n.formObj.name?e("a-button",{attrs:{type:"link"},on:{click:function(e){t.visibileForm=!0}}},[t._v("重新选择")]):e("div",{staticClass:"ant-upload",on:{click:function(e){t.visibileForm=!0}}},[e("a-icon",{attrs:{type:"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" 选择素材 ")])],1)],1)],1):t._e(),5===n.msgType?e("div",{staticClass:"flex-pdf"},[n.videoArr[0]?e("AccessoryList",{attrs:{item:n}}):t._e(),e("div",{staticClass:"flex-pdf"},[e("a-upload",{attrs:{showUploadList:!1,accept:t.acceptVideo,customRequest:t.customRequest},on:{change:t.handleChangeVideo,preview:t.handlePreview}},[n.videoArr[0]?e("a-button",{attrs:{type:"link"}},[t._v("重新上传")]):e("div",{staticClass:"ant-upload"},[e("a-icon",{attrs:{type:"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" 上传视频 ")])],1)],1),e("span",{staticClass:"font-color-black-25",staticStyle:{"margin-left":"10px"}},[t._v("请在10M以内")])],1)],1):t._e()])])})),0),e("a-modal",{attrs:{footer:null,destroyOnClose:"",width:"880px",centered:""},model:{value:t.visibileForm,callback:function(e){t.visibileForm=e},expression:"visibileForm"}},[e("AddForm",{attrs:{editData:t.editData,source:t.source},on:{cancle:function(e){t.visibileForm=!1},serviceOk:t.serviceOk}})],1)],1)},i=[],s=n("5530"),r=n("c7eb"),o=n("1da1"),c=(n("7db0"),n("d3b7"),n("fb6a"),n("d81d"),n("26f2")),l=n("7807"),d=n("7581"),u=n("6536"),m={name:"TypeAccessory",components:{FormList:c["a"],AddLinkWrap:l["a"],AddForm:d["a"],AccessoryList:u["a"]},props:{sendContentList:{type:Array,default:function(){return[]}},needTitle:{type:Boolean,default:function(){return!0}},msgTypeList:{type:Array,default:function(){return[]}},source:{type:String,default:""},isNeedRader:{type:Boolean,default:!0},isNeedSelectRadar:{type:Boolean,default:!0}},data:function(){return{acceptPdf:".pdf",acceptVideo:".MP4",visibileForm:!1,editData:{},formObj:{}}},watch:{sendContentList:function(){}},created:function(){},methods:{changeType:function(t){this.sendContentList[t].msgContent=""},handlePreview:function(t){var e=this;return Object(o["a"])(Object(r["a"])().mark((function n(){var a;return Object(r["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.url||t.preview){n.next=4;break}return n.next=3,e.getBase64(t.originFileObj);case 3:t.preview=n.sent;case 4:a=e.sendContentList.find((function(t){return 5===t.msgType})),a.videoArr[0].pdfFile=t.url||t.preview;case 6:case"end":return n.stop()}}),n)})))()},getBase64:function(t){return new Promise((function(e,n){var a=new FileReader;a.readAsDataURL(t),a.onload=function(){return e(a.result)},a.onerror=function(t){return n(t)}}))},handleChange:function(t){var e,n=this,a=t.fileList,i=a.slice(-1);(null===i||void 0===i||null===(e=i[0])||void 0===e?void 0:e.size)>2048e4?this.$message.warning("pdf不能大于20M"):setTimeout((function(){var t=n.sendContentList.find((function(t){return 3===t.msgType}));t.pdfArr=i.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{status:"done",msgType:3})}))}),0)},handleChangeVideo:function(t){var e,n=this,a=t.fileList,i=a.slice(-1);(null===i||void 0===i||null===(e=i[0])||void 0===e?void 0:e.size)>1024e4?this.$message.warning("视频不能大于10M"):setTimeout((function(){n.getBase64(i[0].originFileObj).then((function(t){var e=n.sendContentList.find((function(t){return 5===t.msgType}));e.videoArr=i.map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{status:"done",msgType:5,pdfFile:t})}))}))}),0)},customRequest:function(t){t.onSuccess()},serviceOk:function(t){var e=this.sendContentList.find((function(t){return 4===t.msgType}));e.formObj=Object(s["a"])(Object(s["a"])({},t),{},{msgType:4}),this.visibileForm=!1}}},p=m,f=(n("0a2c"),n("2877")),g=Object(f["a"])(p,a,i,!1,null,"4b56a150",null);e["a"]=g.exports},"146f":function(t,e,n){"use strict";n("7d57")},"20b3":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t._self._c;return e("div",[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:"".concat(t.isAddText,"个人SOP规则")},on:{back:function(e){return t.$router.go(-1)}}}),e("section",{staticClass:"section background-white"},[e("a-form",{attrs:{"label-col":{span:2},"wrapper-col":{span:12},form:t.form},on:{submit:t.handleSubmit}},[e("p",{staticClass:"base-info"},[t._v("规则基本信息")]),e("a-form-item",{attrs:{label:"规则名称",required:""}},[e("a-input",{attrs:{placeholder:"请输入规则名称",disabled:"look"===t.state},model:{value:t.ruleName,callback:function(e){t.ruleName=e},expression:"ruleName"}})],1),e("a-form-item",{attrs:{label:"客服成员",required:""}},[e("div",{staticClass:"tips"},[e("a-icon",{attrs:{type:"bell",theme:"filled"}}),t._v(" 以下客服成员的新客户触发了规则后，将在侧边栏快捷回复提醒该规则的内容。 ")],1),e("AddContent",{attrs:{selectRoleIdList:[],type:"deptId",dataList:t.selectList,state:t.state,tip:"可添加多个企业客服成员进行统一话术回复"},on:{selectPerson:t.selectPerson}})],1),e("p",{staticClass:"base-info"},[t._v("设置推送周期及内容")]),e("div",{staticClass:"aks-tips"},[t._v(" 设置规则后将会通过「"+t._s(t.ENTERPRICE_NAME)+"提醒」提醒员工发送推送内容, ")]),"look"!==t.state?e("a-button",{staticClass:"add-rule",attrs:{type:"primary"},on:{click:t.addRule}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 添加规则 ")],1):t._e(),e("div",{staticClass:"rule-list"},[t.planList.length>0?e("ul",t._l(t.planList,(function(n,a){return e("li",{key:n.id},[e("div",{staticClass:"rule-head"},[e("a-icon",{staticClass:"clock",attrs:{type:"clock-circle"}}),e("span",[t._v(" "+t._s(n.planNewName)),e("span",[t._v("("+t._s(n.planName)+")")])])],1),e("div",{staticClass:"rule-content"},[e("div",{staticClass:"rule-left"},[t._l(n.messageList,(function(n,a){return[t.isOpen||a<2?e("div",{key:a,staticClass:"text-content"},[e("AccessoryList",{attrs:{item:n}})],1):t._e()]})),e("div",{staticClass:"bottom-content"},[e("a-space",{attrs:{size:12}},[e("span",{staticClass:"aks-tips"},[t._v("共"+t._s(n.messageList.length)+"条")]),n.messageList.length>2?e("span",{staticClass:"aks-tips",on:{click:function(e){t.isOpen=!t.isOpen}}},[t._v(" "+t._s(t.isOpen?"收起":"展开")+" "),e("a-icon",{attrs:{type:t.isOpen?"up":"down"}})],1):t._e()])],1)],2),"look"!==t.state?e("div",{staticClass:"rule-right"},[e("a-space",[e("a-icon",{attrs:{type:"delete"},on:{click:function(e){return t.deleteRule(a)}}}),e("a-icon",{attrs:{type:"edit"},on:{click:function(e){return t.editRule(a)}}})],1)],1):t._e()])])})),0):e("a-empty")],1),t.planList.length>0?e("a-form-item",{attrs:{"wrapper-col":{span:12,offset:2}}},["look"!==t.state?e("a-button",{attrs:{type:"primary","html-type":"submit",loading:t.loading}},[t._v(" "+t._s(t.sopId?"保存修改":"创建规则")+" ")]):t._e()],1):t._e()],1)],1),e("a-modal",{attrs:{destroyOnClose:"",footer:null},model:{value:t.visibleRole,callback:function(e){t.visibleRole=e},expression:"visibleRole"}},[e("AddRole",{attrs:{planIndex:t.planIndex,planItem:t.planList[t.planIndex]},on:{modalOk:t.modalOk,cancle:function(e){t.visibleRole=!1}}})],1)],1)},i=[],s=n("c7eb"),r=n("1da1"),o=n("5530"),c=(n("b0c0"),n("d81d"),n("a434"),n("d3b7"),n("159b"),n("caad"),n("3ca3"),n("ddb0"),n("cf5f")),l=n("e1ae"),d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-role"},[e("h6",{staticClass:"dialog-title"},[t._v("设置推送内容")]),e("ul",{staticClass:"main",attrs:{id:"section"}},[e("li",[e("p",{staticClass:"title"},[t._v("设置内容名称：")]),e("a-input",{attrs:{maxLength:15},model:{value:t.planName,callback:function(e){t.planName=e},expression:"planName"}})],1),e("li",[e("p",{staticClass:"title"},[t._v("设置发送时间：")]),e("div",{staticClass:"tips"},[e("a-icon",{attrs:{type:"bell",theme:"filled"}}),t._v("当客户添加客服成员时，系统将在侧边栏快捷回复中智能提醒该规则内容 ")],1),e("a-radio-group",{model:{value:t.timeType,callback:function(e){t.timeType=e},expression:"timeType"}},[e("a-radio",{style:t.radioStyle,attrs:{value:0,id:"time0"}},[t._v(" 客户添加企业客服后 "),e("a-input-number",{staticClass:"time",attrs:{size:"small",min:0,max:23},model:{value:t.hours,callback:function(e){t.hours=e},expression:"hours"}}),t._v(" 小时 "),e("a-input-number",{staticClass:"time",attrs:{size:"small",min:0,max:59},model:{value:t.minutes,callback:function(e){t.minutes=e},expression:"minutes"}}),t._v(" 分钟后提醒发送 ")],1),e("a-radio",{style:t.radioStyle,attrs:{value:1,id:"time1"}},[t._v(" 客户添加企业客服后 "),e("a-input-number",{staticClass:"time",attrs:{size:"small",min:0,max:3650},model:{value:t.day,callback:function(e){t.day=e},expression:"day"}}),t._v(" 天后，当日 "),e("a-time-picker",{staticClass:"long-time",attrs:{size:"small",format:"HH:mm"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}}),t._v(" 提醒发送 ")],1)],1)],1),e("li",[e("p",{staticClass:"title"},[t._v("设置发送内容：")]),e("TypeAccessory",{attrs:{sendContentList:t.sendContentList,msgTypeList:t.msgTypeList,isNeedSelectRadar:!1,isNeedRader:!1,source:"person_sop"},on:{delContent:t.delContent}}),e("a-button",{staticClass:"send-button",attrs:{type:"primary"},on:{click:t.addContent}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 添加发送内容 ")],1)],1)]),e("div",{staticClass:"foot-button"},[e("a-space",{attrs:{size:12}},[e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary"},on:{click:t.modalOk}},[t._v("设置")])],1)],1)])},u=[],m=(n("a9e3"),n("99af"),n("1011")),p={name:"AddRole",components:{TypeAccessory:m["a"]},data:function(){return{radioStyle:{display:"block",height:"30px",lineHeight:"30px"},hours:0,minutes:30,day:1,time:this.$moment("12:00","HH:mm"),msgTypeList:[{id:0,text:"文字",type:"text"},{id:1,text:"图片",type:"image"},{id:2,text:"链接",type:"link"},{id:3,text:"PDF",type:"pdf"},{id:4,text:"自定义表单",type:"form"}],sendContentList:[{msgType:0,imageObj:{title:"图片",prop:"pic_url",type:"img",tips:"",accept:".jpg,.png",maxLength:2097152,value:{}},msgContent:"",pdfArr:[],formObj:{}}],defaultSendContentList:function(){return{msgType:0,imageObj:{title:"图片",prop:"pic_url",type:"img",tips:"",accept:".jpg,.png",maxLength:2097152,value:{}},msgContent:"",pdfArr:[],formObj:{}}},planName:"",timeType:0}},props:{planItem:{type:[Object],default:function(){return{}}},planIndex:{type:[String,Number],default:function(){return null}}},watch:{planItem:{handler:function(){var t;if(null!==(t=this.planItem)&&void 0!==t&&t.planNewName){var e=JSON.parse(JSON.stringify(this.planItem));if(this.planName=e.planName,this.sendContentList=e.messageList,this.timeType=e.timeType,0===this.timeType&&(this.hours=parseInt(e.addTime/3600),this.minutes=e.addTime%3600/60),1===this.timeType){this.day=e.nextDay;var n="".concat(parseInt(e.addTime/3600),":").concat(e.addTime%3600/60);this.time=this.$moment(n,"HH:mm")}}else this.clearData()},immediate:!0}},computed:{plan:function(){var t,e="",n="";return 0===this.timeType&&(e=60*this.hours*60+60*this.minutes,n="客户添加企业客服后,".concat(this.hours,"小时").concat(this.minutes,"分钟后提醒发送")),1===this.timeType&&(e=60*this.time.get("hour")*60+60*this.time.get("minute"),n="客户添加企业客服后,".concat(this.day,"天后，当日").concat(this.time.format("HH:mm"),"提醒发送")),{id:this.$moment().valueOf(),timeType:this.timeType,nextDay:1===this.timeType?this.day:null,addTime:e,planId:null!==(t=this.planItem)&&void 0!==t&&t.planId?this.planItem.planId:null,planName:this.planName,planNewName:n,messageList:this.sendContentList}}},methods:{clearData:function(){this.hours=0,this.minutes=30,this.day=1,this.time=this.$moment("12:00","HH:mm"),this.sendContentList=[this.defaultSendContentList()],this.planName="",this.timeType=0},modalOk:function(){var t=this;this.verify().then((function(){(t.planIndex||0===t.planIndex)&&(t.plan.planIndex=t.planIndex),t.$emit("modalOk",t.plan)})).catch((function(e){t.$message.warning((null===e||void 0===e?void 0:e.message)||e)}))},verify:function(){var t=this;return new Promise((function(e,n){for(var a=0;a<t.sendContentList.length;a++){var i;if(0!==t.sendContentList[a].msgType||t.sendContentList[a].msgContent||n("消息".concat(a+1,"内容未填写")),1!==t.sendContentList[a].msgType||t.sendContentList[a].msgContent.compress||n("消息".concat(a+1,"内容未填写")),2===t.sendContentList[a].msgType)if(!t.sendContentList[a].msgContent||null===(i=t.sendContentList[a].msgContent)||void 0===i||!i.serviceOk())return}e()}))},addContent:function(){this.sendContentList.push(this.defaultSendContentList()),this.$nextTick((function(){var t=document.getElementById("section");t.scrollHeight>t.clientHeight&&setTimeout((function(){t.scrollTop=t.scrollHeight}),300)}))},delContent:function(t){this.sendContentList.splice(t,1)}}},f=p,g=(n("eaaf"),n("2877")),v=Object(g["a"])(f,d,u,!1,null,"f2acc814",null),h=v.exports,b=n("6536"),y=n("842b"),C={name:"SOPrule",components:{AddContent:l["a"],AddRole:h,AccessoryList:b["a"]},mixins:[y["a"]],data:function(){return{uploadFilePath:"clientTransformation",form:this.$form.createForm(this,{name:"coordinated"}),selectList:[],visibleRole:!1,isOpen:!1,loading:!1,ruleName:"",planList:[],planIndex:null}},computed:{state:function(){return this.$route.query.state},isAddText:function(){var t="";switch(this.$route.query.state){case"add":t="新建";break;case"edit":t="修改";break;case"look":t="查看";break}return t},sopId:function(){return this.$route.query.sopId}},activated:function(){this.sopId?this.getDetailSop():(this.ruleName="",this.planList=[],this.selectList=[],this.planIndex=null,this.isOpen=!1,this.visibleRole=!1)},methods:{addRule:function(){this.planIndex=null,this.visibleRole=!0},getDetailSop:function(){var t=this;Object(c["i"])({sopId:this.sopId}).then((function(e){var n;null!==e&&void 0!==e&&e.data&&(t.ruleName=e.data.name,t.planList=e.data.planList.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{messageList:t.getMessageList(e.messageList)})})),t.selectList=null===(n=e.data.staffList)||void 0===n?void 0:n.map((function(t){return t.key=String(t.userid),t.name=t.staffName,t.title=t.staffName,Object(o["a"])(Object(o["a"])({},t),{},{source:t,userIds:t.userid})})))}))},modalOk:function(t){var e=t.planIndex;e||0===e?this.planList[e]=t:this.planList.push(t),this.visibleRole=!1},selectPerson:function(t){this.selectList=t},deleteRule:function(t){var e=this;this.$confirm({title:"提示",icon:"",okText:"删除",content:"确认后将会删除该条话术内容，是否删除",onOk:function(){e.planList.splice(t,1)}})},editRule:function(t){this.planIndex=t,this.visibleRole=!0},handleSubmit:function(t){var e=this;t.preventDefault(),this.verify().then(Object(r["a"])(Object(s["a"])().mark((function t(){var n,a;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.getParams();case 3:n=t.sent,a=e.sopId?e.updatePersonSop(n):e.addSersonSop(n),a.then((function(){e.$message.success("".concat(e.isAddText,"个人SOP成功")),e.$router.go(-1)})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}));case 6:case"end":return t.stop()}}),t)})))).catch((function(t){e.$message.warning(t),e.loading=!1}))},updatePersonSop:function(t){return t.sopId=this.sopId,Object(c["u"])(t)},addSersonSop:function(t){return Object(c["a"])(t)},verify:function(){var t=this;return new Promise((function(e,n){var a;!t.ruleName&&n("个人SOP名称不能为空"),!(null!==(a=t.selectList)&&void 0!==a&&a.length)>0&&n("个人SOP的客服成员不能为空"),e()}))},getParams:function(){var t=this;return new Promise((function(e,n){var a=[];t.planList.forEach((function(t,e){t.step=e+1,t.messageList.forEach((function(t){[1,2,3].includes(t.msgType)&&a.push(t)}))}));var i=t.getPlanFileList(a);Promise.all(i).then((function(n){var a={name:t.ruleName,staffList:t.selectList.map((function(t){var e=t.source;return{staffId:e.staffId,userid:e.userid,staffName:e.name,thumbAvatar:e.thumbAvatar}})),planList:t.getPlanList(t.planList)};e(a)})).catch((function(t){n(t)}))}))}}},O=C,L=(n("7d1fa"),Object(g["a"])(O,a,i,!1,null,"f3f3d4f0",null));e["default"]=L.exports},2314:function(t,e,n){"use strict";n("afd2")},6536:function(t,e,n){"use strict";n("b0c0");var a=function(){var t=this,e=t._self._c;return e("div",[0===t.item.msgType?e("div",[t._v(" "+t._s(t.item.msgContent)+" ")]):t._e(),1===t.item.msgType?e("div",[e("img",{staticClass:"image",attrs:{src:t.item.msgContent.compress}})]):t._e(),2===t.item.msgType?e("div",{staticClass:"card-box"},[e("img",{attrs:{src:t.item.msgContent.form.coverUrl.compress||"/imgs/default-cover.png"},on:{error:t.errorImg}}),e("div",{staticClass:"box-right"},[e("h5",[t._v(t._s(t.item.msgContent.form.linkTitle))]),e("p",[t._v(t._s(t.item.msgContent.form.desc))])])]):t._e(),3===t.item.msgType?e("div",{staticClass:"custom-pdf"},[e("a-avatar",{attrs:{size:60,src:"/icons/pdf.png",shape:"square"}}),e("div",{staticClass:"contant"},[e("p",[t._v(t._s(t.item.pdfArr[0].name))]),e("span",[t._v(t._s(t._f("getUnits")(t.item.pdfArr[0].size)))])])],1):t._e(),5===t.item.msgType?e("div",[e("video",{staticClass:"cover-img",attrs:{src:t.item.videoArr[0].pdfFile,controls:"",height:"100%"}})]):t._e(),4===t.item.msgType?e("div",{staticClass:"custom-form"},[e("h4",[t._v(t._s(t.item.formObj.name))]),e("div",{staticClass:"flex-box"},[e("p",{staticClass:"font-color-black-25"},[t._v(t._s(t.item.formObj.desc))]),e("a-avatar",{attrs:{size:40,src:t.item.formObj.cover,shape:"square"}})],1)]):t._e()])},i=[],s=n("ca00"),r={name:"AccessoryList",components:{},props:{item:{type:Object,default:function(){return{}}}},watch:{item:{handler:function(){},deep:!0,immediate:!0}},data:function(){return{}},filters:{getUnits:function(t){return Object(s["b"])(t)}},methods:{errorImg:function(t){t.target.src="/imgs/default-cover.png"}}},o=r,c=(n("146f"),n("2877")),l=Object(c["a"])(o,a,i,!1,null,"7b304a5e",null);e["a"]=l.exports},7581:function(t,e,n){"use strict";n("b0c0");var a=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({on:{cancle:function(e){return t.$emit("cancle")},serviceOk:t.serviceOk}},"CommonModal",t.sourceModal,!1),[e("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],staticClass:"scroll-list",attrs:{"infinite-scroll-disabled":t.busy,"infinite-scroll-distance":10}},[t.pageList.length>0?e("ul",{staticClass:"randar-list-wrap"},t._l(t.pageList,(function(n){return e("li",{key:n.formId,staticClass:"randar-list",on:{click:function(e){t.selectRandarId=n.formId}}},[e("header",{staticClass:"randar-head"},[e("div"),e("a-checkbox",{attrs:{checked:t.selectRandarId===n.formId}})],1),e("section",{staticClass:"randar-main"},[e("div",{staticClass:"randar-main-content"},[e("p",[t._v(t._s(n.name))]),e("p",{staticClass:"aks-tips"},[t._v(t._s(n.describe))])]),e("a-avatar",{attrs:{size:40,src:n.cover,shape:"square"}})],1)])})),0):e("a-empty"),t.loading?e("div",{staticClass:"loading-container"},[e("a-spin",{attrs:{tip:"正在加载中..."}})],1):t._e(),!t.loading&&t.pageList.length>0?e("div",{staticClass:"loading-container"},[t._v("没有更多数据了")]):t._e()],1)])},i=[],s=n("2909"),r=(n("7db0"),n("d3b7"),n("2a86")),o=n("487a"),c=n.n(o),l=n("8f19"),d={name:"AddForm",directives:{infiniteScroll:c.a},components:{CommonModal:r["a"]},props:{editData:{type:Object,default:function(){return{}}},source:{type:String,default:""}},data:function(){return{sourceModal:{title:"自定义表单"},pagination:{current:1,pageSize:10,total:0},form:{typeText:"自定义表单",type:"link",linkTitle:"",desc:"",coverUrl:{compress:""}},type:"",typeText:{1:"链接",2:"PDF",3:"文章",4:"文章"},typeImg:{1:"/imgs/default-cover.png",2:"/icons/pdf.png",3:"/imgs/default-cover.png",4:"/imgs/default-cover.png"},radarName:"",loading:!1,busy:!1,pageList:[],selectRandarId:""}},watch:{editData:{handler:function(){},deep:!0,immediate:!0}},methods:{serviceOk:function(){var t=this;if(this.selectRandarId){var e=this.pageList.find((function(e){return e.formId===t.selectRandarId}));e.typeText="自定义表单",e.linkTitle=e.name,e.desc=e.describe,e.type="link",e.key="visibileForm",e.linktype="form_link",e.coverUrl={compress:e.cover},this.$emit("serviceOk",e)}else this.$message.warning("请选择一个自定义表单")},init:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,source:this.source,status:1};this.loading=!0,Object(l["f"])(e).then((function(e){var n;e.data.list.length>0&&(n=t.pageList).push.apply(n,Object(s["a"])(e.data.list));if(t.pagination.current++,e.data.list.length<t.pagination.pageSize)return t.busy=!0,void(t.loading=!1);t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e||e.message)}))},selectTab:function(t){this.type=t,this.pagination.current=1,this.pageList=[],this.busy=!1,this.init()},search:function(){this.pagination.current=1,this.pageList=[],this.busy=!1,this.init()},handleInfiniteOnLoad:function(){!this.busy&&this.init()}}},u=d,m=(n("2314"),n("2877")),p=Object(m["a"])(u,a,i,!1,null,"66fbf478",null);e["a"]=p.exports},"7d1fa":function(t,e,n){"use strict";n("0859")},"7d57":function(t,e,n){},"7e26":function(t,e,n){},"842b":function(t,e,n){"use strict";var a=n("5530"),i=(n("d3b7"),n("d81d"),n("3ca3"),n("ddb0"),n("a15b"),n("a9e3"),n("b0c0"),n("9911"),n("d885")),s=n("cf5f");e["a"]={methods:{interactiveRadarUploadFile:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.uploadFilePath;return new Promise((function(n,a){var i=new FormData;i.append("file",t),i.append("dir",e),Object(s["m"])(i).then((function(t){n(t.data)})).catch((function(t){a(t)}))}))},uploadMedia:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.attachments;return new Promise((function(n,a){var i=(null===e||void 0===e?void 0:e.map((function(e){return new Promise((function(n,a){if("link"===e.type&&e.isRadar&&!e.isMaterial)t.interactiveRadarAdd(e).then((function(t){n(t)})).catch((function(t){a(t)}));else if("img"===e.type){var i=new FormData;i.append("file",e.pic_url.file),i.append("dir","clientTransformation"),i.append("type","image"),Object(s["y"])(i).then((function(t){e.pic_url.fileUrl=t.data.fileUrl,e.pic_url.mediaId=t.data.mediaId,n(t.data)}))}else n()}))})))||[];Promise.all(i).then((function(t){n()})).catch((function(e){t.$message.error(e||e.message),t.loading=!1,a(e)}))}))},interactiveRadarAdd:function(t){var e=this;return new Promise((function(n,a){e.getParamsLink(t).then((function(e){Object(i["f"])(e).then((function(e){t.radarId=e.data.radarId,t.url=e.data.radarLink+t.source,n(e)})).catch((function(t){a(t)}))}))}))},getParamsLink:function(t){return new Promise((function(e,n){var a=new FormData,i=t.isCustomerTag?[{autoMarkTagBitmaps:t.selectCustomerTagList.map((function(t){return t.bitmap})).join(",")}]:[];if(a.append("type",1),a.append("radarName",t.linkTitle),a.append("link",t.url),a.append("activityNotify",Number(t.activityNotify)),a.append("behaviorNotify",Number(t.behaviorNotify)),a.append("tagRule",JSON.stringify(i)),a.append("title",t.radarTitle),a.append("desc",t.desc),a.append("hasCustomerTag",Number(t.isCustomerTag)),t.isScoreRule){var r=JSON.stringify(t.ruleDetails.map((function(t){var e,n;return{autoMarkTagBitmaps:null===(e=t.selectTagList)||void 0===e||null===(n=e.map((function(t){return t.bitmap})))||void 0===n?void 0:n.join(","),hasTag:Number(t.hasTag),score:t.score,ruleKind:t.ruleKind,count:t.count||0}})));a.append("scoreRule",r)}if(t.coverUrl.file){var o=new FormData;o.append("file",t.coverUrl.file),o.append("dir","clientTransformation"),Object(s["m"])(o).then((function(n){a.append("coverUrl",n.data),t.picurl=n.data,e(a)})).catch((function(t){n(t)}))}else e(a)}))},getMessageList:function(t){return t.map((function(t){var e="";if(0===t.msgType&&(e=t.msgContent,t.formObj={},t.pdfArr=[],t.videoArr=[]),1===t.msgType&&(e={compress:t.msgContent},t.imageObj={title:"图片",prop:"pic_url",type:"img",tips:"",accept:".jpg,.png",maxLength:2097152,value:{compress:t.msgContent}},t.formObj={},t.pdfArr=[],t.videoArr=[]),2===t.msgType){t.pdfArr=[],t.videoArr=[];var n,i,s,r,o=JSON.parse(t.msgContent);if(e={form:{linkTitle:o.title,desc:o.desc,coverUrl:{compress:o.picUrl},type:"link",url:o.url}},t.interactRadar)e.form.isRadar=!0,e.form.behaviorNotify=Boolean(t.interactRadar.behaviorNotify),e.form.activityNotify=Boolean(t.interactRadar.activityNotify),e.form.isCustomerTag=(null===(n=t.interactRadar.tagRules)||void 0===n?void 0:n.length)>0,e.form.radarTitle=t.interactRadar.radarName,e.form.radarId=t.interactRadar.radarId,e.form.selectCustomerTagList=null===(i=t.interactRadar.tagRules[0])||void 0===i||null===(s=i.customerTags)||void 0===s?void 0:s.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{key:t.tagId})})),e.form.isScoreRule=(null===(r=t.interactRadar.scoreRules)||void 0===r?void 0:r.length)>0,e.form.ruleDetails=t.interactRadar.scoreRules.map((function(t){var e;return Object(a["a"])(Object(a["a"])({},t),{},{autoMarkTagBitmaps:t.autoMarkTagBitmaps,selectTagList:null===(e=t.customerTags)||void 0===e?void 0:e.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{key:t.tagId})})),hasTag:Boolean(t.hasTag),score:t.score,ruleKind:t.ruleKind,count:t.count})}))}if(3===t.msgType){var c=JSON.parse(t.msgContent);t.pdfArr=[Object(a["a"])(Object(a["a"])({},c),{},{uid:"1",status:"done"})],t.formObj={},t.videoArr=[]}if(4===t.msgType){var l=JSON.parse(t.msgContent);t.formObj=Object(a["a"])(Object(a["a"])({},l),{},{name:l.title}),t.pdfArr=[]}if(5===t.msgType){var d=JSON.parse(t.msgContent);t.videoArr=[Object(a["a"])({},d)],t.formObj={},t.pdfArr=[]}return Object(a["a"])(Object(a["a"])({},t),{},{msgContent:e})}))},getPlanList:function(t){var e=this;return t.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{messageList:e.getAddMessageList(t.messageList)})}))},getAddMessageList:function(t){return t.map((function(t){var e="";if(0===t.msgType&&(e=t.msgContent),1===t.msgType&&(e=t.fileUrl||t.msgContent.compress),2===t.msgType){var n,a,i="";t.fileUrl?i=t.fileUrl:t.msgContent.form.picurl?i=t.msgContent.form.picurl:t.msgContent.form.coverUrl.compress&&(i=t.msgContent.form.coverUrl.compress);var s=t.msgContent.form.radarId||(null===(n=t.msgContent.form.interactRadar)||void 0===n?void 0:n.radarId);s&&(s=String(s)),e=JSON.stringify({desc:t.msgContent.form.desc,picUrl:i,url:t.msgContent.form.url,title:t.msgContent.form.linkTitle,radarId:s,type:t.msgContent.form.radarId||null!==(a=t.msgContent.form.interactRadar)&&void 0!==a&&a.radarId?"radar_link":"normal_link"})}return 3===t.msgType&&(e=JSON.stringify({pdfFile:t.pdfArr[0].fileUrl||t.pdfArr[0].pdfFile,name:t.pdfArr[0].name,size:t.pdfArr[0].size,cover:"https://acadsocscrmpc.oss-cn-shenzhen.aliyuncs.com/h5/img/pdf.png"})),4===t.msgType&&(e=JSON.stringify({cover:t.formObj.cover,desc:t.formObj.desc,title:t.formObj.name,url:t.formObj.link})),{messageId:t.messageId,msgType:t.msgType,msgContent:e}}))},getPlanFileList:function(t){var e=this,n=[];return t.length>0&&(n=t.map((function(t){return new Promise((function(n,a){var i,s,r,o;2===t.msgType?t.msgContent.form.isRadar&&t.msgContent.form.randerIsEdit?e.interactiveRadarAdd(t.msgContent.form).then((function(e){t.radarId=e.data,n(e)})).catch((function(t){a(t)})):t.msgContent.form.coverUrl.file?e.interactiveRadarUploadFile(t.msgContent.form.coverUrl.file).then((function(e){t.fileUrl=e,n(e)})).catch((function(t){a(t)})):n():1===t.msgType&&t.msgContent.file?e.interactiveRadarUploadFile(t.msgContent.file).then((function(e){t.fileUrl=e,n(e)})).catch((function(t){a(t)})):3===t.msgType&&null!==(i=t.pdfArr)&&void 0!==i&&null!==(s=i[0])&&void 0!==s&&s.originFileObj?e.interactiveRadarUploadFile(t.pdfArr[0].originFileObj).then((function(e){t.pdfArr[0].fileUrl=e,n(e)})).catch((function(t){a(t)})):5===t.msgType&&null!==(r=t.videoArr)&&void 0!==r&&null!==(o=r[0])&&void 0!==o&&o.originFileObj?e.interactiveRadarUploadFile(t.videoArr[0].originFileObj).then((function(e){t.videoArr[0].fileUrl=e,n(e)})).catch((function(t){a(t)})):n()}))}))),n}}}},"8f19":function(t,e,n){"use strict";n.d(e,"n",(function(){return s})),n.d(e,"q",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"j",(function(){return c})),n.d(e,"h",(function(){return l})),n.d(e,"f",(function(){return d})),n.d(e,"l",(function(){return u})),n.d(e,"d",(function(){return m})),n.d(e,"e",(function(){return p})),n.d(e,"i",(function(){return f})),n.d(e,"g",(function(){return g})),n.d(e,"b",(function(){return v})),n.d(e,"k",(function(){return h})),n.d(e,"m",(function(){return b})),n.d(e,"c",(function(){return y})),n.d(e,"p",(function(){return C})),n.d(e,"o",(function(){return O}));var a=n("b775"),i={customerFormSave:"/client_transformation/customerForm/save",dateInfoList:"/client_transformation/customerFormData/dateInfoList",customerFormList:"/client_transformation/customerForm/list",customerFormInfo:"/client_transformation/customerForm/info",customerFormUpdate:"/client_transformation/customerForm/update",customerFormPublish:"/client_transformation/customerForm/publish",customerFormDelete:"/client_transformation/customerForm/delete",dataInfo:"/client_transformation/customerFormData/dataInfo",analysis:"/client_transformation/customerFormData/analysis",staffList:"/client_transformation/customerFormData/staffList",infoList:"/client_transformation/customerFormData/infoList",analysisExport:"/client_transformation/customerFormData/analysisExport",dataInfoExport:"/client_transformation/customerFormData/dataInfoExport",infoCityList:"/client_transformation/customerFormData/infoCityList",batchTags:"/client_transformation/customerFormData/batchTags",selectList:"/client_transformation/customerForm/userData/selectList",queryDataList:"/client_transformation/customerFormData/queryDataList"};function s(t){return Object(a["b"])({url:i.infoList,method:"post",data:t})}function r(t){return Object(a["b"])({url:i.staffList,method:"get",params:t})}function o(t){return Object(a["b"])({url:i.analysis,method:"get",params:t})}function c(t){return Object(a["b"])({url:i.dataInfo,method:"get",params:t})}function l(t){return Object(a["b"])({url:i.customerFormSave,method:"post",data:t})}function d(t){return Object(a["b"])({url:i.customerFormList,method:"get",params:t})}function u(t){return Object(a["b"])({url:i.dateInfoList,method:"get",params:t})}function m(t){return Object(a["b"])({url:i.customerFormDelete,method:"post",data:t})}function p(t){return Object(a["b"])({url:i.customerFormInfo,method:"get",params:t})}function f(t){return Object(a["b"])({url:i.customerFormUpdate,method:"post",data:t})}function g(t){return Object(a["b"])({url:i.customerFormPublish,method:"post",data:t})}function v(t){return Object(a["b"])({url:i.analysisExport,method:"get",params:t,responseType:"blob"})}function h(t){return Object(a["b"])({url:i.dataInfoExport,method:"get",params:t,responseType:"blob"})}function b(t){return Object(a["b"])({url:i.infoCityList,method:"get",params:t})}function y(t){return Object(a["b"])({url:i.batchTags,method:"post",data:t})}function C(t){return Object(a["b"])({url:i.selectList,method:"get",params:t})}function O(t){return Object(a["b"])({url:i.queryDataList,method:"post",data:t})}},afd2:function(t,e,n){},c0e2:function(t,e,n){},eaaf:function(t,e,n){"use strict";n("7e26")}}]);