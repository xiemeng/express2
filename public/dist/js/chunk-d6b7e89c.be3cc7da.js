(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d6b7e89c"],{"0fa8":function(t,e,a){},1119:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[t._l(t.form.tagList,(function(a,i){return e("a-form-model-item",t._b({key:a.key,attrs:{prop:"tagList",label:0===i?"标签名称":""}},"a-form-model-item",0===i?t.formItemLayout:t.formItemLayoutWithOutLabel,!1),[e("a-input",{staticStyle:{width:"60%","margin-right":"8px"},attrs:{placeholder:"请输入标签名称",maxLength:10},model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"domain.value"}}),t.form.tagList.length>1?e("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===t.form.tagList.length},on:{click:function(e){return t.removeDomain(a)}}}):t._e(),a.tagCount||0===a.tagCount?e("a-space",{staticClass:"using"},[a.tagCount>0?e("a-tag",{attrs:{color:"green"}},[t._v("使用中")]):e("a-tag",{attrs:{color:"orange"}},[t._v("未使用")])],1):t._e()],1)})),e("a-form-model-item",{attrs:{"wrapper-col":{offset:4}}},[e("a-button",{attrs:{type:"link"},on:{click:t.addDomain}},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v(" 添加标签 ")],1)],1)],2)},n=[],s=(a("a434"),{name:"FormlabelAdd",props:{form:{type:[Object],default:function(){return{}}}},mounted:function(){},data:function(){return{formItemLayout:{labelCol:{sm:{span:5}},wrapperCol:{sm:{span:19}}},formItemLayoutWithOutLabel:{wrapperCol:{sm:{span:19,offset:5}}}}},methods:{removeDomain:function(t){var e=this.form.tagList.indexOf(t);-1!==e&&this.form.tagList.splice(e,1)},addDomain:function(){this.form.tagList.push({value:"",key:Date.now()})}}}),r=s,o=(a("74de"),a("2877")),l=Object(o["a"])(r,i,n,!1,null,"bb9da28a",null);e["a"]=l.exports},1158:function(t,e,a){"use strict";a("d3bd")},1531:function(t,e,a){"use strict";a("b1f6")},"37e2":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-box"},[e("section",{staticClass:"customer-tag-section"},[e("a-row",{staticClass:"tag-manage-header",attrs:{type:"flex",justify:"space-between"}},[e("a-col",[e("div",{staticClass:"tabBar-extra-content"},[e("a-button",{staticClass:"add-member",attrs:{type:"primary"},on:{click:t.addGroupTag}},[t._v("添加标签组")]),[e("span",[t._v("可用部门：")]),e("TreeSelect",{attrs:{treeData:t.treeData},on:{selectDepartment:t.selectDepartment}})]],2)]),e("a-col",[e("a-button",{staticClass:"button ant-btn sync-workwx-tag-btn",attrs:{loading:t.loading},on:{click:t.enterLoading}},[t._v(" 同步企微标签 ")])],1)],1)],1),e("section",{staticClass:"user-tag-panel"},[e("a-list",{staticStyle:{padding:"0 24px"},attrs:{"data-source":t.DataGroupList},scopedSlots:t._u([{key:"renderItem",fn:function(a){return e("a-list-item",{},[e("div",{staticClass:"tag-group-name"},[t._v(t._s(a.groupName))]),e("div",{staticClass:"center col-1"},[e("div",{staticClass:"enable-range-box flex-row"},[t._v(" 可见范围： "),a.depNames?e("a-space",t._l(a.depNames.split(","),(function(a){return e("a-tag",{key:a},[t._v(" "+t._s(a)+" ")])})),1):e("span",[e("a-icon",{staticClass:"folder primaryColor",attrs:{type:"folder",theme:"filled"}}),t._v("全部员工可用 ")],1),e("a-space",{staticClass:"using"},[a.using?e("a-tag",{attrs:{color:"green"}},[t._v("使用中")]):e("a-tag",{attrs:{color:"orange"}},[t._v("未使用")])],1)],1),e("a-list-item",[e("TagComponents",{attrs:{tagslist:a},on:{addTagSucceed:t.getGroupList}})],1)],1),e("a-button",{staticStyle:{color:"#777"},attrs:{type:"link"},on:{click:function(e){return t.EditModal(a)}}},[e("a-icon",{attrs:{type:"form"}}),t._v("修改 ")],1),e("a-button",{staticStyle:{color:"#777"},attrs:{type:"link"},on:{click:function(e){return t.deleteTag(a)}}},[e("a-icon",{attrs:{type:"delete"}}),t._v("删除 ")],1)],1)}}])})],1),e("a-modal",{attrs:{footer:null,"confirm-loading":t.confirmLoading,width:"599px",destroyOnClose:""},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("NewLabelgroup",{attrs:{tagDetail:t.tagDetail},on:{cancle:function(e){t.visible=!1},serviceOk:t.serviceOk}})],1)],1)},n=[],s=(a("d3b7"),a("d81d"),a("c740"),a("b0c0"),a("c758")),r=(a("fb6a"),function(){var t=this,e=t._self._c;return e("div",[e("a-button",{staticClass:"add-tag-button",attrs:{size:"small"},on:{click:t.showInput}},[e("a-icon",{attrs:{type:"plus"}}),t._v("添加")],1),t.inputVisible?e("a-input",{ref:"input",style:{width:"120px"},attrs:{type:"text",size:"small",maxLength:10,inputVisible:"false"},on:{blur:t.handleInputConfirm,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):t._e(),t._l(t.tagslist.tags,(function(a,i){return[a.tagName.length>20?e("a-tooltip",{key:i},[e("a-tag",{key:a.tagName},[t._v(" "+t._s("".concat(a.tagName.slice(0,20),"..."))+" ")])],1):e("a-tag",{key:i},[t._v(" "+t._s(a.tagName)+" ")])]}))],2)}),o=[],l=a("2909"),u=(a("498a"),a("caad"),a("2532"),a("99af"),a("7183")),c={data:function(){return{inputVisible:!1,inputValue:"",index:""}},props:["tagslist"],methods:{showInput:function(){this.inputVisible=!0,this.$nextTick((function(){this.$refs.input.focus()}))},cancle:function(){this.inputValue="",this.inputVisible=!1},handleInputConfirm:function(){var t=this,e=this.inputValue.trim();if(e){var a=this.tagslist.tags,i={tagName:e},n=a.map((function(t){return t.tagName}));if(n.includes(i.tagName))this.$message.warning("存在重复标签");else{var s=this.getAddParams(e);Object(u["a"])(s).then((function(){t.$message.success("添加标签成功"),e&&(a=[].concat(Object(l["a"])(a),[i])),t.tagslist.tags=a,t.$emit("addTagSucceed"),t.cancle()})).catch((function(e){t.$message.error("标签添加失败")}))}}else this.inputValue=""},getAddParams:function(t){var e={wxGroupId:this.tagslist.wxGroupId,tagGroupName:this.tagslist.groupName,scope:this.tagslist.depScope?1:0,addOrEditTags:[{tagName:t}],departments:[]};return e}}},d=c,p=(a("1158"),a("2877")),g=Object(p["a"])(d,r,o,!1,null,"2f8754aa",null),m=g.exports,f=a("48c5"),v=a("1c9c"),h={name:"CustomerTages",data:function(){return{tagDetail:{},wxDepId:"",visible:!1,DataGroupList:[],confirmLoading:!1,visibleEdit:!1,loading:!1,treeData:[]}},components:{NewLabelgroup:s["a"],TagComponents:m,TreeSelect:f["a"]},created:function(){this.getGroupList(),this.getDepartment()},methods:{addGroupTag:function(){this.tagDetail={},this.visible=!0},deleteTag:function(t){var e=this,a=t.using?"该标签组有子标签正被使用，删除后相应客户标签也会被移除，是否删除":"确认后将会删除该客户标签组，是否删除";this.$confirm({title:"提示",icon:"",okText:"删除",content:a,onOk:function(){e.delTagGroup(t.wxGroupId)}})},delTagGroup:function(t){var e=this;Object(u["b"])({delList:[t]}).then((function(){e.$message.success("删除标签组成功"),e.getGroupList()})).catch((function(t){e.$message.error(t)}))},serviceOk:function(){this.visible=!1,this.getGroupList()},selectDepartment:function(t){this.wxDepId="全部部门"==t?"":t,this.getGroupList()},enterLoading:function(){var t=this;this.loading=!0,Object(u["d"])().then((function(){t.$message.success("同步成功"),t.getGroupList()})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},EditModal:function(t){this.tagDetail=t,this.visible=!0},getGroupList:function(){var t=this,e={wxDepId:this.wxDepId};return Object(u["c"])(e).then((function(e){var a,i;t.DataGroupList=(null===e||void 0===e||null===(a=e.data)||void 0===a||null===(i=a.tagGroup)||void 0===i?void 0:i.map((function(t){var e=t.tags.findIndex((function(t){return(null===t||void 0===t?void 0:t.tagCount)>0}));return e>=0&&(t.using=!0),t})))||[]})).catch((function(e){t.$message.error(e)}))},getDepartment:function(){var t=this;Object(v["g"])().then((function(e){var a;(null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.length)>0&&(t.treeData=t.getTreeData(e.data))})).catch((function(e){t.$message.error(e)}))},getTreeData:function(t){var e=this;if((null===t||void 0===t?void 0:t.length)>0){var a=t.map((function(t){var a={title:t.name,key:t.wxDepartmentId,value:t.wxDepartmentId,slots:{icon:"smile"},children:void 0};return t.children&&(a.children=e.getTreeData(t.children)),a}));return a}}}},b=h,y=(a("e66b"),Object(p["a"])(b,i,n,!1,null,"13989f37",null));e["default"]=y.exports},"48c5":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("a-col",[e("a-tree-select",{staticStyle:{width:"192px"},attrs:{"dropdown-style":{maxHeight:"300px",overflow:"auto"},"tree-data":t.treeData,"tree-default-expand-all":"",allowClear:t.allowClear},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1)},n=[],s={data:function(){return{value:"全部部门",allowClear:!1}},watch:{value:function(t){this.$emit("selectDepartment",t),void 0===t?this.value="全部部门":this.allowClear="全部部门"!==t}},props:["treeData"]},r=s,o=a("2877"),l=Object(o["a"])(r,i,n,!1,null,null,null);e["a"]=l.exports},7183:function(t,e,a){"use strict";a.d(e,"c",(function(){return s})),a.d(e,"d",(function(){return r})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return l}));var i=a("b775"),n={getTagGroup:"/client_manager/CustomerTag/getTagGroup",syncTagGroup:"/client_manager/CustomerTag/syncTagGroup",addOrEditTagGroup:"/client_manager/CustomerTag/addOrEditTagGroup",delTagGroup:"/client_manager/CustomerTag/delTagGroup"};function s(t){return Object(i["b"])({url:n.getTagGroup,method:"post",data:t})}function r(t){return Object(i["b"])({url:n.syncTagGroup,method:"post",data:t})}function o(t){return Object(i["b"])({url:n.addOrEditTagGroup,method:"post",data:t})}function l(t){return Object(i["b"])({url:n.delTagGroup,method:"post",data:t})}},"74de":function(t,e,a){"use strict";a("9ee2")},"9ee2":function(t,e,a){},ac43:function(t,e,a){"use strict";a("0fa8")},b1f6:function(t,e,a){},bef3:function(t,e,a){},c758:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-tags"},[e("section",{attrs:{id:"operator-tag-group-dialog"}},[e("p",{staticClass:"dialog-title dialog-tag-title"},[t._v(t._s(t.statusText)+"标签组")]),e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[e("a-form-model-item",{attrs:{label:"标签组名称",prop:"tagGroupName"}},[e("a-input",{staticClass:"tags-name",attrs:{placeholder:"请输入标签组名称",maxLength:15},model:{value:t.form.tagGroupName,callback:function(e){t.$set(t.form,"tagGroupName",e)},expression:"form.tagGroupName"}})],1),e("a-form-model-item",{attrs:{label:"可见范围",prop:"scope"}},[e("a-radio-group",{model:{value:t.form.scope,callback:function(e){t.$set(t.form,"scope",e)},expression:"form.scope"}},[e("a-radio",{attrs:{value:0}},[t._v(" 全部员工 ")]),e("a-radio",{attrs:{value:1}},[t._v(" 部门可用 ")])],1)],1),1===t.form.scope?e("a-form-model-item",{attrs:{label:"选择可用部门"}},[e("AddContent",{attrs:{title:"请选择部门",type:"wxDepartmentId",tip:"",dataList:t.selectList},on:{selectPerson:t.selectPerson}})],1):t._e(),e("FormlabelAdd",{attrs:{form:t.form}})],1)],1),e("div",{staticClass:"foot-button"},[e("a-space",{attrs:{size:12}},[e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("确定")])],1)],1)])},n=[],s=a("5530"),r=(a("d81d"),a("d3b7"),a("99af"),a("159b"),a("c740"),a("a434"),a("e1ae")),o=a("1119"),l=a("7183"),u={props:{tagDetail:{type:[Object],default:function(){return{}}}},computed:{statusText:function(){return this.tagDetail.groupId?"修改":"新增"}},data:function(){return{formLayout:"horizontal",labelCol:{span:5},wrapperCol:{span:14},selectList:[],form:{tagGroupName:"",scope:0,value:"",tagList:[{value:"",key:Date.now()}]},rules:{tagGroupName:[{required:!0,message:"标签组名称不能为空"}],tagList:[{required:!0,message:"标签名称不能为空"}]}}},created:function(){var t;if(null!==(t=this.tagDetail)&&void 0!==t&&t.groupId&&(this.form={tagGroupName:this.tagDetail.groupName,scope:this.tagDetail.depScope?1:0,tagList:this.tagDetail.tags.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{value:t.tagName,key:t.tagId,tagId:t.tagId,wxTagId:t.wxTagId})}))},this.tagDetail.depNames&&this.tagDetail.depScope)){var e=this.tagDetail.depNames.split(","),a=this.tagDetail.depScope.split(",");this.selectList=e.map((function(t,e){return{icon:"file",key:a[e],source:{departmentId:a[e],wxDepartmentId:a[e],name:t},title:t}}))}},components:{AddContent:r["a"],FormlabelAdd:o["a"]},methods:{selectPerson:function(t){this.selectList=t},submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;e.validate().then((function(){e.addOrEditTagGroup()})).catch((function(t){e.$message.warning(t.message||t)}))}))},validate:function(){var t=this;return new Promise((function(e,a){1===t.form.scope&&t.selectList.length<1&&a("请选择部门");for(var i=t.form.tagList,n=0;n<i.length;n++){var s=i[n];s.value||a("请填写标签名称");for(var r=n+1;r<i.length;r++)s.value===i[r].value&&a("第".concat(n+1,"个和第").concat(r+1,"个标签名重复"))}e()}))},getAddParams:function(){var t,e,a={tagGroupName:this.form.tagGroupName,scope:this.form.scope,addOrEditTags:null===(t=this.form.tagList)||void 0===t?void 0:t.map((function(t){return{tagName:t.value}})),departments:null===(e=this.selectList)||void 0===e?void 0:e.map((function(t){return{wxDepartmentId:t.source.wxDepartmentId}}))};return a},getEditParams:function(){var t,e,a=this,i=[],n=[];this.tagDetail.tags.forEach((function(t){var e=a.form.tagList.findIndex((function(e){if(t.wxTagId===e.wxTagId)return e}));e<0&&i.push({tagName:t.tagName,wxTagId:t.wxTagId})})),this.form.tagList.forEach((function(t){t.wxTagId?a.tagDetail.tags.forEach((function(e){e.wxTagId===t.wxTagId&&e.tagName!==t.value&&n.push({tagName:t.value,wxTagId:e.wxTagId})})):n.push({tagName:t.value})})),null===(t=this.form.tagList)||void 0===t||t.map((function(t){return{tagName:t.value,wxTagId:t.wxTagId}}));var s={wxGroupId:this.tagDetail.wxGroupId,tagGroupName:this.form.tagGroupName,scope:this.form.scope,delTags:i,addOrEditTags:n,departments:null===(e=this.selectList)||void 0===e?void 0:e.map((function(t){return{wxDepartmentId:t.source.wxDepartmentId}}))};return 0===this.form.scope&&delete s.departments,s},addOrEditTagGroup:function(){var t,e=this,a=null!==(t=this.tagDetail)&&void 0!==t&&t.groupId?this.getEditParams():this.getAddParams();Object(l["a"])(a).then((function(){e.$message.success("".concat(e.statusText,"标签成功")),e.$emit("serviceOk")})).catch((function(t){e.$message.error(t||t.message)}))},removeDomain:function(t){var e=this.form.tagList.indexOf(t);-1!==e&&this.form.tagList.splice(e,1)}}},c=u,d=(a("ac43"),a("2877")),p=Object(d["a"])(c,i,n,!1,null,"95b22908",null);e["a"]=p.exports},d3bd:function(t,e,a){},e1ae:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",["look"!==t.state?e("header",[e("a-button",{attrs:{type:"primary"},on:{click:function(e){t.visibleTree=!0}}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" "+t._s(t.title)+" ")],1),t.tip?e("span",{staticClass:"font-color-black-25 tips"},[t._v(t._s(t.tip))]):t._e()],1):t._e(),e("ul",t._l(t.selectList,(function(a,i){return e("a-tag",{key:a.key,attrs:{closable:"look"!==t.state},on:{close:function(e){return t.closeTag(i)}}},[a.source.thumbAvatar?e("a-avatar",{attrs:{size:26,src:a.source.thumbAvatar,shape:"square"}}):e("a-avatar",{attrs:{size:26,icon:a.icon,shape:"square"}}),t._v(" "+t._s(a.title)+" ")],1)})),1),e("a-modal",{attrs:{footer:null,centered:"",width:"680px",destroyOnClose:""},model:{value:t.visibleTree,callback:function(e){t.visibleTree=e},expression:"visibleTree"}},[e("AddTransfer",{attrs:{selectRoleIdList:t.selectRoleIdList,title:t.title,type:t.type,selectList:t.selectList},on:{serviceOk:t.serviceOk,cancle:function(e){t.visibleTree=!1}}})],1)],1)},n=[],s=(a("d81d"),a("a434"),a("1eb1")),r={name:"AddContent",props:{value:{type:[Array],default:function(){return[]}},state:{type:[String],default:""},selectRoleIdList:{type:[Array,String],default:function(){return""}},type:{type:[String],default:"wxDepartmentId"},title:{type:[String],default:"添加成员"},tip:{type:[String],default:""},dataList:{type:[Array],default:function(){return[]}}},components:{AddTransfer:s["a"]},data:function(){return{visibleTree:!1,selectList:[]}},watch:{selectList:function(){this.$emit("selectPerson",this.selectList),this.$emit("input",this.selectList)},dataList:{handler:function(){this.selectList=this.dataList},immediate:!0}},methods:{serviceOk:function(t){var e=t.map((function(t){return t.value=100,t}));this.selectList=e,this.visibleTree=!1},closeTag:function(t){this.selectList.splice(t,1)}}},o=r,l=(a("1531"),a("2877")),u=Object(l["a"])(o,i,n,!1,null,"53952032",null);e["a"]=u.exports},e66b:function(t,e,a){"use strict";a("bef3")}}]);