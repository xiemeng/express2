(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-45e0c06a"],{"23ba":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return c}));var n=a("b775"),o={addGroup:"/staffgroup/addGroup",batchMoveGroupMember:"/staffgroup/batchMoveGroupMember",delGroup:"/staffgroup/delGroup",queryGroupAllAndCount:"/staffgroup/queryGroupAllAndCount"};function i(t){return Object(n["b"])({url:o.batchMoveGroupMember,method:"post",data:t})}function s(t){return Object(n["b"])({url:o.addGroup,method:"get",params:t})}function r(t){return Object(n["b"])({url:o.delGroup,method:"get",params:t})}function c(t){return Object(n["b"])({url:o.queryGroupAllAndCount,method:"get",params:t})}},"267a":function(t,e,a){"use strict";a("be53")},"361b":function(t,e,a){},"70b8":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"component-wrap"},[e("div",{staticClass:"contacts-wrap"},[e("header",{staticClass:"header"},[e("h2",[t._v("All contacts")]),e("div",[e("a-button",{attrs:{type:"primary",disabled:t.Actions},on:{click:function(e){t.visibleAgent=!0}}},[t._v("Batch change handlers")]),t._v("    "),e("a-button",{attrs:{type:"primary",disabled:t.Actions},on:{click:function(e){t.visibleImportContact=!0}}},[t._v("Import Contacts")]),t._v("    "),e("a-button",{attrs:{type:"primary",disabled:t.Actions},on:{click:t.addNewContact}},[t._v("Add new contact")])],1)]),e("section",{staticClass:"section"},[e("h3",{staticClass:"total"},[e("a-form-model",{ref:"ruleForm",staticClass:"ant-advanced-search-form",attrs:{form:t.form,layout:"inline"},on:{submit:t.handleSubmit}},[e("a-form-model-item",{attrs:{label:"Name"}},[e("a-input",{attrs:{placeholder:"place input",size:"large",allowClear:""},model:{value:t.form.displayName,callback:function(e){t.$set(t.form,"displayName",e)},expression:"form.displayName"}})],1),e("a-form-model-item",{attrs:{label:"email",name:"email"}},[e("a-input",{attrs:{placeholder:"place input",size:"large",allowClear:""},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),e("a-form-model-item",{attrs:{label:"phone",name:"phone"}},[e("a-input",{attrs:{placeholder:"place input",size:"large",allowClear:""},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("a-form-model-item",{attrs:{label:"UID",name:"uid"}},[e("a-input",{attrs:{placeholder:"place input",size:"large",allowClear:""},model:{value:t.form.uid,callback:function(e){t.$set(t.form,"uid",e)},expression:"form.uid"}})],1),e("a-form-model-item",{attrs:{label:"Group Name"}},[e("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"group",size:"large",allowClear:""},on:{change:function(e){t.form.notAllot=void 0}},model:{value:t.form.groupId,callback:function(e){t.$set(t.form,"groupId",e)},expression:"form.groupId"}},t._l(t.groupList,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.groupName)+" ")])})),1)],1),e("a-form-model-item",{attrs:{label:"Create Time"}},[e("a-range-picker",{attrs:{disabledDate:t.disabledDate},model:{value:t.form.startAndEndTime,callback:function(e){t.$set(t.form,"startAndEndTime",e)},expression:"form.startAndEndTime"}})],1),e("a-form-model-item",{attrs:{label:"Not Allot",name:"notAllot"}},[e("a-checkbox",{on:{change:function(e){t.form.groupId=void 0}},model:{value:t.form.notAllot,callback:function(e){t.$set(t.form,"notAllot",e)},expression:"form.notAllot"}})],1),e("a-form-model-item",[e("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v(" Search ")]),e("a-button",{style:{marginLeft:"8px"},on:{click:t.result}},[t._v(" Clear ")])],1)],1)],1),e("a-table",{staticClass:"table",attrs:{columns:t.columns,"data-source":t.clientData,"row-selection":t.rowSelection,loading:t.loading,scroll:{y:500},pagination:t.pagination},on:{change:t.changeTab},scopedSlots:t._u([{key:"displayName",fn:function(a,n){return e("div",{},[e("a-button",{staticClass:"look-name",attrs:{type:"link"},on:{click:function(e){return t.openDetail(n)}}},[t._v(t._s(a))])],1)}},{key:"Channels",fn:function(a,n){return e("div",{},[e("div",{staticClass:"message",on:{click:function(e){return t.goChat(n)}}},[e("a-icon",{attrs:{type:"message"}})],1)])}},{key:"extraInfoVoList",fn:function(a){return a?e("div",{},[e("a-tooltip",[e("ul",{attrs:{slot:"title"},slot:"title"},t._l(a,(function(a,n){return e("li",{key:n},[e("Span",[t._v(t._s(a.category)+" "+t._s(a.topic))])],1)})),0),e("a-button",{attrs:{type:"link"}},[t._v(t._s(a.length)+"+topics")])],1)],1):t._e()}},{key:"Actions",fn:function(a,n){return e("div",{},[e("a-button",{attrs:{type:"link",disabled:t.Actions},on:{click:function(e){return t.editPage(n)}}},[t._v("Edit")]),e("a-button",{attrs:{type:"link",disabled:t.Actions},on:{click:function(e){return t.deletePage(n)}}},[t._v("Delete")])],1)}}],null,!0)})],1),e("a-modal",{attrs:{width:"600px",footer:null,title:"Create contact",destroyOnClose:"",centered:""},on:{cancel:function(e){t.visibleSearch=!1}},model:{value:t.visibleSearch,callback:function(e){t.visibleSearch=e},expression:"visibleSearch"}},[e("AddContact",{attrs:{editData:t.editData},on:{cancel:function(e){t.visibleSearch=!1},serviceOk:t.serviceOk}})],1),e("a-modal",{attrs:{visible:t.visibleImportContact,width:"600px",title:"Import contacts",centered:"",footer:!1,destroyOnClose:""},on:{ok:function(e){t.visibleImportContact=!1},cancel:function(e){t.visibleImportContact=!1}}},[e("ImportContact")],1),e("a-modal",{attrs:{visible:t.visibleAgent,width:"600px",title:"Batch change handlers",centered:"",destroyOnClose:""},on:{ok:t.submitChangeAgunt,cancel:function(e){t.visibleAgent=!1}}},[e("a-select",{staticStyle:{width:"300px",margin:"20px"},attrs:{placeholder:"place select","show-search":"",optionFilterProp:"children"},model:{value:t.selectUser,callback:function(e){t.selectUser=e},expression:"selectUser"}},t._l(t.userList,(function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(" "+t._s(a.username)+" ")])})),1)],1)],1)])},o=[],i=a("5530"),s=a("2909"),r=(a("d81d"),a("d3b7"),a("7db0"),a("b7a4")),c=a("dc4c"),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"import-contact"},[e("a-upload-dragger",{attrs:{name:"file","file-list":t.fileList,remove:t.handleRemove,accept:t.accept,"before-upload":t.beforeUpload,customRequest:t.customRequest},on:{change:t.handleChange}},[e("p",{staticClass:"ant-upload-text"},[t._v(" Drag file here or browse ")])]),t._m(0)],1)},u=[function(){var t=this,e=t._self._c;return e("section",{staticClass:"section"},[e("h4",[t._v("How to prepare your file")]),e("p",[t._v("- Maximum 20M of contacts")]),e("p",[t._v("- Must be a .xlsx file with commas as separators")]),e("a",{attrs:{href:"/contactsImportTemplate.xlsx",download:"contactsImportTemplate"}},[t._v("Download an example .xlsx file")])])}],d=(a("99af"),a("fb6a"),a("a434"),a("ca00")),m={name:"ImportContact",components:{},data:function(){return{downLoading:!1,accept:".xlsx",formatType:{max:20},fileList:[]}},created:function(){},methods:{downloadTemplateFun:function(){var t=this;this.downLoading=!0,Object(c["f"])().then((function(t){Object(d["b"])(t,".xlsx","contacts")})).catch((function(e){t.$message.error(e)})).finally((function(){t.downLoading=!1}))},beforeUpload:function(t){var e=t.size/1024/1024<this.formatType.max;return this.fileList=[].concat(Object(s["a"])(this.fileList),[t]),e||this.$message.error("文件不能大于".concat(this.formatType.max,"MB!")),e},customRequest:function(t){this.uploadFile=t.file,t.onSuccess()},handleChange:function(t){var e,a=this;if(null!==t&&void 0!==t&&null!==(e=t.file)&&void 0!==e&&e.originFileObj){var n=new FormData;n.append("uploadFile",t.file.originFileObj),Object(c["g"])(n).then((function(t){a.$message.success("success")})).catch((function(t){a.fileList=[],a.$message.error(t)}))}},handleRemove:function(t){var e=this.fileList.indexOf(t),a=this.fileList.slice();a.splice(e,1),this.fileList=a}}},f=m,p=(a("267a"),a("2877")),h=Object(p["a"])(f,l,u,!1,null,"6ec2ace1",null),b=h.exports,g=a("fe74"),v=a("c24f"),y=a("23ba"),C=a("986e"),x={name:"Contacts",components:{AddContact:r["a"],ImportContact:b},data:function(){return{visibleAgent:!1,visibleImportContact:!1,visibleSearch:!1,loading:!1,columns:[{title:"UID",dataIndex:"uid",key:"uid",ellipsis:!0},{title:"Name",dataIndex:"displayName",key:"displayName",width:"150px",ellipsis:!0,scopedSlots:{customRender:"displayName"}},{title:"Channels",dataIndex:"Channels",key:"Channels",scopedSlots:{customRender:"Channels"}},{title:"Phone",dataIndex:"phone",key:"phone",ellipsis:!0},{title:"Email",dataIndex:"email",key:"email",ellipsis:!0},{title:"Extra info",dataIndex:"extraInfoVoList",key:"extraInfoVoList",scopedSlots:{customRender:"extraInfoVoList"},ellipsis:!0},{title:"Agent",dataIndex:"username",key:"username",scopedSlots:{customRender:"username"}},{title:"groupName",dataIndex:"groupName",key:"groupName",scopedSlots:{customRender:"groupName"},ellipsis:!0},{title:"createTime",dataIndex:"createTime",key:"createTime",scopedSlots:{customRender:"createTime"},ellipsis:!0},{title:"Actions",dataIndex:"address",key:"address 4",width:"150px",ellipsis:!0,scopedSlots:{customRender:"Actions"}}],clientData:[],pagination:{current:1,pageSize:10,total:0,showQuickjumper:!0,showTotal:function(t){return"Total ".concat(t," items")}},editData:{},selectedRowKeys:[],userList:[],selectUser:void 0,form:{phone:void 0,notAllot:void 0,groupId:void 0,email:void 0,uid:void 0,startAndEndTime:void 0,displayName:void 0},groupList:[],userRole:this.$store.state.user.info.userRole}},created:function(){this.init(),this.queryEnableGroupFun(),this.contactsPageFun()},computed:{rowSelection:function(){var t=this;return{onChange:function(e,a){t.selectedRowKeys=e}}},Actions:function(){return!this.$route.meta.Actions}},watch:{visibleAgent:function(){this.selectUser=void 0}},methods:{goChat:function(t){C["a"].$emit("getChat",t.id,t)},handleSubmit:function(t){t.preventDefault(),this.contactsPageFun()},result:function(){this.form={phone:void 0,notAllot:void 0,groupId:void 0,email:void 0,displayName:void 0},this.pagination.current=1,this.contactsPageFun()},queryEnableGroupFun:function(){var t=this;Object(y["d"])().then((function(e){t.groupList=e.data})).catch((function(e){t.$message.error(e)}))},init:function(){var t=this,e={username:""};Object(v["f"])(e).then((function(e){var a,n;(a=t.userList).push.apply(a,Object(s["a"])(null===(n=e.data)||void 0===n?void 0:n.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{key:t.id})}))))})).catch((function(e){t.$message.error(e)}))},openDetail:function(t){var e=t.phone||t.email,a=t;C["a"].$emit("getChatDetail",e,a)},editPage:function(t){this.visibleSearch=!0,this.editData=Object(i["a"])({},t)},addNewContact:function(){this.visibleSearch=!0,this.editData={}},changeTab:function(t){var e=t.current;this.pagination.current=e,this.contactsPageFun()},serviceOk:function(){this.visibleSearch=!1,this.contactsPageFun()},contactsPageFun:function(){var t=this;this.loading=!0;var e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,displayName:this.form.displayName,email:this.form.email,groupId:this.form.groupId,notAllot:this.form.notAllot,phone:this.form.phone,uid:this.form.uid,createTimeStart:this.form.startAndEndTime?this.form.startAndEndTime[0].format("YYYY-MM-DD 00:00:00"):"",createTimeEnd:this.form.startAndEndTime?this.form.startAndEndTime[1].format("YYYY-MM-DD 23:59:59"):""};Object(c["d"])(e).then((function(e){var a;t.clientData=null===(a=e.data.records)||void 0===a?void 0:a.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{key:t.id})})),t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},disabledDate:function(t){return t&&t>this.$moment()},deletePage:function(t){var e=this;this.$confirm({title:"tip",icon:"",cancelText:"cancel",okText:"delete",content:"After confirming the deletion, the message will be deleted",onOk:function(){e.contactsDeleteFun(t.id)}})},contactsDeleteFun:function(t){var e=this,a={id:t};Object(c["c"])(a).then((function(t){e.contactsPageFun()})).catch((function(t){e.$message.error(t)}))},submitChangeAgunt:function(){this.selectedRowKeys.length>0?this.changeUser():this.$message.warning("Please select a contact")},changeUser:function(){var t=this,e=this.userList.find((function(e){return e.id===t.selectUser})),a={customerService:e.id,from:e.username,idList:this.selectedRowKeys};Object(g["a"])(a).then((function(a){t.chatData&&(t.chatData.username=e.username),t.visibleAgent=!1,t.contactsPageFun(),t.$message.success("success")})).catch((function(e){t.$message.error(e)}))}}},k=x,A=(a("d75b"),Object(p["a"])(k,n,o,!1,null,"8ebb3760",null));e["default"]=A.exports},be53:function(t,e,a){},d75b:function(t,e,a){"use strict";a("361b")},fe74:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return s})),a.d(e,"d",(function(){return r})),a.d(e,"a",(function(){return c}));var n=a("b775"),o={editUserContacts:"/sessionInfo/editUserContacts",batchUpdateAgent:"/contacts/batchUpdateAgent",getChatStatus:"/sessionInfo/getChatStatus",getChatinfoPage:"/sessionInfo/getChatinfoPage",sendChat:"/sessionInfo/sendChat",sendTemplateChat:"/sessionInfo/sendTemplateChat"};function i(t){return Object(n["b"])({url:o.editUserContacts,method:"post",data:t})}function s(t){return Object(n["b"])({url:o.getChatStatus,method:"get",params:t})}function r(t){return Object(n["b"])({url:o.getChatinfoPage,method:"post",data:t})}function c(t){return Object(n["b"])({url:o.batchUpdateAgent,method:"post",data:t})}}}]);