(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-152b655f"],{1059:function(t,e,a){"use strict";a("58ac")},"17c7":function(t,e,a){},"309f":function(t,e,a){"use strict";a("69a6")},3900:function(t,e,a){},4516:function(t,e,a){"use strict";a("4a33")},"4a33":function(t,e,a){},"58ac":function(t,e,a){},"629b":function(t,e,a){"use strict";a("17c7")},"64af":function(t,e,a){"use strict";a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return c})),a.d(e,"d",(function(){return l}));var n=a("b775"),i={getQuickReplyPage:"/quickReply/getQuickReplyPage",addQuickReply:"/quickReply/addQuickReply",editQuickReply:"/quickReply/editQuickReply",removeQuickReplyById:"/quickReply/removeQuickReplyById"};function s(t){return Object(n["b"])({url:i.getQuickReplyPage,method:"post",data:t})}function o(t){return Object(n["b"])({url:i.addQuickReply,method:"post",data:t})}function c(t){return Object(n["b"])({url:i.editQuickReply,method:"post",data:t})}function l(t){return Object(n["b"])({url:i.removeQuickReplyById,method:"post",data:t})}},"69a6":function(t,e,a){},"8f2c":function(t,e,a){"use strict";a("3900")},ec1f:function(t,e,a){"use strict";a("b0c0");var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"info-list"},["image"===t.dataDetail.type?e("div",{staticClass:"img"},[e("img",{attrs:{src:t.dataDetail.content},on:{click:t.lookBigImg}}),e("p",{staticStyle:{"margin-top":"10px"}},[t._v(t._s(t.dataDetail.caption))])]):t._e(),"text"===t.dataDetail.type?e("div",[e("div",{staticClass:"text",domProps:{innerHTML:t._s(t.dataDetail.content)}})]):t._e(),"unsupported"===t.dataDetail.type?e("div",[e("div",{domProps:{innerHTML:t._s(t.dataDetail.content)}}),t.dataDetail.isSuccess?t._e():e("p",{staticStyle:{color:"red"}},[t._v(t._s(t.dataDetail.msg))])]):t._e(),"audio"===t.dataDetail.type?e("div",[e("audio",{attrs:{src:t.dataDetail.content,controls:""}})]):t._e(),"contacts"===t.dataDetail.type?e("div",[e("div",{staticClass:"contact-wrap"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1),e("span",[t._v(t._s(t.getContactName))])]),e("div",{staticClass:"button-wrap"},[e("a-button",{attrs:{type:"link"},on:{click:function(e){t.contactVisible=!0}}},[t._v("View all")])],1)]):t._e(),"document"===t.dataDetail.type?e("div",[e("div",[e("a-icon",{attrs:{type:"file"}}),t._v(" file ")],1),e("p"),e("a-button",{staticStyle:{padding:"0"},attrs:{type:"link"},on:{click:function(e){return t.downloadnPdf(t.dataDetail.content)}}},[t._v("Download")])],1):t._e(),"video"===t.dataDetail.type?e("div",[e("video",{staticStyle:{width:"100%"},attrs:{src:t.dataDetail.content,controls:""}})]):t._e(),"file"===t.dataDetail.type?e("div",[e("div",[e("a-icon",{attrs:{type:"file"}}),t._v(" file ")],1),e("p"),e("a-button",{staticStyle:{padding:"0"},attrs:{type:"link"},on:{click:function(e){return t.downloadnPdf(t.dataDetail.content)}}},[t._v("Download")])],1):t._e(),e("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:function(e){t.previewVisible=!1}}},[e("img",{staticStyle:{width:"100%"},attrs:{src:t.previewImage}})]),e("a-modal",{attrs:{footer:null,title:"".concat(t.dataDetail.content.length," contacts")},on:{cancel:function(e){t.contactVisible=!1}},model:{value:t.contactVisible,callback:function(e){t.contactVisible=e},expression:"contactVisible"}},[t.contactVisible?e("ul",t._l(t.dataDetail.content,(function(a,n){return e("li",{key:n,staticClass:"box-wrap"},[e("div",{staticClass:"name"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1),e("strong",[t._v(t._s(a.name.formatted_name))])]),e("ul",t._l(a.phones,(function(a,n){return e("li",{key:n,staticClass:"tel-wrap"},[e("p",[t._v(t._s(a.phone))]),e("p",{staticClass:"tel"},[t._v("TEL")])])})),0)])})),0):t._e()])],1)},i=[],s=a("53ca"),o=(a("99af"),a("caad"),a("ac1f"),a("5319"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("7858")),c={name:"InfoList",components:{},props:{dataDetail:{type:Object,default:function(){return{}}}},data:function(){return{previewVisible:!1,contactVisible:!1,previewImage:""}},computed:{getContactName:function(){var t,e,a="";return"contacts"===this.dataDetail.type&&(null===(t=this.dataDetail)||void 0===t||null===(e=t.content)||void 0===e?void 0:e.length)>0&&(a="".concat(this.dataDetail.content[0].name.formatted_name," and ").concat(this.dataDetail.content.length-1," other contact")),a}},created:function(){var t;this.isJSON(this.dataDetail.content)&&["image","contacts"].includes(this.dataDetail.type)&&(this.dataDetail.content=(null===(t=JSON.parse(this.dataDetail.content))||void 0===t?void 0:t.url)||JSON.parse(this.dataDetail.content));"text"===this.dataDetail.type&&(this.dataDetail.content=this.breakStr(this.dataDetail.content))},methods:{lookBigImg:function(t){this.previewVisible=!0,this.previewImage=t.srcElement.currentSrc},breakStr:function(t){var e=/(\r\n)|(\n)|(\↵)/g;t=t.toString().replace(e,"<br>");var a=/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g;return t=t.replace(a,"<a href='$1$2' target='_blank'>$1$2</a>"),t},isJSON:function(t){if("string"==typeof t)try{var e=JSON.parse(t);return!("object"!=Object(s["a"])(e)||!e)}catch(a){return!1}},downloadnPdf:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="blob",e.onload=function(){if(200===e.status){var t=e.response,a=document.createElement("a");a.style.display="none";var n=window.URL.createObjectURL(t);a.href=n,a.setAttribute("download","".concat(Object(o["c"])(),".pdf")),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a)}},e.send()}}},l=c,r=(a("309f"),a("2877")),d=Object(r["a"])(l,n,i,!1,null,"4dbfb761",null);e["a"]=d.exports},fe4e:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"component-wrap"},[e("header",{staticClass:"head"},[e("p",{staticClass:"head-name"},[t._v(t._s(t.chatData.displayName))])]),e("Chat",{staticClass:"chat-wrap",attrs:{chatId:t.chatId,chatData:t.chatData}})],1)},i=[],s=function(){var t=this,e=t._self._c;return e("div",[e("section",{staticClass:"section"},[e("header",[e("div",{staticClass:"section-head"},[e("div",{staticClass:"left"},[e("span",{staticClass:"name"},[t._v(t._s(t.chatData.displayName)+" : "+t._s(t.dispatchName(t.chatData.username)))]),e("a-tree-select",{staticStyle:{width:"200px"},attrs:{"show-search":"",filterTreeNode:t.filterOption,"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"Please select","tree-data":t.filteredOptions,"allow-clear":""},on:{change:t.changeUser},model:{value:t.selectUser,callback:function(e){t.selectUser=e},expression:"selectUser"}})],1),e("div",{staticClass:"right"})])]),e("a-spin",{attrs:{spinning:t.loading}},[e("section",{staticClass:"section-content"},[e("ul",{ref:"new_message",staticClass:"content-list-wrap",attrs:{id:"new_message"},on:{scroll:t.scroll}},[t.isEnd?e("p",{staticStyle:{"text-align":"center","margin-bottom":"20px",color:"#bbb"}},[t._v("No more data.")]):t._e(),t._l(t.chatList,(function(a){return e("li",{key:a.id},[0===a.isSend?e("div",{staticClass:"content-list"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1),e("div",{staticClass:"content-wrap"},[e("InfoList",{staticClass:"text",attrs:{dataDetail:a}}),e("p",{staticClass:"time"},[t._v(t._s(t._f("changeTime")(a.createTime)))])],1)]):t._e(),3===a.isSend?e("div",{staticClass:"content-center"},[t._v(t._s(a.content))]):t._e(),1===a.isSend?e("div",{staticClass:"content-list right"},[e("div",{staticClass:"content-wrap"},[e("InfoList",{staticClass:"text",attrs:{dataDetail:a}}),e("p",{staticClass:"time"},[t._v(t._s(t._f("changeTime")(a.createTime)))]),a.isSuccess?t._e():e("p",{staticClass:"time",staticStyle:{color:"red","font-size":"14px"}},[t._v(t._s(a.msg))])],1),e("div",{staticClass:"person-wrap"},[e("div",{staticClass:"message right"},[t._v(" "+t._s(a.from)+" ")]),t._v(" "+t._s(a.from)+" ")])]):t._e()])}))],2),e("footer",{staticClass:"section-footer"},[t.hasSend?e("div",{staticClass:"sendInfo"},[e("div",[t.has24Hour?e("div",{staticClass:"tip"},[t._v(" You've reached your 24-hour limit on Whatsapp "),e("br"),t._v(" There is a 24-hour window to chat to a customer without paying additional service fees. You can keep in touch by sending an approved WhatsApp template message. ")]):e("a-textarea",{attrs:{placeholder:"Reply",autoSize:{minRows:5,maxRows:5}},model:{value:t.sendContent,callback:function(e){t.sendContent=e},expression:"sendContent"}})],1),e("div",{staticClass:"footer-info"},[e("a-tooltip",{attrs:{title:"Fast Reply"}},[e("a-icon",{staticClass:"primaryColor",attrs:{type:"credit-card"},on:{click:function(e){t.visibleFastReply=!0}}})],1),e("a-tooltip",{attrs:{title:"Emojis"}},[e("a-icon",{attrs:{type:"smile",theme:"twoTone"},on:{click:function(e){t.visibleEmoji=!0}}})],1),e("a-upload",{attrs:{"list-type":"picture",multiple:"",beforeUpload:t.beforeUpload,accept:t.accept,showUploadList:!1,customRequest:t.handleChange}},[e("a-tooltip",{attrs:{title:"file"}},[e("a-icon",{staticClass:"primaryColor",attrs:{type:"paper-clip"}})],1)],1),e("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(e){t.visibleSearch=!0}}},[t._v("Choose Template")]),t.has24Hour?t._e():e("a-button",{attrs:{type:"primary",loading:t.sendLoading},on:{click:t.sendChatFun}},[t._v("Send")])],1)]):t._e()])])])],1),e("a-modal",{attrs:{visible:t.visibleNote,title:"Add note",centered:"",okText:"Save note"},on:{cancel:function(e){t.visibleNote=!1},ok:t.sendChatFun}},[e("a-textarea",{attrs:{autoSize:{minRows:7,maxRows:7},placeholder:"Leave an internal note for this ticket – only you and other agents will see it."},model:{value:t.sendContent,callback:function(e){t.sendContent=e},expression:"sendContent"}})],1),e("a-modal",{attrs:{width:"600px",footer:null,title:"Choose a template",centered:""},on:{cancel:function(e){t.visibleSearch=!1}},model:{value:t.visibleSearch,callback:function(e){t.visibleSearch=e},expression:"visibleSearch"}},[e("ModelChat",{on:{cancel:function(e){t.visibleSearch=!1},serviceOk:t.serviceOk,sendTemplate:t.sendChatFun}})],1),e("a-modal",{attrs:{width:"600px",footer:null,centered:""},on:{cancel:function(e){t.visibleEmoji=!1}},model:{value:t.visibleEmoji,callback:function(e){t.visibleEmoji=e},expression:"visibleEmoji"}},[e("Emoji",{on:{cancel:function(e){t.visibleEmoji=!1},sendMessage:t.sendEmojiMessage}})],1),e("a-modal",{attrs:{width:"600px",footer:null,title:"Fast Reply",centered:""},on:{cancel:function(e){t.visibleFastReply=!1}},model:{value:t.visibleFastReply,callback:function(e){t.visibleFastReply=e},expression:"visibleFastReply"}},[e("FastReplyModel",{on:{copyContent:t.copyContent}})],1)],1)},o=[],c=a("5530"),l=a("2909"),r=(a("a9e3"),a("b0c0"),a("ac1f"),a("5319"),a("d3b7"),a("159b"),a("d81d"),a("fe74")),d=a("c24f"),u=a("986e"),h=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({attrs:{loading:t.loading,footer:!1},on:{cancle:function(e){return t.$emit("cancel")},serviceOk:t.serviceOk}},"CommonModal",t.source,!1),[t.isSelect?e("a-spin",{attrs:{spinning:t.spinLoading}},[e("ul",{staticClass:"new-wrap"},t._l(t.clientData,(function(a,n){return e("li",{key:n,class:{disable:"APPROVED"!==a.status},on:{click:function(e){return t.sendNew(a)}}},[e("h3",[t._v(t._s(a.name))]),t._l(a.components,(function(a,n){return e("p",{key:n,domProps:{innerHTML:t._s(a.text)}})}))],2)})),0)]):e("div",{staticClass:"send-box"},[e("ul",[e("li",{staticClass:"content-list"},[t._v(" "+t._s(t.selectDataText)+" "),e("p",{staticClass:"time"},[t._v(t._s(t.time))])]),e("ul",{staticClass:"input-list-wrap"},t._l(t.getInputList,(function(a,n){return e("li",{key:n},[e("div",{staticClass:"title"},[t._v(t._s(a.text))]),e("a-input",{model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"item.value"}})],1)})),0)]),e("footer",{staticClass:"footer"},[e("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(e){t.isSelect=!0}}},[t._v("Back")]),e("a-button",{attrs:{type:"primary",loading:t.sendLoading},on:{click:t.sendTemplate}},[t._v("Send")])],1)]),e("a-modal",{attrs:{visible:t.visibleNote,title:"select language",centered:""},on:{cancel:function(e){t.visibleNote=!1},ok:t.sendChatFun}},[e("a-select",{staticStyle:{width:"100%",padding:"20px","box-sizing":"border-box"},attrs:{placeholder:"place select"},model:{value:t.selectLang,callback:function(e){t.selectLang=e},expression:"selectLang"}},t._l(t.selectData.language,(function(a){return e("a-select-option",{key:a,attrs:{value:a}},[t._v(" "+t._s(t.lang[a])+" ")])})),1)],1)],1)},p=[],f=(a("4de4"),a("4d63"),a("25f0"),a("466d"),a("498a"),a("2a86")),m=a("ffe6"),v={name:"ModelChat",components:{CommonModal:f["a"]},props:{editData:{type:Object,default:function(){return{}}}},data:function(){return{source:{title:""},visibleNote:!1,lang:m["a"],selectLang:void 0,loading:!1,clientData:[],sendLoading:!1,spinLoading:!1,selectData:{},isSelect:!0,time:this.$moment().format("HH:mm"),getInputList:[],selectDataText:""}},created:function(){this.init()},methods:{init:function(){var t=this,e={templatesName:""};this.spinLoading=!0,Object(d["i"])(e).then((function(e){var a,n=[],i=function(){var a={language:""};e.data[s].forEach((function(e,n){var i="";i=0===n?"".concat(e.language):",".concat(e.language),a=Object(c["a"])(Object(c["a"])({},e),{},{updatedAt:t.$moment(e.updatedAt).calendar(),language:a.language+=i})})),n.push(a)};for(var s in e.data)i();t.clientData=null===(a=n.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{key:t.name,language:t.language.split(",")})})))||void 0===a?void 0:a.filter((function(t){return"APPROVED"===t.status}))})).catch((function(e){t.$message.error(e)})).finally((function(){t.spinLoading=!1}))},getParams:function(){var t={channels:void 0,country:this.form.country,displayName:"",email:"email"===this.form.type?this.form.channels:"",fistName:this.form.fistName,lastName:this.form.lastName,phone:"phone"===this.form.type?this.form.channels:"",profileName:this.form.profileName,tag:void 0,extraInfoVoList:this.form.extraInfoVoList};return t},serviceOk:function(){},sendNew:function(t){var e=this;if("APPROVED"===t.status){this.isSelect=!1,this.selectData=t,this.selectLang=void 0;var a=0;this.selectData.components.forEach((function(t,n){if("BODY"===t.type){e.selectDataText=t.text;var i=new RegExp("}}","g"),s=t.text.match(i);a=s?s.length:0}}));for(var n=[],i=0;i<a;i++)n.push({text:"Custom field{{"+(i+1)+"}}",value:""});this.getInputList=n}},sendTemplate:function(){var t=this;if(this.getInputList)for(var e=0;e<this.getInputList.length;e++){var a,n=this.getInputList[e];if(null===(a=n.value)||void 0===a||!a.trim())return void this.$message.warning("".concat(n.text,"is required"));this.selectDataText.replace("{{".concat(e+1,"}}"),n.value)}this.selectData.language.length>1&&!this.selectLang?this.visibleNote=!0:(this.visibleNote=!1,this.sendLoading=!0,this.$emit("sendTemplate",{content:this.selectDataText,language:this.language||this.selectData.language[0],mane:this.selectData.name,params:this.getInputList.map((function(t){return t.value}))}),setTimeout((function(){t.sendLoading=!1}),1e3))},sendChatFun:function(){this.selectLang?this.visibleNote=!1:this.$message.warning("place select language")}}},g=v,b=(a("629b"),a("2877")),y=Object(b["a"])(g,h,p,!1,null,"1fe82fdf",null),C=y.exports,_=a("ec1f"),k=a("e326"),D=function(){var t=this,e=t._self._c;return e("CommonModal",t._b({attrs:{loading:t.loading,footer:!1},on:{cancle:function(e){return t.$emit("cancel")}}},"CommonModal",t.source,!1),[e("a-table",{staticClass:"table",attrs:{customRow:t.rowClick,columns:t.columns,"data-source":t.clientData,loading:t.loading,scroll:{y:500},pagination:t.pagination},on:{change:t.changeTab},scopedSlots:t._u([{key:"extraInfoVoList",fn:function(a){return a?e("div",{},[e("a-tooltip",[e("ul",{attrs:{slot:"title"},slot:"title"},t._l(a,(function(a,n){return e("li",{key:n},[e("Span",[t._v(t._s(a.category)+" "+t._s(a.topic))])],1)})),0),e("a-button",{attrs:{type:"link"}},[t._v(t._s(a.length)+"+topics")])],1)],1):t._e()}},{key:"Actions",fn:function(a,n){return e("div",{},[e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.editPage(n)}}},[t._v("Edit")]),t._v("   "),e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.deletePage(n)}}},[t._v("Delete")])],1)}}],null,!0)},[e("div",{attrs:{slot:"Channels"},slot:"Channels"},[e("div",{staticClass:"message"},[e("a-icon",{attrs:{type:"message"}})],1)])])],1)},w=[],S=(a("dc4c"),a("64af")),x={name:"FastReplyModel",components:{CommonModal:f["a"]},props:{editData:{type:Object,default:function(){return{}}}},data:function(){return{source:{title:""},loading:!1,columns:[{title:"content",dataIndex:"content",key:"content",scopedSlots:{customRender:"content"}},{title:"createTime",dataIndex:"createTime",key:"createTime",scopedSlots:{customRender:"createTime"}}],clientData:[],pagination:{current:1,pageSize:10,total:0}}},created:function(){this.contactsPageFun()},methods:{rowClick:function(t,e){var a=this;return{on:{click:function(e){a.$emit("copyContent",t.content)}}}},changeTab:function(t){var e=t.current;this.pagination.current=e,this.contactsPageFun()},contactsPageFun:function(){var t=this;this.loading=!0;var e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize};Object(S["c"])(e).then((function(e){var a;t.clientData=null===(a=e.data.records)||void 0===a?void 0:a.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{key:t.id})})),t.pagination.total=e.data.total})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))}}},O=x,j=(a("4516"),Object(b["a"])(O,D,w,!1,null,"5abda069",null)),L=j.exports,I=a("7858"),T=a("c1df"),R=a.n(T),$={name:"Chat",components:{ModelChat:C,InfoList:_["a"],Emoji:k["a"],FastReplyModel:L},props:{chatId:{type:[String,Number],default:""},chatData:{type:Object,default:function(){return{}}}},data:function(){return{accept:".pdf,.mp3,.mp4,.mov,.jpg,.png,.jpeg",visibleSearch:!1,visibleFastReply:!1,visibleEmoji:!1,visibleNote:!1,sendLoading:!1,chatList:[],userList:[],pagination:{current:1,pageSize:20,total:0},loading:!1,isEnd:!1,sendContent:"",username:this.$store.state.user.info.username,userId:this.$store.state.user.info.id,selectUser:void 0,hasSend:!1,has24Hour:!1,height:0,formatType:{max:10}}},watch:{chatData:{handler:function(){var t;null!==(t=this.chatData)&&void 0!==t&&t.id?(this.selectUser=void 0,this.isEnd=!1,this.pagination.current=1,this.chatList=[],this.init(),this.getChatStatusFun()):this.$router.push({name:"Empty"})},immediate:!0,deep:!0}},filters:{changeTime:function(t){return R()(t).format("YYYY-MM-DD HH:mm:ss")}},created:function(){this.contactsPageFun(),u["a"].$on("sendMessage",this.sendMessageFun)},computed:{filteredOptions:function(){return this.userList}},destroyed:function(){u["a"].$off("sendMessage",this.sendMessageFun)},methods:{filterOption:function(t,e){return e.key.indexOf(t)>-1},copyContent:function(t){this.sendContent+=t,this.visibleFastReply=!1},sendEmojiMessage:function(t){this.visibleEmoji=!1,this.sendContent+=t},serviceOk:function(){},dispatchName:function(t){return t===this.$store.state.user.info.username?"you":t||"No Assigned"},handleChange:function(t){var e=this,a=t.file.name.lastIndexOf("."),n=t.file.name.substr(a+1),i=t.file.name.substring(a+1),s=Object(I["c"])()+i;I["b"].put(I["a"]+s,t.file).then((function(t){var a=t.url;e.isAssetTypeAnImage(n)&&e.sendChatFun({},"image",a),"mp3"===i&&e.sendChatFun({},"audio",a),"mp4"!==i&&"mov"!==i||e.sendChatFun({},"video",a),"pdf"===i&&e.sendChatFun({},"document",a)})).catch((function(t){e.$message.error(t)}))},beforeUpload:function(t){var e=t.size/1024/1024<this.formatType.max;return e||this.$message.error("文件不能大于".concat(this.formatType.max,"MB!")),e},sendMessageFun:function(t){var e,a=this;if(t&&t.oldData.cId===(null===(e=this.chatData)||void 0===e?void 0:e.id)){var n,i,s=/\n/gi;t.oldData.content=(null===(n=t.oldData.content)||void 0===n?void 0:n.replace(s,"<br/>"))||(null===(i=item)||void 0===i?void 0:i.content),this.chatList.push(t.oldData),this.visibleSearch=!1,this.sendLoading=!1,this.$nextTick((function(){var t=a.$el.querySelector("#new_message");t.scrollTop=null===t||void 0===t?void 0:t.scrollHeight,a.getChatStatusFun()}))}},scroll:function(t){var e=t.target,a=e.scrollTop;e.clientHeight,e.scrollHeight;if(0===a&&!this.isEnd){if(this.loading)return;this.pagination.current++,this.init()}},getChatStatusFun:function(){var t=this,e={contactsId:this.chatData.id};Object(r["c"])(e).then((function(e){t.userId==e.data.customerService?t.hasSend=!0:t.hasSend=!1,e.data.hourNum>=24?t.has24Hour=!0:t.has24Hour=!1})).catch((function(e){t.$message.error(e)}))},addData:function(){this.loading||(this.pagination.current++,this.init())},changeUser:function(t){var e,a=this,n="";this.userList.forEach((function(e){e.children.forEach((function(e){e.value==t&&(n=e)}))}));var i={customerService:n.value,from:n.title,id:null===(e=this.chatData)||void 0===e?void 0:e.id,to:this.chatId};Object(r["b"])(i).then((function(t){u["a"].$emit("updatePage")})).catch((function(t){a.$message.error(t)}))},init:function(){var t=this,e={currentPage:this.pagination.current,pageSize:this.pagination.pageSize,id:this.chatId};this.loading=!0,Object(r["d"])(e).then((function(e){var a,n,i,s=/\n/gi;if((a=t.chatList).unshift.apply(a,Object(l["a"])(null===(n=e.data.records)||void 0===n?void 0:n.map((function(t){var e;return Object(c["a"])(Object(c["a"])({},t),{},{key:t.id,content:(null===t||void 0===t||null===(e=t.content)||void 0===e?void 0:e.replace(s,"<br/>"))||(null===t||void 0===t?void 0:t.content)})})).reverse())),(null===(i=e.data)||void 0===i?void 0:i.records.length)<t.pagination.pageSize&&(t.isEnd=!0),t.pagination.total=e.data.total,1===t.pagination.current)t.$nextTick((function(){var e=t.$el.querySelector("#new_message");e.scrollTop=e.scrollHeight}));else{var o=t,r=t.$el.querySelector("#new_message").scrollHeight;t.$nextTick((function(){var e=t.$el.querySelector("#new_message"),a=o.height?r-o.height:-50;o.height=o.$refs.new_message.scrollHeight,e.scrollTop=o.height-r+a}))}})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},contactsPageFun:function(){var t=this,e={};Object(d["h"])(e).then((function(e){if(e.data){var a=[];for(var n in e.data)a.push({title:n,value:n,selectable:!1,key:n,children:e.data[n].map((function(t){return{title:t.username,value:t.id,key:t.username}}))});t.userList=a}})).catch((function(e){t.$message.error(e)}))},sendChatFun:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i={};i=this.visibleSearch?Object(c["a"])(Object(c["a"])({},e),{},{id:this.chatId,type:a}):{contactsId:this.chatData.id,content:n||this.sendContent,from:this.$store.state.user.info.username,id:this.chatId,type:a};var s={userName:this.$store.state.user.info.username,messageObject:i,isTemplate:this.visibleSearch,tenantId:this.$store.state.user.info.tenantId};this.sendLoading=!0,u["a"].$emit("publishMessage",JSON.stringify(s)),this.sendContent="",setTimeout((function(){t.sendLoading=!1}),2e3)},isAssetTypeAnImage:function(t){return-1!==["png","jpg","jpeg"].indexOf(t.toLowerCase())}}},N=$,F=(a("1059"),Object(b["a"])(N,s,o,!1,null,"0990a0d2",null)),E=F.exports,P={name:"Tickets",components:{Chat:E},data:function(){return{}},computed:{chatId:function(){return this.$store.state.chatWrap.chatId},chatData:function(){return this.$store.state.chatWrap.chatData||{}}},created:function(){},methods:{}},M=P,U=(a("8f2c"),Object(b["a"])(M,n,i,!1,null,"5520ae87",null));e["default"]=U.exports},fe74:function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return o})),a.d(e,"d",(function(){return c})),a.d(e,"a",(function(){return l}));var n=a("b775"),i={editUserContacts:"/sessionInfo/editUserContacts",batchUpdateAgent:"/contacts/batchUpdateAgent",getChatStatus:"/sessionInfo/getChatStatus",getChatinfoPage:"/sessionInfo/getChatinfoPage",sendChat:"/sessionInfo/sendChat",sendTemplateChat:"/sessionInfo/sendTemplateChat"};function s(t){return Object(n["b"])({url:i.editUserContacts,method:"post",data:t})}function o(t){return Object(n["b"])({url:i.getChatStatus,method:"get",params:t})}function c(t){return Object(n["b"])({url:i.getChatinfoPage,method:"post",data:t})}function l(t){return Object(n["b"])({url:i.batchUpdateAgent,method:"post",data:t})}}}]);