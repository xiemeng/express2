(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-055ec523"],{"0561":function(t,e,i){},"14aa":function(t,e,i){"use strict";i("0561")},"1da1":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));i("d3b7");function a(t,e,i,a,n,r,s){try{var o=t[r](s),c=o.value}catch(l){return void i(l)}o.done?e(c):Promise.resolve(c).then(a,n)}function n(t){return function(){var e=this,i=arguments;return new Promise((function(n,r){var s=t.apply(e,i);function o(t){a(s,n,r,o,c,"next",t)}function c(t){a(s,n,r,o,c,"throw",t)}o(void 0)}))}}},"5a4a":function(t,e,i){},"5fb8":function(t,e,i){},"746d":function(t,e,i){"use strict";i("5a4a")},"8bac":function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return s})),i.d(e,"g",(function(){return o})),i.d(e,"h",(function(){return c})),i.d(e,"j",(function(){return l})),i.d(e,"e",(function(){return u})),i.d(e,"f",(function(){return d})),i.d(e,"a",(function(){return m})),i.d(e,"d",(function(){return p})),i.d(e,"i",(function(){return f}));var a=i("b775"),n={getList:"/marketing/luckyActivity/list",addSave:"/marketing/luckyActivity/save",updateList:"/marketing/luckyActivity/update",deleteList:"/marketing/luckyActivity/delete",getInfo:"/marketing/luckyActivity/info",uploadFile:"/marketing/luckActivityPrize/uploadFile",prizeInfo:"/marketing/luckActivityPrize/prizeInfo",numberOfPeopleInfo:"/marketing/luckyActivity/numberOfPeopleInfo",customerInfo:"/marketing/luckyActivity/customerInfo",cancelAfterVerification:"/marketing/luckyActivity/cancelAfterVerification"};function r(t){return Object(a["b"])({url:n.cancelAfterVerification,method:"post",data:t})}function s(t){return Object(a["b"])({url:n.customerInfo,method:"get",params:t})}function o(t){return Object(a["b"])({url:n.numberOfPeopleInfo,method:"get",params:t})}function c(t){return Object(a["b"])({url:n.prizeInfo,method:"get",params:t})}function l(t){return Object(a["b"])({url:n.uploadFile,method:"post",data:t})}function u(t){return Object(a["b"])({url:n.getInfo,method:"get",params:t})}function d(t){return Object(a["b"])({url:n.getList,method:"get",params:t})}function m(t){return Object(a["b"])({url:n.addSave,method:"post",data:t})}function p(t){return Object(a["b"])({url:n.deleteList,method:"post",data:t})}function f(t){return Object(a["b"])({url:n.updateList,method:"post",data:t})}},b5a4:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"createLuckyDraw"},[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:"".concat(t.isAddText,"抽奖活动")},on:{back:function(e){return t.$router.go(-1)}}}),e("div",{staticClass:"box"},[e("div",{staticClass:"step"},[e("a-steps",{staticClass:"steps-item",attrs:{current:t.currentNum,size:"small"}},[e("a-step",{attrs:{title:"抽奖活动设置"}}),e("a-step",{attrs:{title:"奖品设置"}})],1)],1),e("section",{directives:[{name:"show",rawName:"v-show",value:"0"==t.currentNum,expression:"currentNum=='0'"}],staticClass:"section"},[e("p",{staticClass:"base-info"},[t._v("抽奖活动设置")]),e("a-form",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[e("a-form-item",{attrs:{label:"活动模板：",required:""}},[e("a-radio",{attrs:{checked:!0}},[t._v("转盘")])],1),e("a-form-item",{attrs:{label:"活动名称：",required:""}},[e("a-input",{staticStyle:{width:"300px"},attrs:{disabled:t.disabledflag,placeholder:"请输入活动名称"},model:{value:t.activityName,callback:function(e){t.activityName=e},expression:"activityName"}})],1),e("a-form-item",{attrs:{label:"活动说明：",required:""}},[e("div",{staticClass:"textarea-box textarea"},[e("a-textarea",{attrs:{placeholder:"1.抽奖活动需先关注添加企业微信员工哦~\n2.中奖后请根据提示领取奖品\n3.活动起劲如有疑问欢迎咨询企业微信员工~",maxLength:500},model:{value:t.activityExplain,callback:function(e){t.activityExplain=e},expression:"activityExplain"}}),e("div",{staticClass:"word-count"},[t._v(t._s(t.activityExplain.length)+"/500 ")])],1)]),e("a-form-item",{attrs:{label:"结束时间：",required:""}},[e("div",{staticClass:"activeTime"},[e("span",[t._v("当奖品全部抽完活动自动结束")]),e("a-radio-group",{model:{value:t.permanentValidity,callback:function(e){t.permanentValidity=e},expression:"permanentValidity"}},[e("a-radio",{attrs:{value:1}},[t._v("永久有效")]),e("a-radio",{attrs:{value:0}},[t._v("自定义活动时间")])],1),"0"==t.permanentValidity?e("div",{staticClass:"time-range"},[e("a-date-picker",{staticStyle:{width:"200px"},attrs:{format:"YYYY-MM-DD HH:mm:ss",placeholder:"请输入活动开始时间","show-time":{defaultValue:t.moment("00:00:00","HH:mm:ss")},disabledDate:t.disabledDate},on:{change:t.changeStartDate},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),e("div",{staticClass:"dv"},[t._v("至")]),e("a-date-picker",{staticStyle:{width:"200px"},attrs:{format:"YYYY-MM-DD HH:mm:ss",placeholder:"请输入活动结束时间","show-time":{defaultValue:t.moment("00:00:00","HH:mm:ss")},disabledDate:t.disabledDate},on:{change:t.changeendDate},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1):t._e()],1)])],1),e("div",{staticClass:"base-info"},[e("span",[t._v("客户标签设置")]),e("a-switch",{staticClass:"switch",attrs:{size:"small"},model:{value:t.openCustomerTag,callback:function(e){t.openCustomerTag=e},expression:"openCustomerTag"}}),e("p",[t._v("最多可设置2个标签规则，已设置的标签规则不能进行修改")])],1),e("a-form",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[t.openCustomerTag?e("div",{staticClass:"content-top-tips"},[e("a-icon",{staticClass:"bell",attrs:{type:"bell"}}),t._v("企业微信接口限制，仅支持为已添加企业员工的客户打标签")],1):t._e(),t.openCustomerTag?e("a-form-item",{attrs:{label:"客户标签："}},[e("div",{staticClass:"labelBox"},[e("div",{staticClass:"box"},[e("div",{staticClass:"rule"},[t._v("规则：")]),t._l(t.customerTagRuleList,(function(i,a){return e("div",{key:a},[e("div",{staticClass:"flex"},[e("a-checkbox",{staticClass:"check-box",attrs:{disabled:i.prohibit},model:{value:i.check,callback:function(e){t.$set(i,"check",e)},expression:"info.check"}}),t._v("为 "),e("span",{staticClass:"label-wrap"},[e("a-dropdown",{attrs:{trigger:["click"],disabled:!0}},[e("a",{staticClass:"ant-dropdown-link",on:{click:function(t){return t.preventDefault()}}},[t._v(" "+t._s("0"==a?"已参加活动":"已抽中奖品")+" "),e("a-icon",{attrs:{type:"down"}})],1),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.checkadmin("0")}}},[t._v("已参加活动")])]),e("a-menu-item",[e("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.checkadmin("1")}}},[t._v("已抽中奖品")])])],1)],1)],1),t._v("的客户，打上 "),e("div",{staticClass:"use-person",on:{click:function(e){return t.visibleShow(a,i.tagList,i.prohibit)}}},[e("ul",{staticClass:"a-line-omit"},[t._l(i.tagList,(function(i,a){return e("li",{key:a,staticClass:"a-line-omit"},[e("a-tag",[t._v(t._s(i.tagName))])],1)})),i.tagList.length<1?e("p",{staticClass:"font-color-black-25"},[t._v("请选择标签")]):t._e()],2),i.tagList.length>2?e("span",{staticClass:"omit"},[t._v("等"+t._s(i.tagList.length)+"个标签")]):t._e(),e("div",{staticClass:"icon"},[i.tagList.length<1?e("a-icon",{attrs:{type:"down"}}):t._e(),i.tagList.length>0&&!i.prohibit?e("a-icon",{staticClass:"close-circle",attrs:{type:"close-circle"},on:{click:function(e){return e.stopPropagation(),t.cleanTag(a)}}}):t._e()],1)]),t._v("标签 "),e("br")],1),e("div",{staticClass:"flex-btm"},[e("span",[t._v("并添加评分：")]),e("a-switch",{attrs:{size:"small",disabled:i.prohibit},model:{value:i.flag,callback:function(e){t.$set(i,"flag",e)},expression:"info.flag"}}),e("span",{staticClass:"p-d"},[t._v("给Ta添加")]),e("a-input-number",{attrs:{min:1,precision:0,disabled:i.prohibit,max:100},model:{value:i.score,callback:function(e){t.$set(i,"score",e)},expression:"info.score"}}),e("span",{staticClass:"p-d"},[t._v("分")])],1)])}))],2)])]):t._e()],1),e("a-button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(e){return t.nextBtn()}}},[t._v("下一步")])],1),e("section",{directives:[{name:"show",rawName:"v-show",value:"1"==t.currentNum,expression:"currentNum=='1'"}],staticClass:"section"},[e("prizeSetting",{attrs:{firstObj:t.firstObj,secondDetail:t.secondDetail},on:{loadingStart:t.loadingStart,loadingEnd:t.loadingEnd,backBtnClick:t.backBtnClick}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.spinShow,expression:"spinShow"}],staticClass:"spin-box"},[e("div",{staticClass:"mask"}),e("a-spin",{staticClass:"spin"})],1)]),e("a-modal",{attrs:{footer:null,centered:""},model:{value:t.visibleSelectTag,callback:function(e){t.visibleSelectTag=e},expression:"visibleSelectTag"}},[e("SelectTags",{attrs:{selectTagList:t.tagList},on:{serviceOk:t.pitchTag}})],1)],1)},n=[],r=(i("a9e3"),i("d81d"),i("a15b"),i("d3b7"),i("0481"),i("4069"),i("4de4"),i("c1df")),s=i.n(r),o=i("c844"),c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"prizeSetting"},[t._m(0),e("div",{staticClass:"setting-box"},[e("div",[e("table",[t._m(1),e("tbody",t._l(t.activityPrizeList,(function(i,a){return e("tr",{key:a},[e("td",["0"==a?e("div",[t._v("谢谢参与")]):e("a-input",{staticClass:"drawname",attrs:{placeholder:"奖品名称"},model:{value:i.prizeName,callback:function(e){t.$set(i,"prizeName",e)},expression:"item.prizeName"}})],1),e("td",["0"==a?e("div",[t._v("-")]):e("a-input-number",{staticClass:"darwNumber",attrs:{precision:0,min:0},model:{value:i.prizeCount,callback:function(e){t.$set(i,"prizeCount",e)},expression:"item.prizeCount"}})],1),e("td",[e("a-input-number",{staticClass:"darwNumber",attrs:{min:0,max:100,precision:0},on:{blur:function(e){return t.probability(e,a)}},model:{value:i.prizeProbability,callback:function(e){t.$set(i,"prizeProbability",e)},expression:"item.prizeProbability"}}),t._v(" %")],1),e("td",[e("UpDateImg",{attrs:{url:i.prizeImage,title:"上传图片"},model:{value:i.fileUpateobj,callback:function(e){t.$set(i,"fileUpateobj",e)},expression:"item.fileUpateobj"}})],1),e("td",["0"==a?e("div",[t._v("-")]):e("div",{staticClass:"delete",on:{click:function(e){return t.deleteBtn(a)}}},[t._v("删除")])])])})),0)]),e("span",{staticClass:"add-btn"},[e("a-icon",{staticClass:"icon",attrs:{type:"plus-circle"},on:{click:t.sureDraw}}),e("span",{on:{click:t.sureDraw}},[t._v("添加奖项")]),e("span",{staticClass:"more"},[t._v("最多设置8个奖项，所有奖品项需设置成偶数项")])],1)]),e("img",{staticClass:"legend",attrs:{src:"",alt:""}})]),e("div",{staticClass:"realTime"},[e("a-switch",{staticClass:"switch",attrs:{size:"small",disabled:!0},model:{value:t.showWinPrize,callback:function(e){t.showWinPrize=e},expression:"showWinPrize"}}),e("p",[t._v("实时展示已中奖客户记录")])],1),e("a-form",{attrs:{"label-col":{span:2},"wrapper-col":{span:12}}},[e("a-form-item",{attrs:{label:"兑奖设置",required:""}},[e("div",{staticClass:"content"},[e("span",{staticClass:"txt"},[t._v("当客户完成任务后，联系客服领取奖励，请上传客服二维码")]),e("UpDateImg",{attrs:{url:t.staffQrCode,title:"上传图片"},model:{value:t.cusServiceObj,callback:function(e){t.cusServiceObj=e},expression:"cusServiceObj"}})],1)])],1),e("p",{staticClass:"base-info"},[t._v("抽奖限制设置")]),e("a-form",[e("a-form-item",{staticClass:"form-flex",attrs:{label:"总抽奖机会",required:""}},[e("div",{staticClass:"flex"},[e("a-radio-group",{staticClass:"radioGroup",attrs:{name:"radioGroup"},on:{change:t.allRadioChange},model:{value:t.allLuckyTimesState,callback:function(e){t.allLuckyTimesState=e},expression:"allLuckyTimesState"}},[e("a-radio",{attrs:{value:0}},[t._v("不限")]),e("a-radio",{attrs:{value:1}},[t._v("限制")])],1),"1"==t.allLuckyTimesState?e("span",{staticClass:"r-t"},[t._v("每人最多有"),e("a-input-number",{staticClass:"inputNum",attrs:{precision:0,min:0,max:100},on:{change:t.allLuckychange},model:{value:t.allLuckyTimes,callback:function(e){t.allLuckyTimes=e},expression:"allLuckyTimes"}}),t._v("次抽奖机会")],1):t._e()],1)]),e("a-form-item",{staticClass:"form-flex",attrs:{label:"每日抽奖机会",required:""}},[e("div",{staticClass:"flex"},[e("a-radio-group",{staticClass:"radioGroup",attrs:{name:"radioGroup","default-value":1}},[e("a-radio",{attrs:{value:1}},[t._v("限制")])],1),e("span",{staticClass:"r-t"},[t._v("每人每天最多有"),e("a-input-number",{staticClass:"inputNum",attrs:{precision:0,min:0,max:100},on:{change:t.eveDaychange},model:{value:t.eveDayLuckyTimes,callback:function(e){t.eveDayLuckyTimes=e},expression:"eveDayLuckyTimes"}}),t._v("次抽奖机会")],1)],1)])],1),e("p",{staticClass:"base-info"},[t._v("中奖限制设置")]),e("a-form",[e("a-form-item",{staticClass:"form-flex",attrs:{label:"每人总中奖次数",required:""}},[e("div",{staticClass:"flex"},[e("a-radio-group",{staticClass:"radioGroup",attrs:{name:"radioGroup","default-value":1}},[e("a-radio",{attrs:{value:1}},[t._v("限制")])],1),e("span",{staticClass:"r-t"},[t._v("用户每人最多中奖"),e("a-input-number",{staticClass:"inputNum",attrs:{precision:0,min:1,max:100},on:{change:t.evePeopleChane},model:{value:t.evePeopleWinTimes,callback:function(e){t.evePeopleWinTimes=e},expression:"evePeopleWinTimes"}}),t._v("次")],1)],1)]),e("a-form-item",{staticClass:"form-flex",attrs:{label:"每人每天中奖次数",required:""}},[e("div",{staticClass:"flex"},[e("a-radio-group",{staticClass:"radioGroup",attrs:{name:"radioGroup"},model:{value:t.evePeopleDayWinTimesState,callback:function(e){t.evePeopleDayWinTimesState=e},expression:"evePeopleDayWinTimesState"}},[e("a-radio",{attrs:{value:0}},[t._v("不限")]),e("a-radio",{attrs:{value:1}},[t._v("限制")])],1),"1"==t.evePeopleDayWinTimesState?e("span",{staticClass:"r-t"},[t._v("每人每天最多中奖"),e("a-input-number",{staticClass:"inputNum",attrs:{precision:0,min:1,max:100},on:{change:t.evePeopleDaychange},model:{value:t.evePeopleDayWinTimes,callback:function(e){t.evePeopleDayWinTimes=e},expression:"evePeopleDayWinTimes"}}),t._v("次")],1):t._e()],1)])],1),e("div",{staticClass:"flex-bottom"},[e("a-button",{attrs:{type:"primary"},on:{click:t.backBtn}},[t._v("上一步")]),e("a-button",{staticStyle:{width:"150px"},attrs:{type:"primary",loading:t.tableLoading},on:{click:t.submitBtn}},[t._v(t._s(t.isAddText)+"抽奖活动")])],1),e("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:t.handleCancel}},[e("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:t.previewImage}})])],1)},l=[function(){var t=this,e=t._self._c;return e("p",{staticClass:"base-info"},[t._v("奖品设置"),e("span",[t._v("设置的所有奖项中奖概率总和应等于100%")])])},function(){var t=this,e=t._self._c;return e("thead",[e("th",[e("span",[t._v("*")]),t._v("奖品设置")]),e("th",[e("span",[t._v("*")]),t._v("奖品总数")]),e("th",[e("span",[t._v("*")]),t._v("中奖概率")]),e("th",{staticStyle:{width:"180px"}},[e("span",[t._v("*")]),t._v("奖品图片")]),e("th",[t._v("操作")])])}],u=i("c7eb"),d=i("1da1"),m=(i("a434"),i("3ca3"),i("ddb0"),i("8bac")),p=(i("da92"),i("e9de")),f={props:{firstObj:{type:Object,default:function(){}},secondDetail:{type:Object,default:function(){}}},data:function(){return{allLuckyTimesState:1,allLuckyTimes:1,eveDayLuckyTimes:1,evePeopleWinTimes:1,evePeopleDayWinTimesState:0,evePeopleDayWinTimes:1,tableLoading:!1,previewVisible:!1,previewcusServiceVisible:!1,previewImage:"",imageUrl:"",showWinPrize:!1,probabilityFlag:!1,activityPrizeList:[{prizeName:"谢谢参与",prizeCount:void 0,prizeProbability:0,fileUpateobj:""}],cusServiceObj:void 0,num:0,probabilityNum:0,staffQrCode:""}},mounted:function(){var t,e,i;this.secondDetail&&"edit"==this.$route.query.state&&(this.staffQrCode=null===(t=this.secondDetail)||void 0===t?void 0:t.staffQrCode,this.activityPrizeList=null===(e=this.secondDetail)||void 0===e||null===(i=e.activityPrizeList)||void 0===i?void 0:i.map((function(t){return t})))},methods:{allRadioChange:function(){"1"==this.allLuckyTimesState&&this.allLuckyTimes<this.eveDayLuckyTimes&&(this.allLuckyTimes=this.eveDayLuckyTimes,this.$message.warning("总抽奖次数不能小于每日抽奖次数"))},allLuckychange:function(){if("0"!=this.allLuckyTimesState)return this.allLuckyTimes<this.eveDayLuckyTimes?(this.allLuckyTimes=this.eveDayLuckyTimes,void this.$message.warning("每人总中奖次数不能小于每人每天中奖次数")):void 0},eveDaychange:function(){if("0"!=this.allLuckyTimesState)return this.allLuckyTimes<this.eveDayLuckyTimes?(this.eveDayLuckyTimes=this.allLuckyTimes,void this.$message.warning("每日抽奖次数不能大于总抽奖次数")):void 0},evePeopleChane:function(){if("0"!=this.evePeopleDayWinTimesState)return this.evePeopleWinTimes<this.evePeopleDayWinTimes?(this.evePeopleWinTimes=this.evePeopleDayWinTimes,void this.$message.warning("每人总中奖次数不能小于每人每天中奖次数")):void 0},evePeopleDaychange:function(){if("0"!=this.evePeopleDayWinTimesState)return this.evePeopleWinTimes<this.evePeopleDayWinTimes?(this.evePeopleDayWinTimes=this.evePeopleWinTimes,void this.$message.warning("每人每天中奖次数不能大于每人总中奖次数")):void 0},customRequest:function(t){t.onSuccess()},submitBtn:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i,a,n;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=0,a=0,n=!1,t.activityPrizeList.map((function(t){i+=t.prizeProbability,a+=t.prizeCount||0})),100!==i){e.next=5;break}e.next=7;break;case 5:return t.$message.warning("设置的所有奖项中奖概率总和应等于100%"),e.abrupt("return");case 7:if(!(a<=0)){e.next=10;break}return t.$message.warning("设置的所有奖项中奖数量不能全为0"),e.abrupt("return");case 10:if(t.activityPrizeList.length%2!=0){e.next=13;break}e.next=15;break;case 13:return t.$message.warning("设置的所有奖项需配置成偶数个"),e.abrupt("return");case 15:if(t.activityPrizeList.map((function(e,i){if(!e.prizeName)return t.$message.warning("奖项".concat(i+1,"的名称不能为空")),void(n=!0)})),!n){e.next=18;break}return e.abrupt("return");case 18:return t.tableLoading=!0,e.next=21,t.qrCodeUpate();case 21:if(t.staffQrCode){e.next=25;break}return t.$message.warning("请上传客服二维码"),t.tableLoading=!1,e.abrupt("return");case 25:return t.$emit("loadingStart"),e.next=28,t.updateImage();case 28:if(t.activityPrizeList.map((function(e,i){if(!e.prizeImage)return t.$message.warning("奖项".concat(i+1,"的图片不能为空")),t.tableLoading=!1,void(n=!0)})),!n){e.next=33;break}return t.$emit("loadingEnd"),t.tableLoading=!1,e.abrupt("return");case 33:return e.next=35,t.submitInterface();case 35:case"end":return e.stop()}}),e)})))()},submitInterface:function(){var t=this,e=this.getParm(),i="add"==this.$route.query.state?this.addPage(e):this.updatePage(e);i.then(function(){var e=Object(d["a"])(Object(u["a"])().mark((function e(i){return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$message.success("".concat(t.isAddText,"抽奖成功")),t.$router.go(-1),t.$emit("loadingEnd"),t.tableLoading=!1;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.tableLoading=!1,t.$message.error(e),t.$emit("loadingEnd")}))},updatePage:function(t){return t.id=this.$route.query.id,Object(m["i"])(t)},addPage:function(t){return Object(m["a"])(t)},sureDraw:function(){if(this.activityPrizeList.length>=8)this.$message.warning("最多设置8个奖项");else{var t={prizeName:"",prizeCount:0,prizeProbability:0,fileList:[]};this.activityPrizeList.push(t)}},probability:function(t,e){var i=0;return this.activityPrizeList.map((function(t){i+=t.prizeProbability})),100===i?void(this.probabilityFlag=!0):void(this.probabilityFlag=!1)},deleteBtn:function(t){this.activityPrizeList.splice(t,1)},backBtn:function(){this.$emit("backBtnClick")},getBase64:function(t){return new Promise((function(e,i){var a=new FileReader;a.readAsDataURL(t),a.onload=function(){return e(a.result)},a.onerror=function(t){return i(t)}}))},handleCancel:function(){this.previewVisible=!1,this.previewcusServiceVisible=!1},handlePreview:function(t){var e=this;return Object(d["a"])(Object(u["a"])().mark((function i(){return Object(u["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.url||t.preview){i.next=4;break}return i.next=3,e.getBase64(t.originFileObj);case 3:t.preview=i.sent;case 4:e.previewImage=t.url||t.preview,e.previewVisible=!0;case 6:case"end":return i.stop()}}),i)})))()},getParm:function(){var t=this.firstObj;"0"==this.allLuckyTimesState?t.allLuckyTimes=null:t.allLuckyTimes=this.allLuckyTimes,"0"==this.evePeopleDayWinTimesState?t.evePeopleDayWinTimes=null:t.evePeopleDayWinTimes=this.evePeopleDayWinTimes,t.eveDayLuckyTimes=this.eveDayLuckyTimes,t.evePeopleWinTimes=this.evePeopleWinTimes;var e=this.activityPrizeList.map((function(t,e){return 0===e&&(t.isPrize=0),e>0&&(t.isPrize=1),{activityId:t.activityId||void 0,winCount:t.winCount,surplusCount:t.surplusCou||0,prizeName:t.prizeName,prizeCount:t.prizeCount,prizeImage:t.prizeImage,prizeProbability:t.prizeProbability,isPrize:t.isPrize}}));return t.activityPrizeList=e,t.showWinPrizeRecord=this.showWinPrize?1:0,t.staffQrCode=this.staffQrCode,t},updateImage:function(){var t=this;return Object(d["a"])(Object(u["a"])().mark((function e(){var i,a;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.activityPrizeList,a=i.map((function(e){return new Promise((function(i){if(e.fileUpateobj){var a=new FormData;a.append("file",e.fileUpateobj),a.append("dir","marketCenter"),a.append("type","image"),Object(m["j"])(a).then((function(t){e.prizeImage=t.data,i()})).catch((function(){t.loading=!1,i(),t.$message.error("图片上传失败")}))}else setTimeout((function(){i()}),0)}))})),e.abrupt("return",Promise.all(a).catch((function(e){t.tableLoading=!1,t.loading=!1})));case 3:case"end":return e.stop()}}),e)})))()},qrCodeUpate:function(){var t=this;return new Promise((function(e){var i=t.cusServiceObj;if(i){var a=new FormData;a.append("file",i),a.append("dir","marketCenter"),a.append("type","image"),Object(m["j"])(a).then((function(e){t.staffQrCode=e.data})).catch((function(){t.loading=!1,t.$message.error("图片上传失败")})).finally((function(){e()}))}else e()}))}},components:{UpDateImg:p["a"]},computed:{isAddText:function(){var t="";switch(this.$route.query.state){case"add":t="创建";break;case"edit":t="修改";break}return t},id:function(){return this.$route.query.id}},watch:{secondDetail:function(){var t,e,i;this.flagstatus||(this.staffQrCode=null===(t=this.secondDetail)||void 0===t?void 0:t.staffQrCode,this.activityPrizeList=null===(e=this.secondDetail)||void 0===e||null===(i=e.activityPrizeList)||void 0===i?void 0:i.map((function(t){return t})),this.secondDetail.allLuckyTimes?(this.allLuckyTimes=this.secondDetail.allLuckyTimes,this.allLuckyTimesState=1):this.allLuckyTimesState=0,this.secondDetail.evePeopleDayWinTimes?(this.evePeopleDayWinTimes=this.secondDetail.evePeopleDayWinTimes,this.evePeopleDayWinTimesState=1):this.evePeopleDayWinTimesState=0,this.eveDayLuckyTimes=this.secondDetail.eveDayLuckyTimes,this.evePeopleWinTimes=this.secondDetail.evePeopleWinTimes)}}},v=f,h=(i("746d"),i("2877")),g=Object(h["a"])(v,c,l,!1,null,"6cdd38d0",null),y=g.exports,b={data:function(){return{currentNum:0,visibleSelectTag:!1,activityName:"",activityExplain:"",startTime:void 0,endTime:void 0,permanentValidity:1,openCustomerTag:!0,tagList:[],customerTagRuleList:[{customerType:1,tagList:[],check:!1,flag:!0},{customerType:2,tagList:[],check:!1,flag:!0}],adminStateTxt:"已参加活动",adminendTxt:"已抽中奖品",visibleWay:0,spinShow:!1,firstObj:{},secondDetail:{}}},created:function(){this.id&&this.getDetails()},methods:{moment:s.a,loadingStart:function(){this.spinShow=!0},loadingEnd:function(){this.spinShow=!1},visibleShow:function(t,e,i){i||(this.tagList=e,this.visibleWay=Number(t),this.visibleSelectTag=!0)},backBtnClick:function(){this.currentNum=0},nextBtn:function(){var t=this;if(this.activityName)if(this.activityExplain){var e=!1,i={activityName:this.activityName,activityExplain:this.activityExplain,permanentValidity:this.permanentValidity,openCustomerTagSetting:this.openCustomerTag?1:0,customerTagRuleList:[]};if("0"==this.permanentValidity){if(!this.startTime||!this.endTime)return void this.$message.warning("请选择活动时间");i.startTime=this.startTime,i.endTime=this.endTime}if(this.openCustomerTag){var a=0;if(this.customerTagRuleList.map((function(n){if(n.check){a++;var r=n.tagList.map((function(t){return t.tagName})),s=n.tagList.map((function(t){return t.tagId})),o={flag:n.flag,customerType:n.customerType,tagIdList:s.join(","),tagNameList:r.join(",")};if(n.flag){if(!n.score)return e=!0,void t.$message.warning("请给Ta添加评分");o.score=n.score}else o.score=null;i.customerTagRuleList.push(o)}})),a<=0)return void this.$message.warning("请至少选择一个规则");this.customerTagRuleList.every((function(i){if(i.check&&i.tagList.length<=0)return e=!0,void t.$message.warning("请选择标签")}))}e||(this.firstObj=i,this.currentNum=1)}else this.$message.warning("请输入活动说明");else this.$message.warning("请输入活动名称")},pitchTag:function(t){var e=t.filter((function(t){return t.selectTagList.length>0})).map((function(t){return t.selectTagList})).flat();this.$set(this.customerTagRuleList[this.visibleWay],"tagList",e),this.visibleSelectTag=!1},cleanTag:function(){this.$set(this.customerTagRuleList[this.visibleWay],"tagList",[])},checkadmin:function(t){this.adminStateTxt="0"==t?"已参加活动":"已抽中奖品"},changeStartDate:function(t,e){if(this.startTime=e,this.$moment(this.startTime).isAfter(this.endTime)&&this.endTime)return this.$message.warning("活动开始时间不能大于结束时间"),void(this.startTime=void 0)},changeendDate:function(t,e){if(this.endTime=e,this.$moment(this.endTime).isBefore(this.startTime)&&this.startTime)return this.$message.warning("活动结束时间不能小于开始时间"),void(this.endTime=void 0)},disabledDate:function(t){return t&&t<=this.$moment().subtract(1,"days")},getDetails:function(){var t=this,e=this.id;Object(m["e"])({id:e}).then((function(e){t.activityName=e.data.activityName,t.activityExplain=e.data.activityExplain,t.permanentValidity=e.data.permanentValidity,t.startTime=e.data.startTime,t.endTime=e.data.endTime,t.openCustomerTag="1"==e.data.openCustomerTagSetting,e.data.customerTagRuleList.map((function(e,i){t.customerTagRuleList.map((function(i,a){if(e.customerType==i.customerType){t.$set(t.customerTagRuleList[a],"check",!0),t.$set(t.customerTagRuleList[a],"prohibit",!0),e.score?(t.$set(t.customerTagRuleList[a],"score",e.score),t.$set(t.customerTagRuleList[a],"flag",!0)):(t.$set(t.customerTagRuleList[a],"flag",!1),t.$set(t.customerTagRuleList[a],"score",null));var n=e.tagNameList.split(","),r=e.tagIdList.split(","),s=n.map((function(t,e){return{tagName:t,tagId:r[e]}}));t.$set(t.customerTagRuleList[a],"tagList",s)}}))})),t.secondDetail={staffQrCode:e.data.staffQrCode,activityPrizeList:e.data.activityPrizeList,allLuckyTimes:e.data.allLuckyTimes,eveDayLuckyTimes:e.data.eveDayLuckyTimes,evePeopleWinTimes:e.data.evePeopleWinTimes,evePeopleDayWinTimes:e.data.evePeopleDayWinTimes}})).catch((function(e){t.$message.error(e)}))}},computed:{isAddText:function(){var t="";switch(this.$route.query.state){case"add":t="创建";break;case"edit":t="修改";break}return t},disabledflag:function(){return"add"!=this.$route.query.state},id:function(){return this.$route.query.id}},components:{SelectTags:o["a"],prizeSetting:y}},T=b,w=(i("c580"),Object(h["a"])(T,a,n,!1,null,"55221b84",null));e["default"]=w.exports},c580:function(t,e,i){"use strict";i("5fb8")},c7eb:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));i("a4d3"),i("e01a"),i("d3b7"),i("d28b"),i("3ca3"),i("ddb0"),i("b636"),i("944a"),i("0c47"),i("23dc"),i("3410"),i("159b"),i("b0c0"),i("131a"),i("fb6a");var a=i("53ca");function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
n=function(){return t};var t={},e=Object.prototype,i=e.hasOwnProperty,r=Object.defineProperty||function(t,e,i){t[e]=i.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function u(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(j){u=function(t,e,i){return t[e]=i}}function d(t,e,i,a){var n=e&&e.prototype instanceof f?e:f,s=Object.create(n.prototype),o=new P(a||[]);return r(s,"_invoke",{value:k(t,i,o)}),s}function m(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(j){return{type:"throw",arg:j}}}t.wrap=d;var p={};function f(){}function v(){}function h(){}var g={};u(g,o,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(D([])));b&&b!==e&&i.call(b,o)&&(g=b);var T=h.prototype=f.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function L(t,e){function n(r,s,o,c){var l=m(t[r],t,s);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Object(a["a"])(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,o,c)}),(function(t){n("throw",t,o,c)})):e.resolve(d).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,c)}))}c(l.arg)}var s;r(this,"_invoke",{value:function(t,i){function a(){return new e((function(e,a){n(t,i,e,a)}))}return s=s?s.then(a,a):a()}})}function k(t,e,i){var a="suspendedStart";return function(n,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===n)throw r;return S()}for(i.method=n,i.arg=r;;){var s=i.delegate;if(s){var o=x(s,i);if(o){if(o===p)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===a)throw a="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a="executing";var c=m(t,e,i);if("normal"===c.type){if(a=i.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(a="completed",i.method="throw",i.arg=c.arg)}}}function x(t,e){var i=e.method,a=t.iterator[i];if(void 0===a)return e.delegate=null,"throw"===i&&t.iterator["return"]&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var n=m(a,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,p;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function D(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,n=function e(){for(;++a<t.length;)if(i.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:S}}function S(){return{value:void 0,done:!0}}return v.prototype=h,r(T,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:v,configurable:!0}),v.displayName=u(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,u(t,l,"GeneratorFunction")),t.prototype=Object.create(T),t},t.awrap=function(t){return{__await:t}},w(L.prototype),u(L.prototype,c,(function(){return this})),t.AsyncIterator=L,t.async=function(e,i,a,n,r){void 0===r&&(r=Promise);var s=new L(d(e,i,a,n),r);return t.isGeneratorFunction(i)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},w(T),u(T,l,"Generator"),u(T,o,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),i=[];for(var a in e)i.push(a);return i.reverse(),function t(){for(;i.length;){var a=i.pop();if(a in e)return t.value=a,t.done=!1,t}return t.done=!0,t}},t.values=D,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(i,a){return s.type="throw",s.arg=t,e.next=i,a&&(e.method="next",e.arg=void 0),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var o=i.call(r,"catchLoc"),c=i.call(r,"finallyLoc");if(o&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=t,s.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),_(i),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var a=i.completion;if("throw"===a.type){var n=a.arg;_(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:D(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),p}},t}},da92:function(t,e,i){"use strict";function a(t,e){return void 0===e&&(e=15),+parseFloat(Number(t).toPrecision(e))}function n(t){var e=t.toString().split(/[eE]/),i=(e[0].split(".")[1]||"").length-+(e[1]||0);return i>0?i:0}function r(t){if(-1===t.toString().indexOf("e"))return Number(t.toString().replace(".",""));var e=n(t);return e>0?a(Number(t)*Math.pow(10,e)):Number(t)}function s(t){p&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)&&console.warn(t+" is beyond boundary when transfer to integer, the results may not be accurate")}function o(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var a=e[0],n=e.slice(1);return n.reduce((function(e,i){return t(e,i)}),a)}}var c=o((function(t,e){var i=r(t),a=r(e),o=n(t)+n(e),c=i*a;return s(c),c/Math.pow(10,o)})),l=o((function(t,e){var i=Math.pow(10,Math.max(n(t),n(e)));return(c(t,i)+c(e,i))/i})),u=o((function(t,e){var i=Math.pow(10,Math.max(n(t),n(e)));return(c(t,i)-c(e,i))/i})),d=o((function(t,e){var i=r(t),o=r(e);return s(i),s(o),c(i/o,a(Math.pow(10,n(e)-n(t))))}));function m(t,e){var i=Math.pow(10,e),a=d(Math.round(Math.abs(c(t,i))),i);return t<0&&0!==a&&(a=c(a,-1)),a}var p=!0;function f(t){void 0===t&&(t=!0),p=t}var v={strip:a,plus:l,minus:u,times:c,divide:d,round:m,digitLength:n,float2Fixed:r,enableBoundaryChecking:f};e["a"]=v},e9de:function(t,e,i){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"qrcode-wrap"},[e("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card",accept:t.accept,disabled:t.isDisabled,"file-list":t.fileList,customRequest:t.customRequest},on:{preview:t.handlePreview,change:t.handleChange}},[e("div",[e("a-icon",{attrs:{type:"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" "+t._s(t.imageUrl?"重新选择":t.titleName)+" ")])],1)]),e("a-modal",{attrs:{visible:t.previewVisible,footer:null},on:{cancel:function(e){t.previewVisible=!1}}},[e("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:t.imageUrl}})])],1)},n=[],r={name:"UpDateImg",props:["value","url","title","isDisabled","articleFile"],data:function(){return{accept:".jpg,.png,",previewVisible:!1,imageUrl:"",titleName:this.title||"上传活码",fileList:[]}},watch:{url:{handler:function(){this.url&&(this.fileList[0]={uid:"-1",name:"image.png",status:"done",url:this.url},this.imageUrl=this.url)},immediate:!0},articleFile:{handler:function(){var t=this;this.articleFile&&this.getBase64(this.articleFile,(function(e){t.fileList[0]={uid:"-1",name:"image.png",status:"done",url:t.imageUrl},t.imageUrl=e}))},immediate:!0}},methods:{customRequest:function(t){t.onSuccess()},handlePreview:function(t){this.previewVisible=!0},getBase64:function(t,e){var i=new FileReader;i.addEventListener("load",(function(){return e(i.result)})),i.readAsDataURL(t)},handleChange:function(t){var e,i=this;"uploading"===t.file.status&&(this.getBase64(t.file.originFileObj,(function(t){i.imageUrl=t})),this.fileList=[t.fileList[t.fileList.length-1]],this.fileList[0].status="done"),"removed"===t.file.status&&(this.fileList=[],this.imageUrl=""),this.$emit("input",null===t||void 0===t||null===(e=t.fileList[t.fileList.length-1])||void 0===e?void 0:e.originFileObj)}}},s=r,o=(i("14aa"),i("2877")),c=Object(o["a"])(s,a,n,!1,null,"05819df1",null);e["a"]=c.exports}}]);