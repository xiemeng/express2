(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d257c4b6"],{"0070":function(t,e,a){"use strict";a("60443")},"0fa8":function(t,e,a){},1119:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[t._l(t.form.tagList,(function(a,i){return e("a-form-model-item",t._b({key:a.key,attrs:{prop:"tagList",label:0===i?"标签名称":""}},"a-form-model-item",0===i?t.formItemLayout:t.formItemLayoutWithOutLabel,!1),[e("a-input",{staticStyle:{width:"60%","margin-right":"8px"},attrs:{placeholder:"请输入标签名称",maxLength:10},model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"domain.value"}}),t.form.tagList.length>1?e("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===t.form.tagList.length},on:{click:function(e){return t.removeDomain(a)}}}):t._e(),a.tagCount||0===a.tagCount?e("a-space",{staticClass:"using"},[a.tagCount>0?e("a-tag",{attrs:{color:"green"}},[t._v("使用中")]):e("a-tag",{attrs:{color:"orange"}},[t._v("未使用")])],1):t._e()],1)})),e("a-form-model-item",{attrs:{"wrapper-col":{offset:4}}},[e("a-button",{attrs:{type:"link"},on:{click:t.addDomain}},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v(" 添加标签 ")],1)],1)],2)},s=[],n=(a("a434"),{name:"FormlabelAdd",props:{form:{type:[Object],default:function(){return{}}}},mounted:function(){},data:function(){return{formItemLayout:{labelCol:{sm:{span:5}},wrapperCol:{sm:{span:19}}},formItemLayoutWithOutLabel:{wrapperCol:{sm:{span:19,offset:5}}}}},methods:{removeDomain:function(t){var e=this.form.tagList.indexOf(t);-1!==e&&this.form.tagList.splice(e,1)},addDomain:function(){this.form.tagList.push({value:"",key:Date.now()})}}}),r=n,o=(a("74de"),a("2877")),c=Object(o["a"])(r,i,s,!1,null,"bb9da28a",null);e["a"]=c.exports},1531:function(t,e,a){"use strict";a("b1f6")},"4bbb":function(t,e,a){"use strict";a("e5ad")},60443:function(t,e,a){},6290:function(t,e,a){"use strict";a("caad"),a("2532"),a("fb6a");var i=function(){var t=this,e=t._self._c;return e("div",[t.isEdit?e("a-button",{staticClass:"add-tag-button",attrs:{size:"small"},on:{click:t.showInput}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 添加 ")],1):t._e(),t.inputVisible?e("a-input",{ref:"input",style:{width:"120px"},attrs:{type:"text",size:"small",inputVisible:"false",maxLength:10,value:t.inputValue},on:{change:t.handleInputChange,blur:t.handleInputConfirm,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.stopPropagation(),t.handleInputConfirm.apply(null,arguments))}}}):t._e(),t._l(t.tagslist.tags,(function(a,i){return[a.tagName.length>20?e("a-tooltip",{key:i},[e("a-tag",{key:a.tagId,attrs:{closable:t.closable,color:t.tagIdList.includes(a.tagId)?"blue":""},on:{close:function(e){return t.closeTag(a)},click:function(e){return t.checkedTag(a)}}},[t._v(" "+t._s("".concat(a.tagName.slice(0,20),"..."))+" ")])],1):e("a-tag",{key:a.tagId,attrs:{closable:t.closable,color:t.tagIdList.includes(a.tagId)?"blue":""},on:{close:function(e){return t.closeTag(a)},click:function(e){return t.checkedTag(a)}}},[t._v(" "+t._s(a.tagName)+" ")])]}))],2)},s=[],n=a("2909"),r=(a("d81d"),a("c740"),a("a434"),a("498a"),a("99af"),{name:"TagComponents",props:{selectTagList:{type:[Array],default:function(){return[]}},tagslist:{type:[Object],default:function(){return{}}},closable:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},isSelect:{type:Boolean,default:!0}},data:function(){return{inputVisible:!1,inputValue:"",index:"",selectTags:[]}},computed:{tagIdList:function(){var t;return(null===(t=this.selectTagList)||void 0===t?void 0:t.map((function(t){return t.tagId})))||[]}},methods:{closeTag:function(t){var e=this.tagslist.tags.findIndex((function(e){return e.tagName===t.tagName}));this.tagslist.tags.splice(e,1),this.$emit("closeTag",t)},showInput:function(){this.inputVisible=!0,this.$nextTick((function(){this.$refs.input.focus()}))},checkedTag:function(t){if(this.isSelect){var e=this.selectTagList.findIndex((function(e){if(e.tagId===t.tagId)return e}));e>=0?this.selectTagList.splice(e,1):this.selectTagList.push(t)}},handleInputChange:function(t){var e;this.inputValue=null===(e=t.target.value)||void 0===e?void 0:e.trim()},clean:function(){this.inputValue="",this.inputVisible=!1},handleInputConfirm:function(){var t,e=this.inputValue;if(e){var a=this.tagslist.tags||[],i={tagName:e},s=null===(t=a)||void 0===t?void 0:t.map((function(t){return t.tagName}));null!==s&&void 0!==s&&s.includes(i.tagName)?this.$message.warning("存在重复标签"):(e&&(a=[].concat(Object(n["a"])(a),[i])),this.tagslist.tags=a,this.$emit("addTag",{value:e,tagItem:this.tagslist,callBack:this.clean}))}else this.clean()}}}),o=r,c=(a("0070"),a("2877")),l=Object(c["a"])(o,i,s,!1,null,"22a32bc5",null);e["a"]=l.exports},7183:function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"d",(function(){return r})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return c}));var i=a("b775"),s={getTagGroup:"/client_manager/CustomerTag/getTagGroup",syncTagGroup:"/client_manager/CustomerTag/syncTagGroup",addOrEditTagGroup:"/client_manager/CustomerTag/addOrEditTagGroup",delTagGroup:"/client_manager/CustomerTag/delTagGroup"};function n(t){return Object(i["b"])({url:s.getTagGroup,method:"post",data:t})}function r(t){return Object(i["b"])({url:s.syncTagGroup,method:"post",data:t})}function o(t){return Object(i["b"])({url:s.addOrEditTagGroup,method:"post",data:t})}function c(t){return Object(i["b"])({url:s.delTagGroup,method:"post",data:t})}},"74de":function(t,e,a){"use strict";a("9ee2")},"9ee2":function(t,e,a){},ac43:function(t,e,a){"use strict";a("0fa8")},b1f6:function(t,e,a){},c758:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-tags"},[e("section",{attrs:{id:"operator-tag-group-dialog"}},[e("p",{staticClass:"dialog-title dialog-tag-title"},[t._v(t._s(t.statusText)+"标签组")]),e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[e("a-form-model-item",{attrs:{label:"标签组名称",prop:"tagGroupName"}},[e("a-input",{staticClass:"tags-name",attrs:{placeholder:"请输入标签组名称",maxLength:15},model:{value:t.form.tagGroupName,callback:function(e){t.$set(t.form,"tagGroupName",e)},expression:"form.tagGroupName"}})],1),e("a-form-model-item",{attrs:{label:"可见范围",prop:"scope"}},[e("a-radio-group",{model:{value:t.form.scope,callback:function(e){t.$set(t.form,"scope",e)},expression:"form.scope"}},[e("a-radio",{attrs:{value:0}},[t._v(" 全部员工 ")]),e("a-radio",{attrs:{value:1}},[t._v(" 部门可用 ")])],1)],1),1===t.form.scope?e("a-form-model-item",{attrs:{label:"选择可用部门"}},[e("AddContent",{attrs:{title:"请选择部门",type:"wxDepartmentId",tip:"",dataList:t.selectList},on:{selectPerson:t.selectPerson}})],1):t._e(),e("FormlabelAdd",{attrs:{form:t.form}})],1)],1),e("div",{staticClass:"foot-button"},[e("a-space",{attrs:{size:12}},[e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v("确定")])],1)],1)])},s=[],n=a("5530"),r=(a("d81d"),a("d3b7"),a("99af"),a("159b"),a("c740"),a("a434"),a("e1ae")),o=a("1119"),c=a("7183"),l={props:{tagDetail:{type:[Object],default:function(){return{}}}},computed:{statusText:function(){return this.tagDetail.groupId?"修改":"新增"}},data:function(){return{formLayout:"horizontal",labelCol:{span:5},wrapperCol:{span:14},selectList:[],form:{tagGroupName:"",scope:0,value:"",tagList:[{value:"",key:Date.now()}]},rules:{tagGroupName:[{required:!0,message:"标签组名称不能为空"}],tagList:[{required:!0,message:"标签名称不能为空"}]}}},created:function(){var t;if(null!==(t=this.tagDetail)&&void 0!==t&&t.groupId&&(this.form={tagGroupName:this.tagDetail.groupName,scope:this.tagDetail.depScope?1:0,tagList:this.tagDetail.tags.map((function(t){return Object(n["a"])(Object(n["a"])({},t),{},{value:t.tagName,key:t.tagId,tagId:t.tagId,wxTagId:t.wxTagId})}))},this.tagDetail.depNames&&this.tagDetail.depScope)){var e=this.tagDetail.depNames.split(","),a=this.tagDetail.depScope.split(",");this.selectList=e.map((function(t,e){return{icon:"file",key:a[e],source:{departmentId:a[e],wxDepartmentId:a[e],name:t},title:t}}))}},components:{AddContent:r["a"],FormlabelAdd:o["a"]},methods:{selectPerson:function(t){this.selectList=t},submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;e.validate().then((function(){e.addOrEditTagGroup()})).catch((function(t){e.$message.warning(t.message||t)}))}))},validate:function(){var t=this;return new Promise((function(e,a){1===t.form.scope&&t.selectList.length<1&&a("请选择部门");for(var i=t.form.tagList,s=0;s<i.length;s++){var n=i[s];n.value||a("请填写标签名称");for(var r=s+1;r<i.length;r++)n.value===i[r].value&&a("第".concat(s+1,"个和第").concat(r+1,"个标签名重复"))}e()}))},getAddParams:function(){var t,e,a={tagGroupName:this.form.tagGroupName,scope:this.form.scope,addOrEditTags:null===(t=this.form.tagList)||void 0===t?void 0:t.map((function(t){return{tagName:t.value}})),departments:null===(e=this.selectList)||void 0===e?void 0:e.map((function(t){return{wxDepartmentId:t.source.wxDepartmentId}}))};return a},getEditParams:function(){var t,e,a=this,i=[],s=[];this.tagDetail.tags.forEach((function(t){var e=a.form.tagList.findIndex((function(e){if(t.wxTagId===e.wxTagId)return e}));e<0&&i.push({tagName:t.tagName,wxTagId:t.wxTagId})})),this.form.tagList.forEach((function(t){t.wxTagId?a.tagDetail.tags.forEach((function(e){e.wxTagId===t.wxTagId&&e.tagName!==t.value&&s.push({tagName:t.value,wxTagId:e.wxTagId})})):s.push({tagName:t.value})})),null===(t=this.form.tagList)||void 0===t||t.map((function(t){return{tagName:t.value,wxTagId:t.wxTagId}}));var n={wxGroupId:this.tagDetail.wxGroupId,tagGroupName:this.form.tagGroupName,scope:this.form.scope,delTags:i,addOrEditTags:s,departments:null===(e=this.selectList)||void 0===e?void 0:e.map((function(t){return{wxDepartmentId:t.source.wxDepartmentId}}))};return 0===this.form.scope&&delete n.departments,n},addOrEditTagGroup:function(){var t,e=this,a=null!==(t=this.tagDetail)&&void 0!==t&&t.groupId?this.getEditParams():this.getAddParams();Object(c["a"])(a).then((function(){e.$message.success("".concat(e.statusText,"标签成功")),e.$emit("serviceOk")})).catch((function(t){e.$message.error(t||t.message)}))},removeDomain:function(t){var e=this.form.tagList.indexOf(t);-1!==e&&this.form.tagList.splice(e,1)}}},u=l,d=(a("ac43"),a("2877")),g=Object(d["a"])(u,i,s,!1,null,"95b22908",null);e["a"]=g.exports},c844:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",[e("h4",{staticClass:"title"},[t._v("选择标签")]),t._t("title"),e("a-input-search",{attrs:{allowClear:"",placeholder:"请输入要搜索的标签"},on:{search:t.searchTag},model:{value:t.searchNmae,callback:function(e){t.searchNmae=e},expression:"searchNmae"}}),e("a-spin",{attrs:{spinning:t.spinning}},[e("ul",{staticClass:"add-tags-wrap"},t._l(t.tagList,(function(a,i){return e("li",{key:i},[e("p",{staticClass:"tags-title"},[t._v(t._s(a.groupName)+":")]),e("TagComponents",{attrs:{tagslist:a,selectTagList:a.selectTagList,isEdit:""},on:{addTag:t.addTag}})],1)})),0)]),e("div",{staticClass:"foot-button"},[e("a-button",{staticClass:"add-tags",attrs:{type:"link"},on:{click:function(e){t.visible=!0}}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" 新建标签组 ")],1),e("a-space",{attrs:{size:12}},[e("a-button",{on:{click:function(e){return t.$emit("cancle")}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$emit("serviceOk",t.tagList)}}},[t._v("确定")])],1)],1),e("a-modal",{attrs:{footer:null,width:"599px",centered:"",destroyOnClose:""},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("NewLabelgroup",{on:{cancle:function(e){t.visible=!1},serviceOk:t.serviceOk}})],1)],2)},s=[],n=a("5530"),r=(a("d3b7"),a("d81d"),a("159b"),a("4de4"),a("7183")),o=a("6290"),c=a("c758"),l=a("1119"),u={name:"SelectTags",components:{TagComponents:o["a"],FormlabelAdd:l["a"],NewLabelgroup:c["a"]},props:{selectTagList:{type:[Array],default:function(){return[]}}},data:function(){return{searchNmae:"",visible:!1,tagList:[],spinning:!1}},watch:{selectTagList:function(){this.tagList=this.getTagList(this.tagList)}},created:function(){this.getTagGroup()},methods:{serviceOk:function(){this.visible=!1,this.getTagGroup()},addTag:function(t){var e=this,a=t.value,i=t.tagItem,s=t.callBack,n=this.getAddParams(a,i);Object(r["a"])(n).then((function(){e.$message.success("添加标签成功"),e.getTagGroup(),s()}))},getAddParams:function(t,e){var a={wxGroupId:e.wxGroupId,tagGroupName:e.groupName,scope:e.depScope?1:0,addOrEditTags:[{tagName:t}],departments:[]};return a},searchTag:function(){this.getTagGroup()},getTagGroup:function(){var t=this,e={grpName:this.searchNmae||null};this.spinning=!0,Object(r["c"])(e).then((function(e){t.tagList=t.getTagList(e.data.tagGroup)})).catch((function(e){t.$message.error(e||e.message)})).finally((function(){t.spinning=!1}))},getTagList:function(t){var e=this;return t.map((function(t){var a=[];return e.selectTagList.forEach((function(e){var i;null===(i=t.tags)||void 0===i||i.filter((function(t){e.tagId==t.tagId&&a.push(t)}))})),Object(n["a"])(Object(n["a"])({},t),{},{selectTagList:a})}))}}},d=u,g=(a("4bbb"),a("2877")),p=Object(g["a"])(d,i,s,!1,null,"fe518c7c",null);e["a"]=p.exports},e1ae:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",["look"!==t.state?e("header",[e("a-button",{attrs:{type:"primary"},on:{click:function(e){t.visibleTree=!0}}},[e("a-icon",{attrs:{type:"plus"}}),t._v(" "+t._s(t.title)+" ")],1),t.tip?e("span",{staticClass:"font-color-black-25 tips"},[t._v(t._s(t.tip))]):t._e()],1):t._e(),e("ul",t._l(t.selectList,(function(a,i){return e("a-tag",{key:a.key,attrs:{closable:"look"!==t.state},on:{close:function(e){return t.closeTag(i)}}},[a.source.thumbAvatar?e("a-avatar",{attrs:{size:26,src:a.source.thumbAvatar,shape:"square"}}):e("a-avatar",{attrs:{size:26,icon:a.icon,shape:"square"}}),t._v(" "+t._s(a.title)+" ")],1)})),1),e("a-modal",{attrs:{footer:null,centered:"",width:"680px",destroyOnClose:""},model:{value:t.visibleTree,callback:function(e){t.visibleTree=e},expression:"visibleTree"}},[e("AddTransfer",{attrs:{selectRoleIdList:t.selectRoleIdList,title:t.title,type:t.type,selectList:t.selectList},on:{serviceOk:t.serviceOk,cancle:function(e){t.visibleTree=!1}}})],1)],1)},s=[],n=(a("d81d"),a("a434"),a("1eb1")),r={name:"AddContent",props:{value:{type:[Array],default:function(){return[]}},state:{type:[String],default:""},selectRoleIdList:{type:[Array,String],default:function(){return""}},type:{type:[String],default:"wxDepartmentId"},title:{type:[String],default:"添加成员"},tip:{type:[String],default:""},dataList:{type:[Array],default:function(){return[]}}},components:{AddTransfer:n["a"]},data:function(){return{visibleTree:!1,selectList:[]}},watch:{selectList:function(){this.$emit("selectPerson",this.selectList),this.$emit("input",this.selectList)},dataList:{handler:function(){this.selectList=this.dataList},immediate:!0}},methods:{serviceOk:function(t){var e=t.map((function(t){return t.value=100,t}));this.selectList=e,this.visibleTree=!1},closeTag:function(t){this.selectList.splice(t,1)}}},o=r,c=(a("1531"),a("2877")),l=Object(c["a"])(o,i,s,!1,null,"53952032",null);e["a"]=l.exports},e5ad:function(t,e,a){}}]);