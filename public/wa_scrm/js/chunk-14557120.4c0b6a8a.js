(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14557120"],{"18dd":function(t,e,n){"use strict";n("5e0a")},"33f0":function(t,e,n){"use strict";n("c431")},"5e0a":function(t,e,n){},c431:function(t,e,n){},d28d:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"k",(function(){return s})),n.d(e,"i",(function(){return l})),n.d(e,"j",(function(){return c})),n.d(e,"d",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"e",(function(){return p})),n.d(e,"f",(function(){return m})),n.d(e,"c",(function(){return h})),n.d(e,"g",(function(){return g}));var r=n("b775"),a={categories_tags:"/tbTagCategory/queryAllTagTree",category:"/tbTagCategory/add",searchCategory:"/tbTagCategory/queryAllTag",tag:"/tbUserTag/create",propreties:"/properties/listAll",actions:"/tag/actions",create:"/schedule/create",info:"/tbUserTag/queryById",tag_infos:"/tbTagResult/getTagHierarchyResult",downloadTag:"/tag/download",deleteTag:"/tag",detailTag:"/tag",putTag:"/tag",getAllOptions:"/properties/getAllOptions",changeStatus:"/tbUserTag/changeStatus"};function i(t){return Object(r["b"])({url:a.categories_tags,method:"get",params:t})}function o(t){return Object(r["b"])({url:a.category,method:"get",params:t})}function s(t){return Object(r["b"])({url:a.tag,method:"post",data:t})}function l(t){return Object(r["b"])({url:a.propreties,method:"post",data:t})}function c(t){return Object(r["b"])({url:a.searchCategory,method:"get",params:t})}function u(t){return Object(r["b"])({url:a.create,method:"post",data:t})}function d(t){return Object(r["b"])({url:a.info,method:"get",params:t})}function f(t){return Object(r["b"])({url:a.tag_infos,method:"post",data:t})}function p(t){return Object(r["b"])({url:a.deleteTag,method:"delete",params:t})}function m(t){return Object(r["b"])({url:a.downloadTag,method:"get",params:t,responseType:"blob"})}function h(t){return Object(r["b"])({url:a.changeStatus,method:"post",data:t})}function g(t){return Object(r["b"])({url:a.getAllOptions,method:"get",params:t})}},e6e8:function(t,e,n){"use strict";n.r(e);n("b0c0");var r=function(){var t=this,e=t._self._c;return e("div",[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:"Creating user Labels"},on:{back:function(e){return t.$router.go(-1)}}}),e("section",{staticClass:"section"},[e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,"label-col":{span:2},"wrapper-col":{span:14},form:t.form,layout:"horizontal",rules:t.rules}},[e("p",{staticClass:"base-info"},[t._v("basic information")]),e("a-form-model-item",{attrs:{label:"Tag Display Name",prop:"tag_name"}},[e("a-input",{attrs:{placeholder:"Place Input Tag Display Name"},model:{value:t.form.tag_name,callback:function(e){t.$set(t.form,"tag_name",e)},expression:"form.tag_name"}})],1),e("a-form-model-item",{attrs:{label:"Classification",prop:"category"}},[e("a-select",{attrs:{placeholder:"place select"},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}},t._l(t.tagList,(function(n,r){return e("a-select-option",{key:r,attrs:{value:n.id}},[t._v(" "+t._s(n.categoryName)+" ")])})),1)],1),e("a-form-model-item",{attrs:{label:"Note(Optional)"}},[e("a-textarea",{attrs:{placeholder:"place input",maxLength:1e3},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),e("p",{staticClass:"base-info"},[t._v("Tag Rules")]),e("a-form-model-item",{attrs:{label:"Create rules"}},[e("p"),e("div",[t._l(t.form.filter_rules,(function(n,r){return e("a-dropdown-button",{key:r,staticStyle:{"margin-right":"20px"},on:{click:function(e){return t.handleButtonClick(r)}}},[t._v(" "+t._s(n.rule_name)+" "),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",{key:"2",on:{click:function(e){return t.deleteRule(r)}}},[e("a-icon",{staticStyle:{color:"red"},attrs:{type:"rest"}}),t._v("Delete ")],1)],1)],1)})),t.id?t._e():e("a-button",{attrs:{type:"link"},on:{click:t.addRule}},[t._v("Add Layer")])],2),t.selectRules.rule_info?e("div",[e("a-input",{attrs:{placeholder:"Please enter the layer name",maxLength:20},model:{value:t.selectRules.rule_name,callback:function(e){t.$set(t.selectRules,"rule_name",e)},expression:"selectRules.rule_name"}}),e("a-collapse",{attrs:{activeKey:t.activeKey}},[e("a-collapse-panel",{key:"1",attrs:{header:"User Attributes Meet"}},[t.id?t._e():e("div",{staticClass:"icon-add",attrs:{slot:"extra"},on:{click:function(e){return e.stopPropagation(),t.addAttr(t.selectRules.rule_info.proprety_condition,t.proprety_condition,1)}},slot:"extra"},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v(" Add ")],1),e("ul",{staticClass:"list-wrap"},t._l(t.selectRules.rule_info.proprety_condition,(function(n,r){return e("li",{key:r},[e("a-select",{staticClass:"select",attrs:{"show-search":"",filterOption:t.filterOption,placeholder:"place select"},on:{change:function(e){return t.changeProprety(n.proprety_id,r)}},model:{value:n.proprety_id,callback:function(e){t.$set(n,"proprety_id",e)},expression:"list.proprety_id"}},t._l(t.propretyList,(function(n,r){return e("a-select-option",{key:r,attrs:{value:n.id}},[t._v(" "+t._s(n.cname)+" ")])})),1),e("a-select",{staticClass:"select",attrs:{placeholder:"place select"},model:{value:n.condition,callback:function(e){t.$set(n,"condition",e)},expression:"list.condition"}},t._l(n.requireList,(function(n,r){return e("a-select-option",{key:r,attrs:{value:n.type}},[t._v(" "+t._s(n.name)+" ")])})),1),e("TypeList",{key:t.typeKey,staticClass:"type-list",attrs:{type:n.dataType,dataList:n.propertiesExtendVoList},model:{value:n.value,callback:function(e){t.$set(n,"value",e)},expression:"list.value"}}),e("a-tooltip",{attrs:{title:"Recommended words are attribute keywords from last 7 days (display up to 20 keywords), not all keywords available. You can enter a keyword and press Enter to complete."}},[e("a-icon",{staticClass:"icon",attrs:{type:"question-circle"}})],1),e("a-icon",{staticClass:"minus icon",attrs:{type:"minus-circle"},on:{click:function(e){return t.decrease(t.selectRules.rule_info.proprety_condition,r)}}})],1)})),0)])],1)],1):t._e()]),e("a-form-model-item",{attrs:{label:"Status"}},[e("a-radio-group",{attrs:{name:"radioGroup"},model:{value:t.form.task_type,callback:function(e){t.$set(t.form,"task_type",e)},expression:"form.task_type"}},[e("a-radio",{attrs:{value:0}},[t._v(" enable ")]),e("a-radio",{attrs:{value:1}},[t._v(" disable ")])],1)],1),e("a-form-model-item",{staticStyle:{"margin-left":"150px"}},["look"!==t.look?e("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.buildTag}},[t._v("Create")]):t._e(),e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("Cancel")])],1)],1)],1)],1)},a=[],i=n("5530"),o=(n("d81d"),n("d3b7"),n("159b"),n("7db0"),n("3ca3"),n("ddb0"),n("a434"),n("a15b"),n("b64b"),n("d28d")),s=function(){var t=this,e=t._self._c;return e("div",["LIST"===t.type?e("a-select",{staticClass:"select",attrs:{"token-separators":[","],mode:"tags",placeholder:"place select"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}},t._l(t.dataList,(function(n,r){return e("a-select-option",{key:r,attrs:{value:n.extendValue}},[t._v(" "+t._s(n.extendValue)+" ")])})),1):t._e(),"STRING"===t.type?e("a-input",{staticClass:"select",attrs:{placeholder:"place input"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e(),"year"===t.type?e("a-select",{staticClass:"select",attrs:{placeholder:"请选择"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}},t._l(100,(function(n,r){return e("a-select-option",{key:r,attrs:{value:t.time-r}},[t._v(" "+t._s(t.time-r)+" ")])})),1):t._e(),"NUMBER"===t.type?e("a-input-number",{staticClass:"select",attrs:{placeholder:"place input"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e(),"DATETIME"===t.type?e("a-date-picker",{staticClass:"select",attrs:{format:"YYYY-MM-DD HH:mm:ss"},on:{change:function(e){return t.changeEnum("time")}},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e(),"DATETIME2"===t.type?e("a-date-picker",{staticClass:"select",on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e()],1)},l=[],c=(n("a9e3"),{name:"TypeList",components:{},props:{value:{type:[Number,String,Object,Array],default:""},type:{type:String,default:""},dataList:{type:Array,default:function(){return[]}}},data:function(){return{information:void 0,time:void 0}},created:function(){this.time=this.$moment().format("YYYY"),this.information=this.value||void 0},methods:{changeEnum:function(t){var e;"time"==t?this.$emit("input",null===(e=this.information)||void 0===e?void 0:e.format("YYYY-MM-DD HH:mm:ss")):this.$emit("input",this.information)},update:function(){this.$forceUpdate()}}}),u=c,d=(n("33f0"),n("2877")),f=Object(d["a"])(u,s,l,!1,null,"194b38d3",null),p=f.exports,m=n("c1df"),h=n.n(m),g={name:"BuildTag",components:{TypeList:p},data:function(){return{loading:!1,activeKey:[],typeKey:1,dataType:{enum:"",str:"",year:"",int:"",datetime:"",date:""},form:{tag_name:void 0,category:void 0,remark:void 0,task_type:1,filter_rules:[{rule_name:"Layer1",rule_info:{proprety_condition:[],action_condition:[],action_list:[]}}]},selectRules:{},typeList:[{test:"决策标签",value:1},{test:"消费类标签",value:2},{test:"会员信息",value:3},{test:"活跃类标签",value:4},{test:"未分类",value:5}],ruleIndex:0,tagList:[],rules:{tag_name:[{required:!0,message:"请填写分类名"}],category:[{required:!0,message:"请选择分类"}]},propretyList:[],actionList:[],proprety_condition:{hierarchyId:void 0,options:void 0,id:void 0,propertiesId:void 0,targetValue:void 0,condition:void 0},action_condition:{action_id:"",is_done:"true",start_time:h()().format("YYYY-MM-DD"),end_time:h()().format("YYYY-MM-DD"),startAndEnd:[h()(),h()()]},action_list:{start_time:h()().format("YYYY-MM-DD"),end_time:h()().format("YYYY-MM-DD"),startAndEnd:[h()(),h()()],actions:[{action_rank:1,action_id:""},{action_rank:2,action_id:""}]}}},created:function(){this.id?this.detailTagFun():this.init()},computed:{id:function(){return this.$route.query.id},look:function(){return this.$route.query.look}},methods:{detailTagFun:function(){var t=this;Object(o["h"])({id:this.id}).then((function(e){var n,r=e.data;r&&(t.form={tag_name:r.tagName,category:r.categoryId,remark:r.remark,task_type:r.status,filter_rules:null===(n=r.hierarchyInsertDtoList)||void 0===n?void 0:n.map((function(e){var n;return{rule_name:e.hierarchyName,rule_id:e.tagId,rule_info:{proprety_condition:null===(n=e.ruleInsertDtoList)||void 0===n?void 0:n.map((function(e){return t.activeKey.indexOf("1")<0&&t.activeKey.push("1"),{hierarchyId:e.hierarchyId,condition:e.options,id:e.id,proprety_id:e.propertiesId,value:e.targetValue.indexOf(",")>0?e.targetValue.split(","):e.targetValue}}))}}}))},t.init())})).catch((function(e){t.$message.error(e)}))},init:function(){var t=this,e=Object(o["j"])().then((function(e){t.tagList=e.data})).catch((function(e){t.$message.error(e)})),n=Object(o["i"])().then((function(e){var n;if((null===(n=e.data)||void 0===n?void 0:n.length)>0){var r,a;if(t.propretyList=null===(r=e.data)||void 0===r?void 0:r.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{key:t.cname})})),t.id)return void t.form.filter_rules.forEach((function(e){e.rule_info.proprety_condition.forEach((function(e){var n=t.propretyList.find((function(t){return t.id===e.proprety_id}));null!==n&&void 0!==n&&n.id&&Object.assign(e,n)}))}));t.proprety_condition.condition=null===(a=e.data[0].option)||void 0===a?void 0:a[0].name,Object.assign(t.proprety_condition,e.data[0])}})).catch((function(e){t.$message.error(e)})),r=Object(o["g"])().then((function(e){var n;if((null===(n=e.data)||void 0===n?void 0:n.length)>0){if(t.id)return void t.form.filter_rules.forEach((function(t){t.rule_info.proprety_condition.forEach((function(t){t.requireList=e.data}))}));t.proprety_condition.requireList=e.data}})).catch((function(e){t.$message.error(e)}));Promise.all([e,n,r]).then((function(){t.selectRules=t.form.filter_rules[0],t.$forceUpdate()}))},addAttr:function(t,e,n){var r=this.activeKey.find((function(t){return t==n}));r||this.activeKey.push(n),t.push(JSON.parse(JSON.stringify(e)))},decrease:function(t,e){t.splice(e,1)},addRule:function(){var t,e;this.form.filter_rules.push(Object(i["a"])(Object(i["a"])({},JSON.parse(JSON.stringify(this.form.filter_rules[0]))),{},{rule_name:"Layer"+(this.form.filter_rules.length+1),rule_id:null,rule_info:{proprety_condition:[Object(i["a"])(Object(i["a"])({},null===(t=this.form.filter_rules[0])||void 0===t||null===(e=t.rule_info.proprety_condition)||void 0===e?void 0:e[0]),{},{condition:void 0,id:void 0,proprety_id:void 0,value:"",dataType:""})]}})),this.$forceUpdate(),this.selectRules=this.form.filter_rules[this.form.filter_rules.length-1]},buildTag:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;var n;if(!t.checkRule()){t.loading=!0;var r={tagName:t.form.tag_name,categoryId:t.form.category,remark:t.form.remark,status:t.form.task_type,hierarchyInsertDtoList:null===(n=t.form.filter_rules)||void 0===n?void 0:n.map((function(e){var n;return{hierarchyName:e.rule_name,id:e.rule_id,ruleInsertDtoList:null===(n=e.rule_info.proprety_condition)||void 0===n?void 0:n.map((function(n){var r;return{hierarchyId:e.rule_id,options:n.condition,id:t.id?n.id:void 0,propertiesId:n.proprety_id,targetValue:"string"==typeof n.value?n.value:null===(r=n.value)||void 0===r?void 0:r.join(",")}}))}}))};t.id?(r.tag_id=t.id,t.putTagFun(r)):t.tagFun(r)}}))},checkRule:function(){var t=this,e=!1;return this.form.filter_rules.forEach((function(n){if(!n.rule_name)return t.$message.warning("请填写分类名"),void(e=!0);var r=Object.keys(n.rule_info),a=!0;if(r.forEach((function(t){var e;(null===(e=n.rule_info[t])||void 0===e?void 0:e.length)>0&&(a=!1)})),a)return t.$message.warning("".concat(n.rule_name,"没有填写规则")),void(e=!0);n.rule_info.proprety_condition.length>0&&n.rule_info.proprety_condition.forEach((function(r){if(!r.value)return t.$message.warning("".concat(n.rule_name,"用户属性满足的值没有填写")),void(e=!0)}))})),e},handleButtonClick:function(t){this.selectRules=this.form.filter_rules[t],this.typeKey++,this.$forceUpdate()},tagFun:function(t){var e=this;Object(o["k"])(t).then((function(t){e.$message.success("创建标签成功"),e.$router.go(-1)})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}))},putTagFun:function(t){var e=this;Object(o["k"])(t).then((function(t){e.$router.go(-1)})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}))},deleteRule:function(t){if(this.form.filter_rules.length<=1)this.$message.error("There has to be a rule");else{this.form.filter_rules.splice(t,1);var e=t-1;t-1<=0&&(e=0),this.selectRules=this.form.filter_rules[e],this.typeKey++}},copyRule:function(){},filterOption:function(t,e){return e.componentOptions.children[0].text.indexOf(t)>-1},changeTime:function(t){t.startAndEnd.length>0&&(t.start_time=t.startAndEnd[0].format("YYYY-MM-DD"),t.end_time=t.startAndEnd[1].format("YYYY-MM-DD"))},changeProprety:function(t,e){var n=this.propretyList.find((function(e){return e.id===t}));this.selectRules.rule_info.proprety_condition[e].proprety_id=n.id,Object.assign(this.selectRules.rule_info.proprety_condition[e],n,{value:""}),this.typeKey++},addEvent:function(t){t.actions.push({action_rank:t.actions.length+1,action_id:this.actionList[0].id})},deleteAction:function(t,e){t.actions.splice(e,1)}}},y=g,_=(n("18dd"),Object(d["a"])(y,r,a,!1,null,"50ff3a50",null));e["default"]=_.exports}}]);