(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-34a00b1a"],{"503f":function(t,e,n){"use strict";n("e7c8")},6981:function(t,e,n){"use strict";n("d7a5")},8027:function(t,e,n){"use strict";n.r(e);n("b0c0");var i=function(){var t=this,e=t._self._c;return e("div",[e("a-page-header",{staticClass:"page-header background-white",attrs:{title:t.title},on:{back:function(e){return t.$router.go(-1)}}}),e("section",{staticClass:"section"},[e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,"label-col":{span:3},"wrapper-col":{span:14},form:t.form,layout:"horizontal",rules:t.rules}},[e("p",{staticClass:"base-info"},[t._v("Basic Information")]),e("a-form-model-item",{attrs:{label:"Segment Display Name",prop:"group_name"}},[e("a-input",{attrs:{placeholder:"place input Segment Display Name"},model:{value:t.form.group_name,callback:function(e){t.$set(t.form,"group_name",e)},expression:"form.group_name"}})],1),e("a-form-model-item",{attrs:{label:"Memo（Optional）"}},[e("a-textarea",{attrs:{placeholder:"place input"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),e("p",{staticClass:"base-info"},[t._v("Segment Rules")]),e("a-form-model-item",{attrs:{label:"Build Rule"}},[e("div",{staticClass:"rule-wrap"},[t.selectRules.rule_info?e("a-collapse",{staticClass:"collapse",attrs:{activeKey:t.activeKey}},[e("a-collapse-panel",{key:"1",attrs:{header:"User Attributes Meet"}},[t.id?t._e():e("div",{staticClass:"icon-add",attrs:{slot:"extra"},on:{click:function(e){return e.stopPropagation(),t.addAttr(t.selectRules.rule_info.proprety_condition,t.proprety_condition,1)}},slot:"extra"},[e("a-icon",{attrs:{type:"plus-circle"}}),t._v(" Add ")],1),e("ul",{staticClass:"list-wrap"},t._l(t.selectRules.rule_info.proprety_condition,(function(n,i){return e("li",{key:i},[e("a-select",{staticClass:"select",attrs:{"show-search":"",filterOption:t.filterOption,placeholder:"place select"},on:{change:function(e){return t.changeProprety(n.proprety_id,i)}},model:{value:n.proprety_id,callback:function(e){t.$set(n,"proprety_id",e)},expression:"list.proprety_id"}},t._l(t.propretyList,(function(n,i){return e("a-select-option",{key:i,attrs:{value:n.id}},[t._v(" "+t._s(n.cname)+" ")])})),1),e("a-select",{staticClass:"select",attrs:{placeholder:"place select"},model:{value:n.condition,callback:function(e){t.$set(n,"condition",e)},expression:"list.condition"}},t._l(n.requireList,(function(n,i){return e("a-select-option",{key:i,attrs:{value:n.type}},[t._v(" "+t._s(n.name)+" ")])})),1),e("TypeList",{key:t.typeKey,staticClass:"type-list",attrs:{type:n.dataType,dataList:n.propertiesExtendVoList},model:{value:n.value,callback:function(e){t.$set(n,"value",e)},expression:"list.value"}}),e("a-tooltip",{attrs:{title:"Recommended words are attribute keywords from last 7 days (display up to 20 keywords), not all keywords available. You can enter a keyword and press Enter to complete."}},[e("a-icon",{staticClass:"icon",attrs:{type:"question-circle"}})],1),e("a-icon",{staticClass:"minus icon",attrs:{type:"minus-circle"},on:{click:function(e){return t.decrease(t.selectRules.rule_info.proprety_condition,i)}}})],1)})),0)])],1):t._e()],1)]),e("a-form-model-item",{attrs:{label:"Status"}},[e("a-radio-group",{attrs:{name:"radioGroup"},model:{value:t.form.task_type,callback:function(e){t.$set(t.form,"task_type",e)},expression:"form.task_type"}},[e("a-radio",{attrs:{value:0}},[t._v(" enable ")]),e("a-radio",{attrs:{value:1}},[t._v(" disable ")])],1)],1),e("a-form-model-item",{staticStyle:{"margin-left":"150px"}},[t.isEdit?t._e():e("a-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.buildTag}},[t._v("Create")]),e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("cancel")])],1)],1)],1)],1)},r=[],o=n("5530"),a=(n("a9e3"),n("d81d"),n("d3b7"),n("159b"),n("7db0"),n("3ca3"),n("ddb0"),n("a434"),n("a15b"),n("b64b"),n("d28d")),s=n("4820"),c=function(){var t=this,e=t._self._c;return e("div",["LIST"===t.type?e("a-select",{staticClass:"select",attrs:{"token-separators":[","],mode:"tags",placeholder:"place select"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}},t._l(t.dataList,(function(n,i){return e("a-select-option",{key:i,attrs:{value:n.extendValue}},[t._v(" "+t._s(n.extendValue)+" ")])})),1):t._e(),"STRING"===t.type?e("a-input",{staticClass:"select",attrs:{placeholder:"place input"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e(),"year"===t.type?e("a-select",{staticClass:"select",attrs:{placeholder:"请选择"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}},t._l(100,(function(n,i){return e("a-select-option",{key:i,attrs:{value:t.time-i}},[t._v(" "+t._s(t.time-i)+" ")])})),1):t._e(),"NUMBER"===t.type?e("a-input-number",{staticClass:"select",attrs:{placeholder:"place input"},on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e(),"DATETIME"===t.type?e("a-date-picker",{staticClass:"select",attrs:{format:"YYYY-MM-DD HH:mm:ss"},on:{change:function(e){return t.changeEnum("time")}},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e(),"DATETIME2"===t.type?e("a-date-picker",{staticClass:"select",on:{change:t.changeEnum},model:{value:t.information,callback:function(e){t.information=e},expression:"information"}}):t._e()],1)},u=[],l={name:"TypeList",components:{},props:{value:{type:[Number,String,Object],default:""},type:{type:String,default:""},dataList:{type:Array,default:function(){return[]}}},data:function(){return{information:void 0,time:void 0}},created:function(){this.time=this.$moment().format("YYYY"),this.information=this.value||void 0},methods:{changeEnum:function(t){var e;"time"==t?this.$emit("input",null===(e=this.information)||void 0===e?void 0:e.format("YYYY-MM-DD HH:mm:ss")):this.$emit("input",this.information)},update:function(){this.$forceUpdate()}}},d=l,f=(n("dd46"),n("2877")),p=Object(f["a"])(d,c,u,!1,null,"ab261fc0",null),m=p.exports,h=n("c1df"),_=n.n(h),g=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"container"}})},y=[],v=n("99afe"),b={name:"PreChat",components:{},props:{countData:{type:Object,default:function(){return{percent:0}}}},data:function(){return{liquidPlot:{}}},watch:{countData:{handler:function(){this.changeChat()},deep:!0}},mounted:function(){this.rendChat()},methods:{rendChat:function(){this.liquidPlot=new v["Liquid"]("container",{percent:this.countData.percent||0,outline:{border:4,distance:8},wave:{length:128}}),this.liquidPlot.render()},changeChat:function(){this.liquidPlot.options.percent=this.countData.percent||0,this.liquidPlot.render()}}},k=b,O=(n("6981"),Object(f["a"])(k,g,y,!1,null,"e4b5daa8",null)),C=O.exports,Y={name:"BuildGroup",components:{TypeList:m,PreChat:C},data:function(){return{loading:!1,activeKey:[],typeKey:1,dataType:{enum:"",str:"",year:"",int:"",datetime:"",date:""},form:{group_name:void 0,limit:void 0,remark:void 0,task_type:1,filter_rules:[{rule_name:"分层1",rule_info:{proprety_condition:[],action_condition:[],action_list:[]}}]},selectRules:{},typeList:[{test:"决策标签",value:1},{test:"消费类标签",value:2},{test:"会员信息",value:3},{test:"活跃类标签",value:4},{test:"未分类",value:5}],ruleIndex:0,tagList:[],rules:{group_name:[{required:!0,message:"请填写分类名"}]},propretyList:[],actionList:[],proprety_condition:{hierarchyId:void 0,options:void 0,id:void 0,propertiesId:void 0,targetValue:void 0,condition:void 0},action_condition:{action_id:"",is_done:"true",start_time:_()().format("YYYY-MM-DD"),end_time:_()().format("YYYY-MM-DD"),startAndEnd:[_()(),_()()]},action_list:{start_time:_()().format("YYYY-MM-DD"),end_time:_()().format("YYYY-MM-DD"),startAndEnd:[_()(),_()()],actions:[{action_rank:1,action_id:""},{action_rank:2,action_id:""}]},countData:{},isSearchContentEdit:!0,formOrigin:{}}},created:function(){this.id?this.detailTagFun():this.init()},computed:{id:function(){return this.$route.query.id},isEdit:function(){return this.$route.query.isEdit},title:function(){return this.id?"User Group":"Create User Group"}},watch:{selectRules:{handler:function(){JSON.stringify(this.formOrigin)==JSON.stringify(this.selectRules)?this.isSearchContentEdit=!0:(this.isSearchContentEdit=!1,this.countData={})},deep:!0}},methods:{detailTagFun:function(){var t=this;Object(s["i"])({id:Number(this.id)}).then((function(e){var n,i=e.data;i&&(t.form={group_name:i.groupName,limit:i.groupNum,remark:i.remark,task_type:Number(i.status),filter_rules:[{rule_name:"",rule_id:"",rule_info:{proprety_condition:null===(n=i.ruleInsertDtoList)||void 0===n?void 0:n.map((function(e){return t.activeKey.indexOf("1")<0&&t.activeKey.push("1"),{hierarchyId:e.hierarchyId,condition:e.options,id:e.id,proprety_id:e.propertiesId,value:e.targetValue.indexOf(",")>0?e.targetValue.split(","):e.targetValue}}))}}]},t.init())})).catch((function(e){t.$message.error(e)}))},init:function(){var t=this,e=Object(a["j"])().then((function(e){t.tagList=e.data})).catch((function(e){t.$message.error(e)})),n=Object(a["i"])().then((function(e){var n;if((null===(n=e.data)||void 0===n?void 0:n.length)>0){if(t.propretyList=e.data,t.id)return void t.form.filter_rules.forEach((function(e){e.rule_info.proprety_condition.forEach((function(e){var n=t.propretyList.find((function(t){return t.id===e.proprety_id}));null!==n&&void 0!==n&&n.id&&Object.assign(e,n)}))}));var i;t.proprety_condition.condition=null===(i=e.data[0].option)||void 0===i?void 0:i[0].name,Object.assign(t.proprety_condition,e.data[0])}})).catch((function(e){t.$message.error(e)})),i=Object(a["g"])().then((function(e){var n;if((null===(n=e.data)||void 0===n?void 0:n.length)>0){if(t.id)return void t.form.filter_rules.forEach((function(t){t.rule_info.proprety_condition.forEach((function(t){t.requireList=e.data}))}));t.proprety_condition.requireList=e.data}})).catch((function(e){t.$message.error(e)}));Promise.all([e,n,i]).then((function(){t.selectRules=t.form.filter_rules[0],t.formOrigin=JSON.parse(JSON.stringify(t.selectRules)),t.$forceUpdate()}))},addAttr:function(t,e,n){var i=this.activeKey.find((function(t){return t==n}));i||this.activeKey.push(n),t.push(JSON.parse(JSON.stringify(e)))},decrease:function(t,e){t.splice(e,1)},addRule:function(){this.form.filter_rules.push(Object(o["a"])(Object(o["a"])({},JSON.parse(JSON.stringify(this.form.filter_rules[0]))),{},{rule_name:"分层"+(this.form.filter_rules.length+1),rule_id:null})),this.selectRules=this.form.filter_rules[this.form.filter_rules.length-1]},buildTag:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;var n;if(!t.checkRule()){t.loading=!0;var i={groupName:t.form.group_name,remark:t.form.remark,groupNum:t.form.limit,status:t.form.task_type,ruleInsertDtoList:null===(n=t.form.filter_rules[0].rule_info.proprety_condition)||void 0===n?void 0:n.map((function(e){var n;return{options:e.condition,id:t.id?e.id:void 0,propertiesId:e.proprety_id,targetValue:"string"==typeof e.value?e.value:null===(n=e.value)||void 0===n?void 0:n.join(",")}}))};t.id?(i.group_id=t.id,t.putTagFun(i)):t.tagFun(i)}}))},checkRule:function(){var t=this,e=!1;return this.form.filter_rules.forEach((function(n){var i=Object.keys(n.rule_info),r=!0;if(i.forEach((function(t){var e;(null===(e=n.rule_info[t])||void 0===e?void 0:e.length)>0&&(r=!1)})),r)return t.$message.warning("最少填写一个规则"),void(e=!0);n.rule_info.proprety_condition.length>0&&n.rule_info.proprety_condition.forEach((function(n){if(!n.value)return t.$message.warning("用户属性满足的值没有填写"),void(e=!0)}))})),e},handleButtonClick:function(t){this.selectRules=this.form.filter_rules[t],this.typeKey++,this.$forceUpdate()},tagFun:function(t){var e=this;Object(s["g"])(t).then((function(t){e.$message.success("创建标签成功"),e.$router.go(-1)})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}))},putTagFun:function(t){var e=this;Object(s["j"])(t).then((function(t){e.$router.go(-1)})).catch((function(t){e.$message.error(t)})).finally((function(){e.loading=!1}))},deleteRule:function(t){this.form.filter_rules.splice(t,1);var e=t-1;t-1<=0&&(e=0),this.selectRules=this.form.filter_rules[e],this.typeKey++},copyRule:function(){},changeTime:function(t){t.startAndEnd.length>0&&(t.start_time=t.startAndEnd[0].format("YYYY-MM-DD"),t.end_time=t.startAndEnd[1].format("YYYY-MM-DD"))},changeProprety:function(t,e){var n=this.propretyList.find((function(e){return e.id===t}));this.selectRules.rule_info.proprety_condition[e].proprety_id=n.id,Object.assign(this.selectRules.rule_info.proprety_condition[e],n,{value:""}),this.typeKey++},addEvent:function(t){t.actions.push({action_rank:t.actions.length+1,action_id:this.actionList[0].id})},deleteAction:function(t,e){t.actions.splice(e,1)},filterOption:function(t,e){return e.componentOptions.children[0].text.indexOf(t)>-1},countPersonFun:function(){var t,e=this;if(!this.checkRule()){var n=Object(o["a"])({},null===(t=this.form.filter_rules)||void 0===t?void 0:t.map((function(t){var e,n,i;return{rule_name:t.rule_name,rule_id:t.rule_id,rule_info:{proprety_condition:null===(e=t.rule_info.proprety_condition)||void 0===e?void 0:e.map((function(t){return{proprety_id:t.proprety_id,condition:t.condition,value:t.value}})),action_condition:null===(n=t.rule_info.action_condition)||void 0===n?void 0:n.map((function(t){return{action_id:t.action_id,is_done:t.is_done,start_time:t.start_time,end_time:t.end_time}})),action_list:null===(i=t.rule_info.action_list)||void 0===i?void 0:i.map((function(t){return{start_time:t.start_time,end_time:t.end_time,actions:t.actions.map((function(t,e){return{action_rank:e+1,action_id:t.action_id}}))}}))}}}))[0].rule_info);Object(s["b"])(n).then((function(t){e.formOrigin=JSON.parse(JSON.stringify(e.selectRules)),e.isSearchContentEdit=!0,e.countData=t.data})).catch((function(t){e.$message.error(t)}))}}}},T=Y,j=(n("503f"),Object(f["a"])(T,i,r,!1,null,"40aab10e",null));e["default"]=j.exports},d28d:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"k",(function(){return s})),n.d(e,"i",(function(){return c})),n.d(e,"j",(function(){return u})),n.d(e,"d",(function(){return l})),n.d(e,"h",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"e",(function(){return p})),n.d(e,"f",(function(){return m})),n.d(e,"c",(function(){return h})),n.d(e,"g",(function(){return _}));var i=n("b775"),r={categories_tags:"/tbTagCategory/queryAllTagTree",category:"/tbTagCategory/add",searchCategory:"/tbTagCategory/queryAllTag",tag:"/tbUserTag/create",propreties:"/properties/listAll",actions:"/tag/actions",create:"/schedule/create",info:"/tbUserTag/queryById",tag_infos:"/tbTagResult/getTagHierarchyResult",downloadTag:"/tag/download",deleteTag:"/tag",detailTag:"/tag",putTag:"/tag",getAllOptions:"/properties/getAllOptions",changeStatus:"/tbUserTag/changeStatus"};function o(t){return Object(i["b"])({url:r.categories_tags,method:"get",params:t})}function a(t){return Object(i["b"])({url:r.category,method:"get",params:t})}function s(t){return Object(i["b"])({url:r.tag,method:"post",data:t})}function c(t){return Object(i["b"])({url:r.propreties,method:"post",data:t})}function u(t){return Object(i["b"])({url:r.searchCategory,method:"get",params:t})}function l(t){return Object(i["b"])({url:r.create,method:"post",data:t})}function d(t){return Object(i["b"])({url:r.info,method:"get",params:t})}function f(t){return Object(i["b"])({url:r.tag_infos,method:"post",data:t})}function p(t){return Object(i["b"])({url:r.deleteTag,method:"delete",params:t})}function m(t){return Object(i["b"])({url:r.downloadTag,method:"get",params:t,responseType:"blob"})}function h(t){return Object(i["b"])({url:r.changeStatus,method:"post",data:t})}function _(t){return Object(i["b"])({url:r.getAllOptions,method:"get",params:t})}},d7a5:function(t,e,n){},da5f:function(t,e,n){},dd46:function(t,e,n){"use strict";n("da5f")},e7c8:function(t,e,n){}}]);